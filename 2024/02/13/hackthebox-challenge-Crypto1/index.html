<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="hackthebox challenge刷题系列1"><meta name="keywords" content="密码学,ctf"><meta name="author" content="Alex"><meta name="copyright" content="Alex"><title>hackthebox challenge刷题系列1 | Alex's blog~</title><meta name="robots" content="noindex"><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '5.4.0'
} </script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Alex's blog~" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#BabyEncryption"><span class="toc-number">1.</span> <span class="toc-text">BabyEncryption</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Baby-Time-Capsule"><span class="toc-number">2.</span> <span class="toc-text">Baby Time Capsule</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-Last-Dance"><span class="toc-number">3.</span> <span class="toc-text">The Last Dance</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lost-Modulus"><span class="toc-number">4.</span> <span class="toc-text">Lost Modulus</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://pic4.zhimg.com/80/v2-5cb1e2bdc0644f9828029a94181f4542_1440w.jpg"></div><div class="author-info__name text-center">Alex</div><div class="author-info__description text-center">pwn</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">31</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">31</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">1</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://n0vice.top/">N0vice</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://snowywar.top/">魔法少女雪殇</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://l0ne1y.xyz/">L0ne1y</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://eeeeeeeeeeeeeeeea.cn/">eeeeeeeeeeeeeeeea</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://giles-one.github.io/">cat03</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://ulrica66666.github.io/">ulrica66666</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://i.loli.net/2021/03/05/xqReclzVihJKGUu.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Alex's blog~</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">文章</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">hackthebox challenge刷题系列1</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2024-02-13</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="BabyEncryption"><a href="#BabyEncryption" class="headerlink" title="BabyEncryption"></a>BabyEncryption</h2><p>题目脚本如下，并且提供了msg.enc：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> MSG</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encryption</span>(<span class="params">msg</span>):</span></span><br><span class="line">    ct = []</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> msg:</span><br><span class="line">        ct.append((<span class="number">123</span> * char + <span class="number">18</span>) % <span class="number">256</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(ct)</span><br><span class="line"></span><br><span class="line">ct = encryption(MSG)</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;./msg.enc&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">f.write(ct.<span class="built_in">hex</span>())</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>
<p>求123关于256的逆元，解密脚本如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">secret = gmpy2.invert(<span class="number">123</span>, <span class="number">256</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params">msg</span>):</span></span><br><span class="line">  flag = []</span><br><span class="line">  <span class="keyword">for</span> char <span class="keyword">in</span> msg:</span><br><span class="line">    char = (secret * (char - <span class="number">18</span>)) % <span class="number">256</span></span><br><span class="line">    flag.append(char)</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">bytes</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;msg.enc&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    c = <span class="built_in">bytes</span>.fromhex(f.read())</span><br><span class="line"></span><br><span class="line">flag = decode(c)</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ python exp.py</span><br><span class="line">b<span class="string">&#x27;Th3 nucl34r w1ll 4rr1v3 0n fr1d4y.\nHTB&#123;l00k_47_y0u_r3v3rs1ng_3qu4710n5_c0ngr475&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="Baby-Time-Capsule"><a href="#Baby-Time-Capsule" class="headerlink" title="Baby Time Capsule"></a>Baby Time Capsule</h2><p>题目提供了server.py，脚本如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, getPrime</span><br><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">FLAG = <span class="string">b&#x27;HTB&#123;--REDACTED--&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimeCapsule</span>():</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, msg</span>):</span></span><br><span class="line">        self.msg = msg</span><br><span class="line">        self.bit_size = <span class="number">1024</span></span><br><span class="line">        self.e = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_get_new_pubkey</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            p = getPrime(self.bit_size // <span class="number">2</span>)</span><br><span class="line">            q = getPrime(self.bit_size // <span class="number">2</span>)</span><br><span class="line">            n = p * q</span><br><span class="line">            phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="built_in">pow</span>(self.e, -<span class="number">1</span>, phi)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> ValueError:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> n, self.e</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_new_time_capsule</span>(<span class="params">self</span>):</span></span><br><span class="line">        n, e = self._get_new_pubkey()</span><br><span class="line">        m = bytes_to_long(self.msg)</span><br><span class="line">        m = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;time_capsule&quot;</span>: <span class="string">f&quot;<span class="subst">&#123;m:X&#125;</span>&quot;</span>, <span class="string">&quot;pubkey&quot;</span>: [<span class="string">f&quot;<span class="subst">&#123;n:X&#125;</span>&quot;</span>, <span class="string">f&quot;<span class="subst">&#123;e:X&#125;</span>&quot;</span>]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span>(<span class="params">req</span>):</span></span><br><span class="line">    time_capsule = TimeCapsule(FLAG)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            req.sendall(</span><br><span class="line">                <span class="string">b&#x27;Welcome to Qubit Enterprises. Would you like your own time capsule? (Y/n) &#x27;</span></span><br><span class="line">            )</span><br><span class="line">            msg = req.recv(<span class="number">4096</span>).decode().strip().upper()</span><br><span class="line">            <span class="keyword">if</span> msg == <span class="string">&#x27;Y&#x27;</span> <span class="keyword">or</span> msg == <span class="string">&#x27;YES&#x27;</span>:</span><br><span class="line">                capsule = time_capsule.get_new_time_capsule()</span><br><span class="line">                req.sendall(json.dumps(capsule).encode() + <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">            <span class="keyword">elif</span> msg == <span class="string">&#x27;N&#x27;</span> <span class="keyword">or</span> msg == <span class="string">&quot;NO&quot;</span>:</span><br><span class="line">                req.sendall(<span class="string">b&#x27;Thank you, take care\n&#x27;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                req.sendall(<span class="string">b&#x27;I\&#x27;m sorry I don\&#x27;t understand\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="comment"># Socket closed, bail</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTCPRequestHandler</span>(<span class="params">socketserver.BaseRequestHandler</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span>(<span class="params">self</span>):</span></span><br><span class="line">        req = self.request</span><br><span class="line">        challenge(req)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadingTCPServer</span>(<span class="params">socketserver.ThreadingMixIn, socketserver.TCPServer</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    socketserver.TCPServer.allow_reuse_address = <span class="literal">True</span></span><br><span class="line">    server = ThreadingTCPServer((<span class="string">&quot;0.0.0.0&quot;</span>, <span class="number">1337</span>), MyTCPRequestHandler)</span><br><span class="line">    server.serve_forever()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>TimeCapsule这个类的构造函数中设置了msg和素数比特大小以及指数e的值，然后_get_new_pubkey用来生成公钥，要求指数e在模phi下存在逆，最后返回n和e作为公钥。get_new_time_capsule函数获取公钥后，将msg转为长整数，加密后得到密文。其实TimeCapsule就是实现了RSA加密，密文内容就是flag。</p>
<p>每次连接服务器的时候，获取到的n都不同，但是e一样，这就形成了一组同余方程组，可以使用中国剩余定理求解：</p>
<script type="math/tex; mode=display">
\begin{cases}
m^e \equiv c_1 \pmod{n_1} \\
m^e \equiv c_2 \pmod{n_2} \\
\quad \vdots \\
m^e \equiv c_n \pmod{n_n}
\end{cases}</script><p>设：$n = n_1 \cdot n_2 \cdot \ldots \cdot n_n$</p>
<p> $N_i = \frac{n}{n_i}$，然后找到 $N_i$ 对应的模数的乘法逆元素，记为 $x_i$，满足 $N_i \cdot x_i \equiv 1 \pmod{n_i}$</p>
<p>然后计算：$m_i = N_i \cdot x_i \pmod{n_i}$</p>
<p>得到解：$ m^e \equiv \left(\sum_{i=1}^{n} (c_i \cdot m_i)\right) \pmod{n} $</p>
<p>exp如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> sympy.ntheory.modular <span class="keyword">import</span> crt</span><br><span class="line"><span class="keyword">from</span> sympy.simplify.simplify <span class="keyword">import</span> nthroot</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&#x27;94.237.53.58&#x27;</span>, <span class="number">52665</span>)</span><br><span class="line"></span><br><span class="line">c = []</span><br><span class="line">pub = []</span><br><span class="line">e = <span class="number">5</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">&#x27;Welcome to Qubit Enterprises. Would you like your own time capsule? (Y/n)&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>)</span><br><span class="line">    data = io.recvline()</span><br><span class="line">    data = json.loads(data)</span><br><span class="line">    cipher = <span class="built_in">int</span>(data[<span class="string">&#x27;time_capsule&#x27;</span>], <span class="number">16</span>)</span><br><span class="line">    n = <span class="built_in">int</span>(data[<span class="string">&#x27;pubkey&#x27;</span>][<span class="number">0</span>], <span class="number">16</span>)</span><br><span class="line">    c.append(cipher)</span><br><span class="line">    pub.append(n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = crt(pub, c, check=<span class="literal">True</span>)</span><br><span class="line">flag = long_to_bytes(nthroot(flag[<span class="number">0</span>], e))</span><br><span class="line">print(flag)</span><br><span class="line"></span><br><span class="line">io.close()</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ python exp.py</span><br><span class="line">[+] Opening connection to 94.237.53.58 on port 52665: Done</span><br><span class="line">HTB&#123;t3h_FuTUr3_15_bR1ghT_1_H0p3_y0uR3_W34r1nG_5h4d35!&#125;</span><br></pre></td></tr></table></figure>
<h2 id="The-Last-Dance"><a href="#The-Last-Dance" class="headerlink" title="The Last Dance"></a>The Last Dance</h2><p>题目描述：</p>
<blockquote>
<p>To be accepted into the upper class of the Berford Empire, you had to attend the annual Cha-Cha Ball at the High Court. Little did you know that among the many aristocrats invited, you would find a burned enemy spy. Your goal quickly became to capture him, which you succeeded in doing after putting something in his drink. Many hours passed in your agency’s interrogation room, and you eventually learned important information about the enemy agency’s secret communications. Can you use what you learned to decrypt the rest of the messages?</p>
</blockquote>
<p>题目中的source.py内容如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> ChaCha20</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> FLAG</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encryptMessage</span>(<span class="params">message, key, nonce</span>):</span></span><br><span class="line">    cipher = ChaCha20.new(key=key, nonce=iv)</span><br><span class="line">    ciphertext = cipher.encrypt(message)</span><br><span class="line">    <span class="keyword">return</span> ciphertext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">writeData</span>(<span class="params">data</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;out.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    message = <span class="string">b&quot;Our counter agencies have intercepted your messages and a lot &quot;</span></span><br><span class="line">    message += <span class="string">b&quot;of your agent&#x27;s identities have been exposed. In a matter of &quot;</span></span><br><span class="line">    message += <span class="string">b&quot;days all of them will be captured&quot;</span></span><br><span class="line"></span><br><span class="line">    key, iv = os.urandom(<span class="number">32</span>), os.urandom(<span class="number">12</span>)</span><br><span class="line"></span><br><span class="line">    encrypted_message = encryptMessage(message, key, iv)</span><br><span class="line">    encrypted_flag = encryptMessage(FLAG, key, iv)</span><br><span class="line"></span><br><span class="line">    data = iv.<span class="built_in">hex</span>() + <span class="string">&quot;\n&quot;</span> + encrypted_message.<span class="built_in">hex</span>() + <span class="string">&quot;\n&quot;</span> + encrypted_flag.<span class="built_in">hex</span>()</span><br><span class="line">    writeData(data)</span><br></pre></td></tr></table></figure>
<p>out.txt内容如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">c4a66edfe80227b4fa24d431</span><br><span class="line">7aa34395a258f5893e3db1822139b8c1f04cfab9d757b9b9cca57e1df33d093f07c7f06e06bb6293676f9060a838ea138b6bc9f20b08afeb73120506e2ce7b9b9dcd9e4a421584cfaba2481132dfbdf4216e98e3facec9ba199ca3a97641e9ca9782868d0222a1d7c0d3119b867edaf2e72e2a6f7d344df39a14edc39cb6f960944ddac2aaef324827c36cba67dcb76b22119b43881a3f1262752990</span><br><span class="line">7d8273ceb459e4d4386df4e32e1aecc1aa7aaafda50cb982f6c62623cf6b29693d86b15457aa76ac7e2eef6cf814ae3a8d39c7</span><br></pre></td></tr></table></figure>
<p>用了ChaCha20流密码对消息进行了加密，但是可以发现的是对message加密的密钥和iv，与对flag加密的密钥和iv是相同的，并且题目中还提供了iv的值。</p>
<p>ChaCha20的核心加密逻辑是将明文与一个生成的数据进行异或，得到密文数据；解密时将密文数据再次与这个数据进行异或便能恢复明文。</p>
<p>根据题目脚本可以得到：</p>
<script type="math/tex; mode=display">
message \oplus KEY = c1</script><script type="math/tex; mode=display">
FLAG \oplus KEY = c2</script><p>将上述两个式子异或，得到：</p>
<script type="math/tex; mode=display">
message \oplus KEY \oplus FLAG \oplus KEY = message \oplus FLAG = c1 \oplus c2</script><p>从而：</p>
<script type="math/tex; mode=display">
FLAG = c1 \oplus c2 \oplus message</script><p>exp如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span>(<span class="params">message, p1, p2</span>):</span></span><br><span class="line">    p1_bytes = <span class="built_in">bytes</span>.fromhex(p1)</span><br><span class="line">    p2_bytes = <span class="built_in">bytes</span>.fromhex(p2)</span><br><span class="line">    xor1 = <span class="built_in">bytes</span>(a ^ b <span class="keyword">for</span> a,b <span class="keyword">in</span> <span class="built_in">zip</span>(message, p1_bytes))</span><br><span class="line">    xor2 = <span class="built_in">bytes</span>(a ^ b <span class="keyword">for</span> a,b <span class="keyword">in</span> <span class="built_in">zip</span>(xor1, p2_bytes))</span><br><span class="line">    <span class="keyword">return</span> xor2</span><br><span class="line"></span><br><span class="line">message = <span class="string">b&quot;Our counter agencies have intercepted your messages and a lot &quot;</span></span><br><span class="line">message += <span class="string">b&quot;of your agent&#x27;s identities have been exposed. In a matter of &quot;</span></span><br><span class="line">message += <span class="string">b&quot;days all of them will be captured&quot;</span></span><br><span class="line"></span><br><span class="line">c1 = <span class="string">&quot;7aa34395a258f5893e3db1822139b8c1f04cfab9d757b9b9cca57e1df33d093f07c7f06e06bb6293676f9060a838ea138b6bc9f20b08afeb73120506e2ce7b9b9dcd9e4a421584cfaba2481132dfbdf4216e98e3facec9ba199ca3a97641e9ca9782868d0222a1d7c0d3119b867edaf2e72e2a6f7d344df39a14edc39cb6f960944ddac2aaef324827c36cba67dcb76b22119b43881a3f1262752990&quot;</span></span><br><span class="line">c2 = <span class="string">&quot;7d8273ceb459e4d4386df4e32e1aecc1aa7aaafda50cb982f6c62623cf6b29693d86b15457aa76ac7e2eef6cf814ae3a8d39c7&quot;</span></span><br><span class="line"></span><br><span class="line">flag = xor(message, c1, c2)</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ python exp.py</span><br><span class="line">b<span class="string">&#x27;HTB&#123;und3r57AnD1n9_57R3aM_C1PH3R5_15_51mPl3_a5_7Ha7&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="Lost-Modulus"><a href="#Lost-Modulus" class="headerlink" title="Lost Modulus"></a>Lost Modulus</h2><p>题目描述：</p>
<blockquote>
<p>I encrypted a secret message with RSA but I lost the modulus. Can you help me recover it?</p>
</blockquote>
<p>challenge.py内容如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, long_to_bytes, inverse</span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).read().strip().encode()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RSA</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.p = getPrime(<span class="number">512</span>)</span><br><span class="line">        self.q = getPrime(<span class="number">512</span>)</span><br><span class="line">        self.e = <span class="number">3</span></span><br><span class="line">        self.n = self.p * self.q</span><br><span class="line">        self.d = inverse(self.e, (self.p-<span class="number">1</span>)*(self.q-<span class="number">1</span>))</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">self, data: <span class="built_in">bytes</span></span>) -&gt; bytes:</span></span><br><span class="line">        pt = <span class="built_in">int</span>(data.<span class="built_in">hex</span>(), <span class="number">16</span>)</span><br><span class="line">        ct = <span class="built_in">pow</span>(pt, self.e, self.n)</span><br><span class="line">        <span class="keyword">return</span> long_to_bytes(ct)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">self, data: <span class="built_in">bytes</span></span>) -&gt; bytes:</span></span><br><span class="line">        ct = <span class="built_in">int</span>(data.<span class="built_in">hex</span>(), <span class="number">16</span>)</span><br><span class="line">        pt = <span class="built_in">pow</span>(ct, self.d, self.n)</span><br><span class="line">        <span class="keyword">return</span> long_to_bytes(pt)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    crypto = RSA()</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&#x27;Flag:&#x27;</span>, crypto.encrypt(flag).<span class="built_in">hex</span>())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>output.txt内容如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Flag: 05c61636499a82088bf4388203a93e67bf046f8c49f62857681ec9aaaa40b4772933e0abc83e938c84ff8e67e5ad85bd6eca167585b0cc03eb1333b1b1462d9d7c25f44e53bcb568f0f05219c0147f7dc3cbad45dec2f34f03bcadcbba866dd0c566035c8122d68255ada7d18954ad604965</span><br></pre></td></tr></table></figure>
<p>可以发现脚本中的e为3，由于：</p>
<script type="math/tex; mode=display">
C \equiv m^e \pmod N,\quad \text{且}e=3</script><p>则有：</p>
<script type="math/tex; mode=display">
m^3 = c + k\times N</script><p>即：</p>
<script type="math/tex; mode=display">
m = \sqrt[3]{c + k\times N}</script><p>爆破k即可，如果m的三次方小于N，则k=0。</p>
<p>解题脚本如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy.simplify.simplify <span class="keyword">import</span> nthroot</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;05c61636499a82088bf4388203a93e67bf046f8c49f62857681ec9aaaa40b4772933e0abc83e938c84ff8e67e5ad85bd6eca167585b0cc03eb1333b1b1462d9d7c25f44e53bcb568f0f05219c0147f7dc3cbad45dec2f34f03bcadcbba866dd0c566035c8122d68255ada7d18954ad604965&quot;</span></span><br><span class="line">flag = <span class="built_in">int</span>(flag, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">flag = long_to_bytes(nthroot(flag, <span class="number">3</span>))</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ python exp.py</span><br><span class="line">b<span class="string">&#x27;HTB&#123;n3v3r_us3_sm4ll_3xp0n3n7s_f0r_rs4&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<!-- flag of hidden posts --></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Alex</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2024/02/13/hackthebox-challenge-Crypto1/">http://example.com/2024/02/13/hackthebox-challenge-Crypto1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com">Alex's blog~</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/">密码学</a><a class="post-meta__tags" href="/tags/ctf/">ctf</a></div><nav id="pagination"></nav></div></div><footer class="footer-bg" style="background-image: url(https://i.loli.net/2021/03/05/xqReclzVihJKGUu.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2021.03.05 - 2025 By Alex</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>